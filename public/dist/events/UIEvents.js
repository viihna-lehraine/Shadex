// File: events/UIEvents.js
import { EventManager } from './EventManager.js';
import { data } from '../config/index.js';
const classes = data.dom.classes;
const ids = data.dom.ids;
export class UIEvents {
    paletteManager;
    services;
    utils;
    log;
    errors;
    elements;
    constructor(paletteManager, services, utils) {
        this.paletteManager = paletteManager;
        this.services = services;
        this.utils = utils;
        this.services = services;
        this.errors = services.errors;
        this.utils = utils;
        this.log = this.services.log;
        this.paletteManager = paletteManager;
        const validatedElements = this.utils.dom.getValidatedDOMElements(ids);
        if (!validatedElements) {
            throw new Error(`Critical UI elements not found. Application cannot start`);
        }
        this.elements = validatedElements;
    }
    init() {
        this.errors.handle(() => {
            EventManager.add(document, 'click', event => {
                const target = event.target;
                // open modal
                if (target.matches(classes.modalTrigger)) {
                    const modal = this.utils.core.getElement(target.dataset.modalID);
                    modal?.classList.remove(classes.hidden);
                }
                // close modal when clicking outside
                if (target.matches(classes.modal)) {
                    target.classList.add(classes.hidden);
                }
            });
            // handle 'Esc' key press to close modals
            EventManager.add(document, 'keydown', ((event) => {
                if (event.key === 'Escape') {
                    this.utils.core
                        .getAllElements(classes.modal)
                        .forEach(modal => modal.classList.add(classes.hidden));
                }
            }));
        }, 'Failed to initialize UI events');
    }
    initButtons() {
        this.errors.handle(() => {
            const addButtonEvent = (button, logMessage, action) => {
                if (!button)
                    return;
                EventManager.add(button, 'click', (e) => {
                    e.preventDefault();
                    this.log(logMessage, 'debug');
                    action?.();
                });
            };
            addButtonEvent(this.elements.btns.desaturate, 'Desaturate button clicked', () => {
                this.log('Desaturation logic not implemented!', 'warn');
            });
            addButtonEvent(this.elements.btns.export, 'Export button clicked', () => {
                this.log('Export logic not implemented!', 'debug');
            });
            addButtonEvent(this.elements.btns.generate, 'Generate button clicked', () => {
                this.paletteManager.renderNewPalette();
                this.log('New palette generated and rendered', 'debug');
            });
            EventManager.add(document, 'click', this.handleWindowClick.bind(this));
        }, 'Failed to initialize buttons');
    }
    attachTooltipListener(id, tooltipText) {
        this.errors.handle(() => {
            const element = this.utils.core.getElement(id);
            if (!element)
                return;
            EventManager.add(element, 'mouseenter', () => this.utils.dom.createTooltip(element, tooltipText));
            EventManager.add(element, 'mouseleave', () => this.utils.dom.removeTooltip(element));
        }, `Failed to attach tooltip listener for ${id}`);
    }
    handleWindowClick(event) {
        this.errors.handle(() => {
            const target = event.target;
            if (target === this.elements.divs.helpMenu) {
                this.elements.divs.helpMenu.classList.add(classes.hidden);
            }
            if (target === this.elements.divs.historyMenu) {
                this.elements.divs.historyMenu.classList.add(classes.hidden);
            }
        }, 'Failed to handle window click');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVUlFdmVudHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZXZlbnRzL1VJRXZlbnRzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDJCQUEyQjtBQU8zQixPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFFakQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTFDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO0FBQ2pDLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO0FBRXpCLE1BQU0sT0FBTyxRQUFRO0lBTVg7SUFDQTtJQUNBO0lBUEQsR0FBRyxDQUEyQjtJQUM5QixNQUFNLENBQThCO0lBQ3BDLFFBQVEsQ0FBYztJQUU5QixZQUNTLGNBQThCLEVBQzlCLFFBQTJCLEVBQzNCLEtBQXlCO1FBRnpCLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixhQUFRLEdBQVIsUUFBUSxDQUFtQjtRQUMzQixVQUFLLEdBQUwsS0FBSyxDQUFvQjtRQUVqQyxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7UUFDOUIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQztRQUM3QixJQUFJLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztRQUVyQyxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLHVCQUF1QixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RFLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3hCLE1BQU0sSUFBSSxLQUFLLENBQ2QsMERBQTBELENBQzFELENBQUM7UUFDSCxD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Q0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMzRCxDQUFDO1lBRUQsSUFBSSxNQUFNLEtBQUssSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQy9DLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUM5RCxDQUFDO1FBQ0YsQ0FBQyxFQUFFLCtCQUErQixDQUFDLENBQUM7SUFDckMsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogZXZlbnRzL1VJRXZlbnRzLmpzXG5cbmltcG9ydCB7XG5cdERPTUVsZW1lbnRzLFxuXHRTZXJ2aWNlc0ludGVyZmFjZSxcblx0VXRpbGl0aWVzSW50ZXJmYWNlXG59IGZyb20gJy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IEV2ZW50TWFuYWdlciB9IGZyb20gJy4vRXZlbnRNYW5hZ2VyLmpzJztcbmltcG9ydCB7IFBhbGV0dGVNYW5hZ2VyIH0gZnJvbSAnLi4vcGFsZXR0ZS9QYWxldHRlTWFuYWdlci5qcyc7XG5pbXBvcnQgeyBkYXRhIH0gZnJvbSAnLi4vY29uZmlnL2luZGV4LmpzJztcblxuY29uc3QgY2xhc3NlcyA9IGRhdGEuZG9tLmNsYXNzZXM7XG5jb25zdCBpZHMgPSBkYXRhLmRvbS5pZHM7XG5cbmV4cG9ydCBjbGFzcyBVSUV2ZW50cyB7XG5cdHByaXZhdGUgbG9nOiBTZXJ2aWNlc0ludGVyZmFjZVsnbG9nJ107XG5cdHByaXZhdGUgZXJyb3JzOiBTZXJ2aWNlc0ludGVyZmFjZVsnZXJyb3JzJ107XG5cdHByaXZhdGUgZWxlbWVudHM6IERPTUVsZW1lbnRzO1xuXG5cdGNvbnN0cnVjdG9yKFxuXHRcdHByaXZhdGUgcGFsZXR0ZU1hbmFnZXI6IFBhbGV0dGVNYW5hZ2VyLFxuXHRcdHByaXZhdGUgc2VydmljZXM6IFNlcnZpY2VzSW50ZXJmYWNlLFxuXHRcdHByaXZhdGUgdXRpbHM6IFV0aWxpdGllc0ludGVyZmFjZVxuXHQpIHtcblx0XHR0aGlzLnNlcnZpY2VzID0gc2VydmljZXM7XG5cdFx0dGhpcy5lcnJvcnMgPSBzZXJ2aWNlcy5lcnJvcnM7XG5cdFx0dGhpcy51dGlscyA9IHV0aWxzO1xuXHRcdHRoaXMubG9nID0gdGhpcy5zZXJ2aWNlcy5sb2c7XG5cdFx0dGhpcy5wYWxldHRlTWFuYWdlciA9IHBhbGV0dGVNYW5hZ2VyO1xuXG5cdFx0Y29uc3QgdmFsaWRhdGVkRWxlbWVudHMgPSB0aGlzLnV0aWxzLmRvbS5nZXRWYWxpZGF0ZWRET01FbGVtZW50cyhpZHMpO1xuXHRcdGlmICghdmFsaWRhdGVkRWxlbWVudHMpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0YENyaXRpY2FsIFVJIGVsZW1lbnRzIG5vdCBmb3VuZC4gQXBwbGljYXRpb24gY2Fubm90IHN0YXJ0YFxuXHRcdFx0KTtcblx0XHR9XG5cdFx0dGhpcy5lbGVtZW50cyA9IHZhbGlkYXRlZEVsZW1lbnRzO1xuXHR9XG5cblx0cHVibGljIGluaXQoKTogdm9pZCB7XG5cdFx0dGhpcy5lcnJvcnMuaGFuZGxlKCgpID0+IHtcblx0XHRcdEV2ZW50TWFuYWdlci5hZGQoZG9jdW1lbnQsICdjbGljaycsIGV2ZW50ID0+IHtcblx0XHRcdFx0Y29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0XHRcdC8vIG9wZW4gbW9kYWxcblx0XHRcdFx0aWYgKHRhcmdldC5tYXRjaGVzKGNsYXNzZXMubW9kYWxUcmlnZ2VyKSkge1xuXHRcdFx0XHRcdGNvbnN0IG1vZGFsID0gdGhpcy51dGlscy5jb3JlLmdldEVsZW1lbnQoXG5cdFx0XHRcdFx0XHR0YXJnZXQuZGF0YXNldC5tb2RhbElEIVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0bW9kYWw/LmNsYXNzTGlzdC5yZW1vdmUoY2xhc3Nlcy5oaWRkZW4pO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gY2xvc2UgbW9kYWwgd2hlbiBjbGlja2luZyBvdXRzaWRlXG5cdFx0XHRcdGlmICh0YXJnZXQubWF0Y2hlcyhjbGFzc2VzLm1vZGFsKSkge1xuXHRcdFx0XHRcdHRhcmdldC5jbGFzc0xpc3QuYWRkKGNsYXNzZXMuaGlkZGVuKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vIGhhbmRsZSAnRXNjJyBrZXkgcHJlc3MgdG8gY2xvc2UgbW9kYWxzXG5cdFx0XHRFdmVudE1hbmFnZXIuYWRkKGRvY3VtZW50LCAna2V5ZG93bicsICgoZXZlbnQ6IEtleWJvYXJkRXZlbnQpID0+IHtcblx0XHRcdFx0aWYgKGV2ZW50LmtleSA9PT0gJ0VzY2FwZScpIHtcblx0XHRcdFx0XHR0aGlzLnV0aWxzLmNvcmVcblx0XHRcdFx0XHRcdC5nZXRBbGxFbGVtZW50cyhjbGFzc2VzLm1vZGFsKVxuXHRcdFx0XHRcdFx0LmZvckVhY2gobW9kYWwgPT4gbW9kYWwuY2xhc3NMaXN0LmFkZChjbGFzc2VzLmhpZGRlbikpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KSBhcyBFdmVudExpc3RlbmVyKTtcblx0XHR9LCAnRmFpbGVkIHRvIGluaXRpYWxpemUgVUkgZXZlbnRzJyk7XG5cdH1cblxuXHRwdWJsaWMgaW5pdEJ1dHRvbnMoKTogdm9pZCB7XG5cdFx0dGhpcy5lcnJvcnMuaGFuZGxlKCgpID0+IHtcblx0XHRcdGNvbnN0IGFkZEJ1dHRvbkV2ZW50ID0gKFxuXHRcdFx0XHRidXR0b246IEhUTUxFbGVtZW50IHwgbnVsbCxcblx0XHRcdFx0bG9nTWVzc2FnZTogc3RyaW5nLFxuXHRcdFx0XHRhY3Rpb24/OiAoKSA9PiB2b2lkXG5cdFx0XHQpID0+IHtcblx0XHRcdFx0aWYgKCFidXR0b24pIHJldHVybjtcblxuXHRcdFx0XHRFdmVudE1hbmFnZXIuYWRkKGJ1dHRvbiwgJ2NsaWNrJywgKGU6IEV2ZW50KSA9PiB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHRoaXMubG9nKGxvZ01lc3NhZ2UsICdkZWJ1ZycpO1xuXHRcdFx0XHRcdGFjdGlvbj8uKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fTtcblxuXHRcdFx0YWRkQnV0dG9uRXZlbnQoXG5cdFx0XHRcdHRoaXMuZWxlbWVudHMuYnRucy5kZXNhdHVyYXRlLFxuXHRcdFx0XHQnRGVzYXR1cmF0ZSBidXR0b24gY2xpY2tlZCcsXG5cdFx0XHRcdCgpID0+IHtcblx0XHRcdFx0XHR0aGlzLmxvZygnRGVzYXR1cmF0aW9uIGxvZ2ljIG5vdCBpbXBsZW1lbnRlZCEnLCAnd2FybicpO1xuXHRcdFx0XHR9XG5cdFx0XHQpO1xuXG5cdFx0XHRhZGRCdXR0b25FdmVudChcblx0XHRcdFx0dGhpcy5lbGVtZW50cy5idG5zLmV4cG9ydCxcblx0XHRcdFx0J0V4cG9ydCBidXR0b24gY2xpY2tlZCcsXG5cdFx0XHRcdCgpID0+IHtcblx0XHRcdFx0XHR0aGlzLmxvZygnRXhwb3J0IGxvZ2ljIG5vdCBpbXBsZW1lbnRlZCEnLCAnZGVidWcnKTtcblx0XHRcdFx0fVxuXHRcdFx0KTtcblxuXHRcdFx0YWRkQnV0dG9uRXZlbnQoXG5cdFx0XHRcdHRoaXMuZWxlbWVudHMuYnRucy5nZW5lcmF0ZSxcblx0XHRcdFx0J0dlbmVyYXRlIGJ1dHRvbiBjbGlja2VkJyxcblx0XHRcdFx0KCkgPT4ge1xuXHRcdFx0XHRcdHRoaXMucGFsZXR0ZU1hbmFnZXIucmVuZGVyTmV3UGFsZXR0ZSgpO1xuXHRcdFx0XHRcdHRoaXMubG9nKCdOZXcgcGFsZXR0ZSBnZW5lcmF0ZWQgYW5kIHJlbmRlcmVkJywgJ2RlYnVnJyk7XG5cdFx0XHRcdH1cblx0XHRcdCk7XG5cblx0XHRcdEV2ZW50TWFuYWdlci5hZGQoXG5cdFx0XHRcdGRvY3VtZW50LFxuXHRcdFx0XHQnY2xpY2snLFxuXHRcdFx0XHR0aGlzLmhhbmRsZVdpbmRvd0NsaWNrLmJpbmQodGhpcylcblx0XHRcdCk7XG5cdFx0fSwgJ0ZhaWxlZCB0byBpbml0aWFsaXplIGJ1dHRvbnMnKTtcblx0fVxuXG5cdHB1YmxpYyBhdHRhY2hUb29sdGlwTGlzdGVuZXIoaWQ6IHN0cmluZywgdG9vbHRpcFRleHQ6IHN0cmluZyk6IHZvaWQge1xuXHRcdHRoaXMuZXJyb3JzLmhhbmRsZSgoKSA9PiB7XG5cdFx0XHRjb25zdCBlbGVtZW50ID0gdGhpcy51dGlscy5jb3JlLmdldEVsZW1lbnQoaWQpO1xuXHRcdFx0aWYgKCFlbGVtZW50KSByZXR1cm47XG5cblx0XHRcdEV2ZW50TWFuYWdlci5hZGQoZWxlbWVudCwgJ21vdXNlZW50ZXInLCAoKSA9PlxuXHRcdFx0XHR0aGlzLnV0aWxzLmRvbS5jcmVhdGVUb29sdGlwKGVsZW1lbnQsIHRvb2x0aXBUZXh0KVxuXHRcdFx0KTtcblx0XHRcdEV2ZW50TWFuYWdlci5hZGQoZWxlbWVudCwgJ21vdXNlbGVhdmUnLCAoKSA9PlxuXHRcdFx0XHR0aGlzLnV0aWxzLmRvbS5yZW1vdmVUb29sdGlwKGVsZW1lbnQpXG5cdFx0XHQpO1xuXHRcdH0sIGBGYWlsZWQgdG8gYXR0YWNoIHRvb2x0aXAgbGlzdGVuZXIgZm9yICR7aWR9YCk7XG5cdH1cblxuXHRwcml2YXRlIGhhbmRsZVdpbmRvd0NsaWNrKGV2ZW50OiBFdmVudCk6IHZvaWQge1xuXHRcdHRoaXMuZXJyb3JzLmhhbmRsZSgoKSA9PiB7XG5cdFx0XHRjb25zdCB0YXJnZXQgPSBldmVudC50YXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG5cblx0XHRcdGlmICh0YXJnZXQgPT09IHRoaXMuZWxlbWVudHMuZGl2cy5oZWxwTWVudSkge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnRzLmRpdnMuaGVscE1lbnUuY2xhc3NMaXN0LmFkZChjbGFzc2VzLmhpZGRlbik7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0YXJnZXQgPT09IHRoaXMuZWxlbWVudHMuZGl2cy5oaXN0b3J5TWVudSkge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnRzLmRpdnMuaGlzdG9yeU1lbnUuY2xhc3NMaXN0LmFkZChjbGFzc2VzLmhpZGRlbik7XG5cdFx0XHR9XG5cdFx0fSwgJ0ZhaWxlZCB0byBoYW5kbGUgd2luZG93IGNsaWNrJyk7XG5cdH1cbn1cbiJdfQ==