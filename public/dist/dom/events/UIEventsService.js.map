{"version":3,"file":"UIEventsService.js","sources":["../../../../../src/dom/events/UIEventsService.ts"],"sourcesContent":["import {\n\tDOMElements,\n\tHelpers,\n\tServices,\n\tUIEventsContract,\n\tUtilities\n} from '../../types/index.js';\nimport { DOMStore } from '../DOMStore.js';\nimport { EventManager } from './EventManager.js';\nimport { PaletteRendererService } from '../PaletteRendererService.js';\nimport { domIndex } from '../../config/index.js';\n\nconst caller = 'UIEventsService';\nconst classes = domIndex.classes;\n\nexport class UIEventsService implements UIEventsContract {\n\tstatic #instance: UIEventsService | null = null;\n\n\t#domStore: DOMStore;\n\t#elements: DOMElements;\n\t#paletteRenderer: PaletteRendererService;\n\n\t#errors: Services['errors'];\n\t#helpers: Helpers;\n\t#log: Services['log'];\n\t#utils: Utilities;\n\n\tprivate constructor(\n\t\tdomStore: DOMStore,\n\t\thelpers: Helpers,\n\t\tpaletteRenderer: PaletteRendererService,\n\t\tservices: Services,\n\t\tutils: Utilities\n\t) {\n\t\ttry {\n\t\t\tservices.log.info(\n\t\t\t\t`Constructing UIEvents instance`,\n\t\t\t\t`${caller} constructor`\n\t\t\t);\n\n\t\t\tthis.#domStore = domStore;\n\t\t\tthis.#errors = services.errors;\n\t\t\tthis.#helpers = helpers;\n\t\t\tthis.#log = services.log;\n\t\t\tthis.#utils = utils;\n\n\t\t\tconst validatedElements = this.#domStore.getElements();\n\n\t\t\tif (!validatedElements) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`[${caller} constructor]: Critical UI elements not found. Application cannot start!`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis.#elements = validatedElements;\n\t\t\tthis.#paletteRenderer = paletteRenderer;\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller} constructor]: ${error instanceof Error ? error.message : error}`\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic getInstance(\n\t\tdomStore: DOMStore,\n\t\thelpers: Helpers,\n\t\tpaletteRenderer: PaletteRendererService,\n\t\tservices: Services,\n\t\tutils: Utilities\n\t): UIEventsService {\n\t\treturn services.errors.handleSync(() => {\n\t\t\tif (!UIEventsService.#instance) {\n\t\t\t\tservices.log.debug(\n\t\t\t\t\t'No UIEvents instance exists yet. Creating UIEvents instance',\n\t\t\t\t\t`${caller}.getInstance`\n\t\t\t\t);\n\n\t\t\t\tUIEventsService.#instance = new UIEventsService(\n\t\t\t\t\tdomStore,\n\t\t\t\t\thelpers,\n\t\t\t\t\tpaletteRenderer,\n\t\t\t\t\tservices,\n\t\t\t\t\tutils\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn UIEventsService.#instance;\n\t\t}, `[${caller}.getInstance]: Failed to get UIEvents instance.`);\n\t}\n\n\tinit(): void {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tEventManager.add(document, 'click', event => {\n\t\t\t\tconst target = event.target as HTMLElement;\n\n\t\t\t\t// open modal\n\t\t\t\tif (target.matches(classes.modalTrigger)) {\n\t\t\t\t\tconst modal = this.#helpers.dom.getElement(\n\t\t\t\t\t\ttarget.dataset.modalID!\n\t\t\t\t\t);\n\n\t\t\t\t\tmodal?.classList.remove(classes.hidden);\n\t\t\t\t}\n\n\t\t\t\t// close modal when clicking outside\n\t\t\t\tif (target.matches(classes.modal)) {\n\t\t\t\t\ttarget.classList.add(classes.hidden);\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// handle 'Esc' key press to close modals\n\t\t\tEventManager.add(document, 'keydown', ((event: KeyboardEvent) => {\n\t\t\t\tif (event.key === 'Escape') {\n\t\t\t\t\tthis.#helpers.dom\n\t\t\t\t\t\t.getAllElements(`.${classes.modal}`)\n\t\t\t\t\t\t.forEach(modal => modal.classList.add(classes.hidden));\n\t\t\t\t}\n\t\t\t}) as EventListener);\n\t\t}, `[${caller}]: Failed to initialize UI events.`);\n\t}\n\n\tinitButtons(): void {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tconst addButtonEvent = (\n\t\t\t\tbutton: HTMLElement | null,\n\t\t\t\tlogMessage: string,\n\t\t\t\taction?: () => void\n\t\t\t) => {\n\t\t\t\tif (!button) return;\n\n\t\t\t\tEventManager.add(button, 'click', (e: Event) => {\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tthis.#log.debug(logMessage, `${caller}.initButtons`);\n\n\t\t\t\t\taction?.();\n\t\t\t\t});\n\t\t\t};\n\n\t\t\taddButtonEvent(\n\t\t\t\tthis.#elements.btns.desaturate,\n\t\t\t\t'Desaturate button clicked',\n\t\t\t\t() => {\n\t\t\t\t\tthis.#log.warn(\n\t\t\t\t\t\t'Desaturation logic not implemented!',\n\t\t\t\t\t\t`${caller}.initButtons`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\taddButtonEvent(\n\t\t\t\tthis.#elements.btns.export,\n\t\t\t\t'Export button clicked',\n\t\t\t\t() => {\n\t\t\t\t\tthis.#log.warn(\n\t\t\t\t\t\t'Export logic not implemented!',\n\t\t\t\t\t\t`${caller}.initButtons`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\taddButtonEvent(\n\t\t\t\tthis.#elements.btns.generate,\n\t\t\t\t'Generate button clicked',\n\t\t\t\t() => {\n\t\t\t\t\tthis.#paletteRenderer.renderNewPalette();\n\t\t\t\t\tthis.#log.debug(\n\t\t\t\t\t\t'New palette generated and rendered',\n\t\t\t\t\t\t`${caller}.initButtons`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t);\n\n\t\t\tEventManager.add(\n\t\t\t\tdocument,\n\t\t\t\t'click',\n\t\t\t\tthis.handleWindowClick.bind(this)\n\t\t\t);\n\t\t}, `[${caller}]: Failed to initialize buttons.`);\n\t}\n\n\tattachTooltipListener(id: string, tooltipText: string): void {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tconst element = this.#helpers.dom.getElement(id);\n\n\t\t\tif (!element) return;\n\n\t\t\tEventManager.add(element, 'mouseenter', () =>\n\t\t\t\tthis.#utils.dom.createTooltip(element, tooltipText)\n\t\t\t);\n\t\t\tEventManager.add(element, 'mouseleave', () =>\n\t\t\t\tthis.#utils.dom.removeTooltip(element)\n\t\t\t);\n\t\t}, `[${caller}]: Failed to attach tooltip listener for ${id}.`);\n\t}\n\n\tprivate handleWindowClick(event: Event): void {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tconst target = event.target as HTMLElement;\n\n\t\t\tif (target === this.#elements.divs.helpMenu) {\n\t\t\t\tthis.#elements.divs.helpMenu.classList.add(classes.hidden);\n\t\t\t}\n\n\t\t\tif (target === this.#elements.divs.historyMenu) {\n\t\t\t\tthis.#elements.divs.historyMenu.classList.add(classes.hidden);\n\t\t\t}\n\t\t}, `[${caller}]: Failed to handle window click.`);\n\t}\n}\n"],"names":[],"mappings":"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"}