// File: dom/events/EventManager.ts
const caller = 'EventManager';
export class EventManager {
    static #instance = null;
    static #listeners = new Map();
    static #errors;
    static #log;
    constructor(services) {
        try {
            services.log.info(`Constructing EventManager instance`, `${caller} constructor`);
            EventManager.#errors = services.errors;
            EventManager.#log = services.log;
        }
        catch (error) {
            throw new Error(`[${caller} constructor]: ${error instanceof Error ? error.message : error}`);
        }
    }
    static getInstance(services) {
        return services.errors.handleSync(() => {
            if (!EventManager.#instance) {
                EventManager.#instance = new EventManager(services);
            }
            return EventManager.#instance;
        }, `[${caller}.getInstance]: Failed to create EventManager instance.`);
    }
    static add(element, eventType, handler) {
        return EventManager.#errors.handleSync(() => {
            element.addEventListener(eventType, handler);
            EventManager.#listeners.set(`${eventType}_${handler}`, {
                element,
                handler
            });
        }, `[${caller}]: Failed to add event listener for ${eventType}.`);
    }
    static async listAll() {
        return await EventManager.#errors.handleAsync(async () => {
            if (!EventManager.#listeners.size) {
                EventManager.#log.info('No active listeners found.', `${caller}.listAll`);
                return;
            }
            console.groupCollapsed('Active Listeners:');
            EventManager.#listeners.forEach(({ element, handler }, key) => {
                EventManager.#log.info(`Event: ${key.split('_')[0]}`, `${caller}.listAll`);
                console.log({ element, handler });
            });
            console.groupEnd();
        }, `[${caller}]: Failed to list all event listeners.`);
    }
    static async listByType(eventType) {
        return await EventManager.#errors.handleAsync(async () => {
            const listeners = Array.from(EventManager.#listeners.entries()).filter(([key]) => key.startsWith(`${eventType}_`));
            if (listeners.length === 0) {
                EventManager.#log.info(`No listeners found for event type "${eventType}".`, `${caller}.listByType`);
                return;
            }
            console.groupCollapsed(`ðŸ› ï¸ Event Listeners for: ${eventType}`);
            listeners.forEach(([_, { element, handler }]) => {
                EventManager.#log.info(`Listener for ${eventType}`, `${caller}.listByType`);
                console.log({ element, handler });
            });
            console.groupEnd();
        }, `[${caller}]: Failed to list event listeners for ${eventType}.`);
    }
    static async remove(element, eventType, handler) {
        return await EventManager.#errors.handleAsync(async () => {
            element.removeEventListener(eventType, handler);
            const listenerKey = `${eventType}_${handler}`;
            const wasRemoved = EventManager.#listeners.delete(listenerKey);
            if (wasRemoved) {
                EventManager.#log.info(`Removed listener for ${eventType}`, `${caller}.remove`);
            }
            else {
                EventManager.#log.info(`No matching listener found for ${eventType}`, `${caller}.remove`);
            }
        }, `[${caller}]: Failed to remove event listener for ${eventType}.`);
    }
    static async removeAll() {
        return await EventManager.#errors.handleAsync(async () => {
            if (EventManager.#listeners.size === 0) {
                EventManager.#log.info('No active listeners to remove.', `${caller}.removeAll`);
                return;
            }
            EventManager.#listeners.forEach(({ element, handler }, key) => {
                const [eventType] = key.split('_');
                element.removeEventListener(eventType, handler);
                EventManager.#log.debug(`Removed listener: ${eventType}`, `${caller}.removeAll`);
            });
            EventManager.#listeners.clear();
            EventManager.#log.info('All listeners have been removed.', `${caller}.removeAll`);
        }, `[${caller}]: Failed to remove all event listeners.`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRXZlbnRNYW5hZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2RvbS9ldmVudHMvRXZlbnRNYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG1DQUFtQztBQUluQyxNQUFNLE1BQU0sR0FBRyxjQUFjLENBQUM7QUFFOUIsTUFBTSxPQUFPLFlBQVk7SUFDeEIsTUFBTSxDQUFDLFNBQVMsR0FBd0IsSUFBSSxDQUFDO0lBRTdDLE1BQU0sQ0FBQyxVQUFVLEdBTWIsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUVkLE1BQU0sQ0FBQyxPQUFPLENBQXFCO0lBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQWtCO0lBRTdCLFlBQW9CLFFBQWtCO1FBQ3JDLElBQUksQ0FBQztZQUNKLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUNoQixvQ0FBb0MsRUFDcEMsR0FBRyxNQUFNLGNBQWMsQ0FDdkIsQ0FBQztZQUVGLFlBQVksQ0FBQyxPQUFPLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztZQUV2QyxZQUFZLENBQUMsSUFBSSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUM7UUFDbEMsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FDZCxJQUFJLE1BQU0sa0JBQWtCLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUM1RSxDQUFDO1FBQ0gsQ0FBQztJQUNGLENBQUM7SUFFRCxNQUFNLENBQUMsV0FBVyxDQUFDLFFBQWtCO1FBQ3BDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ3RDLElBQUksQ0FBQyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQzdCLFlBQVksQ0FBQyxTQUFTLEdBQUcsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDckQs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RyxNQUFNLFlBQVksQ0FDckIsQ0FBQztnQkFFRixPQUFPO1lBQ1IsQ0FBQztZQUVELFlBQVksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEVBQUUsR0FBRyxFQUFFLEVBQUU7Z0JBQzdELE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUVuQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUVoRCxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FDdEIscUJBQXFCLFNBQVMsRUFBRSxFQUNoQyxHQUFHLE1BQU0sWUFBWSxDQUNyQixDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7WUFFSCxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRWhDLFlBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUNyQixrQ0FBa0MsRUFDbEMsR0FBRyxNQUFNLFlBQVksQ0FDckIsQ0FBQztRQUNILENBQUMsRUFBRSxJQUFJLE1BQU0sMENBQTBDLENBQUMsQ0FBQztJQUMxRCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogZG9tL2V2ZW50cy9FdmVudE1hbmFnZXIudHNcblxuaW1wb3J0IHsgU2VydmljZXMgfSBmcm9tICcuLi8uLi90eXBlcy9pbmRleC5qcyc7XG5cbmNvbnN0IGNhbGxlciA9ICdFdmVudE1hbmFnZXInO1xuXG5leHBvcnQgY2xhc3MgRXZlbnRNYW5hZ2VyIHtcblx0c3RhdGljICNpbnN0YW5jZTogRXZlbnRNYW5hZ2VyIHwgbnVsbCA9IG51bGw7XG5cblx0c3RhdGljICNsaXN0ZW5lcnM6IE1hcDxcblx0XHRzdHJpbmcsXG5cdFx0e1xuXHRcdFx0ZWxlbWVudDogRWxlbWVudCB8IERvY3VtZW50O1xuXHRcdFx0aGFuZGxlcjogRXZlbnRMaXN0ZW5lck9yRXZlbnRMaXN0ZW5lck9iamVjdDtcblx0XHR9XG5cdD4gPSBuZXcgTWFwKCk7XG5cblx0c3RhdGljICNlcnJvcnM6IFNlcnZpY2VzWydlcnJvcnMnXTtcblx0c3RhdGljICNsb2c6IFNlcnZpY2VzWydsb2cnXTtcblxuXHRwcml2YXRlIGNvbnN0cnVjdG9yKHNlcnZpY2VzOiBTZXJ2aWNlcykge1xuXHRcdHRyeSB7XG5cdFx0XHRzZXJ2aWNlcy5sb2cuaW5mbyhcblx0XHRcdFx0YENvbnN0cnVjdGluZyBFdmVudE1hbmFnZXIgaW5zdGFuY2VgLFxuXHRcdFx0XHRgJHtjYWxsZXJ9IGNvbnN0cnVjdG9yYFxuXHRcdFx0KTtcblxuXHRcdFx0RXZlbnRNYW5hZ2VyLiNlcnJvcnMgPSBzZXJ2aWNlcy5lcnJvcnM7XG5cblx0XHRcdEV2ZW50TWFuYWdlci4jbG9nID0gc2VydmljZXMubG9nO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoXG5cdFx0XHRcdGBbJHtjYWxsZXJ9IGNvbnN0cnVjdG9yXTogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IGVycm9yfWBcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG5cblx0c3RhdGljIGdldEluc3RhbmNlKHNlcnZpY2VzOiBTZXJ2aWNlcyk6IEV2ZW50TWFuYWdlciB7XG5cdFx0cmV0dXJuIHNlcnZpY2VzLmVycm9ycy5oYW5kbGVTeW5jKCgpID0+IHtcblx0XHRcdGlmICghRXZlbnRNYW5hZ2VyLiNpbnN0YW5jZSkge1xuXHRcdFx0XHRFdmVudE1hbmFnZXIuI2luc3RhbmNlID0gbmV3IEV2ZW50TWFuYWdlcihzZXJ2aWNlcyk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBFdmVudE1hbmFnZXIuI2luc3RhbmNlO1xuXHRcdH0sIGBbJHtjYWxsZXJ9LmdldEluc3RhbmNlXTogRmFpbGVkIHRvIGNyZWF0ZSBFdmVudE1hbmFnZXIgaW5zdGFuY2UuYCk7XG5cdH1cblxuXHRzdGF0aWMgYWRkKFxuXHRcdGVsZW1lbnQ6IEVsZW1lbnQgfCBEb2N1bWVudCxcblx0XHRldmVudFR5cGU6IHN0cmluZyxcblx0XHRoYW5kbGVyOiBFdmVudExpc3RlbmVyT3JFdmVudExpc3RlbmVyT2JqZWN0XG5cdCk6IHZvaWQge1xuXHRcdHJldHVybiBFdmVudE1hbmFnZXIuI2Vycm9ycy5oYW5kbGVTeW5jKCgpID0+IHtcblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGhhbmRsZXIpO1xuXG5cdFx0XHRFdmVudE1hbmFnZXIuI2xpc3RlbmVycy5zZXQoYCR7ZXZlbnRUeXBlfV8ke2hhbmRsZXJ9YCwge1xuXHRcdFx0XHRlbGVtZW50LFxuXHRcdFx0XHRoYW5kbGVyXG5cdFx0XHR9KTtcblx0XHR9LCBgWyR7Y2FsbGVyfV06IEZhaWxlZCB0byBhZGQgZXZlbnQgbGlzdGVuZXIgZm9yICR7ZXZlbnRUeXBlfS5gKTtcblx0fVxuXG5cdHN0YXRpYyBhc3luYyBsaXN0QWxsKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHJldHVybiBhd2FpdCBFdmVudE1hbmFnZXIuI2Vycm9ycy5oYW5kbGVBc3luYyhhc3luYyAoKSA9PiB7XG5cdFx0XHRpZiAoIUV2ZW50TWFuYWdlci4jbGlzdGVuZXJzLnNpemUpIHtcblx0XHRcdFx0RXZlbnRNYW5hZ2VyLiNsb2cuaW5mbyhcblx0XHRcdFx0XHQnTm8gYWN0aXZlIGxpc3RlbmVycyBmb3VuZC4nLFxuXHRcdFx0XHRcdGAke2NhbGxlcn0ubGlzdEFsbGBcblx0XHRcdFx0KTtcblxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoJ0FjdGl2ZSBMaXN0ZW5lcnM6Jyk7XG5cblx0XHRcdEV2ZW50TWFuYWdlci4jbGlzdGVuZXJzLmZvckVhY2goKHsgZWxlbWVudCwgaGFuZGxlciB9LCBrZXkpID0+IHtcblx0XHRcdFx0RXZlbnRNYW5hZ2VyLiNsb2cuaW5mbyhcblx0XHRcdFx0XHRgRXZlbnQ6ICR7a2V5LnNwbGl0KCdfJylbMF19YCxcblx0XHRcdFx0XHRgJHtjYWxsZXJ9Lmxpc3RBbGxgXG5cdFx0XHRcdCk7XG5cblx0XHRcdFx0Y29uc29sZS5sb2coeyBlbGVtZW50LCBoYW5kbGVyIH0pO1xuXHRcdFx0fSk7XG5cdFx0XHRjb25zb2xlLmdyb3VwRW5kKCk7XG5cdFx0fSwgYFske2NhbGxlcn1dOiBGYWlsZWQgdG8gbGlzdCBhbGwgZXZlbnQgbGlzdGVuZXJzLmApO1xuXHR9XG5cblx0c3RhdGljIGFzeW5jIGxpc3RCeVR5cGUoZXZlbnRUeXBlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRyZXR1cm4gYXdhaXQgRXZlbnRNYW5hZ2VyLiNlcnJvcnMuaGFuZGxlQXN5bmMoYXN5bmMgKCkgPT4ge1xuXHRcdFx0Y29uc3QgbGlzdGVuZXJzID0gQXJyYXkuZnJvbShcblx0XHRcdFx0RXZlbnRNYW5hZ2VyLiNsaXN0ZW5lcnMuZW50cmllcygpXG5cdFx0XHQpLmZpbHRlcigoW2tleV0pID0+IGtleS5zdGFydHNXaXRoKGAke2V2ZW50VHlwZX1fYCkpO1xuXG5cdFx0XHRpZiAobGlzdGVuZXJzLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRFdmVudE1hbmFnZXIuI2xvZy5pbmZvKFxuXHRcdFx0XHRcdGBObyBsaXN0ZW5lcnMgZm91bmQgZm9yIGV2ZW50IHR5cGUgXCIke2V2ZW50VHlwZX1cIi5gLFxuXHRcdFx0XHRcdGAke2NhbGxlcn0ubGlzdEJ5VHlwZWBcblx0XHRcdFx0KTtcblxuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoYPCfm6DvuI8gRXZlbnQgTGlzdGVuZXJzIGZvcjogJHtldmVudFR5cGV9YCk7XG5cblx0XHRcdGxpc3RlbmVycy5mb3JFYWNoKChbXywgeyBlbGVtZW50LCBoYW5kbGVyIH1dKSA9PiB7XG5cdFx0XHRcdEV2ZW50TWFuYWdlci4jbG9nLmluZm8oXG5cdFx0XHRcdFx0YExpc3RlbmVyIGZvciAke2V2ZW50VHlwZX1gLFxuXHRcdFx0XHRcdGAke2NhbGxlcn0ubGlzdEJ5VHlwZWBcblx0XHRcdFx0KTtcblxuXHRcdFx0XHRjb25zb2xlLmxvZyh7IGVsZW1lbnQsIGhhbmRsZXIgfSk7XG5cdFx0XHR9KTtcblx0XHRcdGNvbnNvbGUuZ3JvdXBFbmQoKTtcblx0XHR9LCBgWyR7Y2FsbGVyfV06IEZhaWxlZCB0byBsaXN0IGV2ZW50IGxpc3RlbmVycyBmb3IgJHtldmVudFR5cGV9LmApO1xuXHR9XG5cblx0c3RhdGljIGFzeW5jIHJlbW92ZShcblx0XHRlbGVtZW50OiBFbGVtZW50IHwgRG9jdW1lbnQsXG5cdFx0ZXZlbnRUeXBlOiBzdHJpbmcsXG5cdFx0aGFuZGxlcjogRXZlbnRMaXN0ZW5lck9yRXZlbnRMaXN0ZW5lck9iamVjdFxuXHQpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRyZXR1cm4gYXdhaXQgRXZlbnRNYW5hZ2VyLiNlcnJvcnMuaGFuZGxlQXN5bmMoYXN5bmMgKCkgPT4ge1xuXHRcdFx0ZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgaGFuZGxlcik7XG5cblx0XHRcdGNvbnN0IGxpc3RlbmVyS2V5ID0gYCR7ZXZlbnRUeXBlfV8ke2hhbmRsZXJ9YDtcblx0XHRcdGNvbnN0IHdhc1JlbW92ZWQgPSBFdmVudE1hbmFnZXIuI2xpc3RlbmVycy5kZWxldGUobGlzdGVuZXJLZXkpO1xuXG5cdFx0XHRpZiAod2FzUmVtb3ZlZCkge1xuXHRcdFx0XHRFdmVudE1hbmFnZXIuI2xvZy5pbmZvKFxuXHRcdFx0XHRcdGBSZW1vdmVkIGxpc3RlbmVyIGZvciAke2V2ZW50VHlwZX1gLFxuXHRcdFx0XHRcdGAke2NhbGxlcn0ucmVtb3ZlYFxuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0RXZlbnRNYW5hZ2VyLiNsb2cuaW5mbyhcblx0XHRcdFx0XHRgTm8gbWF0Y2hpbmcgbGlzdGVuZXIgZm91bmQgZm9yICR7ZXZlbnRUeXBlfWAsXG5cdFx0XHRcdFx0YCR7Y2FsbGVyfS5yZW1vdmVgXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fSwgYFske2NhbGxlcn1dOiBGYWlsZWQgdG8gcmVtb3ZlIGV2ZW50IGxpc3RlbmVyIGZvciAke2V2ZW50VHlwZX0uYCk7XG5cdH1cblxuXHRzdGF0aWMgYXN5bmMgcmVtb3ZlQWxsKCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHJldHVybiBhd2FpdCBFdmVudE1hbmFnZXIuI2Vycm9ycy5oYW5kbGVBc3luYyhhc3luYyAoKSA9PiB7XG5cdFx0XHRpZiAoRXZlbnRNYW5hZ2VyLiNsaXN0ZW5lcnMuc2l6ZSA9PT0gMCkge1xuXHRcdFx0XHRFdmVudE1hbmFnZXIuI2xvZy5pbmZvKFxuXHRcdFx0XHRcdCdObyBhY3RpdmUgbGlzdGVuZXJzIHRvIHJlbW92ZS4nLFxuXHRcdFx0XHRcdGAke2NhbGxlcn0ucmVtb3ZlQWxsYFxuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0RXZlbnRNYW5hZ2VyLiNsaXN0ZW5lcnMuZm9yRWFjaCgoeyBlbGVtZW50LCBoYW5kbGVyIH0sIGtleSkgPT4ge1xuXHRcdFx0XHRjb25zdCBbZXZlbnRUeXBlXSA9IGtleS5zcGxpdCgnXycpO1xuXG5cdFx0XHRcdGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGhhbmRsZXIpO1xuXG5cdFx0XHRcdEV2ZW50TWFuYWdlci4jbG9nLmRlYnVnKFxuXHRcdFx0XHRcdGBSZW1vdmVkIGxpc3RlbmVyOiAke2V2ZW50VHlwZX1gLFxuXHRcdFx0XHRcdGAke2NhbGxlcn0ucmVtb3ZlQWxsYFxuXHRcdFx0XHQpO1xuXHRcdFx0fSk7XG5cblx0XHRcdEV2ZW50TWFuYWdlci4jbGlzdGVuZXJzLmNsZWFyKCk7XG5cblx0XHRcdEV2ZW50TWFuYWdlci4jbG9nLmluZm8oXG5cdFx0XHRcdCdBbGwgbGlzdGVuZXJzIGhhdmUgYmVlbiByZW1vdmVkLicsXG5cdFx0XHRcdGAke2NhbGxlcn0ucmVtb3ZlQWxsYFxuXHRcdFx0KTtcblx0XHR9LCBgWyR7Y2FsbGVyfV06IEZhaWxlZCB0byByZW1vdmUgYWxsIGV2ZW50IGxpc3RlbmVycy5gKTtcblx0fVxufVxuIl19