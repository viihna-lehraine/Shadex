// File: dom/eventListeners.js
import { IDBManager } from '../db/IDBManager.js';
import { coreUtils, superUtils, utils } from '../common/index.js';
import { constsData as consts } from '../data/consts.js';
import { createLogger } from '../logger/index.js';
import { domData } from '../data/dom.js';
import { parse } from './parse.js';
import { modeData as mode } from '../data/mode.js';
import { start } from '../palette/index.js';
import { UIManager } from '../ui/index.js';
const btnDebounce = consts.debounce.btn || 300;
const logMode = mode.logging;
const uiElements = domData.elements.static;
const uiElementIDs = domData.ids.static;
const thisModule = 'dom/eventListeners.js';
const logger = await createLogger();
const idb = await IDBManager.getInstance();
const uiManager = new UIManager();
function addEventListener(id, eventType, callback) {
    const thisFunction = 'addEventListener()';
    const element = document.getElementById(id);
    if (element) {
        element.addEventListener(eventType, callback);
    }
    else if (logMode.warn) {
        if (mode.debug && logMode.warn && logMode.verbosity > 2)
            logger.warn(`Element with id "${id}" not found.`, `${thisModule} > ${thisFunction}`);
    }
}
function initializeEventListeners() {
    const thisFunction = 'initializeEventListeners()';
    const addConversionListener = (id, colorSpace) => {
        const btn = document.getElementById(id);
        if (btn) {
            if (coreUtils.guards.isColorSpace(colorSpace)) {
                btn.addEventListener('click', () => superUtils.dom.switchColorSpace(colorSpace));
            }
            else {
                if (logMode.warn) {
                    logger.warn(`Invalid color space provided: ${colorSpace}`, `${thisModule} > ${thisFunction}`);
                }
            }
        }
        else {
            if (logMode.warn)
                logger.warn(`Element with id "${id}" not found.`, `${thisModule} > ${thisFunction}`);
        }
    };
    addConversionListener(String(uiElementIDs.btns.showAsCMYK), 'cmyk');
    addConversionListener(String(uiElementIDs.btns.showAsHex), 'hex');
    addConversionListener(String(uiElementIDs.btns.showAsHSL), 'hsl');
    addConversionListener(String(uiElementIDs.btns.showAsHSV), 'hsv');
    addConversionListener(String(uiElementIDs.btns.showAsLAB), 'lab');
    addConversionListener(String(uiElementIDs.btns.showAsRGB), 'rgb');
    addEventListener(uiElementIDs.btns.applyCustomColor, 'click', async (e) => {
        e.preventDefault();
        const customHSLColor = uiManager.applyCustomColor();
        const customHSLColorClone = coreUtils.base.clone(customHSLColor);
        await idb.saveData('customColor', 'appSettings', customHSLColorClone);
        if (!mode.quiet && logMode.info)
            logger.info('Custom color saved to IndexedDB', `${thisModule} > applyCustomColorButton click event`);
        // *DEV-NOTE* unfinished, I think? Double-check this
    });
    addEventListener(uiElementIDs.btns.clearCustomColor, 'click', async (e) => {
        e.preventDefault();
        uiElements.inputs.customColor.value = '#ff0000';
        if (!mode.quiet && logMode.info)
            logger.info('Custom color cleared', `${thisModule} > clearCustomColorButton click event`);
    });
    addEventListener(uiElementIDs.btns.customColorMenu, 'click', async (e) => {
        e.preventDefault();
        uiElements.divs.customColorMenu?.classList.add('hidden');
        uiElements.divs.customColorMenu?.setAttribute('aria-hidden', 'true');
    });
    if (!uiElements.inputs.customColor)
        throw new Error('Custom color input element not found');
    uiElements.inputs.customColor.addEventListener('input', () => {
        if (!uiElements.spans.customColorDisplay)
            throw new Error('Custom color display element not found');
        uiElements.spans.customColorDisplay.textContent =
            uiElements.inputs.customColor.value;
    });
    addEventListener(uiElementIDs.btns.desaturate, 'click', async (e) => {
        e.preventDefault();
        const selectedColor = uiElements.selects.swatch
            ? parseInt(uiElements.selects.swatch.value, 10)
            : 0;
        if (!mode.quiet && logMode.clicks)
            logger.info('desaturateButton clicked', `${thisModule} > desaturateButton click event`);
        uiManager.desaturateColor(selectedColor);
    });
    addEventListener(uiElementIDs.btns.export, 'click', async (e) => {
        e.preventDefault();
        const format = parse.paletteExportFormat();
        if (mode.debug && logMode.info && logMode.verbosity > 1)
            logger.info(`Export Button click event: Export format selected: ${format}`, `${thisModule} > exportButton click event`);
        if (!format) {
            if (logMode.error && !mode.quiet && logMode.verbosity > 1) {
                logger.error('Export format not selected', `${thisModule} > exportButton click event`);
                return;
            }
        }
        else {
            uiManager.handleExport(format);
        }
    });
    addEventListener(uiElementIDs.btns.generate, 'click', async (e) => {
        e.preventDefault();
        const { type, swatches, limitDark, limitGray, limitLight } = uiManager.pullParamsFromUI();
        if (logMode.info && logMode.verbosity > 1)
            logger.info('Generate Button click event: Retrieved parameters from UI.', `${thisModule} > generateButton click event`);
        if (logMode.info && mode.debug && logMode.verbosity > 1)
            logger.info(`Type: ${type}\nSwatches: ${swatches}\nLimit Dark: ${limitDark}\nLimit Gray: ${limitGray}\nLimit Light${limitLight}.`, `${thisModule} > generateButton click event`);
        let customColor = (await idb.getCustomColor());
        if (!customColor) {
            customColor = utils.random.hsl();
        }
        else {
            if (mode.debug && logMode.info)
                logger.info(`User-generated Custom Color found in IndexedDB: ${JSON.stringify(customColor)}`, `${thisModule} > generateButton click event`);
        }
        const paletteOptions = {
            customColor: coreUtils.base.clone(customColor),
            flags: {
                limitDark,
                limitGray,
                limitLight
            },
            swatches,
            type
        };
        await start.paletteGeneration(paletteOptions);
    });
    addEventListener(uiElementIDs.btns.helpMenu, 'click', async (e) => {
        e.preventDefault();
        uiElements.divs.helpMenu?.classList.remove('hidden');
    });
    addEventListener(uiElementIDs.btns.historyMenu, 'click', async (e) => {
        e.preventDefault();
        uiElements.divs.historyMenu?.classList.remove('hidden');
    });
    addEventListener(uiElementIDs.inputs.historyLimit, 'input', async (e) => {
        const input = e.target;
        const newLimit = parseInt(input.value, 10);
        if (isNaN(newLimit) || newLimit < 1 || newLimit > 1000) {
            input.value = '50';
            return;
        }
        const uiManager = new UIManager();
        await uiManager.setHistoryLimit(newLimit);
    });
    addEventListener(uiElementIDs.btns.ioMenu, 'click', async (e) => {
        e.preventDefault();
        uiElements.divs.ioMenu?.classList.remove('hidden');
    });
    addEventListener(uiElementIDs.inputs.import, 'change', async (e) => {
        const input = e.target;
        if (input.files && input.files.length > 0) {
            const file = input.files[0];
            // *DEV-NOTE* implement a way to determine whether file describes CSS, JSON, or XML import
            const format = 'JSON';
            await uiManager.handleImport(file, format);
        }
    });
    addEventListener(uiElementIDs.btns.saturate, 'click', async (e) => {
        e.preventDefault();
        if (!uiElements.selects.swatch) {
            throw new Error('Selected color option not found');
        }
        const selectedColor = uiElements.selects.swatch
            ? parseInt(uiElements.selects.swatch.value, 10)
            : 0;
        uiManager.saturateColor(selectedColor);
    });
    window.addEventListener('click', async (e) => {
        if (uiElements.divs.customColorMenu)
            if (e.target === uiElements.divs.customColorMenu) {
                uiElements.divs.customColorMenu.classList.add('hidden');
            }
    });
    window.addEventListener('click', async (e) => {
        if (uiElements.divs.helpMenu)
            if (e.target === uiElements.divs.helpMenu) {
                uiElements.divs.helpMenu.classList.add('hidden');
            }
    });
    window.addEventListener('click', async (e) => {
        if (uiElements.divs.historyMenu)
            if (e.target === uiElements.divs.historyMenu) {
                uiElements.divs.historyMenu.classList.add('hidden');
            }
    });
    window.addEventListener('click', async (e) => {
        if (uiElements.divs.ioMenu)
            if (e.target === uiElements.divs.ioMenu) {
                uiElements.divs.ioMenu.classList.add('hidden');
            }
    });
}
const processPaletteGeneration = coreUtils.base.debounce(async () => {
    const thisFunction = 'processPaletteGeneration';
    try {
        const params = superUtils.dom.getPaletteGenerationArgs();
        if (!params) {
            if (logMode.error) {
                logger.error('Failed to retrieve generateButton parameters', `${thisModule} > ${thisFunction}`);
            }
            return;
        }
        const { swatches, customColor, type, limitDark, limitGray, limitLight } = params;
        if (!type || !swatches) {
            if (logMode.error) {
                logger.error('paletteType and/or swatches are undefined', `${thisModule} > ${thisFunction}`);
            }
            return;
        }
        const options = {
            customColor,
            flags: {
                limitDark,
                limitGray,
                limitLight
            },
            swatches,
            type
        };
        start.paletteGeneration(options);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Failed to handle generate button click: ${error}`, `${thisModule} > ${thisFunction}`);
    }
}, btnDebounce);
export const base = {
    addEventListener,
    initializeEventListeners,
    processPaletteGeneration
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXZlbnRMaXN0ZW5lcnMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZG9tL2V2ZW50TGlzdGVuZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDhCQUE4QjtBQVE5QixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakQsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDbEUsT0FBTyxFQUFFLFVBQVUsSUFBSSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDbEQsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDbkMsT0FBTyxFQUFFLFFBQVEsSUFBSSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDNUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxJQUFJLEdBQUcsQ0FBQztBQUMvQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBQzdCLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO0FBQzNDLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO0FBRXhDLE1BQU0sVUFBVSxHQUFHLHVCQUF1QixDQUFDO0FBRTNDLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxFQUFFLENBQUM7QUFFcEMsTUFBTSxHQUFHLEdBQUcsTUFBTSxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDM0MsTUFBTSxTQUFTLEdBQUcsSUFBSSxTQUFTLEVBQUUsQ0FBQztBQUVsQyxTQUFTLGdCQUFnQixDQUN4QixFQUFVLEVBQ1YsU0FBWSxFQUNaLFFBQThDO0lBRTlDLE1BQU0sWUFBWSxHQUFHLG9CQUFvQixDQUFDO0lBQzFDLE1BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFNUMsSUFBSSxPQUFPLEVBQUUsQ0FBQztRQUNiLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDL0MsQ0FBQztTQUFNLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3pCLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLEdBQUcsQ0FBQztZQUN0RCxNQUFNLENBQUMsSUFBSSxDQUNWLG9CQUFvQixFQUFFLGNBQWMsRUFDcEMsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7SUFDSixDQUFDO0FBQ0YsQ0FBQztBQUVELFNBQVMsd0JBQXdCO0lBQ2hDLE1BQU0sWUFBWSxHQUFHLDRCQUE0QixDQUFDO0lBRWxELE1BQU0scUJBQXFCLEdBQUcsQ0FBQyxFQUFVLEVBQUUsVUFBa0IsRUFBRSxFQUFFO1FBQ2hFLE1BQU0sR0FBRyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUE2QixDQUFDO1FBRXBFLElBQUksR0FBRyxFQUFFLENBQUM7WUFDVCxJQUFJLFNBQVMsQ0FBQyxNQUFNLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7Z0JBQy9DLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQ2xDLFVBQVUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsVUFBd0IsQ0FBQyxDQUN6RCxDQUFDO1lBQ0gsQ0FBQztpQkFBTSxDQUFDO2dCQUNQLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO29CQUNsQixNQUFNLENBQUMsSUFBSSxDQUNWLGlDQUFpQyxVQUFVLEVBQUUsRUFDN0MsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7Z0JBQ0gsQ0FBQztZQUNGLENBQUM7UUFDRixDQUFDO2FBQU0sQ0FBQztZQUNQLElBQUksT0FBTyxDQUFDLElBQUk7Z0JBQ2YsTUFBTSxDQUFDLElBQUksQ0FDVixvQkFBb0IsRUFBRSxjQUFjLEVBQ3BDLEdBQUcsVUFBVSxNQUFNLFlBQVksRUFBRSxDQUNqQyxDQUFDO1FBQ0osQ0FBQztJQUNGLENBQUMsQ0FBQztJQUVGLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3BFLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2xFLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2xFLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2xFLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ2xFLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBRWxFLGdCQUFnQixDQUNmLFlBQVksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQ2xDLE9BQU8sRUFDUCxLQUFLLEVBQUUsQ0FBYSxFQUFFLEVBQUU7UUFDdkIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBRW5CLE1BQU0sY0FBYyxHQUFHLFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3BELE1BQU0sbUJBQW1CLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFakUsTUFBTSxHQUFHLENBQUMsUUFBUSxDQUNqQixhQUFhLEVBQ2IsYUFBYSxFQUNiLG1CQUFtQixDQUNuQixDQUFDO1FBRUYsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLElBQUk7WUFDOUIsTUFBTSxDQUFDLElBQUksQ0FDVixpQ0FBaUMsRUFDakMsR0FBRyxVQUFVLHVDQUF1QyxDQUNwRCxDQUFDO1FBRUgsb0RBQW9EO0lBQ3JELENBQUMsQ0FDRCxDQUFDO0lBRUYsZ0JBQWdCLENBQ2YsWUFBWSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFDbEMsT0FBTyxFQUNQLEtBQUssRUFBRSxDQUFhLEVBQUUsRUFBRTtRQUN2QixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFbkIsVUFBVSxDQUFDLE1BQU0sQ0FBQyxXQUFZLENBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQztRQUVqRCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSTtZQUM5QixNQUFNLENBQUMsSUFBSSxDQUNWLHNCQUFzQixFQUN0QixHQUFHLFVBQVUsdUNBQXVDLENBQ3BELENBQUM7SUFDSixDQUFDLENBQ0QsQ0FBQztJQUVGLGdCQUFnQixDQUNmLFlBQVksQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUNqQyxPQUFPLEVBQ1AsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3ZCLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUVuQixVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3pELFVBQVUsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLFlBQVksQ0FDNUMsYUFBYSxFQUNiLE1BQU0sQ0FDTixDQUFDO0lBQ0gsQ0FBQyxDQUNELENBQUM7SUFFRixJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxXQUFXO1FBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQztJQUV6RCxVQUFVLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFO1FBQzVELElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLGtCQUFrQjtZQUN2QyxNQUFNLElBQUksS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7UUFFM0QsVUFBVSxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXO1lBQzlDLFVBQVUsQ0FBQyxNQUFNLENBQUMsV0FBWSxDQUFDLEtBQUssQ0FBQztJQUN2QyxDQUFDLENBQUMsQ0FBQztJQUVILGdCQUFnQixDQUNmLFlBQVksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUM1QixPQUFPLEVBQ1AsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3ZCLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUVuQixNQUFNLGFBQWEsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU07WUFDOUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO1lBQy9DLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFTCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsTUFBTTtZQUNoQyxNQUFNLENBQUMsSUFBSSxDQUNWLDBCQUEwQixFQUMxQixHQUFHLFVBQVUsaUNBQWlDLENBQzlDLENBQUM7UUFFSCxTQUFTLENBQUMsZUFBZSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FDRCxDQUFDO0lBRUYsZ0JBQWdCLENBQ2YsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQ3hCLE9BQU8sRUFDUCxLQUFLLEVBQUUsQ0FBYSxFQUFFLEVBQUU7UUFDdkIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBRW5CLE1BQU0sTUFBTSxHQUFHLEtBQUssQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO1FBRTNDLElBQUksSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLEdBQUcsQ0FBQztZQUN0RCxNQUFNLENBQUMsSUFBSSxDQUNWLHNEQUFzRCxNQUFNLEVBQUUsRUFDOUQsR0FBRyxVQUFVLDZCQUE2QixDQUMxQyxDQUFDO1FBRUgsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2IsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsU0FBUyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUMzRCxNQUFNLENBQUMsS0FBSyxDQUNYLDRCQUE0QixFQUM1QixHQUFHLFVBQVUsNkJBQTZCLENBQzFDLENBQUM7Z0JBRUYsT0FBTztZQUNSLENBQUM7UUFDRixDQUFDO2FBQU0sQ0FBQztZQUNQLFNBQVMsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEMsQ0FBQztJQUNGLENBQUMsQ0FDRCxDQUFDO0lBRUYsZ0JBQWdCLENBQ2YsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQzFCLE9BQU8sRUFDUCxLQUFLLEVBQUUsQ0FBYSxFQUFFLEVBQUU7UUFDdkIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBRW5CLE1BQU0sRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEdBQ3pELFNBQVMsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBRTlCLElBQUksT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsU0FBUyxHQUFHLENBQUM7WUFDeEMsTUFBTSxDQUFDLElBQUksQ0FDViw0REFBNEQsRUFDNUQsR0FBRyxVQUFVLCtCQUErQixDQUM1QyxDQUFDO1FBRUgsSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFNBQVMsR0FBRyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxJQUFJLENBQ1YsU0FBUyxJQUFJLGVBQWUsUUFBUSxpQkFBaUIsU0FBUyxpQkFBaUIsU0FBUyxnQkFBZ0IsVUFBVSxHQUFHLEVBQ3JILEdBQUcsVUFBVSwrQkFBK0IsQ0FDNUMsQ0FBQztRQUVILElBQUksV0FBVyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsY0FBYyxFQUFFLENBQWUsQ0FBQztRQUU3RCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDbEIsV0FBVyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDbEMsQ0FBQzthQUFNLENBQUM7WUFDUCxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLElBQUk7Z0JBQzdCLE1BQU0sQ0FBQyxJQUFJLENBQ1YsbURBQW1ELElBQUksQ0FBQyxTQUFTLENBQ2hFLFdBQVcsQ0FDWCxFQUFFLEVBQ0gsR0FBRyxVQUFVLCtCQUErQixDQUM1QyxDQUFDO1FBQ0osQ0FBQztRQUVELE1BQU0sY0FBYyxHQUFtQjtZQUN0QyxXQUFXLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDO1lBQzlDLEtBQUssRUFBRTtnQkFDTixTQUFTO2dCQUNULFNBQVM7Z0JBQ1QsVUFBVTthQUNWO1lBQ0QsUUFBUTtZQUNSLElBQUk7U0FDSixDQUFDO1FBRUYsTUFBTSxLQUFLLENBQUMsaUJBQWlCLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDL0MsQ0FBQyxDQUNELENBQUM7SUFFRixnQkFBZ0IsQ0FDZixZQUFZLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFDMUIsT0FBTyxFQUNQLEtBQUssRUFBRSxDQUFhLEVBQUUsRUFBRTtRQUN2QixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUM7UUFFbkIsVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN0RCxDQUFDLENBQ0QsQ0FBQztJQUVGLGdCQUFnQixDQUNmLFlBQVksQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUM3QixPQUFPLEVBQ1AsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3ZCLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUVuQixVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3pELENBQUMsQ0FDRCxDQUFDO0lBRUYsZ0JBQWdCLENBQ2YsWUFBWSxDQUFDLE1BQU0sQ0FBQyxZQUFZLEVBQ2hDLE9BQU8sRUFDUCxLQUFLLEVBQUUsQ0FBUSxFQUFFLEVBQUU7UUFDbEIsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLE1BQTBCLENBQUM7UUFDM0MsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFM0MsSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksUUFBUSxHQUFHLENBQUMsSUFBSSxRQUFRLEdBQUcsSUFBSSxFQUFFLENBQUM7WUFDeEQsS0FBSyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7WUFFbkIsT0FBTztRQUNSLENBQUM7UUFFRCxNQUFNLFNBQVMsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDO1FBQ2xDLE1BQU0sU0FBUyxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUMzQyxDQUFDLENBQ0QsQ0FBQztJQUVGLGdCQUFnQixDQUNmLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUN4QixPQUFPLEVBQ1AsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3ZCLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUVuQixVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3BELENBQUMsQ0FDRCxDQUFDO0lBRUYsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFRLEVBQUUsRUFBRTtRQUN6RSxNQUFNLEtBQUssR0FBRyxDQUFDLENBQUMsTUFBMEIsQ0FBQztRQUUzQyxJQUFJLEtBQUssQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDM0MsTUFBTSxJQUFJLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUU1QiwwRkFBMEY7WUFDMUYsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBRXRCLE1BQU0sU0FBUyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDNUMsQ0FBQztJQUNGLENBQUMsQ0FBQyxDQUFDO0lBRUgsZ0JBQWdCLENBQ2YsWUFBWSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQzFCLE9BQU8sRUFDUCxLQUFLLEVBQUUsQ0FBYSxFQUFFLEVBQUU7UUFDdkIsQ0FBQyxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBRW5CLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ2hDLE1BQU0sSUFBSSxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBRUQsTUFBTSxhQUFhLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNO1lBQzlDLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsQ0FBQztZQUMvQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRUwsU0FBUyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUN4QyxDQUFDLENBQ0QsQ0FBQztJQUVGLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3hELElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxlQUFlO1lBQ2xDLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUNsRCxVQUFVLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3pELENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3hELElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFRO1lBQzNCLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUMzQyxVQUFVLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2xELENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3hELElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFXO1lBQzlCLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUM5QyxVQUFVLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3JELENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLENBQWEsRUFBRSxFQUFFO1FBQ3hELElBQUksVUFBVSxDQUFDLElBQUksQ0FBQyxNQUFNO1lBQ3pCLElBQUksQ0FBQyxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUN6QyxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2hELENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLHdCQUF3QixHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssSUFBSSxFQUFFO0lBQ25FLE1BQU0sWUFBWSxHQUFHLDBCQUEwQixDQUFDO0lBRWhELElBQUksQ0FBQztRQUNKLE1BQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztRQUV6RCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDYixJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDbkIsTUFBTSxDQUFDLEtBQUssQ0FDWCw4Q0FBOEMsRUFDOUMsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7WUFDSCxDQUFDO1lBRUQsT0FBTztRQUNSLENBQUM7UUFFRCxNQUFNLEVBQ0wsUUFBUSxFQUNSLFdBQVcsRUFDWCxJQUFJLEVBQ0osU0FBUyxFQUNULFNBQVMsRUFDVCxVQUFVLEVBQ1YsR0FBRyxNQUFNLENBQUM7UUFFWCxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDeEIsSUFBSSxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQ25CLE1BQU0sQ0FBQyxLQUFLLENBQ1gsMkNBQTJDLEVBQzNDLEdBQUcsVUFBVSxNQUFNLFlBQVksRUFBRSxDQUNqQyxDQUFDO1lBQ0gsQ0FBQztZQUVELE9BQU87UUFDUixDQUFDO1FBRUQsTUFBTSxPQUFPLEdBQW1CO1lBQy9CLFdBQVc7WUFDWCxLQUFLLEVBQUU7Z0JBQ04sU0FBUztnQkFDVCxTQUFTO2dCQUNULFVBQVU7YUFDVjtZQUNELFFBQVE7WUFDUixJQUFJO1NBQ0osQ0FBQztRQUVGLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLE9BQU8sQ0FBQyxLQUFLO1lBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsMkNBQTJDLEtBQUssRUFBRSxFQUNsRCxHQUFHLFVBQVUsTUFBTSxZQUFZLEVBQUUsQ0FDakMsQ0FBQztJQUNKLENBQUM7QUFDRixDQUFDLEVBQUUsV0FBVyxDQUFDLENBQUM7QUFFaEIsTUFBTSxDQUFDLE1BQU0sSUFBSSxHQUFvQztJQUNwRCxnQkFBZ0I7SUFDaEIsd0JBQXdCO0lBQ3hCLHdCQUF3QjtDQUN4QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogZG9tL2V2ZW50TGlzdGVuZXJzLmpzXG5cbmltcG9ydCB7XG5cdENvbG9yU3BhY2UsXG5cdERPTUZuX01hc3RlckludGVyZmFjZSxcblx0SFNMLFxuXHRQYWxldHRlT3B0aW9uc1xufSBmcm9tICcuLi90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBJREJNYW5hZ2VyIH0gZnJvbSAnLi4vZGIvSURCTWFuYWdlci5qcyc7XG5pbXBvcnQgeyBjb3JlVXRpbHMsIHN1cGVyVXRpbHMsIHV0aWxzIH0gZnJvbSAnLi4vY29tbW9uL2luZGV4LmpzJztcbmltcG9ydCB7IGNvbnN0c0RhdGEgYXMgY29uc3RzIH0gZnJvbSAnLi4vZGF0YS9jb25zdHMuanMnO1xuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnLi4vbG9nZ2VyL2luZGV4LmpzJztcbmltcG9ydCB7IGRvbURhdGEgfSBmcm9tICcuLi9kYXRhL2RvbS5qcyc7XG5pbXBvcnQgeyBwYXJzZSB9IGZyb20gJy4vcGFyc2UuanMnO1xuaW1wb3J0IHsgbW9kZURhdGEgYXMgbW9kZSB9IGZyb20gJy4uL2RhdGEvbW9kZS5qcyc7XG5pbXBvcnQgeyBzdGFydCB9IGZyb20gJy4uL3BhbGV0dGUvaW5kZXguanMnO1xuaW1wb3J0IHsgVUlNYW5hZ2VyIH0gZnJvbSAnLi4vdWkvaW5kZXguanMnO1xuXG5jb25zdCBidG5EZWJvdW5jZSA9IGNvbnN0cy5kZWJvdW5jZS5idG4gfHwgMzAwO1xuY29uc3QgbG9nTW9kZSA9IG1vZGUubG9nZ2luZztcbmNvbnN0IHVpRWxlbWVudHMgPSBkb21EYXRhLmVsZW1lbnRzLnN0YXRpYztcbmNvbnN0IHVpRWxlbWVudElEcyA9IGRvbURhdGEuaWRzLnN0YXRpYztcblxuY29uc3QgdGhpc01vZHVsZSA9ICdkb20vZXZlbnRMaXN0ZW5lcnMuanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxuY29uc3QgaWRiID0gYXdhaXQgSURCTWFuYWdlci5nZXRJbnN0YW5jZSgpO1xuY29uc3QgdWlNYW5hZ2VyID0gbmV3IFVJTWFuYWdlcigpO1xuXG5mdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyPEsgZXh0ZW5kcyBrZXlvZiBIVE1MRWxlbWVudEV2ZW50TWFwPihcblx0aWQ6IHN0cmluZyxcblx0ZXZlbnRUeXBlOiBLLFxuXHRjYWxsYmFjazogKGV2OiBIVE1MRWxlbWVudEV2ZW50TWFwW0tdKSA9PiB2b2lkXG4pOiB2b2lkIHtcblx0Y29uc3QgdGhpc0Z1bmN0aW9uID0gJ2FkZEV2ZW50TGlzdGVuZXIoKSc7XG5cdGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7XG5cblx0aWYgKGVsZW1lbnQpIHtcblx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRUeXBlLCBjYWxsYmFjayk7XG5cdH0gZWxzZSBpZiAobG9nTW9kZS53YXJuKSB7XG5cdFx0aWYgKG1vZGUuZGVidWcgJiYgbG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMilcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHRgRWxlbWVudCB3aXRoIGlkIFwiJHtpZH1cIiBub3QgZm91bmQuYCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGluaXRpYWxpemVFdmVudExpc3RlbmVycygpOiB2b2lkIHtcblx0Y29uc3QgdGhpc0Z1bmN0aW9uID0gJ2luaXRpYWxpemVFdmVudExpc3RlbmVycygpJztcblxuXHRjb25zdCBhZGRDb252ZXJzaW9uTGlzdGVuZXIgPSAoaWQ6IHN0cmluZywgY29sb3JTcGFjZTogc3RyaW5nKSA9PiB7XG5cdFx0Y29uc3QgYnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpIGFzIEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbDtcblxuXHRcdGlmIChidG4pIHtcblx0XHRcdGlmIChjb3JlVXRpbHMuZ3VhcmRzLmlzQ29sb3JTcGFjZShjb2xvclNwYWNlKSkge1xuXHRcdFx0XHRidG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PlxuXHRcdFx0XHRcdHN1cGVyVXRpbHMuZG9tLnN3aXRjaENvbG9yU3BhY2UoY29sb3JTcGFjZSBhcyBDb2xvclNwYWNlKVxuXHRcdFx0XHQpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKGxvZ01vZGUud2Fybikge1xuXHRcdFx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHRcdFx0YEludmFsaWQgY29sb3Igc3BhY2UgcHJvdmlkZWQ6ICR7Y29sb3JTcGFjZX1gLFxuXHRcdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAobG9nTW9kZS53YXJuKVxuXHRcdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0XHRgRWxlbWVudCB3aXRoIGlkIFwiJHtpZH1cIiBub3QgZm91bmQuYCxcblx0XHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc0Z1bmN0aW9ufWBcblx0XHRcdFx0KTtcblx0XHR9XG5cdH07XG5cblx0YWRkQ29udmVyc2lvbkxpc3RlbmVyKFN0cmluZyh1aUVsZW1lbnRJRHMuYnRucy5zaG93QXNDTVlLKSwgJ2NteWsnKTtcblx0YWRkQ29udmVyc2lvbkxpc3RlbmVyKFN0cmluZyh1aUVsZW1lbnRJRHMuYnRucy5zaG93QXNIZXgpLCAnaGV4Jyk7XG5cdGFkZENvbnZlcnNpb25MaXN0ZW5lcihTdHJpbmcodWlFbGVtZW50SURzLmJ0bnMuc2hvd0FzSFNMKSwgJ2hzbCcpO1xuXHRhZGRDb252ZXJzaW9uTGlzdGVuZXIoU3RyaW5nKHVpRWxlbWVudElEcy5idG5zLnNob3dBc0hTViksICdoc3YnKTtcblx0YWRkQ29udmVyc2lvbkxpc3RlbmVyKFN0cmluZyh1aUVsZW1lbnRJRHMuYnRucy5zaG93QXNMQUIpLCAnbGFiJyk7XG5cdGFkZENvbnZlcnNpb25MaXN0ZW5lcihTdHJpbmcodWlFbGVtZW50SURzLmJ0bnMuc2hvd0FzUkdCKSwgJ3JnYicpO1xuXG5cdGFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0dWlFbGVtZW50SURzLmJ0bnMuYXBwbHlDdXN0b21Db2xvcixcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGNvbnN0IGN1c3RvbUhTTENvbG9yID0gdWlNYW5hZ2VyLmFwcGx5Q3VzdG9tQ29sb3IoKTtcblx0XHRcdGNvbnN0IGN1c3RvbUhTTENvbG9yQ2xvbmUgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZShjdXN0b21IU0xDb2xvcik7XG5cblx0XHRcdGF3YWl0IGlkYi5zYXZlRGF0YShcblx0XHRcdFx0J2N1c3RvbUNvbG9yJyxcblx0XHRcdFx0J2FwcFNldHRpbmdzJyxcblx0XHRcdFx0Y3VzdG9tSFNMQ29sb3JDbG9uZVxuXHRcdFx0KTtcblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUuaW5mbylcblx0XHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0J0N1c3RvbSBjb2xvciBzYXZlZCB0byBJbmRleGVkREInLFxuXHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gYXBwbHlDdXN0b21Db2xvckJ1dHRvbiBjbGljayBldmVudGBcblx0XHRcdFx0KTtcblxuXHRcdFx0Ly8gKkRFVi1OT1RFKiB1bmZpbmlzaGVkLCBJIHRoaW5rPyBEb3VibGUtY2hlY2sgdGhpc1xuXHRcdH1cblx0KTtcblxuXHRhZGRFdmVudExpc3RlbmVyKFxuXHRcdHVpRWxlbWVudElEcy5idG5zLmNsZWFyQ3VzdG9tQ29sb3IsXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHR1aUVsZW1lbnRzLmlucHV0cy5jdXN0b21Db2xvciEudmFsdWUgPSAnI2ZmMDAwMCc7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLmluZm8pXG5cdFx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHRcdCdDdXN0b20gY29sb3IgY2xlYXJlZCcsXG5cdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiBjbGVhckN1c3RvbUNvbG9yQnV0dG9uIGNsaWNrIGV2ZW50YFxuXHRcdFx0XHQpO1xuXHRcdH1cblx0KTtcblxuXHRhZGRFdmVudExpc3RlbmVyKFxuXHRcdHVpRWxlbWVudElEcy5idG5zLmN1c3RvbUNvbG9yTWVudSxcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdHVpRWxlbWVudHMuZGl2cy5jdXN0b21Db2xvck1lbnU/LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuXHRcdFx0dWlFbGVtZW50cy5kaXZzLmN1c3RvbUNvbG9yTWVudT8uc2V0QXR0cmlidXRlKFxuXHRcdFx0XHQnYXJpYS1oaWRkZW4nLFxuXHRcdFx0XHQndHJ1ZSdcblx0XHRcdCk7XG5cdFx0fVxuXHQpO1xuXG5cdGlmICghdWlFbGVtZW50cy5pbnB1dHMuY3VzdG9tQ29sb3IpXG5cdFx0dGhyb3cgbmV3IEVycm9yKCdDdXN0b20gY29sb3IgaW5wdXQgZWxlbWVudCBub3QgZm91bmQnKTtcblxuXHR1aUVsZW1lbnRzLmlucHV0cy5jdXN0b21Db2xvci5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpID0+IHtcblx0XHRpZiAoIXVpRWxlbWVudHMuc3BhbnMuY3VzdG9tQ29sb3JEaXNwbGF5KVxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdDdXN0b20gY29sb3IgZGlzcGxheSBlbGVtZW50IG5vdCBmb3VuZCcpO1xuXG5cdFx0dWlFbGVtZW50cy5zcGFucy5jdXN0b21Db2xvckRpc3BsYXkudGV4dENvbnRlbnQgPVxuXHRcdFx0dWlFbGVtZW50cy5pbnB1dHMuY3VzdG9tQ29sb3IhLnZhbHVlO1xuXHR9KTtcblxuXHRhZGRFdmVudExpc3RlbmVyKFxuXHRcdHVpRWxlbWVudElEcy5idG5zLmRlc2F0dXJhdGUsXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRjb25zdCBzZWxlY3RlZENvbG9yID0gdWlFbGVtZW50cy5zZWxlY3RzLnN3YXRjaFxuXHRcdFx0XHQ/IHBhcnNlSW50KHVpRWxlbWVudHMuc2VsZWN0cy5zd2F0Y2gudmFsdWUsIDEwKVxuXHRcdFx0XHQ6IDA7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLmNsaWNrcylcblx0XHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0J2Rlc2F0dXJhdGVCdXR0b24gY2xpY2tlZCcsXG5cdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiBkZXNhdHVyYXRlQnV0dG9uIGNsaWNrIGV2ZW50YFxuXHRcdFx0XHQpO1xuXG5cdFx0XHR1aU1hbmFnZXIuZGVzYXR1cmF0ZUNvbG9yKHNlbGVjdGVkQ29sb3IpO1xuXHRcdH1cblx0KTtcblxuXHRhZGRFdmVudExpc3RlbmVyKFxuXHRcdHVpRWxlbWVudElEcy5idG5zLmV4cG9ydCxcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGNvbnN0IGZvcm1hdCA9IHBhcnNlLnBhbGV0dGVFeHBvcnRGb3JtYXQoKTtcblxuXHRcdFx0aWYgKG1vZGUuZGVidWcgJiYgbG9nTW9kZS5pbmZvICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMSlcblx0XHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0YEV4cG9ydCBCdXR0b24gY2xpY2sgZXZlbnQ6IEV4cG9ydCBmb3JtYXQgc2VsZWN0ZWQ6ICR7Zm9ybWF0fWAsXG5cdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiBleHBvcnRCdXR0b24gY2xpY2sgZXZlbnRgXG5cdFx0XHRcdCk7XG5cblx0XHRcdGlmICghZm9ybWF0KSB7XG5cdFx0XHRcdGlmIChsb2dNb2RlLmVycm9yICYmICFtb2RlLnF1aWV0ICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMSkge1xuXHRcdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHRcdCdFeHBvcnQgZm9ybWF0IG5vdCBzZWxlY3RlZCcsXG5cdFx0XHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+IGV4cG9ydEJ1dHRvbiBjbGljayBldmVudGBcblx0XHRcdFx0XHQpO1xuXG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR1aU1hbmFnZXIuaGFuZGxlRXhwb3J0KGZvcm1hdCk7XG5cdFx0XHR9XG5cdFx0fVxuXHQpO1xuXG5cdGFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0dWlFbGVtZW50SURzLmJ0bnMuZ2VuZXJhdGUsXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRjb25zdCB7IHR5cGUsIHN3YXRjaGVzLCBsaW1pdERhcmssIGxpbWl0R3JheSwgbGltaXRMaWdodCB9ID1cblx0XHRcdFx0dWlNYW5hZ2VyLnB1bGxQYXJhbXNGcm9tVUkoKTtcblxuXHRcdFx0aWYgKGxvZ01vZGUuaW5mbyAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDEpXG5cdFx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHRcdCdHZW5lcmF0ZSBCdXR0b24gY2xpY2sgZXZlbnQ6IFJldHJpZXZlZCBwYXJhbWV0ZXJzIGZyb20gVUkuJyxcblx0XHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+IGdlbmVyYXRlQnV0dG9uIGNsaWNrIGV2ZW50YFxuXHRcdFx0XHQpO1xuXG5cdFx0XHRpZiAobG9nTW9kZS5pbmZvICYmIG1vZGUuZGVidWcgJiYgbG9nTW9kZS52ZXJib3NpdHkgPiAxKVxuXHRcdFx0XHRsb2dnZXIuaW5mbyhcblx0XHRcdFx0XHRgVHlwZTogJHt0eXBlfVxcblN3YXRjaGVzOiAke3N3YXRjaGVzfVxcbkxpbWl0IERhcms6ICR7bGltaXREYXJrfVxcbkxpbWl0IEdyYXk6ICR7bGltaXRHcmF5fVxcbkxpbWl0IExpZ2h0JHtsaW1pdExpZ2h0fS5gLFxuXHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gZ2VuZXJhdGVCdXR0b24gY2xpY2sgZXZlbnRgXG5cdFx0XHRcdCk7XG5cblx0XHRcdGxldCBjdXN0b21Db2xvciA9IChhd2FpdCBpZGIuZ2V0Q3VzdG9tQ29sb3IoKSkgYXMgSFNMIHwgbnVsbDtcblxuXHRcdFx0aWYgKCFjdXN0b21Db2xvcikge1xuXHRcdFx0XHRjdXN0b21Db2xvciA9IHV0aWxzLnJhbmRvbS5oc2woKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmIChtb2RlLmRlYnVnICYmIGxvZ01vZGUuaW5mbylcblx0XHRcdFx0XHRsb2dnZXIuaW5mbyhcblx0XHRcdFx0XHRcdGBVc2VyLWdlbmVyYXRlZCBDdXN0b20gQ29sb3IgZm91bmQgaW4gSW5kZXhlZERCOiAke0pTT04uc3RyaW5naWZ5KFxuXHRcdFx0XHRcdFx0XHRjdXN0b21Db2xvclxuXHRcdFx0XHRcdFx0KX1gLFxuXHRcdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiBnZW5lcmF0ZUJ1dHRvbiBjbGljayBldmVudGBcblx0XHRcdFx0XHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRjb25zdCBwYWxldHRlT3B0aW9uczogUGFsZXR0ZU9wdGlvbnMgPSB7XG5cdFx0XHRcdGN1c3RvbUNvbG9yOiBjb3JlVXRpbHMuYmFzZS5jbG9uZShjdXN0b21Db2xvciksXG5cdFx0XHRcdGZsYWdzOiB7XG5cdFx0XHRcdFx0bGltaXREYXJrLFxuXHRcdFx0XHRcdGxpbWl0R3JheSxcblx0XHRcdFx0XHRsaW1pdExpZ2h0XG5cdFx0XHRcdH0sXG5cdFx0XHRcdHN3YXRjaGVzLFxuXHRcdFx0XHR0eXBlXG5cdFx0XHR9O1xuXG5cdFx0XHRhd2FpdCBzdGFydC5wYWxldHRlR2VuZXJhdGlvbihwYWxldHRlT3B0aW9ucyk7XG5cdFx0fVxuXHQpO1xuXG5cdGFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0dWlFbGVtZW50SURzLmJ0bnMuaGVscE1lbnUsXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHR1aUVsZW1lbnRzLmRpdnMuaGVscE1lbnU/LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuXHRcdH1cblx0KTtcblxuXHRhZGRFdmVudExpc3RlbmVyKFxuXHRcdHVpRWxlbWVudElEcy5idG5zLmhpc3RvcnlNZW51LFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0dWlFbGVtZW50cy5kaXZzLmhpc3RvcnlNZW51Py5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcblx0XHR9XG5cdCk7XG5cblx0YWRkRXZlbnRMaXN0ZW5lcihcblx0XHR1aUVsZW1lbnRJRHMuaW5wdXRzLmhpc3RvcnlMaW1pdCxcblx0XHQnaW5wdXQnLFxuXHRcdGFzeW5jIChlOiBFdmVudCkgPT4ge1xuXHRcdFx0Y29uc3QgaW5wdXQgPSBlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXHRcdFx0Y29uc3QgbmV3TGltaXQgPSBwYXJzZUludChpbnB1dC52YWx1ZSwgMTApO1xuXG5cdFx0XHRpZiAoaXNOYU4obmV3TGltaXQpIHx8IG5ld0xpbWl0IDwgMSB8fCBuZXdMaW1pdCA+IDEwMDApIHtcblx0XHRcdFx0aW5wdXQudmFsdWUgPSAnNTAnO1xuXG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgdWlNYW5hZ2VyID0gbmV3IFVJTWFuYWdlcigpO1xuXHRcdFx0YXdhaXQgdWlNYW5hZ2VyLnNldEhpc3RvcnlMaW1pdChuZXdMaW1pdCk7XG5cdFx0fVxuXHQpO1xuXG5cdGFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0dWlFbGVtZW50SURzLmJ0bnMuaW9NZW51LFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0dWlFbGVtZW50cy5kaXZzLmlvTWVudT8uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG5cdFx0fVxuXHQpO1xuXG5cdGFkZEV2ZW50TGlzdGVuZXIodWlFbGVtZW50SURzLmlucHV0cy5pbXBvcnQsICdjaGFuZ2UnLCBhc3luYyAoZTogRXZlbnQpID0+IHtcblx0XHRjb25zdCBpbnB1dCA9IGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG5cblx0XHRpZiAoaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXMubGVuZ3RoID4gMCkge1xuXHRcdFx0Y29uc3QgZmlsZSA9IGlucHV0LmZpbGVzWzBdO1xuXG5cdFx0XHQvLyAqREVWLU5PVEUqIGltcGxlbWVudCBhIHdheSB0byBkZXRlcm1pbmUgd2hldGhlciBmaWxlIGRlc2NyaWJlcyBDU1MsIEpTT04sIG9yIFhNTCBpbXBvcnRcblx0XHRcdGNvbnN0IGZvcm1hdCA9ICdKU09OJztcblxuXHRcdFx0YXdhaXQgdWlNYW5hZ2VyLmhhbmRsZUltcG9ydChmaWxlLCBmb3JtYXQpO1xuXHRcdH1cblx0fSk7XG5cblx0YWRkRXZlbnRMaXN0ZW5lcihcblx0XHR1aUVsZW1lbnRJRHMuYnRucy5zYXR1cmF0ZSxcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGlmICghdWlFbGVtZW50cy5zZWxlY3RzLnN3YXRjaCkge1xuXHRcdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ1NlbGVjdGVkIGNvbG9yIG9wdGlvbiBub3QgZm91bmQnKTtcblx0XHRcdH1cblxuXHRcdFx0Y29uc3Qgc2VsZWN0ZWRDb2xvciA9IHVpRWxlbWVudHMuc2VsZWN0cy5zd2F0Y2hcblx0XHRcdFx0PyBwYXJzZUludCh1aUVsZW1lbnRzLnNlbGVjdHMuc3dhdGNoLnZhbHVlLCAxMClcblx0XHRcdFx0OiAwO1xuXG5cdFx0XHR1aU1hbmFnZXIuc2F0dXJhdGVDb2xvcihzZWxlY3RlZENvbG9yKTtcblx0XHR9XG5cdCk7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRpZiAodWlFbGVtZW50cy5kaXZzLmN1c3RvbUNvbG9yTWVudSlcblx0XHRcdGlmIChlLnRhcmdldCA9PT0gdWlFbGVtZW50cy5kaXZzLmN1c3RvbUNvbG9yTWVudSkge1xuXHRcdFx0XHR1aUVsZW1lbnRzLmRpdnMuY3VzdG9tQ29sb3JNZW51LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuXHRcdFx0fVxuXHR9KTtcblxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdGlmICh1aUVsZW1lbnRzLmRpdnMuaGVscE1lbnUpXG5cdFx0XHRpZiAoZS50YXJnZXQgPT09IHVpRWxlbWVudHMuZGl2cy5oZWxwTWVudSkge1xuXHRcdFx0XHR1aUVsZW1lbnRzLmRpdnMuaGVscE1lbnUuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG5cdFx0XHR9XG5cdH0pO1xuXG5cdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0aWYgKHVpRWxlbWVudHMuZGl2cy5oaXN0b3J5TWVudSlcblx0XHRcdGlmIChlLnRhcmdldCA9PT0gdWlFbGVtZW50cy5kaXZzLmhpc3RvcnlNZW51KSB7XG5cdFx0XHRcdHVpRWxlbWVudHMuZGl2cy5oaXN0b3J5TWVudS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcblx0XHRcdH1cblx0fSk7XG5cblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRpZiAodWlFbGVtZW50cy5kaXZzLmlvTWVudSlcblx0XHRcdGlmIChlLnRhcmdldCA9PT0gdWlFbGVtZW50cy5kaXZzLmlvTWVudSkge1xuXHRcdFx0XHR1aUVsZW1lbnRzLmRpdnMuaW9NZW51LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuXHRcdFx0fVxuXHR9KTtcbn1cblxuY29uc3QgcHJvY2Vzc1BhbGV0dGVHZW5lcmF0aW9uID0gY29yZVV0aWxzLmJhc2UuZGVib3VuY2UoYXN5bmMgKCkgPT4ge1xuXHRjb25zdCB0aGlzRnVuY3Rpb24gPSAncHJvY2Vzc1BhbGV0dGVHZW5lcmF0aW9uJztcblxuXHR0cnkge1xuXHRcdGNvbnN0IHBhcmFtcyA9IHN1cGVyVXRpbHMuZG9tLmdldFBhbGV0dGVHZW5lcmF0aW9uQXJncygpO1xuXG5cdFx0aWYgKCFwYXJhbXMpIHtcblx0XHRcdGlmIChsb2dNb2RlLmVycm9yKSB7XG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHQnRmFpbGVkIHRvIHJldHJpZXZlIGdlbmVyYXRlQnV0dG9uIHBhcmFtZXRlcnMnLFxuXHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzRnVuY3Rpb259YFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3Qge1xuXHRcdFx0c3dhdGNoZXMsXG5cdFx0XHRjdXN0b21Db2xvcixcblx0XHRcdHR5cGUsXG5cdFx0XHRsaW1pdERhcmssXG5cdFx0XHRsaW1pdEdyYXksXG5cdFx0XHRsaW1pdExpZ2h0XG5cdFx0fSA9IHBhcmFtcztcblxuXHRcdGlmICghdHlwZSB8fCAhc3dhdGNoZXMpIHtcblx0XHRcdGlmIChsb2dNb2RlLmVycm9yKSB7XG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHQncGFsZXR0ZVR5cGUgYW5kL29yIHN3YXRjaGVzIGFyZSB1bmRlZmluZWQnLFxuXHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzRnVuY3Rpb259YFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXG5cdFx0Y29uc3Qgb3B0aW9uczogUGFsZXR0ZU9wdGlvbnMgPSB7XG5cdFx0XHRjdXN0b21Db2xvcixcblx0XHRcdGZsYWdzOiB7XG5cdFx0XHRcdGxpbWl0RGFyayxcblx0XHRcdFx0bGltaXRHcmF5LFxuXHRcdFx0XHRsaW1pdExpZ2h0XG5cdFx0XHR9LFxuXHRcdFx0c3dhdGNoZXMsXG5cdFx0XHR0eXBlXG5cdFx0fTtcblxuXHRcdHN0YXJ0LnBhbGV0dGVHZW5lcmF0aW9uKG9wdGlvbnMpO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRmFpbGVkIHRvIGhhbmRsZSBnZW5lcmF0ZSBidXR0b24gY2xpY2s6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXHR9XG59LCBidG5EZWJvdW5jZSk7XG5cbmV4cG9ydCBjb25zdCBiYXNlOiBET01Gbl9NYXN0ZXJJbnRlcmZhY2VbJ2V2ZW50cyddID0ge1xuXHRhZGRFdmVudExpc3RlbmVyLFxuXHRpbml0aWFsaXplRXZlbnRMaXN0ZW5lcnMsXG5cdHByb2Nlc3NQYWxldHRlR2VuZXJhdGlvblxufTtcbiJdfQ==