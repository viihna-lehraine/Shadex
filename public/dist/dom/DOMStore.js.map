{"version":3,"file":"DOMStore.js","sources":["../../../../src/dom/DOMStore.ts"],"sourcesContent":["// File: common/services/DOMStore.ts\n\nimport {\n\tDOMElements,\n\tDOMStoreContract,\n\tHelpers,\n\tServices,\n\tUnvalidatedDOMElements\n} from '../types/index.js';\nimport { domIndex } from '../config/index.js';\n\nconst caller = 'DOMStore';\nconst ids = domIndex.ids;\n\nexport class DOMStore implements DOMStoreContract {\n\tstatic #instance: DOMStore;\n\n\t#elements: DOMElements | null = null;\n\n\t#errors: Services['errors'];\n\t#helpers: Helpers;\n\t#log: Services['log'];\n\n\tprivate constructor(\n\t\terrors: Services['errors'],\n\t\thelpers: Helpers,\n\t\tlog: Services['log']\n\t) {\n\t\ttry {\n\t\t\tlog.info(`Constructing DOMStore instance`, `${caller} constructor`);\n\n\t\t\tthis.#errors = errors;\n\t\t\tthis.#log = log;\n\t\t\tthis.#helpers = helpers;\n\n\t\t\tthis.#validateAndGetDOMElements();\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller} constructor]: ${error instanceof Error ? error.message : error}`\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic getInstance(\n\t\terrors: Services['errors'],\n\t\thelpers: Helpers,\n\t\tlog: Services['log']\n\t): DOMStore {\n\t\treturn errors.handleSync(() => {\n\t\t\tif (!DOMStore.#instance) {\n\t\t\t\tlog.debug(\n\t\t\t\t\t'No DOMStore instance exists yet. Creating DOMStore instance',\n\t\t\t\t\t`${caller}.getInstance`\n\t\t\t\t);\n\n\t\t\t\tDOMStore.#instance = new DOMStore(errors, helpers, log);\n\t\t\t}\n\n\t\t\tlog.debug(`Returning DOMStore instance`, `${caller}.getInstance`);\n\t\t\treturn DOMStore.#instance;\n\t\t}, `[${caller}]: Error getting DOMStore instance.`);\n\t}\n\n\tgetElement<K extends keyof DOMElements, E extends keyof DOMElements[K]>(\n\t\tcategory: K,\n\t\tkey: E\n\t): DOMElements[K][E] {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tconst element = this.#elements?.[category]?.[key];\n\n\t\t\tif (!element) {\n\t\t\t\tthis.#log.error(\n\t\t\t\t\t`Element ${category}.${String(key)} is not validated or missing.`,\n\t\t\t\t\t`${caller}.getElement`\n\t\t\t\t);\n\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`[${caller}]: Element ${category}.${String(key)} not found`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn element;\n\t\t}, `[${caller}]: Error getting DOM element.`);\n\t}\n\n\tgetElements(): DOMElements {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tif (!this.#elements) {\n\t\t\t\tthis.#log.warn(\n\t\t\t\t\t'DOM elements are not validated yet.',\n\t\t\t\t\t`${caller}.getElements`\n\t\t\t\t);\n\n\t\t\t\tthrow new Error(`[${caller}]: DOM elements are not yet validated.`);\n\t\t\t}\n\n\t\t\treturn this.#elements;\n\t\t}, `[${caller}]: Error getting DOM elements.`);\n\t}\n\n\tsetElements(elements: DOMElements): void {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tthis.#elements = elements;\n\n\t\t\tthis.#log.debug('DOM elements set successfully', `${caller}.setElements`);\n\t\t}, `[${caller}]: Unable to set DOM elements.`);\n\t}\n\n\t#validateAndGetDOMElements(): void {\n\t\tconst missingElements: string[] = [];\n\n\t\treturn this.#errors.handleSync(\n\t\t\t() => {\n\t\t\t\tconst elementTypeMap: Record<\n\t\t\t\t\tkeyof UnvalidatedDOMElements,\n\t\t\t\t\tkeyof HTMLElementTagNameMap\n\t\t\t\t> = {\n\t\t\t\t\tbtns: 'button',\n\t\t\t\t\tdivs: 'div',\n\t\t\t\t\tinputs: 'input'\n\t\t\t\t};\n\n\t\t\t\tconst elements: Partial<DOMElements> = {\n\t\t\t\t\tbtns: {} as DOMElements['btns'],\n\t\t\t\t\tdivs: {} as DOMElements['divs'],\n\t\t\t\t\tinputs: {} as DOMElements['inputs']\n\t\t\t\t};\n\n\t\t\t\tfor (const [category, elementsGroup] of Object.entries(ids)) {\n\t\t\t\t\tconst tagName =\n\t\t\t\t\t\telementTypeMap[category as keyof UnvalidatedDOMElements];\n\t\t\t\t\tif (!tagName) {\n\t\t\t\t\t\tthis.#log.warn(\n\t\t\t\t\t\t\t`No element type mapping for category \"${category}\". Skipping...`,\n\t\t\t\t\t\t\t`${caller}.#validateAndGetDOMElements`\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const [key, id] of Object.entries(elementsGroup)) {\n\t\t\t\t\t\tconst element =\n\t\t\t\t\t\t\tthis.#helpers.dom.getElement<\n\t\t\t\t\t\t\t\tHTMLElementTagNameMap[typeof tagName]\n\t\t\t\t\t\t\t>(id);\n\n\t\t\t\t\t\tif (!element) {\n\t\t\t\t\t\t\tthis.#log.warn(\n\t\t\t\t\t\t\t\t`Element with ID \"${id}\" not found.`,\n\t\t\t\t\t\t\t\t`${caller}.#validateAndGetDOMElements`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tmissingElements.push(id);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\telements[category as keyof DOMElements] as Record<\n\t\t\t\t\t\t\t\t\tstring,\n\t\t\t\t\t\t\t\t\tHTMLElement\n\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t)[key] = element;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (missingElements.length > 0) {\n\t\t\t\t\tthis.#log.warn(\n\t\t\t\t\t\t`Missing elements: ${missingElements.join(', ')}`,\n\t\t\t\t\t\t`${caller}.#validateAndGetDOMElements`\n\t\t\t\t\t);\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`[${caller}]: Some DOM elements are missing. Validation failed.`\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.#elements = elements as DOMElements;\n\n\t\t\t\tthis.#log.info(\n\t\t\t\t\t'All static elements are present! üè≥Ô∏è‚Äç‚ößÔ∏è ü©∑ üè≥Ô∏è‚Äç‚ößÔ∏è',\n\t\t\t\t\t`[${caller}.#validateAndGetDOMElements]`\n\t\t\t\t);\n\t\t\t},\n\t\t\t`[${caller}]: Unable to validate DOM elements.`,\n\t\t\t{ context: { missingElements } }\n\t\t);\n\t}\n}\n"],"names":[],"mappings":"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"}