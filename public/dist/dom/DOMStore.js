// File: common/services/DOMStore.ts
import { domIndex } from '../config/index.js';
const caller = 'DOMStore';
const ids = domIndex.ids;
export class DOMStore {
    static #instance;
    #elements = null;
    #errors;
    #helpers;
    #log;
    constructor(errors, helpers, log) {
        try {
            log.info(`Constructing DOMStore instance`, `${caller} constructor`);
            this.#errors = errors;
            this.#log = log;
            this.#helpers = helpers;
            this.#validateAndGetDOMElements();
        }
        catch (error) {
            throw new Error(`[${caller} constructor]: ${error instanceof Error ? error.message : error}`);
        }
    }
    static getInstance(errors, helpers, log) {
        return errors.handleSync(() => {
            if (!DOMStore.#instance) {
                log.debug('No DOMStore instance exists yet. Creating DOMStore instance', `${caller}.getInstance`);
                DOMStore.#instance = new DOMStore(errors, helpers, log);
            }
            return DOMStore.#instance;
        }, `[${caller}]: Error getting DOMStore instance.`, { fallback: new DOMStore(errors, helpers, log) });
    }
    getElement(category, key) {
        return this.#errors.handleSync(() => {
            const element = this.#elements?.[category]?.[key];
            if (!element) {
                this.#log.error(`Element ${category}.${String(key)} is not validated or missing.`, `${caller}.getElement`);
                throw new Error(`[${caller}]: Element ${category}.${String(key)} not found`);
            }
            return element;
        }, `[${caller}]: Error getting DOM element.`);
    }
    getElements() {
        return this.#errors.handleSync(() => {
            if (!this.#elements) {
                this.#log.warn('DOM elements are not validated yet.', `${caller}.getElements`);
                throw new Error(`[${caller}]: DOM elements are not yet validated.`);
            }
            return this.#elements;
        }, `[${caller}]: Error getting DOM elements.`);
    }
    setElements(elements) {
        return this.#errors.handleSync(() => {
            this.#elements = elements;
            this.#log.debug('DOM elements set successfully', `${caller}.setElements`);
        }, `[${caller}]: Unable to set DOM elements.`);
    }
    #validateAndGetDOMElements() {
        const missingElements = [];
        return this.#errors.handleSync(() => {
            const elementTypeMap = {
                btns: 'button',
                divs: 'div',
                inputs: 'input'
            };
            const elements = {
                btns: {},
                divs: {},
                inputs: {}
            };
            for (const [category, elementsGroup] of Object.entries(ids)) {
                const tagName = elementTypeMap[category];
                if (!tagName) {
                    this.#log.warn(`No element type mapping for category "${category}". Skipping...`, `${caller}.#validateAndGetDOMElements`);
                    continue;
                }
                for (const [key, id] of Object.entries(elementsGroup)) {
                    const element = this.#helpers.dom.getElement(id);
                    if (!element) {
                        this.#log.warn(`Element with ID "${id}" not found.`, `${caller}.#validateAndGetDOMElements`);
                        missingElements.push(id);
                    }
                    else {
                        elements[category][key] = element;
                    }
                }
            }
            if (missingElements.length > 0) {
                this.#log.warn(`Missing elements: ${missingElements.join(', ')}`, `${caller}.#validateAndGetDOMElements`);
                throw new Error(`[${caller}]: Some DOM elements are missing. Validation failed.`);
            }
            this.#elements = elements;
            this.#log.info('All static elements are present! üè≥Ô∏è‚Äç‚ößÔ∏è ü©∑ üè≥Ô∏è‚Äç‚ößÔ∏è', `[${caller}.#validateAndGetDOMElements]`);
        }, `[${caller}]: Unable to validate DOM elements.`, { context: { missingElements } });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRE9NU3RvcmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZG9tL0RPTVN0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG9DQUFvQztBQVNwQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFOUMsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDO0FBQzFCLE1BQU0sR0FBRyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUM7QUFFekIsTUFBTSxPQUFPLFFBQVE7SUFDcEIsTUFBTSxDQUFDLFNBQVMsQ0FBVztJQUUzQixTQUFTLEdBQXVCLElBQUksQ0FBQztJQUVyQyxPQUFPLENBQXFCO0lBQzVCLFFBQVEsQ0FBVTtJQUNsQixJQUFJLENBQWtCO0lBRXRCLFlBQ0MsTUFBMEIsRUFDMUIsT0FBZ0IsRUFDaEIsR0FBb0I7UUFFcEIsSUFBSSxDQUFDO1lBQ0osR0FBRyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLE1BQU0sY0FBYyxDQUFDLENBQUM7WUFFcEUsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7WUFDdEIsSUFBSSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7WUFDaEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUM7WUFFeEIsSUFBSSxDQUFDLDBCQUEwQixFQUFFLENBQUM7UUFDbkMsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FDZCxJQUFJLE1BQU0sa0JBQWtCLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUM1RSxDQUFDO1FBQ0gsQ0FBQztJQUNGLENBQUM7SUFFRCxNQUFNLENBQUMsV0FBVyxDQUNqQixNQUEwQixFQUMxQixPQUFnQixFQUNoQixHQUFvQjtRQUVwQixPQUFPLE1BQU0sQ0FBQyxVQUFVLENBQ3ZCLEdBQUcs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SSxNQUFNLDhCQUE4QixDQUN4QyxDQUFDO1FBQ0gsQ0FBQyxFQUNELElBQUksTUFBTSxxQ0FBcUMsRUFDL0MsRUFBRSxPQUFPLEVBQUUsRUFBRSxlQUFlLEVBQUUsRUFBRSxDQUNoQyxDQUFDO0lBQ0gsQ0FBQztDQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogY29tbW9uL3NlcnZpY2VzL0RPTVN0b3JlLnRzXG5cbmltcG9ydCB7XG5cdERPTUVsZW1lbnRzLFxuXHRET01TdG9yZUNvbnRyYWN0LFxuXHRIZWxwZXJzLFxuXHRTZXJ2aWNlcyxcblx0VW52YWxpZGF0ZWRET01FbGVtZW50c1xufSBmcm9tICcuLi90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBkb21JbmRleCB9IGZyb20gJy4uL2NvbmZpZy9pbmRleC5qcyc7XG5cbmNvbnN0IGNhbGxlciA9ICdET01TdG9yZSc7XG5jb25zdCBpZHMgPSBkb21JbmRleC5pZHM7XG5cbmV4cG9ydCBjbGFzcyBET01TdG9yZSBpbXBsZW1lbnRzIERPTVN0b3JlQ29udHJhY3Qge1xuXHRzdGF0aWMgI2luc3RhbmNlOiBET01TdG9yZTtcblxuXHQjZWxlbWVudHM6IERPTUVsZW1lbnRzIHwgbnVsbCA9IG51bGw7XG5cblx0I2Vycm9yczogU2VydmljZXNbJ2Vycm9ycyddO1xuXHQjaGVscGVyczogSGVscGVycztcblx0I2xvZzogU2VydmljZXNbJ2xvZyddO1xuXG5cdHByaXZhdGUgY29uc3RydWN0b3IoXG5cdFx0ZXJyb3JzOiBTZXJ2aWNlc1snZXJyb3JzJ10sXG5cdFx0aGVscGVyczogSGVscGVycyxcblx0XHRsb2c6IFNlcnZpY2VzWydsb2cnXVxuXHQpIHtcblx0XHR0cnkge1xuXHRcdFx0bG9nLmluZm8oYENvbnN0cnVjdGluZyBET01TdG9yZSBpbnN0YW5jZWAsIGAke2NhbGxlcn0gY29uc3RydWN0b3JgKTtcblxuXHRcdFx0dGhpcy4jZXJyb3JzID0gZXJyb3JzO1xuXHRcdFx0dGhpcy4jbG9nID0gbG9nO1xuXHRcdFx0dGhpcy4jaGVscGVycyA9IGhlbHBlcnM7XG5cblx0XHRcdHRoaXMuI3ZhbGlkYXRlQW5kR2V0RE9NRWxlbWVudHMoKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRgWyR7Y2FsbGVyfSBjb25zdHJ1Y3Rvcl06ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBlcnJvcn1gXG5cdFx0XHQpO1xuXHRcdH1cblx0fVxuXG5cdHN0YXRpYyBnZXRJbnN0YW5jZShcblx0XHRlcnJvcnM6IFNlcnZpY2VzWydlcnJvcnMnXSxcblx0XHRoZWxwZXJzOiBIZWxwZXJzLFxuXHRcdGxvZzogU2VydmljZXNbJ2xvZyddXG5cdCk6IERPTVN0b3JlIHtcblx0XHRyZXR1cm4gZXJyb3JzLmhhbmRsZVN5bmMoXG5cdFx0XHQoKSA9PiB7XG5cdFx0XHRcdGlmICghRE9NU3RvcmUuI2luc3RhbmNlKSB7XG5cdFx0XHRcdFx0bG9nLmRlYnVnKFxuXHRcdFx0XHRcdFx0J05vIERPTVN0b3JlIGluc3RhbmNlIGV4aXN0cyB5ZXQuIENyZWF0aW5nIERPTVN0b3JlIGluc3RhbmNlJyxcblx0XHRcdFx0XHRcdGAke2NhbGxlcn0uZ2V0SW5zdGFuY2VgXG5cdFx0XHRcdFx0KTtcblxuXHRcdFx0XHRcdERPTVN0b3JlLiNpbnN0YW5jZSA9IG5ldyBET01TdG9yZShlcnJvcnMsIGhlbHBlcnMsIGxvZyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXR1cm4gRE9NU3RvcmUuI2luc3RhbmNlO1xuXHRcdFx0fSxcblx0XHRcdGBbJHtjYWxsZXJ9XTogRXJyb3IgZ2V0dGluZyBET01TdG9yZSBpbnN0YW5jZS5gLFxuXHRcdFx0eyBmYWxsYmFjazogbmV3IERPTVN0b3JlKGVycm9ycywgaGVscGVycywgbG9nKSB9XG5cdFx0KTtcblx0fVxuXG5cdGdldEVsZW1lbnQ8SyBleHRlbmRzIGtleW9mIERPTUVsZW1lbnRzLCBFIGV4dGVuZHMga2V5b2YgRE9NRWxlbWVudHNbS10+KFxuXHRcdGNhdGVnb3J5OiBLLFxuXHRcdGtleTogRVxuXHQpOiBET01FbGVtZW50c1tLXVtFXSB7XG5cdFx0cmV0dXJuIHRoaXMuI2Vycm9ycy5oYW5kbGVTeW5jKCgpID0+IHtcblx0XHRcdGNvbnN0IGVsZW1lbnQgPSB0aGlzLiNlbGVtZW50cz8uW2NhdGVnb3J5XT8uW2tleV07XG5cblx0XHRcdGlmICghZWxlbWVudCkge1xuXHRcdFx0XHR0aGlzLiNsb2cuZXJyb3IoXG5cdFx0XHRcdFx0YEVsZW1lbnQgJHtjYXRlZ29yeX0uJHtTdHJpbmcoa2V5KX0gaXMgbm90IHZhbGlkYXRlZCBvciBtaXNzaW5nLmAsXG5cdFx0XHRcdFx0YCR7Y2FsbGVyfS5nZXRFbGVtZW50YFxuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHRgWyR7Y2FsbGVyfV06IEVsZW1lbnQgJHtjYXRlZ29yeX0uJHtTdHJpbmcoa2V5KX0gbm90IGZvdW5kYFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZWxlbWVudDtcblx0XHR9LCBgWyR7Y2FsbGVyfV06IEVycm9yIGdldHRpbmcgRE9NIGVsZW1lbnQuYCk7XG5cdH1cblxuXHRnZXRFbGVtZW50cygpOiBET01FbGVtZW50cyB7XG5cdFx0cmV0dXJuIHRoaXMuI2Vycm9ycy5oYW5kbGVTeW5jKCgpID0+IHtcblx0XHRcdGlmICghdGhpcy4jZWxlbWVudHMpIHtcblx0XHRcdFx0dGhpcy4jbG9nLndhcm4oXG5cdFx0XHRcdFx0J0RPTSBlbGVtZW50cyBhcmUgbm90IHZhbGlkYXRlZCB5ZXQuJyxcblx0XHRcdFx0XHRgJHtjYWxsZXJ9LmdldEVsZW1lbnRzYFxuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHRgWyR7Y2FsbGVyfV06IERPTSBlbGVtZW50cyBhcmUgbm90IHlldCB2YWxpZGF0ZWQuYFxuXHRcdFx0XHQpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gdGhpcy4jZWxlbWVudHM7XG5cdFx0fSwgYFske2NhbGxlcn1dOiBFcnJvciBnZXR0aW5nIERPTSBlbGVtZW50cy5gKTtcblx0fVxuXG5cdHNldEVsZW1lbnRzKGVsZW1lbnRzOiBET01FbGVtZW50cyk6IHZvaWQge1xuXHRcdHJldHVybiB0aGlzLiNlcnJvcnMuaGFuZGxlU3luYygoKSA9PiB7XG5cdFx0XHR0aGlzLiNlbGVtZW50cyA9IGVsZW1lbnRzO1xuXG5cdFx0XHR0aGlzLiNsb2cuZGVidWcoXG5cdFx0XHRcdCdET00gZWxlbWVudHMgc2V0IHN1Y2Nlc3NmdWxseScsXG5cdFx0XHRcdGAke2NhbGxlcn0uc2V0RWxlbWVudHNgXG5cdFx0XHQpO1xuXHRcdH0sIGBbJHtjYWxsZXJ9XTogVW5hYmxlIHRvIHNldCBET00gZWxlbWVudHMuYCk7XG5cdH1cblxuXHQjdmFsaWRhdGVBbmRHZXRET01FbGVtZW50cygpOiB2b2lkIHtcblx0XHRjb25zdCBtaXNzaW5nRWxlbWVudHM6IHN0cmluZ1tdID0gW107XG5cblx0XHRyZXR1cm4gdGhpcy4jZXJyb3JzLmhhbmRsZVN5bmMoXG5cdFx0XHQoKSA9PiB7XG5cdFx0XHRcdGNvbnN0IGVsZW1lbnRUeXBlTWFwOiBSZWNvcmQ8XG5cdFx0XHRcdFx0a2V5b2YgVW52YWxpZGF0ZWRET01FbGVtZW50cyxcblx0XHRcdFx0XHRrZXlvZiBIVE1MRWxlbWVudFRhZ05hbWVNYXBcblx0XHRcdFx0PiA9IHtcblx0XHRcdFx0XHRidG5zOiAnYnV0dG9uJyxcblx0XHRcdFx0XHRkaXZzOiAnZGl2Jyxcblx0XHRcdFx0XHRpbnB1dHM6ICdpbnB1dCdcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRjb25zdCBlbGVtZW50czogUGFydGlhbDxET01FbGVtZW50cz4gPSB7XG5cdFx0XHRcdFx0YnRuczoge30gYXMgRE9NRWxlbWVudHNbJ2J0bnMnXSxcblx0XHRcdFx0XHRkaXZzOiB7fSBhcyBET01FbGVtZW50c1snZGl2cyddLFxuXHRcdFx0XHRcdGlucHV0czoge30gYXMgRE9NRWxlbWVudHNbJ2lucHV0cyddXG5cdFx0XHRcdH07XG5cblx0XHRcdFx0Zm9yIChjb25zdCBbY2F0ZWdvcnksIGVsZW1lbnRzR3JvdXBdIG9mIE9iamVjdC5lbnRyaWVzKGlkcykpIHtcblx0XHRcdFx0XHRjb25zdCB0YWdOYW1lID1cblx0XHRcdFx0XHRcdGVsZW1lbnRUeXBlTWFwW1xuXHRcdFx0XHRcdFx0XHRjYXRlZ29yeSBhcyBrZXlvZiBVbnZhbGlkYXRlZERPTUVsZW1lbnRzXG5cdFx0XHRcdFx0XHRdO1xuXHRcdFx0XHRcdGlmICghdGFnTmFtZSkge1xuXHRcdFx0XHRcdFx0dGhpcy4jbG9nLndhcm4oXG5cdFx0XHRcdFx0XHRcdGBObyBlbGVtZW50IHR5cGUgbWFwcGluZyBmb3IgY2F0ZWdvcnkgXCIke2NhdGVnb3J5fVwiLiBTa2lwcGluZy4uLmAsXG5cdFx0XHRcdFx0XHRcdGAke2NhbGxlcn0uI3ZhbGlkYXRlQW5kR2V0RE9NRWxlbWVudHNgXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Zm9yIChjb25zdCBba2V5LCBpZF0gb2YgT2JqZWN0LmVudHJpZXMoZWxlbWVudHNHcm91cCkpIHtcblx0XHRcdFx0XHRcdGNvbnN0IGVsZW1lbnQgPVxuXHRcdFx0XHRcdFx0XHR0aGlzLiNoZWxwZXJzLmRvbS5nZXRFbGVtZW50PFxuXHRcdFx0XHRcdFx0XHRcdEhUTUxFbGVtZW50VGFnTmFtZU1hcFt0eXBlb2YgdGFnTmFtZV1cblx0XHRcdFx0XHRcdFx0PihpZCk7XG5cblx0XHRcdFx0XHRcdGlmICghZWxlbWVudCkge1xuXHRcdFx0XHRcdFx0XHR0aGlzLiNsb2cud2Fybihcblx0XHRcdFx0XHRcdFx0XHRgRWxlbWVudCB3aXRoIElEIFwiJHtpZH1cIiBub3QgZm91bmQuYCxcblx0XHRcdFx0XHRcdFx0XHRgJHtjYWxsZXJ9LiN2YWxpZGF0ZUFuZEdldERPTUVsZW1lbnRzYFxuXHRcdFx0XHRcdFx0XHQpO1xuXG5cdFx0XHRcdFx0XHRcdG1pc3NpbmdFbGVtZW50cy5wdXNoKGlkKTtcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdChcblx0XHRcdFx0XHRcdFx0XHRlbGVtZW50c1tcblx0XHRcdFx0XHRcdFx0XHRcdGNhdGVnb3J5IGFzIGtleW9mIERPTUVsZW1lbnRzXG5cdFx0XHRcdFx0XHRcdFx0XSBhcyBSZWNvcmQ8c3RyaW5nLCBIVE1MRWxlbWVudD5cblx0XHRcdFx0XHRcdFx0KVtrZXldID0gZWxlbWVudDtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAobWlzc2luZ0VsZW1lbnRzLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHR0aGlzLiNsb2cud2Fybihcblx0XHRcdFx0XHRcdGBNaXNzaW5nIGVsZW1lbnRzOiAke21pc3NpbmdFbGVtZW50cy5qb2luKCcsICcpfWAsXG5cdFx0XHRcdFx0XHRgJHtjYWxsZXJ9LiN2YWxpZGF0ZUFuZEdldERPTUVsZW1lbnRzYFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRcdFx0YFske2NhbGxlcn1dOiBTb21lIERPTSBlbGVtZW50cyBhcmUgbWlzc2luZy4gVmFsaWRhdGlvbiBmYWlsZWQuYFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHR0aGlzLiNlbGVtZW50cyA9IGVsZW1lbnRzIGFzIERPTUVsZW1lbnRzO1xuXG5cdFx0XHRcdHRoaXMuI2xvZy5pbmZvKFxuXHRcdFx0XHRcdCdBbGwgc3RhdGljIGVsZW1lbnRzIGFyZSBwcmVzZW50ISDwn4+z77iP4oCN4pqn77iPIPCfqbcg8J+Ps++4j+KAjeKap++4jycsXG5cdFx0XHRcdFx0YFske2NhbGxlcn0uI3ZhbGlkYXRlQW5kR2V0RE9NRWxlbWVudHNdYFxuXHRcdFx0XHQpO1xuXHRcdFx0fSxcblx0XHRcdGBbJHtjYWxsZXJ9XTogVW5hYmxlIHRvIHZhbGlkYXRlIERPTSBlbGVtZW50cy5gLFxuXHRcdFx0eyBjb250ZXh0OiB7IG1pc3NpbmdFbGVtZW50cyB9IH1cblx0XHQpO1xuXHR9XG59XG4iXX0=