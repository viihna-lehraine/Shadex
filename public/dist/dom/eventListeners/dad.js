// File: dom/eventListeners/dad.js
import { createLogger } from '../../logger/factory.js';
import { modeData as mode } from '../../data/mode.js';
const logMode = mode.logging;
const thisModule = 'dom/eventListeners/groups/dad.js';
const logger = await createLogger();
let dragSrcEl = null;
export function attachDADListeners(element) {
    const thisFunction = 'attach()';
    try {
        if (element) {
            element.addEventListener('dragstart', dragStart);
            element.addEventListener('dragover', dragOver);
            element.addEventListener('drop', drop);
            element.addEventListener('dragend', dragEnd);
        }
        if (logMode.debug && logMode.verbosity >= 4)
            logger.debug('Drag and drop event listeners successfully attached', `${thisModule} > ${thisFunction}`);
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Failed to execute attachDragAndDropEventListeners: ${error}`, `${thisModule} > ${thisFunction}`);
    }
}
function dragStart(e) {
    const thisFunction = 'handleDragStart()';
    try {
        dragSrcEl = e.currentTarget;
        if (e.dataTransfer) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', dragSrcEl.outerHTML);
        }
        if (logMode.debug && logMode.verbosity === 5)
            logger.info('handleDragStart complete', `${thisModule} > ${thisFunction}`);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragStart: ${error}`, `${thisModule} > ${thisFunction}`);
    }
}
function dragOver(e) {
    const thisMethod = 'handleDragOver()';
    try {
        e.preventDefault();
        if (e.dataTransfer) {
            e.dataTransfer.dropEffect = 'move';
        }
        if (mode.debug && logMode.verbosity === 5)
            logger.info('handleDragOver complete', `${thisModule} > ${thisMethod}`);
        return false;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragOver: ${error}`, `${thisModule} > ${thisMethod}`);
        return false;
    }
}
function dragEnd(e) {
    const thisMethod = 'handleDragEnd()';
    try {
        const target = e.currentTarget;
        target.classList.remove('dragging');
        document.querySelectorAll('.color-stripe').forEach(el => {
            el.classList.remove('dragging');
        });
        if (mode.debug && logMode.verbosity === 5)
            logger.info('handleDragEnd complete', `${thisModule} > ${thisMethod}`);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragEnd: ${error}`, `${thisModule} > ${thisMethod}`);
    }
}
function drop(e) {
    const thisMethod = 'drop()';
    try {
        e.stopPropagation();
        const target = e.currentTarget;
        if (dragSrcEl && dragSrcEl !== target) {
            const dragSrcId = dragSrcEl.id;
            const dropTargetId = target.id;
            const dragSrcText = dragSrcEl.querySelector('.color-text-output-box').value;
            const dropTargetText = target.querySelector('.color-text-output-box').value;
            const dragSrcOuterHTML = dragSrcEl.outerHTML;
            const dropTargetOuterHTML = target.outerHTML;
            dragSrcEl.outerHTML = dropTargetOuterHTML;
            target.outerHTML = dragSrcOuterHTML;
            const newDragSrcEl = document.getElementById(dropTargetId);
            const newDropTargetEl = document.getElementById(dragSrcId);
            newDragSrcEl.id = dragSrcId;
            newDropTargetEl.id = dropTargetId;
            newDragSrcEl.querySelector('.color-text-output-box').value = dropTargetText;
            newDropTargetEl.querySelector('.color-text-output-box').value = dragSrcText;
            if (mode.debug && logMode.verbosity >= 4)
                logger.debug('calling attachDragAndDropEventListeners for new elements', `${thisModule} > ${thisMethod}`);
            attachDADListeners(newDragSrcEl);
            attachDADListeners(newDropTargetEl);
        }
        if (logMode.debug && logMode.verbosity === 5)
            logger.info('handleDrop complete', `${thisModule} > ${thisMethod}`);
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Error in handleDrop: ${error}`, `${thisModule} > ${thisMethod}`);
    }
}
export const dadListeners = {
    attach: attachDADListeners
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGFkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2RvbS9ldmVudExpc3RlbmVycy9kYWQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsa0NBQWtDO0FBRWxDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUN2RCxPQUFPLEVBQUUsUUFBUSxJQUFJLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXRELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7QUFFN0IsTUFBTSxVQUFVLEdBQUcsa0NBQWtDLENBQUM7QUFFdEQsTUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLEVBQUUsQ0FBQztBQUVwQyxJQUFJLFNBQVMsR0FBdUIsSUFBSSxDQUFDO0FBRXpDLE1BQU0sVUFBVSxrQkFBa0IsQ0FBQyxPQUEyQjtJQUM3RCxNQUFNLFlBQVksR0FBRyxVQUFVLENBQUM7SUFFaEMsSUFBSSxDQUFDO1FBQ0osSUFBSSxPQUFPLEVBQUUsQ0FBQztZQUNiLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDakQsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUMvQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3ZDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDOUMsQ0FBQztRQUVELElBQUksT0FBTyxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsU0FBUyxJQUFJLENBQUM7WUFDMUMsTUFBTSxDQUFDLEtBQUssQ0FDWCxxREFBcUQsRUFDckQsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7SUFDSixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLEtB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QUM7WUFFdEIsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQztnQkFDdkMsTUFBTSxDQUFDLEtBQUssQ0FDWCwwREFBMEQsRUFDMUQsR0FBRyxVQUFVLE1BQU0sVUFBVSxFQUFFLENBQy9CLENBQUM7WUFFSCxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUVqQyxrQkFBa0IsQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUNyQyxDQUFDO1FBRUQsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEtBQUssQ0FBQztZQUMzQyxNQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixFQUFFLEdBQUcsVUFBVSxNQUFNLFVBQVUsRUFBRSxDQUFDLENBQUM7SUFDdEUsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLO1lBQ2pCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsd0JBQXdCLEtBQUssRUFBRSxFQUMvQixHQUFHLFVBQVUsTUFBTSxVQUFVLEVBQUUsQ0FDL0IsQ0FBQztJQUNKLENBQUM7QUFDRixDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0sWUFBWSxHQUFHO0lBQzNCLE1BQU0sRUFBRSxrQkFBa0I7Q0FDMUIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IGRvbS9ldmVudExpc3RlbmVycy9kYWQuanNcblxuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnLi4vLi4vbG9nZ2VyL2ZhY3RvcnkuanMnO1xuaW1wb3J0IHsgbW9kZURhdGEgYXMgbW9kZSB9IGZyb20gJy4uLy4uL2RhdGEvbW9kZS5qcyc7XG5cbmNvbnN0IGxvZ01vZGUgPSBtb2RlLmxvZ2dpbmc7XG5cbmNvbnN0IHRoaXNNb2R1bGUgPSAnZG9tL2V2ZW50TGlzdGVuZXJzL2dyb3Vwcy9kYWQuanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxubGV0IGRyYWdTcmNFbDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuZXhwb3J0IGZ1bmN0aW9uIGF0dGFjaERBRExpc3RlbmVycyhlbGVtZW50OiBIVE1MRWxlbWVudCB8IG51bGwpOiB2b2lkIHtcblx0Y29uc3QgdGhpc0Z1bmN0aW9uID0gJ2F0dGFjaCgpJztcblxuXHR0cnkge1xuXHRcdGlmIChlbGVtZW50KSB7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGRyYWdTdGFydCk7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZHJhZ092ZXIpO1xuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZHJvcCk7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCBkcmFnRW5kKTtcblx0XHR9XG5cblx0XHRpZiAobG9nTW9kZS5kZWJ1ZyAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSA0KVxuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnRHJhZyBhbmQgZHJvcCBldmVudCBsaXN0ZW5lcnMgc3VjY2Vzc2Z1bGx5IGF0dGFjaGVkJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmICghbG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEZhaWxlZCB0byBleGVjdXRlIGF0dGFjaERyYWdBbmREcm9wRXZlbnRMaXN0ZW5lcnM6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRyYWdTdGFydChlOiBEcmFnRXZlbnQpOiB2b2lkIHtcblx0Y29uc3QgdGhpc0Z1bmN0aW9uID0gJ2hhbmRsZURyYWdTdGFydCgpJztcblxuXHR0cnkge1xuXHRcdGRyYWdTcmNFbCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudDtcblxuXHRcdGlmIChlLmRhdGFUcmFuc2Zlcikge1xuXHRcdFx0ZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcblx0XHRcdGUuZGF0YVRyYW5zZmVyLnNldERhdGEoJ3RleHQvaHRtbCcsIGRyYWdTcmNFbC5vdXRlckhUTUwpO1xuXHRcdH1cblxuXHRcdGlmIChsb2dNb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID09PSA1KVxuXHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdCdoYW5kbGVEcmFnU3RhcnQgY29tcGxldGUnLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc0Z1bmN0aW9ufWBcblx0XHRcdCk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBpbiBoYW5kbGVEcmFnU3RhcnQ6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRyYWdPdmVyKGU6IERyYWdFdmVudCk6IGJvb2xlYW4ge1xuXHRjb25zdCB0aGlzTWV0aG9kID0gJ2hhbmRsZURyYWdPdmVyKCknO1xuXG5cdHRyeSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0aWYgKGUuZGF0YVRyYW5zZmVyKSB7XG5cdFx0XHRlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gJ21vdmUnO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID09PSA1KVxuXHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdCdoYW5kbGVEcmFnT3ZlciBjb21wbGV0ZScsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBpbiBoYW5kbGVEcmFnT3ZlcjogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRyYWdFbmQoZTogRHJhZ0V2ZW50KTogdm9pZCB7XG5cdGNvbnN0IHRoaXNNZXRob2QgPSAnaGFuZGxlRHJhZ0VuZCgpJztcblxuXHR0cnkge1xuXHRcdGNvbnN0IHRhcmdldCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudDtcblxuXHRcdHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xuXG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbG9yLXN0cmlwZScpLmZvckVhY2goZWwgPT4ge1xuXHRcdFx0ZWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTtcblx0XHR9KTtcblxuXHRcdGlmIChtb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID09PSA1KVxuXHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdCdoYW5kbGVEcmFnRW5kIGNvbXBsZXRlJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGluIGhhbmRsZURyYWdFbmQ6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblx0fVxufVxuXG5mdW5jdGlvbiBkcm9wKGU6IERyYWdFdmVudCk6IHZvaWQge1xuXHRjb25zdCB0aGlzTWV0aG9kID0gJ2Ryb3AoKSc7XG5cblx0dHJ5IHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0Y29uc3QgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0aWYgKGRyYWdTcmNFbCAmJiBkcmFnU3JjRWwgIT09IHRhcmdldCkge1xuXHRcdFx0Y29uc3QgZHJhZ1NyY0lkID0gZHJhZ1NyY0VsLmlkO1xuXHRcdFx0Y29uc3QgZHJvcFRhcmdldElkID0gdGFyZ2V0LmlkO1xuXHRcdFx0Y29uc3QgZHJhZ1NyY1RleHQgPSAoXG5cdFx0XHRcdGRyYWdTcmNFbC5xdWVyeVNlbGVjdG9yKFxuXHRcdFx0XHRcdCcuY29sb3ItdGV4dC1vdXRwdXQtYm94J1xuXHRcdFx0XHQpIGFzIEhUTUxJbnB1dEVsZW1lbnRcblx0XHRcdCkudmFsdWU7XG5cdFx0XHRjb25zdCBkcm9wVGFyZ2V0VGV4dCA9IChcblx0XHRcdFx0dGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdFx0Jy5jb2xvci10ZXh0LW91dHB1dC1ib3gnXG5cdFx0XHRcdCkgYXMgSFRNTElucHV0RWxlbWVudFxuXHRcdFx0KS52YWx1ZTtcblx0XHRcdGNvbnN0IGRyYWdTcmNPdXRlckhUTUwgPSBkcmFnU3JjRWwub3V0ZXJIVE1MO1xuXHRcdFx0Y29uc3QgZHJvcFRhcmdldE91dGVySFRNTCA9IHRhcmdldC5vdXRlckhUTUw7XG5cblx0XHRcdGRyYWdTcmNFbC5vdXRlckhUTUwgPSBkcm9wVGFyZ2V0T3V0ZXJIVE1MO1xuXHRcdFx0dGFyZ2V0Lm91dGVySFRNTCA9IGRyYWdTcmNPdXRlckhUTUw7XG5cblx0XHRcdGNvbnN0IG5ld0RyYWdTcmNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRkcm9wVGFyZ2V0SWRcblx0XHRcdCkgYXMgSFRNTEVsZW1lbnQ7XG5cdFx0XHRjb25zdCBuZXdEcm9wVGFyZ2V0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHRcdFx0ZHJhZ1NyY0lkXG5cdFx0XHQpIGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0XHRuZXdEcmFnU3JjRWwuaWQgPSBkcmFnU3JjSWQ7XG5cdFx0XHRuZXdEcm9wVGFyZ2V0RWwuaWQgPSBkcm9wVGFyZ2V0SWQ7XG5cblx0XHRcdChcblx0XHRcdFx0bmV3RHJhZ1NyY0VsLnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdFx0Jy5jb2xvci10ZXh0LW91dHB1dC1ib3gnXG5cdFx0XHRcdCkgYXMgSFRNTElucHV0RWxlbWVudFxuXHRcdFx0KS52YWx1ZSA9IGRyb3BUYXJnZXRUZXh0O1xuXHRcdFx0KFxuXHRcdFx0XHRuZXdEcm9wVGFyZ2V0RWwucXVlcnlTZWxlY3Rvcihcblx0XHRcdFx0XHQnLmNvbG9yLXRleHQtb3V0cHV0LWJveCdcblx0XHRcdFx0KSBhcyBIVE1MSW5wdXRFbGVtZW50XG5cdFx0XHQpLnZhbHVlID0gZHJhZ1NyY1RleHQ7XG5cblx0XHRcdGlmIChtb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDQpXG5cdFx0XHRcdGxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0XHQnY2FsbGluZyBhdHRhY2hEcmFnQW5kRHJvcEV2ZW50TGlzdGVuZXJzIGZvciBuZXcgZWxlbWVudHMnLFxuXHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdFx0KTtcblxuXHRcdFx0YXR0YWNoREFETGlzdGVuZXJzKG5ld0RyYWdTcmNFbCk7XG5cblx0XHRcdGF0dGFjaERBRExpc3RlbmVycyhuZXdEcm9wVGFyZ2V0RWwpO1xuXHRcdH1cblxuXHRcdGlmIChsb2dNb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID09PSA1KVxuXHRcdFx0bG9nZ2VyLmluZm8oJ2hhbmRsZURyb3AgY29tcGxldGUnLCBgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAoIWxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBpbiBoYW5kbGVEcm9wOiAke2Vycm9yfWAsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cdH1cbn1cblxuZXhwb3J0IGNvbnN0IGRhZExpc3RlbmVycyA9IHtcblx0YXR0YWNoOiBhdHRhY2hEQURMaXN0ZW5lcnNcbn07XG4iXX0=