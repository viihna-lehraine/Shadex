{"version":3,"file":"StateFactory.js","sources":["../../../../src/state/StateFactory.ts"],"sourcesContent":["// File: state/StateFactory.ts\n\nimport {\n\tHelpers,\n\tServices,\n\tState,\n\tStateFactoryContract,\n\tUtilities\n} from '../types/index.js';\n\nconst caller = 'StateFactory';\n\nexport class StateFactory implements StateFactoryContract {\n\tstatic #instance: StateFactory | null = null;\n\n\t#errors: Services['errors'];\n\t#helpers: Helpers;\n\t#log: Services['log'];\n\t#utils: Utilities;\n\n\tprivate constructor(helpers: Helpers, services: Services, utils: Utilities) {\n\t\ttry {\n\t\t\tservices.log.debug(\n\t\t\t\t`Constructing StateFactory instance.`,\n\t\t\t\t`${caller} constructor`\n\t\t\t);\n\n\t\t\tthis.#errors = services.errors;\n\t\t\tthis.#helpers = helpers;\n\t\t\tthis.#log = services.log;\n\t\t\tthis.#utils = utils;\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller} constructor]: ${\n\t\t\t\t\terror instanceof Error ? error.message : error\n\t\t\t\t}`\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic getInstance(\n\t\thelpers: Helpers,\n\t\tservices: Services,\n\t\tutils: Utilities\n\t): StateFactory {\n\t\treturn services.errors.handleSync(() => {\n\t\t\tif (!StateFactory.#instance) {\n\t\t\t\tservices.log.debug(\n\t\t\t\t\t'Creating StateFactory instance.',\n\t\t\t\t\t`${caller}.getInstance`\n\t\t\t\t);\n\n\t\t\t\tStateFactory.#instance = new StateFactory(helpers, services, utils);\n\t\t\t}\n\n\t\t\tservices.log.debug(\n\t\t\t\t`Returning StateFactory instance.`,\n\t\t\t\t`${caller}.getInstance`\n\t\t\t);\n\n\t\t\treturn StateFactory.#instance;\n\t\t}, `[${caller}]: Error getting instance.`);\n\t}\n\n\tcreateInitialState(): Promise<State> {\n\t\treturn (\n\t\t\tthis.#errors.handleAsync(async () => {\n\t\t\t\tthis.#log.debug(\n\t\t\t\t\t'Generating initial state.',\n\t\t\t\t\t`${caller}.#generateInitialState`\n\t\t\t\t);\n\n\t\t\t\tconst columns = this.#utils.dom.scanPaletteColumns() ?? [];\n\n\t\t\t\tif (!columns) {\n\t\t\t\t\tthis.#log.error(\n\t\t\t\t\t\t'No palette columns found!',\n\t\t\t\t\t\t`${caller}.#generateInitialState`\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.#log.debug(\n\t\t\t\t\t`Scanned palette columns.`,\n\t\t\t\t\t`${caller}.#generateInitialState`\n\t\t\t\t);\n\n\t\t\t\treturn {\n\t\t\t\t\tappMode: 'edit',\n\t\t\t\t\tpaletteContainer: { columns },\n\t\t\t\t\tpaletteHistory: [],\n\t\t\t\t\tpreferences: {\n\t\t\t\t\t\tcolorSpace: 'hsl',\n\t\t\t\t\t\tdistributionType: 'soft',\n\t\t\t\t\t\tmaxHistory: 20,\n\t\t\t\t\t\tmaxPaletteHistory: 10,\n\t\t\t\t\t\ttheme: 'light'\n\t\t\t\t\t},\n\t\t\t\t\tselections: {\n\t\t\t\t\t\tpaletteColumnCount: columns.length,\n\t\t\t\t\t\tpaletteType: 'complementary',\n\t\t\t\t\t\ttargetedColumnPosition: 1\n\t\t\t\t\t},\n\t\t\t\t\ttimestamp: this.#helpers.data.getFormattedTimestamp()\n\t\t\t\t};\n\t\t\t}, `[${caller}]: Failed to generate initial state`) ?? ({} as State)\n\t\t);\n\t}\n}\n"],"names":[],"mappings":"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"}