{"version":3,"file":"PaletteState.js","sources":["../../../../src/state/PaletteState.ts"],"sourcesContent":["// File: state/PaletteState.ts\n\nimport {\n\tAllColors,\n\tPaletteItem,\n\tPaletteStateInterface,\n\tServicesInterface,\n\tUtilitiesInterface\n} from '../types/index.js';\nimport { StateManager } from './StateManager.js';\n\nexport class PaletteState implements PaletteStateInterface {\n\tprivate errors: ServicesInterface['errors'];\n\tprivate utils: UtilitiesInterface;\n\n\tconstructor(\n\t\tprivate stateManager: StateManager,\n\t\tservices: ServicesInterface,\n\t\tutils: UtilitiesInterface\n\t) {\n\t\tthis.errors = services.errors;\n\t\tthis.utils = utils;\n\t}\n\n\tpublic updatePaletteItemColor(columnID: number, newColor: string): void {\n\t\tthis.errors.handle(\n\t\t\t() => {\n\t\t\t\tconst currentState = this.stateManager.getState();\n\t\t\t\tconst latestPalette = currentState.paletteHistory[0];\n\n\t\t\t\tif (!latestPalette) return;\n\n\t\t\t\t// find the PaletteItem corresponding to this column\n\t\t\t\tconst updatedItems = latestPalette.items.map(item => {\n\t\t\t\t\tif (item.itemID !== columnID) return item;\n\n\t\t\t\t\tconst parsedNewColor =\n\t\t\t\t\t\tthis.utils.color.convertCSSToColor(newColor);\n\t\t\t\t\tif (!parsedNewColor) throw new Error('Invalid color value');\n\n\t\t\t\t\t// ensure color is in HSL format\n\t\t\t\t\tconst hslColor =\n\t\t\t\t\t\tparsedNewColor.format === 'hsl'\n\t\t\t\t\t\t\t? parsedNewColor\n\t\t\t\t\t\t\t: this.utils.color.convertToHSL(parsedNewColor);\n\n\t\t\t\t\t// generate all color representations (ensuring correct branded types)\n\t\t\t\t\tconst allColors: AllColors =\n\t\t\t\t\t\tthis.utils.palette.generateAllColorValues(hslColor);\n\n\t\t\t\t\t// ensure CSS representations match expected format\n\t\t\t\t\tconst structuredCSS = {\n\t\t\t\t\t\tcmyk: this.utils.color.convertColorToCSS(\n\t\t\t\t\t\t\tallColors.cmyk\n\t\t\t\t\t\t),\n\t\t\t\t\t\thex: this.utils.color.convertColorToCSS(allColors.hex),\n\t\t\t\t\t\thsl: this.utils.color.convertColorToCSS(allColors.hsl),\n\t\t\t\t\t\thsv: this.utils.color.convertColorToCSS(allColors.hsv),\n\t\t\t\t\t\tlab: this.utils.color.convertColorToCSS(allColors.lab),\n\t\t\t\t\t\trgb: this.utils.color.convertColorToCSS(allColors.rgb),\n\t\t\t\t\t\txyz: this.utils.color.convertColorToCSS(allColors.xyz)\n\t\t\t\t\t};\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...item,\n\t\t\t\t\t\tcolors: allColors,\n\t\t\t\t\t\tcss: structuredCSS\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\t\t// ensure column state is updated\n\t\t\t\tconst updatedColumns = updatedItems.map((item, index) => ({\n\t\t\t\t\tid: item.itemID,\n\t\t\t\t\tisLocked:\n\t\t\t\t\t\tcurrentState.paletteContainer.columns[index].isLocked,\n\t\t\t\t\tposition: index + 1,\n\t\t\t\t\tsize: currentState.paletteContainer.columns[index].size\n\t\t\t\t}));\n\n\t\t\t\t// update state history with type assertions\n\t\t\t\tthis.stateManager.updatePaletteColumns(updatedColumns, true, 3);\n\t\t\t\tthis.stateManager.updatePaletteHistory([\n\t\t\t\t\t{ ...latestPalette, items: updatedItems as PaletteItem[] },\n\t\t\t\t\t...currentState.paletteHistory.slice(1)\n\t\t\t\t]);\n\t\t\t},\n\t\t\t'Failed to update palette item color',\n\t\t\t{ columnID, newColor }\n\t\t);\n\t}\n}\n"],"names":[],"mappings":"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"}