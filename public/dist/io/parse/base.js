// File: io/parse/base.js
import { commonFn } from '../../common/index.js';
import { configData } from '../../data/config.js';
import { createLogger } from '../../logger/index.js';
import { modeData as mode } from '../../data/mode.js';
const brand = commonFn.core.brand;
const logMode = mode.logging;
const regex = {
    cmyk: configData.regex.colors.cmyk,
    hex: configData.regex.colors.hex,
    hsl: configData.regex.colors.hsl,
    hsv: configData.regex.colors.hsv,
    lab: configData.regex.colors.lab,
    rgb: configData.regex.colors.rgb,
    xyz: configData.regex.colors.xyz
};
const thisModule = 'io/parse/base.js';
const logger = await createLogger();
function parseCMYKColorValue(rawCMYK) {
    const caller = 'parseCMYKColorValue()';
    if (!rawCMYK) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A CMYK element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing CMYK element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            cyan: brand.asPercentile(0),
            magenta: brand.asPercentile(0),
            yellow: brand.asPercentile(0),
            key: brand.asPercentile(0)
        };
    }
    const match = rawCMYK.match(regex.cmyk);
    return match
        ? {
            cyan: brand.asPercentile(parseFloat(match[1])),
            magenta: brand.asPercentile(parseFloat(match[2])),
            yellow: brand.asPercentile(parseFloat(match[3])),
            key: brand.asPercentile(parseFloat(match[4]))
        }
        : {
            cyan: brand.asPercentile(0),
            magenta: brand.asPercentile(0),
            yellow: brand.asPercentile(0),
            key: brand.asPercentile(0)
        };
}
function parseHexColorValue(rawHex) {
    const caller = 'parseHexColorValue()';
    if (!rawHex) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A Hex element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing Hex element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return { hex: brand.asHexSet('#000000') };
    }
    const match = rawHex.match(regex.hex);
    return match
        ? {
            hex: brand.asHexSet(`#${match[1]}`)
        }
        : {
            hex: brand.asHexSet('#000000')
        };
}
function parseHSLColorValue(rawHSL) {
    const caller = 'parseHSLColorValue()';
    if (!rawHSL) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An HSL element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing HSL element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            lightness: brand.asPercentile(0)
        };
    }
    const match = rawHSL.match(regex.hsl);
    return match
        ? {
            hue: brand.asRadial(parseFloat(match[1])),
            saturation: brand.asPercentile(parseFloat(match[2])),
            lightness: brand.asPercentile(parseFloat(match[3]))
        }
        : {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            lightness: brand.asPercentile(0)
        };
}
function parseHSVColorValue(rawHSV) {
    const caller = 'parseHSVColorValue()';
    if (!rawHSV) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An HSV element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing HSV element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            value: brand.asPercentile(0)
        };
    }
    const match = rawHSV.match(regex.hsv);
    return match
        ? {
            hue: brand.asRadial(parseFloat(match[1])),
            saturation: brand.asPercentile(parseFloat(match[2])),
            value: brand.asPercentile(parseFloat(match[3]))
        }
        : {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            value: brand.asPercentile(0)
        };
}
function parseLABColorValue(rawLAB) {
    const caller = 'parseLABColorValue()';
    if (!rawLAB) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A LAB element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing LAB element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            l: brand.asLAB_L(0),
            a: brand.asLAB_A(0),
            b: brand.asLAB_B(0)
        };
    }
    const match = rawLAB.match(regex.lab);
    return match
        ? {
            l: brand.asLAB_L(parseFloat(match[1])),
            a: brand.asLAB_A(parseFloat(match[2])),
            b: brand.asLAB_B(parseFloat(match[3]))
        }
        : {
            l: brand.asLAB_L(0),
            a: brand.asLAB_A(0),
            b: brand.asLAB_B(0)
        };
}
function parseRGBColorValue(rawRGB) {
    const caller = 'parseRGBColorValue()';
    if (!rawRGB) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An RGB element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing RGB element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            red: brand.asByteRange(0),
            green: brand.asByteRange(0),
            blue: brand.asByteRange(0)
        };
    }
    const match = rawRGB.match(regex.rgb);
    return match
        ? {
            red: brand.asByteRange(parseFloat(match[1])),
            green: brand.asByteRange(parseFloat(match[2])),
            blue: brand.asByteRange(parseFloat(match[3]))
        }
        : {
            red: brand.asByteRange(0),
            green: brand.asByteRange(0),
            blue: brand.asByteRange(0)
        };
}
function parseXYZColorValue(rawXYZ) {
    const caller = 'parseXYZColorValue()';
    if (!rawXYZ) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An XYZ element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing XYZ element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            x: brand.asXYZ_X(0),
            y: brand.asXYZ_Y(0),
            z: brand.asXYZ_Z(0)
        };
    }
    const match = rawXYZ.match(regex.xyz);
    return match
        ? {
            x: brand.asXYZ_X(parseFloat(match[1])),
            y: brand.asXYZ_Y(parseFloat(match[2])),
            z: brand.asXYZ_Z(parseFloat(match[3]))
        }
        : {
            x: brand.asXYZ_X(0),
            y: brand.asXYZ_Y(0),
            z: brand.asXYZ_Z(0)
        };
}
export const color = {
    cmyk: parseCMYKColorValue,
    hex: parseHexColorValue,
    hsl: parseHSLColorValue,
    hsv: parseHSVColorValue,
    lab: parseLABColorValue,
    rgb: parseRGBColorValue,
    xyz: parseXYZColorValue
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9pby9wYXJzZS9iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHlCQUF5QjtBQVl6QixPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDakQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxJQUFJLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXRELE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0FBQ2xDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7QUFDN0IsTUFBTSxLQUFLLEdBQUc7SUFDYixJQUFJLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSTtJQUNsQyxHQUFHLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRztJQUNoQyxHQUFHLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRztJQUNoQyxHQUFHLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRztJQUNoQyxHQUFHLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRztJQUNoQyxHQUFHLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRztJQUNoQyxHQUFHLEVBQUUsVUFBVSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRztDQUNoQyxDQUFDO0FBRUYsTUFBTSxVQUFVLEdBQUcsa0JBQWtCLENBQUM7QUFFdEMsTUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLEVBQUUsQ0FBQztBQUVwQyxTQUFTLG1CQUFtQixDQUFDLE9BQXNCO0lBQ2xELE1B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Q0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RDO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDbkIsQ0FBQztBQUNMLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxLQUFLLEdBQTJDO0lBQzVELElBQUksRUFBRSxtQkFBbUI7SUFDekIsR0FBRyxFQUFFLGtCQUFrQjtJQUN2QixHQUFHLEVBQUUsa0JBQWtCO0lBQ3ZCLEdBQUcsRUFBRSxrQkFBa0I7SUFDdkIsR0FBRyxFQUFFLGtCQUFrQjtJQUN2QixHQUFHLEVBQUUsa0JBQWtCO0lBQ3ZCLEdBQUcsRUFBRSxrQkFBa0I7Q0FDdkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IGlvL3BhcnNlL2Jhc2UuanNcblxuaW1wb3J0IHtcblx0Q01ZSyxcblx0SGV4LFxuXHRIU0wsXG5cdEhTVixcblx0SU9Gbl9NYXN0ZXJJbnRlcmZhY2UsXG5cdExBQixcblx0UkdCLFxuXHRYWVpcbn0gZnJvbSAnLi4vLi4vdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgY29tbW9uRm4gfSBmcm9tICcuLi8uLi9jb21tb24vaW5kZXguanMnO1xuaW1wb3J0IHsgY29uZmlnRGF0YSB9IGZyb20gJy4uLy4uL2RhdGEvY29uZmlnLmpzJztcbmltcG9ydCB7IGNyZWF0ZUxvZ2dlciB9IGZyb20gJy4uLy4uL2xvZ2dlci9pbmRleC5qcyc7XG5pbXBvcnQgeyBtb2RlRGF0YSBhcyBtb2RlIH0gZnJvbSAnLi4vLi4vZGF0YS9tb2RlLmpzJztcblxuY29uc3QgYnJhbmQgPSBjb21tb25Gbi5jb3JlLmJyYW5kO1xuY29uc3QgbG9nTW9kZSA9IG1vZGUubG9nZ2luZztcbmNvbnN0IHJlZ2V4ID0ge1xuXHRjbXlrOiBjb25maWdEYXRhLnJlZ2V4LmNvbG9ycy5jbXlrLFxuXHRoZXg6IGNvbmZpZ0RhdGEucmVnZXguY29sb3JzLmhleCxcblx0aHNsOiBjb25maWdEYXRhLnJlZ2V4LmNvbG9ycy5oc2wsXG5cdGhzdjogY29uZmlnRGF0YS5yZWdleC5jb2xvcnMuaHN2LFxuXHRsYWI6IGNvbmZpZ0RhdGEucmVnZXguY29sb3JzLmxhYixcblx0cmdiOiBjb25maWdEYXRhLnJlZ2V4LmNvbG9ycy5yZ2IsXG5cdHh5ejogY29uZmlnRGF0YS5yZWdleC5jb2xvcnMueHl6XG59O1xuXG5jb25zdCB0aGlzTW9kdWxlID0gJ2lvL3BhcnNlL2Jhc2UuanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxuZnVuY3Rpb24gcGFyc2VDTVlLQ29sb3JWYWx1ZShyYXdDTVlLOiBzdHJpbmcgfCBudWxsKTogQ01ZS1sndmFsdWUnXSB7XG5cdGNvbnN0IGNhbGxlciA9ICdwYXJzZUNNWUtDb2xvclZhbHVlKCknO1xuXG5cdGlmICghcmF3Q01ZSykge1xuXHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLndhcm4gJiYgbG9nTW9kZS52ZXJib3NpdHkgPj0gMikge1xuXHRcdFx0bG9nZ2VyLndhcm4oXG5cdFx0XHRcdCdBIENNWUsgZWxlbWVudCBjb3VsZCBub3QgYmUgZm91bmQgd2hpbGUgcGFyc2luZyBwYWxldHRlIGZpbGUuIEluamVjdGluZyBkZWZhdWx0IHZhbHVlcy4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0J01pc3NpbmcgQ01ZSyBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0Y3lhbjogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0bWFnZW50YTogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0eWVsbG93OiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRrZXk6IGJyYW5kLmFzUGVyY2VudGlsZSgwKVxuXHRcdH07XG5cdH1cblxuXHRjb25zdCBtYXRjaCA9IHJhd0NNWUsubWF0Y2gocmVnZXguY215ayk7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdGN5YW46IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdG1hZ2VudGE6IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzJdKSksXG5cdFx0XHRcdHllbGxvdzogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobWF0Y2hbM10pKSxcblx0XHRcdFx0a2V5OiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFs0XSkpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdGN5YW46IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdFx0bWFnZW50YTogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0XHR5ZWxsb3c6IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdFx0a2V5OiBicmFuZC5hc1BlcmNlbnRpbGUoMClcblx0XHRcdH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlSGV4Q29sb3JWYWx1ZShyYXdIZXg6IHN0cmluZyB8IG51bGwpOiBIZXhbJ3ZhbHVlJ10ge1xuXHRjb25zdCBjYWxsZXIgPSAncGFyc2VIZXhDb2xvclZhbHVlKCknO1xuXG5cdGlmICghcmF3SGV4KSB7XG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUud2FybiAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSAyKSB7XG5cdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0J0EgSGV4IGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIEhleCBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4geyBoZXg6IGJyYW5kLmFzSGV4U2V0KCcjMDAwMDAwJykgfTtcblx0fVxuXG5cdGNvbnN0IG1hdGNoID0gcmF3SGV4Lm1hdGNoKHJlZ2V4LmhleCk7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdGhleDogYnJhbmQuYXNIZXhTZXQoYCMke21hdGNoWzFdfWApXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdGhleDogYnJhbmQuYXNIZXhTZXQoJyMwMDAwMDAnKVxuXHRcdFx0fTtcbn1cblxuZnVuY3Rpb24gcGFyc2VIU0xDb2xvclZhbHVlKHJhd0hTTDogc3RyaW5nIHwgbnVsbCk6IEhTTFsndmFsdWUnXSB7XG5cdGNvbnN0IGNhbGxlciA9ICdwYXJzZUhTTENvbG9yVmFsdWUoKSc7XG5cblx0aWYgKCFyYXdIU0wpIHtcblx0XHRpZiAoIW1vZGUucXVpZXQgJiYgbG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDIpIHtcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHQnQW4gSFNMIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIEhTTCBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbCgwKSxcblx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdGxpZ2h0bmVzczogYnJhbmQuYXNQZXJjZW50aWxlKDApXG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IG1hdGNoID0gcmF3SFNMLm1hdGNoKHJlZ2V4LmhzbCk7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHRsaWdodG5lc3M6IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzNdKSlcblx0XHRcdH1cblx0XHQ6IHtcblx0XHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbCgwKSxcblx0XHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0XHRsaWdodG5lc3M6IGJyYW5kLmFzUGVyY2VudGlsZSgwKVxuXHRcdFx0fTtcbn1cblxuZnVuY3Rpb24gcGFyc2VIU1ZDb2xvclZhbHVlKHJhd0hTVjogc3RyaW5nIHwgbnVsbCk6IEhTVlsndmFsdWUnXSB7XG5cdGNvbnN0IGNhbGxlciA9ICdwYXJzZUhTVkNvbG9yVmFsdWUoKSc7XG5cblx0aWYgKCFyYXdIU1YpIHtcblx0XHRpZiAoIW1vZGUucXVpZXQgJiYgbG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDIpIHtcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHQnQW4gSFNWIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIEhTViBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbCgwKSxcblx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdHZhbHVlOiBicmFuZC5hc1BlcmNlbnRpbGUoMClcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdIU1YubWF0Y2gocmVnZXguaHN2KTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbChwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzJdKSksXG5cdFx0XHRcdHZhbHVlOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFszXSkpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwoMCksXG5cdFx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdFx0dmFsdWU6IGJyYW5kLmFzUGVyY2VudGlsZSgwKVxuXHRcdFx0fTtcbn1cblxuZnVuY3Rpb24gcGFyc2VMQUJDb2xvclZhbHVlKHJhd0xBQjogc3RyaW5nIHwgbnVsbCk6IExBQlsndmFsdWUnXSB7XG5cdGNvbnN0IGNhbGxlciA9ICdwYXJzZUxBQkNvbG9yVmFsdWUoKSc7XG5cblx0aWYgKCFyYXdMQUIpIHtcblx0XHRpZiAoIW1vZGUucXVpZXQgJiYgbG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDIpIHtcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHQnQSBMQUIgZWxlbWVudCBjb3VsZCBub3QgYmUgZm91bmQgd2hpbGUgcGFyc2luZyBwYWxldHRlIGZpbGUuIEluamVjdGluZyBkZWZhdWx0IHZhbHVlcy4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0J01pc3NpbmcgTEFCIGVsZW1lbnQgaW4gcGFsZXR0ZSBmaWxlLicsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHtjYWxsZXJ9YFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAobW9kZS5zdGFja1RyYWNlKSBjb25zb2xlLnRyYWNlKCdTdGFjayBUcmFjZTonKTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRsOiBicmFuZC5hc0xBQl9MKDApLFxuXHRcdFx0YTogYnJhbmQuYXNMQUJfQSgwKSxcblx0XHRcdGI6IGJyYW5kLmFzTEFCX0IoMClcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdMQUIubWF0Y2gocmVnZXgubGFiKTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0bDogYnJhbmQuYXNMQUJfTChwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdGE6IGJyYW5kLmFzTEFCX0EocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHRiOiBicmFuZC5hc0xBQl9CKHBhcnNlRmxvYXQobWF0Y2hbM10pKVxuXHRcdFx0fVxuXHRcdDoge1xuXHRcdFx0XHRsOiBicmFuZC5hc0xBQl9MKDApLFxuXHRcdFx0XHRhOiBicmFuZC5hc0xBQl9BKDApLFxuXHRcdFx0XHRiOiBicmFuZC5hc0xBQl9CKDApXG5cdFx0XHR9O1xufVxuXG5mdW5jdGlvbiBwYXJzZVJHQkNvbG9yVmFsdWUocmF3UkdCOiBzdHJpbmcgfCBudWxsKTogUkdCWyd2YWx1ZSddIHtcblx0Y29uc3QgY2FsbGVyID0gJ3BhcnNlUkdCQ29sb3JWYWx1ZSgpJztcblxuXHRpZiAoIXJhd1JHQikge1xuXHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLndhcm4gJiYgbG9nTW9kZS52ZXJib3NpdHkgPj0gMikge1xuXHRcdFx0bG9nZ2VyLndhcm4oXG5cdFx0XHRcdCdBbiBSR0IgZWxlbWVudCBjb3VsZCBub3QgYmUgZm91bmQgd2hpbGUgcGFyc2luZyBwYWxldHRlIGZpbGUuIEluamVjdGluZyBkZWZhdWx0IHZhbHVlcy4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0J01pc3NpbmcgUkdCIGVsZW1lbnQgaW4gcGFsZXR0ZSBmaWxlLicsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHtjYWxsZXJ9YFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAobW9kZS5zdGFja1RyYWNlKSBjb25zb2xlLnRyYWNlKCdTdGFjayBUcmFjZTonKTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRyZWQ6IGJyYW5kLmFzQnl0ZVJhbmdlKDApLFxuXHRcdFx0Z3JlZW46IGJyYW5kLmFzQnl0ZVJhbmdlKDApLFxuXHRcdFx0Ymx1ZTogYnJhbmQuYXNCeXRlUmFuZ2UoMClcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdSR0IubWF0Y2gocmVnZXgucmdiKTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0cmVkOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdGdyZWVuOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzJdKSksXG5cdFx0XHRcdGJsdWU6IGJyYW5kLmFzQnl0ZVJhbmdlKHBhcnNlRmxvYXQobWF0Y2hbM10pKVxuXHRcdFx0fVxuXHRcdDoge1xuXHRcdFx0XHRyZWQ6IGJyYW5kLmFzQnl0ZVJhbmdlKDApLFxuXHRcdFx0XHRncmVlbjogYnJhbmQuYXNCeXRlUmFuZ2UoMCksXG5cdFx0XHRcdGJsdWU6IGJyYW5kLmFzQnl0ZVJhbmdlKDApXG5cdFx0XHR9O1xufVxuXG5mdW5jdGlvbiBwYXJzZVhZWkNvbG9yVmFsdWUocmF3WFlaOiBzdHJpbmcgfCBudWxsKTogWFlaWyd2YWx1ZSddIHtcblx0Y29uc3QgY2FsbGVyID0gJ3BhcnNlWFlaQ29sb3JWYWx1ZSgpJztcblxuXHRpZiAoIXJhd1hZWikge1xuXHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLndhcm4gJiYgbG9nTW9kZS52ZXJib3NpdHkgPj0gMikge1xuXHRcdFx0bG9nZ2VyLndhcm4oXG5cdFx0XHRcdCdBbiBYWVogZWxlbWVudCBjb3VsZCBub3QgYmUgZm91bmQgd2hpbGUgcGFyc2luZyBwYWxldHRlIGZpbGUuIEluamVjdGluZyBkZWZhdWx0IHZhbHVlcy4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0J01pc3NpbmcgWFlaIGVsZW1lbnQgaW4gcGFsZXR0ZSBmaWxlLicsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHtjYWxsZXJ9YFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAobW9kZS5zdGFja1RyYWNlKSBjb25zb2xlLnRyYWNlKCdTdGFjayBUcmFjZTonKTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHR4OiBicmFuZC5hc1hZWl9YKDApLFxuXHRcdFx0eTogYnJhbmQuYXNYWVpfWSgwKSxcblx0XHRcdHo6IGJyYW5kLmFzWFlaX1ooMClcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdYWVoubWF0Y2gocmVnZXgueHl6KTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0eDogYnJhbmQuYXNYWVpfWChwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdHk6IGJyYW5kLmFzWFlaX1kocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHR6OiBicmFuZC5hc1hZWl9aKHBhcnNlRmxvYXQobWF0Y2hbM10pKVxuXHRcdFx0fVxuXHRcdDoge1xuXHRcdFx0XHR4OiBicmFuZC5hc1hZWl9YKDApLFxuXHRcdFx0XHR5OiBicmFuZC5hc1hZWl9ZKDApLFxuXHRcdFx0XHR6OiBicmFuZC5hc1hZWl9aKDApXG5cdFx0XHR9O1xufVxuXG5leHBvcnQgY29uc3QgY29sb3I6IElPRm5fTWFzdGVySW50ZXJmYWNlWydwYXJzZSddWydjb2xvciddID0ge1xuXHRjbXlrOiBwYXJzZUNNWUtDb2xvclZhbHVlLFxuXHRoZXg6IHBhcnNlSGV4Q29sb3JWYWx1ZSxcblx0aHNsOiBwYXJzZUhTTENvbG9yVmFsdWUsXG5cdGhzdjogcGFyc2VIU1ZDb2xvclZhbHVlLFxuXHRsYWI6IHBhcnNlTEFCQ29sb3JWYWx1ZSxcblx0cmdiOiBwYXJzZVJHQkNvbG9yVmFsdWUsXG5cdHh5ejogcGFyc2VYWVpDb2xvclZhbHVlXG59O1xuIl19