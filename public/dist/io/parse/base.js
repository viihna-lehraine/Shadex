// File: src/io/parse/base.ts
import { common } from '../../common/index.js';
import { config, mode } from '../../common/data/base.js';
import { createLogger } from '../../logger/index.js';
const logger = await createLogger();
const brand = common.core.brand;
const logMode = mode.logging;
const regex = {
    cmyk: config.regex.colors.cmyk,
    hex: config.regex.colors.hex,
    hsl: config.regex.colors.hsl,
    hsv: config.regex.colors.hsv,
    lab: config.regex.colors.lab,
    rgb: config.regex.colors.rgb,
    xyz: config.regex.colors.xyz
};
function parseCMYKColorValue(rawCMYK) {
    if (!rawCMYK) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A CMYK element could not be found while parsing palette file. Injecting default values.', 'io > parse > base > parseCMYKColorValue()');
        }
        else {
            logger.debug('Missing CMYK element in palette file.', 'io > parse > base > parseCMYKColorValue()');
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            cyan: brand.asPercentile(0),
            magenta: brand.asPercentile(0),
            yellow: brand.asPercentile(0),
            key: brand.asPercentile(0),
            alpha: brand.asAlphaRange(1)
        };
    }
    const match = rawCMYK.match(regex.cmyk);
    return match
        ? {
            cyan: brand.asPercentile(parseFloat(match[1])),
            magenta: brand.asPercentile(parseFloat(match[2])),
            yellow: brand.asPercentile(parseFloat(match[3])),
            key: brand.asPercentile(parseFloat(match[4])),
            alpha: brand.asAlphaRange(parseFloat(match[5] ?? '1'))
        }
        : {
            cyan: brand.asPercentile(0),
            magenta: brand.asPercentile(0),
            yellow: brand.asPercentile(0),
            key: brand.asPercentile(0),
            alpha: brand.asAlphaRange(1)
        };
}
function parseHexColorValue(rawHex) {
    if (!rawHex) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A Hex element could not be found while parsing palette file. Injecting default values.', 'io > parse > base > parseHexColorValue()');
        }
        else {
            logger.debug('Missing Hex element in palette file.', 'io > parse > base > parseHexColorValue()');
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            hex: brand.asHexSet('#000000'),
            alpha: brand.asHexComponent('FF'),
            numAlpha: brand.asAlphaRange(1)
        };
    }
    const match = rawHex.match(regex.hex);
    return match
        ? {
            hex: brand.asHexSet(`#${match[1]}`),
            alpha: brand.asHexComponent(match[2] || 'FF'),
            numAlpha: brand.asAlphaRange(parseInt(match[2] || 'FF', 16) / 255)
        }
        : {
            hex: brand.asHexSet('#000000'),
            alpha: brand.asHexComponent('FF'),
            numAlpha: brand.asAlphaRange(1)
        };
}
function parseHSLColorValue(rawHSL) {
    if (!rawHSL) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An HSL element could not be found while parsing palette file. Injecting default values.', 'io > parse > base > parseHSLColorValue()');
        }
        else {
            logger.debug('Missing HSL element in palette file.', 'io > parse > base > parseHSLColorValue()');
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            lightness: brand.asPercentile(0),
            alpha: brand.asAlphaRange(1)
        };
    }
    const match = rawHSL.match(regex.hsl);
    return match
        ? {
            hue: brand.asRadial(parseFloat(match[1])),
            saturation: brand.asPercentile(parseFloat(match[2])),
            lightness: brand.asPercentile(parseFloat(match[3])),
            alpha: brand.asAlphaRange(parseFloat(match[4] ?? '1'))
        }
        : {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            lightness: brand.asPercentile(0),
            alpha: brand.asAlphaRange(1)
        };
}
function parseHSVColorValue(rawHSV) {
    if (!rawHSV) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An HSV element could not be found while parsing palette file. Injecting default values.', 'io > parse > base > parseHSVColorValue()');
        }
        else {
            logger.debug('Missing HSV element in palette file.', 'io > parse > base > parseHSVColorValue()');
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            value: brand.asPercentile(0),
            alpha: brand.asAlphaRange(1)
        };
    }
    const match = rawHSV.match(regex.hsv);
    return match
        ? {
            hue: brand.asRadial(parseFloat(match[1])),
            saturation: brand.asPercentile(parseFloat(match[2])),
            value: brand.asPercentile(parseFloat(match[3])),
            alpha: brand.asAlphaRange(parseFloat(match[4] ?? '1'))
        }
        : {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            value: brand.asPercentile(0),
            alpha: brand.asAlphaRange(1)
        };
}
function parseLABColorValue(rawLAB) {
    if (!rawLAB) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A LAB element could not be found while parsing palette file. Injecting default values.', 'io > parse > base > parseLABColorValue()');
        }
        else {
            logger.debug('Missing LAB element in palette file.', 'io > parse > base > parseLABColorValue()');
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            l: brand.asLAB_L(0),
            a: brand.asLAB_A(0),
            b: brand.asLAB_B(0),
            alpha: brand.asAlphaRange(1)
        };
    }
    const match = rawLAB.match(regex.lab);
    return match
        ? {
            l: brand.asLAB_L(parseFloat(match[1])),
            a: brand.asLAB_A(parseFloat(match[2])),
            b: brand.asLAB_B(parseFloat(match[3])),
            alpha: brand.asAlphaRange(parseFloat(match[4] ?? '1'))
        }
        : {
            l: brand.asLAB_L(0),
            a: brand.asLAB_A(0),
            b: brand.asLAB_B(0),
            alpha: brand.asAlphaRange(1)
        };
}
function parseRGBColorValue(rawRGB) {
    if (!rawRGB) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An RGB element could not be found while parsing palette file. Injecting default values.', 'io > parse > base > parseRGBColorValue()');
        }
        else {
            logger.debug('Missing RGB element in palette file.', 'io > parse > base > parseRGBColorValue()');
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            red: brand.asByteRange(0),
            green: brand.asByteRange(0),
            blue: brand.asByteRange(0),
            alpha: brand.asAlphaRange(1)
        };
    }
    const match = rawRGB.match(regex.rgb);
    return match
        ? {
            red: brand.asByteRange(parseFloat(match[1])),
            green: brand.asByteRange(parseFloat(match[2])),
            blue: brand.asByteRange(parseFloat(match[3])),
            alpha: brand.asAlphaRange(parseFloat(match[4] ?? '1'))
        }
        : {
            red: brand.asByteRange(0),
            green: brand.asByteRange(0),
            blue: brand.asByteRange(0),
            alpha: brand.asAlphaRange(1)
        };
}
function parseXYZColorValue(rawXYZ) {
    if (!rawXYZ) {
        if (!mode.quiet && logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An XYZ element could not be found while parsing palette file. Injecting default values.', 'io > parse > base > parseXYZColorValue()');
        }
        else {
            logger.debug('Missing XYZ element in palette file.', 'io > parse > base > parseXYZColorValue()');
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            x: brand.asXYZ_X(0),
            y: brand.asXYZ_Y(0),
            z: brand.asXYZ_Z(0),
            alpha: brand.asAlphaRange(1)
        };
    }
    const match = rawXYZ.match(regex.xyz);
    return match
        ? {
            x: brand.asXYZ_X(parseFloat(match[1])),
            y: brand.asXYZ_Y(parseFloat(match[2])),
            z: brand.asXYZ_Z(parseFloat(match[3])),
            alpha: brand.asAlphaRange(parseFloat(match[4] ?? '1'))
        }
        : {
            x: brand.asXYZ_X(0),
            y: brand.asXYZ_Y(0),
            z: brand.asXYZ_Z(0),
            alpha: brand.asAlphaRange(1)
        };
}
export const color = {
    cmyk: parseCMYKColorValue,
    hex: parseHexColorValue,
    hsl: parseHSLColorValue,
    hsv: parseHSVColorValue,
    lab: parseLABColorValue,
    rgb: parseRGBColorValue,
    xyz: parseXYZColorValue
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9pby9wYXJzZS9iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZCQUE2QjtBQVk3QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDL0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUN6RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFFckQsTUFBTSxNQUFNLEdBQUcsTUFBTSxZQUFZLEVBQUUsQ0FBQztBQUVwQyxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUNoQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBQzdCLE1BQU0sS0FBSyxHQUFHO0lBQ2IsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUk7SUFDOUIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDNUIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDNUIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDNUIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDNUIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDNUIsR0FBRyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7Q0FDNUIsQ0FBQztBQUVGLFNBQVMsbUJBQW1CLENBQUMsT0FBc0I7SUFDbEQsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2QsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsU0FBUyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQzNELE1BQU0sQ0FBQyxJQUFJLENBQ1YseUZBQXlGLEVBQ3pGLDJDQUEyQyxDQUMzQyxDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDUCxNQUFNLENBQUMsS0FBSyxDQUNYLHVDQUF1QyxFQUN2QywyQ0FBMkMsQ0FDM0MsQ0FBQztRQUNILENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxVQUFVO1lBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUVuRCxPQUFPO1lBQ04sSUFBSSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzNCLE9BQU8sRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDN0IsR0FBRyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzFCLEtBQUssRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUM1QixDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXhDLE9BQU8sS0FBSztRQUNYLENBQUMsQ0FBQztZQUNBLElBQUksRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QyxPQUFPLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakQsTUFBTSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hELEdBQUcsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsSUFBSSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzNCLE9BQU8sRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUM5QixNQUFNLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDN0IsR0FBRyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzFCLEtBQUssRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUM1QixDQUFDO0FBQ0wsQ0FBQztBQUVELFNBQVMsa0JBQWtCLENBQUMsTUFBcUI7SUFDaEQsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2IsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsU0FBUyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQzNELE1BQU0sQ0FBQyxJQUFJLENBQ1Ysd0ZBQXdGLEVBQ3hGLDBDQUEwQyxDQUMxQyxDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDUCxNQUFNLENBQUMsS0FBSyxDQUNYLHNDQUFzQyxFQUN0QywwQ0FBMEMsQ0FDMUMsQ0FBQztRQUNILENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxVQUFVO1lBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUVuRCxPQUFPO1lBQ04sR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO1lBQzlCLEtBQUssRUFBRSxLQUFLLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQztZQUNqQyxRQUFRLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDL0IsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ25DLEtBQUssRUFBRSxLQUFLLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUM7WUFDN0MsUUFBUSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQzNCLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLElBQUksSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FDcEM7U0FDRDtRQUNGLENBQUMsQ0FBQztZQUNBLEdBQUcsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQztZQUM5QixLQUFLLEVBQUUsS0FBSyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUM7WUFDakMsUUFBUSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQy9CLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxNQUFxQjtJQUNoRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0QsTUFBTSxDQUFDLElBQUksQ0FDVix5RkFBeUYsRUFDekYsMENBQTBDLENBQzFDLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLDBDQUEwQyxDQUMxQyxDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU87WUFDTixHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdEIsVUFBVSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLFNBQVMsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUNoQyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDNUIsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekMsVUFBVSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELFNBQVMsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuRCxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLFVBQVUsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUNqQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDaEMsS0FBSyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQzVCLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxNQUFxQjtJQUNoRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0QsTUFBTSxDQUFDLElBQUksQ0FDVix5RkFBeUYsRUFDekYsMENBQTBDLENBQzFDLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLDBDQUEwQyxDQUMxQyxDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU87WUFDTixHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdEIsVUFBVSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLEtBQUssRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUM1QixLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDNUIsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekMsVUFBVSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BELEtBQUssRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMvQyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLFVBQVUsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUNqQyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDNUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQzVCLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxNQUFxQjtJQUNoRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0QsTUFBTSxDQUFDLElBQUksQ0FDVix3RkFBd0YsRUFDeEYsMENBQTBDLENBQzFDLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLDBDQUEwQyxDQUMxQyxDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU87WUFDTixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDNUIsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkIsS0FBSyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQzVCLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxNQUFxQjtJQUNoRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0QsTUFBTSxDQUFDLElBQUksQ0FDVix5RkFBeUYsRUFDekYsMENBQTBDLENBQzFDLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLDBDQUEwQyxDQUMxQyxDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU87WUFDTixHQUFHLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDekIsS0FBSyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQUksRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUMxQixLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDNUIsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxHQUFHLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzlDLElBQUksRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsR0FBRyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLEtBQUssRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUMzQixJQUFJLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDMUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQzVCLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxNQUFxQjtJQUNoRCxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDM0QsTUFBTSxDQUFDLElBQUksQ0FDVix5RkFBeUYsRUFDekYsMENBQTBDLENBQzFDLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLDBDQUEwQyxDQUMxQyxDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU87WUFDTixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDNUIsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1NBQ3REO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkIsS0FBSyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQzVCLENBQUM7QUFDTCxDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0sS0FBSyxHQUFtQztJQUNwRCxJQUFJLEVBQUUsbUJBQW1CO0lBQ3pCLEdBQUcsRUFBRSxrQkFBa0I7SUFDdkIsR0FBRyxFQUFFLGtCQUFrQjtJQUN2QixHQUFHLEVBQUUsa0JBQWtCO0lBQ3ZCLEdBQUcsRUFBRSxrQkFBa0I7SUFDdkIsR0FBRyxFQUFFLGtCQUFrQjtJQUN2QixHQUFHLEVBQUUsa0JBQWtCO0NBQ3ZCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBzcmMvaW8vcGFyc2UvYmFzZS50c1xuXG5pbXBvcnQge1xuXHRDTVlLVmFsdWUsXG5cdEhleFZhbHVlLFxuXHRIU0xWYWx1ZSxcblx0SFNWVmFsdWUsXG5cdElPX0ludGVyZmFjZSxcblx0TEFCVmFsdWUsXG5cdFJHQlZhbHVlLFxuXHRYWVpWYWx1ZVxufSBmcm9tICcuLi8uLi90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBjb21tb24gfSBmcm9tICcuLi8uLi9jb21tb24vaW5kZXguanMnO1xuaW1wb3J0IHsgY29uZmlnLCBtb2RlIH0gZnJvbSAnLi4vLi4vY29tbW9uL2RhdGEvYmFzZS5qcyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuLi8uLi9sb2dnZXIvaW5kZXguanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxuY29uc3QgYnJhbmQgPSBjb21tb24uY29yZS5icmFuZDtcbmNvbnN0IGxvZ01vZGUgPSBtb2RlLmxvZ2dpbmc7XG5jb25zdCByZWdleCA9IHtcblx0Y215azogY29uZmlnLnJlZ2V4LmNvbG9ycy5jbXlrLFxuXHRoZXg6IGNvbmZpZy5yZWdleC5jb2xvcnMuaGV4LFxuXHRoc2w6IGNvbmZpZy5yZWdleC5jb2xvcnMuaHNsLFxuXHRoc3Y6IGNvbmZpZy5yZWdleC5jb2xvcnMuaHN2LFxuXHRsYWI6IGNvbmZpZy5yZWdleC5jb2xvcnMubGFiLFxuXHRyZ2I6IGNvbmZpZy5yZWdleC5jb2xvcnMucmdiLFxuXHR4eXo6IGNvbmZpZy5yZWdleC5jb2xvcnMueHl6XG59O1xuXG5mdW5jdGlvbiBwYXJzZUNNWUtDb2xvclZhbHVlKHJhd0NNWUs6IHN0cmluZyB8IG51bGwpOiBDTVlLVmFsdWUge1xuXHRpZiAoIXJhd0NNWUspIHtcblx0XHRpZiAoIW1vZGUucXVpZXQgJiYgbG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDIpIHtcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHQnQSBDTVlLIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0J2lvID4gcGFyc2UgPiBiYXNlID4gcGFyc2VDTVlLQ29sb3JWYWx1ZSgpJ1xuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnTWlzc2luZyBDTVlLIGVsZW1lbnQgaW4gcGFsZXR0ZSBmaWxlLicsXG5cdFx0XHRcdCdpbyA+IHBhcnNlID4gYmFzZSA+IHBhcnNlQ01ZS0NvbG9yVmFsdWUoKSdcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0Y3lhbjogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0bWFnZW50YTogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0eWVsbG93OiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRrZXk6IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdDTVlLLm1hdGNoKHJlZ2V4LmNteWspO1xuXG5cdHJldHVybiBtYXRjaFxuXHRcdD8ge1xuXHRcdFx0XHRjeWFuOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHRtYWdlbnRhOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHR5ZWxsb3c6IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzNdKSksXG5cdFx0XHRcdGtleTogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobWF0Y2hbNF0pKSxcblx0XHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzVdID8/ICcxJykpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdGN5YW46IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdFx0bWFnZW50YTogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0XHR5ZWxsb3c6IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdFx0a2V5OiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHRcdH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlSGV4Q29sb3JWYWx1ZShyYXdIZXg6IHN0cmluZyB8IG51bGwpOiBIZXhWYWx1ZSB7XG5cdGlmICghcmF3SGV4KSB7XG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUud2FybiAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSAyKSB7XG5cdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0J0EgSGV4IGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0J2lvID4gcGFyc2UgPiBiYXNlID4gcGFyc2VIZXhDb2xvclZhbHVlKCknXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIEhleCBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHQnaW8gPiBwYXJzZSA+IGJhc2UgPiBwYXJzZUhleENvbG9yVmFsdWUoKSdcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0aGV4OiBicmFuZC5hc0hleFNldCgnIzAwMDAwMCcpLFxuXHRcdFx0YWxwaGE6IGJyYW5kLmFzSGV4Q29tcG9uZW50KCdGRicpLFxuXHRcdFx0bnVtQWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZSgxKVxuXHRcdH07XG5cdH1cblxuXHRjb25zdCBtYXRjaCA9IHJhd0hleC5tYXRjaChyZWdleC5oZXgpO1xuXG5cdHJldHVybiBtYXRjaFxuXHRcdD8ge1xuXHRcdFx0XHRoZXg6IGJyYW5kLmFzSGV4U2V0KGAjJHttYXRjaFsxXX1gKSxcblx0XHRcdFx0YWxwaGE6IGJyYW5kLmFzSGV4Q29tcG9uZW50KG1hdGNoWzJdIHx8ICdGRicpLFxuXHRcdFx0XHRudW1BbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKFxuXHRcdFx0XHRcdHBhcnNlSW50KG1hdGNoWzJdIHx8ICdGRicsIDE2KSAvIDI1NVxuXHRcdFx0XHQpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdGhleDogYnJhbmQuYXNIZXhTZXQoJyMwMDAwMDAnKSxcblx0XHRcdFx0YWxwaGE6IGJyYW5kLmFzSGV4Q29tcG9uZW50KCdGRicpLFxuXHRcdFx0XHRudW1BbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKDEpXG5cdFx0XHR9O1xufVxuXG5mdW5jdGlvbiBwYXJzZUhTTENvbG9yVmFsdWUocmF3SFNMOiBzdHJpbmcgfCBudWxsKTogSFNMVmFsdWUge1xuXHRpZiAoIXJhd0hTTCkge1xuXHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLndhcm4gJiYgbG9nTW9kZS52ZXJib3NpdHkgPj0gMikge1xuXHRcdFx0bG9nZ2VyLndhcm4oXG5cdFx0XHRcdCdBbiBIU0wgZWxlbWVudCBjb3VsZCBub3QgYmUgZm91bmQgd2hpbGUgcGFyc2luZyBwYWxldHRlIGZpbGUuIEluamVjdGluZyBkZWZhdWx0IHZhbHVlcy4nLFxuXHRcdFx0XHQnaW8gPiBwYXJzZSA+IGJhc2UgPiBwYXJzZUhTTENvbG9yVmFsdWUoKSdcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0J01pc3NpbmcgSFNMIGVsZW1lbnQgaW4gcGFsZXR0ZSBmaWxlLicsXG5cdFx0XHRcdCdpbyA+IHBhcnNlID4gYmFzZSA+IHBhcnNlSFNMQ29sb3JWYWx1ZSgpJ1xuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAobW9kZS5zdGFja1RyYWNlKSBjb25zb2xlLnRyYWNlKCdTdGFjayBUcmFjZTonKTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRodWU6IGJyYW5kLmFzUmFkaWFsKDApLFxuXHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0bGlnaHRuZXNzOiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRhbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKDEpXG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IG1hdGNoID0gcmF3SFNMLm1hdGNoKHJlZ2V4LmhzbCk7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHRsaWdodG5lc3M6IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzNdKSksXG5cdFx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UocGFyc2VGbG9hdChtYXRjaFs0XSA/PyAnMScpKVxuXHRcdFx0fVxuXHRcdDoge1xuXHRcdFx0XHRodWU6IGJyYW5kLmFzUmFkaWFsKDApLFxuXHRcdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRcdGxpZ2h0bmVzczogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0XHRhbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKDEpXG5cdFx0XHR9O1xufVxuXG5mdW5jdGlvbiBwYXJzZUhTVkNvbG9yVmFsdWUocmF3SFNWOiBzdHJpbmcgfCBudWxsKTogSFNWVmFsdWUge1xuXHRpZiAoIXJhd0hTVikge1xuXHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLndhcm4gJiYgbG9nTW9kZS52ZXJib3NpdHkgPj0gMikge1xuXHRcdFx0bG9nZ2VyLndhcm4oXG5cdFx0XHRcdCdBbiBIU1YgZWxlbWVudCBjb3VsZCBub3QgYmUgZm91bmQgd2hpbGUgcGFyc2luZyBwYWxldHRlIGZpbGUuIEluamVjdGluZyBkZWZhdWx0IHZhbHVlcy4nLFxuXHRcdFx0XHQnaW8gPiBwYXJzZSA+IGJhc2UgPiBwYXJzZUhTVkNvbG9yVmFsdWUoKSdcblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGxvZ2dlci5kZWJ1Zyhcblx0XHRcdFx0J01pc3NpbmcgSFNWIGVsZW1lbnQgaW4gcGFsZXR0ZSBmaWxlLicsXG5cdFx0XHRcdCdpbyA+IHBhcnNlID4gYmFzZSA+IHBhcnNlSFNWQ29sb3JWYWx1ZSgpJ1xuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAobW9kZS5zdGFja1RyYWNlKSBjb25zb2xlLnRyYWNlKCdTdGFjayBUcmFjZTonKTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRodWU6IGJyYW5kLmFzUmFkaWFsKDApLFxuXHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0dmFsdWU6IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdIU1YubWF0Y2gocmVnZXguaHN2KTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbChwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzJdKSksXG5cdFx0XHRcdHZhbHVlOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFszXSkpLFxuXHRcdFx0XHRhbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKHBhcnNlRmxvYXQobWF0Y2hbNF0gPz8gJzEnKSlcblx0XHRcdH1cblx0XHQ6IHtcblx0XHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbCgwKSxcblx0XHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0XHR2YWx1ZTogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0XHRhbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKDEpXG5cdFx0XHR9O1xufVxuXG5mdW5jdGlvbiBwYXJzZUxBQkNvbG9yVmFsdWUocmF3TEFCOiBzdHJpbmcgfCBudWxsKTogTEFCVmFsdWUge1xuXHRpZiAoIXJhd0xBQikge1xuXHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLndhcm4gJiYgbG9nTW9kZS52ZXJib3NpdHkgPj0gMikge1xuXHRcdFx0bG9nZ2VyLndhcm4oXG5cdFx0XHRcdCdBIExBQiBlbGVtZW50IGNvdWxkIG5vdCBiZSBmb3VuZCB3aGlsZSBwYXJzaW5nIHBhbGV0dGUgZmlsZS4gSW5qZWN0aW5nIGRlZmF1bHQgdmFsdWVzLicsXG5cdFx0XHRcdCdpbyA+IHBhcnNlID4gYmFzZSA+IHBhcnNlTEFCQ29sb3JWYWx1ZSgpJ1xuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnTWlzc2luZyBMQUIgZWxlbWVudCBpbiBwYWxldHRlIGZpbGUuJyxcblx0XHRcdFx0J2lvID4gcGFyc2UgPiBiYXNlID4gcGFyc2VMQUJDb2xvclZhbHVlKCknXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLnN0YWNrVHJhY2UpIGNvbnNvbGUudHJhY2UoJ1N0YWNrIFRyYWNlOicpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGw6IGJyYW5kLmFzTEFCX0woMCksXG5cdFx0XHRhOiBicmFuZC5hc0xBQl9BKDApLFxuXHRcdFx0YjogYnJhbmQuYXNMQUJfQigwKSxcblx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdMQUIubWF0Y2gocmVnZXgubGFiKTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0bDogYnJhbmQuYXNMQUJfTChwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdGE6IGJyYW5kLmFzTEFCX0EocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHRiOiBicmFuZC5hc0xBQl9CKHBhcnNlRmxvYXQobWF0Y2hbM10pKSxcblx0XHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzRdID8/ICcxJykpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdGw6IGJyYW5kLmFzTEFCX0woMCksXG5cdFx0XHRcdGE6IGJyYW5kLmFzTEFCX0EoMCksXG5cdFx0XHRcdGI6IGJyYW5kLmFzTEFCX0IoMCksXG5cdFx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHRcdH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlUkdCQ29sb3JWYWx1ZShyYXdSR0I6IHN0cmluZyB8IG51bGwpOiBSR0JWYWx1ZSB7XG5cdGlmICghcmF3UkdCKSB7XG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUud2FybiAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSAyKSB7XG5cdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0J0FuIFJHQiBlbGVtZW50IGNvdWxkIG5vdCBiZSBmb3VuZCB3aGlsZSBwYXJzaW5nIHBhbGV0dGUgZmlsZS4gSW5qZWN0aW5nIGRlZmF1bHQgdmFsdWVzLicsXG5cdFx0XHRcdCdpbyA+IHBhcnNlID4gYmFzZSA+IHBhcnNlUkdCQ29sb3JWYWx1ZSgpJ1xuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnTWlzc2luZyBSR0IgZWxlbWVudCBpbiBwYWxldHRlIGZpbGUuJyxcblx0XHRcdFx0J2lvID4gcGFyc2UgPiBiYXNlID4gcGFyc2VSR0JDb2xvclZhbHVlKCknXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLnN0YWNrVHJhY2UpIGNvbnNvbGUudHJhY2UoJ1N0YWNrIFRyYWNlOicpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHJlZDogYnJhbmQuYXNCeXRlUmFuZ2UoMCksXG5cdFx0XHRncmVlbjogYnJhbmQuYXNCeXRlUmFuZ2UoMCksXG5cdFx0XHRibHVlOiBicmFuZC5hc0J5dGVSYW5nZSgwKSxcblx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdSR0IubWF0Y2gocmVnZXgucmdiKTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0cmVkOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdGdyZWVuOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzJdKSksXG5cdFx0XHRcdGJsdWU6IGJyYW5kLmFzQnl0ZVJhbmdlKHBhcnNlRmxvYXQobWF0Y2hbM10pKSxcblx0XHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzRdID8/ICcxJykpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdHJlZDogYnJhbmQuYXNCeXRlUmFuZ2UoMCksXG5cdFx0XHRcdGdyZWVuOiBicmFuZC5hc0J5dGVSYW5nZSgwKSxcblx0XHRcdFx0Ymx1ZTogYnJhbmQuYXNCeXRlUmFuZ2UoMCksXG5cdFx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHRcdH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlWFlaQ29sb3JWYWx1ZShyYXdYWVo6IHN0cmluZyB8IG51bGwpOiBYWVpWYWx1ZSB7XG5cdGlmICghcmF3WFlaKSB7XG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUud2FybiAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSAyKSB7XG5cdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0J0FuIFhZWiBlbGVtZW50IGNvdWxkIG5vdCBiZSBmb3VuZCB3aGlsZSBwYXJzaW5nIHBhbGV0dGUgZmlsZS4gSW5qZWN0aW5nIGRlZmF1bHQgdmFsdWVzLicsXG5cdFx0XHRcdCdpbyA+IHBhcnNlID4gYmFzZSA+IHBhcnNlWFlaQ29sb3JWYWx1ZSgpJ1xuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnTWlzc2luZyBYWVogZWxlbWVudCBpbiBwYWxldHRlIGZpbGUuJyxcblx0XHRcdFx0J2lvID4gcGFyc2UgPiBiYXNlID4gcGFyc2VYWVpDb2xvclZhbHVlKCknXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLnN0YWNrVHJhY2UpIGNvbnNvbGUudHJhY2UoJ1N0YWNrIFRyYWNlOicpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdHg6IGJyYW5kLmFzWFlaX1goMCksXG5cdFx0XHR5OiBicmFuZC5hc1hZWl9ZKDApLFxuXHRcdFx0ejogYnJhbmQuYXNYWVpfWigwKSxcblx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdYWVoubWF0Y2gocmVnZXgueHl6KTtcblxuXHRyZXR1cm4gbWF0Y2hcblx0XHQ/IHtcblx0XHRcdFx0eDogYnJhbmQuYXNYWVpfWChwYXJzZUZsb2F0KG1hdGNoWzFdKSksXG5cdFx0XHRcdHk6IGJyYW5kLmFzWFlaX1kocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHR6OiBicmFuZC5hc1hZWl9aKHBhcnNlRmxvYXQobWF0Y2hbM10pKSxcblx0XHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzRdID8/ICcxJykpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdHg6IGJyYW5kLmFzWFlaX1goMCksXG5cdFx0XHRcdHk6IGJyYW5kLmFzWFlaX1koMCksXG5cdFx0XHRcdHo6IGJyYW5kLmFzWFlaX1ooMCksXG5cdFx0XHRcdGFscGhhOiBicmFuZC5hc0FscGhhUmFuZ2UoMSlcblx0XHRcdH07XG59XG5cbmV4cG9ydCBjb25zdCBjb2xvcjogSU9fSW50ZXJmYWNlWydwYXJzZSddWydjb2xvciddID0ge1xuXHRjbXlrOiBwYXJzZUNNWUtDb2xvclZhbHVlLFxuXHRoZXg6IHBhcnNlSGV4Q29sb3JWYWx1ZSxcblx0aHNsOiBwYXJzZUhTTENvbG9yVmFsdWUsXG5cdGhzdjogcGFyc2VIU1ZDb2xvclZhbHVlLFxuXHRsYWI6IHBhcnNlTEFCQ29sb3JWYWx1ZSxcblx0cmdiOiBwYXJzZVJHQkNvbG9yVmFsdWUsXG5cdHh5ejogcGFyc2VYWVpDb2xvclZhbHVlXG59O1xuIl19