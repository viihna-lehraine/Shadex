// File: src/palette/io/parse/color.ts
import { common } from '../../common/index.js';
import { config } from '../../common/data/base.js';
const brand = common.core.brand;
const regex = config.regex;
const colorParsers = {};
const cmykParser = {
    parse(input) {
        const match = input.match(regex.colors.cmyk);
        if (!match) {
            throw new Error(`Invalid CMYK string format: ${input}`);
        }
        const [_, cyan, magenta, yellow, key, alpha = '1'] = match;
        const value = {
            cyan: brand.asPercentile(parseFloat(cyan) / 100),
            magenta: brand.asPercentile(parseFloat(magenta) / 100),
            yellow: brand.asPercentile(parseFloat(yellow) / 100),
            key: brand.asPercentile(parseFloat(key) / 100),
            alpha: brand.asAlphaRange(parseFloat(alpha))
        };
        return { format: 'cmyk', value };
    }
};
const hexParser = {
    parse(input) {
        const match = input.match(regex.colors.hex);
        if (!match) {
            throw new Error(`Invalid Hex string format: ${input}`);
        }
        const hex = brand.asHexSet(match[1].substring(0, 6));
        const alpha = brand.asHexComponent(String(match[1].length === 8
            ? parseInt(match[1].substring(6, 8), 16) / 255
            : 1));
        const numAlpha = brand.asAlphaRange(alpha);
        return {
            format: 'hex',
            value: { hex, alpha, numAlpha }
        };
    }
};
const hslParser = {
    parse(input) {
        const match = input.match(regex.colors.hsl);
        if (!match) {
            throw new Error(`Invalid HSL string format: ${input}`);
        }
        const [_, hue, saturation, lightness, alpha = '1'] = match;
        const value = {
            hue: brand.asRadial(parseFloat(hue)),
            saturation: brand.asPercentile(parseFloat(saturation) / 100),
            lightness: brand.asPercentile(parseFloat(lightness) / 100),
            alpha: brand.asAlphaRange(parseFloat(alpha))
        };
        return { format: 'hsl', value };
    }
};
const hsvParser = {
    parse(input) {
        const match = input.match(regex.colors.hsv);
        if (!match) {
            throw new Error(`Invalid HSV string format: ${input}`);
        }
        const [_, hue, saturation, value, alpha = '1'] = match;
        const hsvValue = {
            hue: brand.asRadial(parseFloat(hue)),
            saturation: brand.asPercentile(parseFloat(saturation) / 100),
            value: brand.asPercentile(parseFloat(value) / 100),
            alpha: brand.asAlphaRange(parseFloat(alpha))
        };
        return { format: 'hsv', value: hsvValue };
    }
};
const labParser = {
    parse(input) {
        const match = input.match(regex.colors.lab);
        if (!match) {
            throw new Error(`Invalid LAB string format: ${input}`);
        }
        const [_, l, a, b, alpha = '1'] = match;
        const labValue = {
            l: brand.asLAB_L(parseFloat(l)),
            a: brand.asLAB_A(parseFloat(a)),
            b: brand.asLAB_B(parseFloat(b)),
            alpha: brand.asAlphaRange(parseFloat(alpha))
        };
        return { format: 'lab', value: labValue };
    }
};
const rgbParser = {
    parse(input) {
        const match = input.match(regex.colors.rgb);
        if (!match) {
            throw new Error(`Invalid RGB string format: ${input}`);
        }
        const [_, red, green, blue, alpha = '1'] = match;
        const rgbValue = {
            red: brand.asByteRange(parseFloat(red)),
            green: brand.asByteRange(parseFloat(green)),
            blue: brand.asByteRange(parseFloat(blue)),
            alpha: brand.asAlphaRange(parseFloat(alpha))
        };
        return { format: 'rgb', value: rgbValue };
    }
};
const xyzParser = {
    parse(input) {
        const match = input.match(regex.colors.xyz);
        if (!match) {
            throw new Error(`Invalid XYZ string format: ${input}`);
        }
        const [_, x, y, z, alpha = '1'] = match;
        const xyzValue = {
            x: brand.asXYZ_X(parseFloat(x)),
            y: brand.asXYZ_Y(parseFloat(y)),
            z: brand.asXYZ_Z(parseFloat(z)),
            alpha: brand.asAlphaRange(parseFloat(alpha))
        };
        return { format: 'xyz', value: xyzValue };
    }
};
colorParsers['cmyk'] = cmykParser;
colorParsers['hex'] = hexParser;
colorParsers['hsl'] = hslParser;
colorParsers['hsv'] = hsvParser;
colorParsers['lab'] = labParser;
colorParsers['rgb'] = rgbParser;
colorParsers['xyz'] = xyzParser;
export function asColorString(format, input) {
    const parser = colorParsers[format.toLowerCase()];
    if (!parser) {
        throw new Error(`No parser available for format: ${format}`);
    }
    return parser.parse(input);
}
// ******** CSS COLOR STRINGS ********
export function asCSSColorString(format, input) {
    const color = asColorString(format, input);
    switch (color.format) {
        case 'cmyk':
            const cmyk = color.value;
            return `cmyk(${cmyk.cyan * 100}%, ${cmyk.magenta * 100}%, ${cmyk.yellow * 100}%, ${cmyk.key * 100}${cmyk.alpha !== 1 ? `, ${cmyk.alpha}` : ''})`;
        case 'hex':
            const hex = color.value;
            return `#${hex.hex}${String(hex.alpha) !== 'FF' ? hex.alpha : ''}`;
        case 'hsl':
            const hsl = color.value;
            return `hsl(${hsl.hue}, ${hsl.saturation * 100}%, ${hsl.lightness * 100}%${hsl.alpha !== 1 ? `, ${hsl.alpha}` : ''})`;
        case 'hsv':
            const hsv = color.value;
            return `hsv(${hsv.hue}, ${hsv.saturation * 100}%, ${hsv.value * 100}%${hsv.alpha !== 1 ? `, ${hsv.alpha}` : ''})`;
        case 'lab':
            const lab = color.value;
            return `lab(${lab.l}, ${lab.a}, ${lab.b}${lab.alpha !== 1 ? `, ${lab.alpha}` : ''})`;
        case 'rgb':
            const rgb = color.value;
            return `rgb(${rgb.red}, ${rgb.green}, ${rgb.blue}${rgb.alpha !== 1 ? `, ${rgb.alpha}` : ''})`;
        case 'xyz':
            const xyz = color.value;
            return `xyz(${xyz.x}, ${xyz.y}, ${xyz.z}${xyz.alpha !== 1 ? `, ${xyz.alpha}` : ''})`;
        default:
            throw new Error(`Unsupported color format: ${color.format}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvaW8vcGFyc2UvY29sb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsc0NBQXNDO0FBbUJ0QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDL0MsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBRW5ELE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0FBQ2hDLE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFFM0IsTUFBTSxZQUFZLEdBQWdDLEVBQUUsQ0FBQztBQUVyRCxNQUFNLFVBQVUsR0FBZ0I7SUFDL0IsS0FBSyxDQUFDLEtBQWE7UUFDbEIsTUFBTSxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTdDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNaLE1BQU0sSUFBSSxLQUFLLENBQUMsK0JBQStCLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDekQsQ0FBQztRQUVELE1BQU0sQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEtBQUssR0FBRyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7UUFFM0QsTUFBTSxLQUFLLEdBQWM7WUFDeEIsSUFBSSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUNoRCxPQUFPLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDO1lBQ3RELE1BQU0sRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDcEQsR0FBRyxF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QUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUN0QyxHQUFHLENBQUM7UUFFTCxLQUFLLEtBQUs7WUFDVCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsS0FBcUIsQ0FBQztZQUN4QyxPQUFPLE9BQU8sR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQ3RDLEdBQUcsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFDdEMsR0FBRyxDQUFDO1FBRUw7WUFDQyxNQUFNLElBQUksS0FBSyxDQUFDLDZCQUE2QixLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUMvRCxDQUFDO0FBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IHNyYy9wYWxldHRlL2lvL3BhcnNlL2NvbG9yLnRzXG5cbmltcG9ydCB7XG5cdENNWUssXG5cdENNWUtWYWx1ZSxcblx0Q29sb3IsXG5cdENvbG9yUGFyc2VyLFxuXHRIZXgsXG5cdEhTTCxcblx0SFNMVmFsdWUsXG5cdEhTVixcblx0SFNWVmFsdWUsXG5cdExBQixcblx0TEFCVmFsdWUsXG5cdFJHQixcblx0UkdCVmFsdWUsXG5cdFhZWixcblx0WFlaVmFsdWVcbn0gZnJvbSAnLi4vLi4vdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgY29tbW9uIH0gZnJvbSAnLi4vLi4vY29tbW9uL2luZGV4LmpzJztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJy4uLy4uL2NvbW1vbi9kYXRhL2Jhc2UuanMnO1xuXG5jb25zdCBicmFuZCA9IGNvbW1vbi5jb3JlLmJyYW5kO1xuY29uc3QgcmVnZXggPSBjb25maWcucmVnZXg7XG5cbmNvbnN0IGNvbG9yUGFyc2VyczogUmVjb3JkPHN0cmluZywgQ29sb3JQYXJzZXI+ID0ge307XG5cbmNvbnN0IGNteWtQYXJzZXI6IENvbG9yUGFyc2VyID0ge1xuXHRwYXJzZShpbnB1dDogc3RyaW5nKTogQ01ZSyB7XG5cdFx0Y29uc3QgbWF0Y2ggPSBpbnB1dC5tYXRjaChyZWdleC5jb2xvcnMuY215ayk7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgQ01ZSyBzdHJpbmcgZm9ybWF0OiAke2lucHV0fWApO1xuXHRcdH1cblxuXHRcdGNvbnN0IFtfLCBjeWFuLCBtYWdlbnRhLCB5ZWxsb3csIGtleSwgYWxwaGEgPSAnMSddID0gbWF0Y2g7XG5cblx0XHRjb25zdCB2YWx1ZTogQ01ZS1ZhbHVlID0ge1xuXHRcdFx0Y3lhbjogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQoY3lhbikgLyAxMDApLFxuXHRcdFx0bWFnZW50YTogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobWFnZW50YSkgLyAxMDApLFxuXHRcdFx0eWVsbG93OiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdCh5ZWxsb3cpIC8gMTAwKSxcblx0XHRcdGtleTogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQoa2V5KSAvIDEwMCksXG5cdFx0XHRhbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKHBhcnNlRmxvYXQoYWxwaGEpKVxuXHRcdH07XG5cblx0XHRyZXR1cm4geyBmb3JtYXQ6ICdjbXlrJywgdmFsdWUgfTtcblx0fVxufTtcblxuY29uc3QgaGV4UGFyc2VyOiBDb2xvclBhcnNlciA9IHtcblx0cGFyc2UoaW5wdXQ6IHN0cmluZyk6IEhleCB7XG5cdFx0Y29uc3QgbWF0Y2ggPSBpbnB1dC5tYXRjaChyZWdleC5jb2xvcnMuaGV4KTtcblxuXHRcdGlmICghbWF0Y2gpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBIZXggc3RyaW5nIGZvcm1hdDogJHtpbnB1dH1gKTtcblx0XHR9XG5cblx0XHRjb25zdCBoZXggPSBicmFuZC5hc0hleFNldChtYXRjaFsxXS5zdWJzdHJpbmcoMCwgNikpO1xuXHRcdGNvbnN0IGFscGhhID0gYnJhbmQuYXNIZXhDb21wb25lbnQoXG5cdFx0XHRTdHJpbmcoXG5cdFx0XHRcdG1hdGNoWzFdLmxlbmd0aCA9PT0gOFxuXHRcdFx0XHRcdD8gcGFyc2VJbnQobWF0Y2hbMV0uc3Vic3RyaW5nKDYsIDgpLCAxNikgLyAyNTVcblx0XHRcdFx0XHQ6IDFcblx0XHRcdClcblx0XHQpO1xuXHRcdGNvbnN0IG51bUFscGhhID0gYnJhbmQuYXNBbHBoYVJhbmdlKGFscGhhKTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRmb3JtYXQ6ICdoZXgnLFxuXHRcdFx0dmFsdWU6IHsgaGV4LCBhbHBoYSwgbnVtQWxwaGEgfVxuXHRcdH07XG5cdH1cbn07XG5cbmNvbnN0IGhzbFBhcnNlcjogQ29sb3JQYXJzZXIgPSB7XG5cdHBhcnNlKGlucHV0OiBzdHJpbmcpOiBIU0wge1xuXHRcdGNvbnN0IG1hdGNoID0gaW5wdXQubWF0Y2gocmVnZXguY29sb3JzLmhzbCk7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgSFNMIHN0cmluZyBmb3JtYXQ6ICR7aW5wdXR9YCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgW18sIGh1ZSwgc2F0dXJhdGlvbiwgbGlnaHRuZXNzLCBhbHBoYSA9ICcxJ10gPSBtYXRjaDtcblxuXHRcdGNvbnN0IHZhbHVlOiBIU0xWYWx1ZSA9IHtcblx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwocGFyc2VGbG9hdChodWUpKSxcblx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KHNhdHVyYXRpb24pIC8gMTAwKSxcblx0XHRcdGxpZ2h0bmVzczogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobGlnaHRuZXNzKSAvIDEwMCksXG5cdFx0XHRhbHBoYTogYnJhbmQuYXNBbHBoYVJhbmdlKHBhcnNlRmxvYXQoYWxwaGEpKVxuXHRcdH07XG5cblx0XHRyZXR1cm4geyBmb3JtYXQ6ICdoc2wnLCB2YWx1ZSB9O1xuXHR9XG59O1xuXG5jb25zdCBoc3ZQYXJzZXI6IENvbG9yUGFyc2VyID0ge1xuXHRwYXJzZShpbnB1dDogc3RyaW5nKTogSFNWIHtcblx0XHRjb25zdCBtYXRjaCA9IGlucHV0Lm1hdGNoKHJlZ2V4LmNvbG9ycy5oc3YpO1xuXG5cdFx0aWYgKCFtYXRjaCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEhTViBzdHJpbmcgZm9ybWF0OiAke2lucHV0fWApO1xuXHRcdH1cblxuXHRcdGNvbnN0IFtfLCBodWUsIHNhdHVyYXRpb24sIHZhbHVlLCBhbHBoYSA9ICcxJ10gPSBtYXRjaDtcblxuXHRcdGNvbnN0IGhzdlZhbHVlOiBIU1ZWYWx1ZSA9IHtcblx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwocGFyc2VGbG9hdChodWUpKSxcblx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KHNhdHVyYXRpb24pIC8gMTAwKSxcblx0XHRcdHZhbHVlOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdCh2YWx1ZSkgLyAxMDApLFxuXHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KGFscGhhKSlcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHsgZm9ybWF0OiAnaHN2JywgdmFsdWU6IGhzdlZhbHVlIH07XG5cdH1cbn07XG5cbmNvbnN0IGxhYlBhcnNlcjogQ29sb3JQYXJzZXIgPSB7XG5cdHBhcnNlKGlucHV0OiBzdHJpbmcpOiBMQUIge1xuXHRcdGNvbnN0IG1hdGNoID0gaW5wdXQubWF0Y2gocmVnZXguY29sb3JzLmxhYik7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgTEFCIHN0cmluZyBmb3JtYXQ6ICR7aW5wdXR9YCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgW18sIGwsIGEsIGIsIGFscGhhID0gJzEnXSA9IG1hdGNoO1xuXG5cdFx0Y29uc3QgbGFiVmFsdWU6IExBQlZhbHVlID0ge1xuXHRcdFx0bDogYnJhbmQuYXNMQUJfTChwYXJzZUZsb2F0KGwpKSxcblx0XHRcdGE6IGJyYW5kLmFzTEFCX0EocGFyc2VGbG9hdChhKSksXG5cdFx0XHRiOiBicmFuZC5hc0xBQl9CKHBhcnNlRmxvYXQoYikpLFxuXHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KGFscGhhKSlcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHsgZm9ybWF0OiAnbGFiJywgdmFsdWU6IGxhYlZhbHVlIH07XG5cdH1cbn07XG5cbmNvbnN0IHJnYlBhcnNlcjogQ29sb3JQYXJzZXIgPSB7XG5cdHBhcnNlKGlucHV0OiBzdHJpbmcpOiBSR0Ige1xuXHRcdGNvbnN0IG1hdGNoID0gaW5wdXQubWF0Y2gocmVnZXguY29sb3JzLnJnYik7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgUkdCIHN0cmluZyBmb3JtYXQ6ICR7aW5wdXR9YCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgW18sIHJlZCwgZ3JlZW4sIGJsdWUsIGFscGhhID0gJzEnXSA9IG1hdGNoO1xuXG5cdFx0Y29uc3QgcmdiVmFsdWU6IFJHQlZhbHVlID0ge1xuXHRcdFx0cmVkOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KHJlZCkpLFxuXHRcdFx0Z3JlZW46IGJyYW5kLmFzQnl0ZVJhbmdlKHBhcnNlRmxvYXQoZ3JlZW4pKSxcblx0XHRcdGJsdWU6IGJyYW5kLmFzQnl0ZVJhbmdlKHBhcnNlRmxvYXQoYmx1ZSkpLFxuXHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KGFscGhhKSlcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHsgZm9ybWF0OiAncmdiJywgdmFsdWU6IHJnYlZhbHVlIH07XG5cdH1cbn07XG5cbmNvbnN0IHh5elBhcnNlcjogQ29sb3JQYXJzZXIgPSB7XG5cdHBhcnNlKGlucHV0OiBzdHJpbmcpOiBYWVoge1xuXHRcdGNvbnN0IG1hdGNoID0gaW5wdXQubWF0Y2gocmVnZXguY29sb3JzLnh5eik7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgWFlaIHN0cmluZyBmb3JtYXQ6ICR7aW5wdXR9YCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgW18sIHgsIHksIHosIGFscGhhID0gJzEnXSA9IG1hdGNoO1xuXG5cdFx0Y29uc3QgeHl6VmFsdWU6IFhZWlZhbHVlID0ge1xuXHRcdFx0eDogYnJhbmQuYXNYWVpfWChwYXJzZUZsb2F0KHgpKSxcblx0XHRcdHk6IGJyYW5kLmFzWFlaX1kocGFyc2VGbG9hdCh5KSksXG5cdFx0XHR6OiBicmFuZC5hc1hZWl9aKHBhcnNlRmxvYXQoeikpLFxuXHRcdFx0YWxwaGE6IGJyYW5kLmFzQWxwaGFSYW5nZShwYXJzZUZsb2F0KGFscGhhKSlcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHsgZm9ybWF0OiAneHl6JywgdmFsdWU6IHh5elZhbHVlIH07XG5cdH1cbn07XG5cbmNvbG9yUGFyc2Vyc1snY215ayddID0gY215a1BhcnNlcjtcbmNvbG9yUGFyc2Vyc1snaGV4J10gPSBoZXhQYXJzZXI7XG5jb2xvclBhcnNlcnNbJ2hzbCddID0gaHNsUGFyc2VyO1xuY29sb3JQYXJzZXJzWydoc3YnXSA9IGhzdlBhcnNlcjtcbmNvbG9yUGFyc2Vyc1snbGFiJ10gPSBsYWJQYXJzZXI7XG5jb2xvclBhcnNlcnNbJ3JnYiddID0gcmdiUGFyc2VyO1xuY29sb3JQYXJzZXJzWyd4eXonXSA9IHh5elBhcnNlcjtcblxuZXhwb3J0IGZ1bmN0aW9uIGFzQ29sb3JTdHJpbmcoZm9ybWF0OiBzdHJpbmcsIGlucHV0OiBzdHJpbmcpOiBDb2xvciB7XG5cdGNvbnN0IHBhcnNlciA9IGNvbG9yUGFyc2Vyc1tmb3JtYXQudG9Mb3dlckNhc2UoKV07XG5cblx0aWYgKCFwYXJzZXIpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYE5vIHBhcnNlciBhdmFpbGFibGUgZm9yIGZvcm1hdDogJHtmb3JtYXR9YCk7XG5cdH1cblxuXHRyZXR1cm4gcGFyc2VyLnBhcnNlKGlucHV0KTtcbn1cblxuLy8gKioqKioqKiogQ1NTIENPTE9SIFNUUklOR1MgKioqKioqKipcblxuZXhwb3J0IGZ1bmN0aW9uIGFzQ1NTQ29sb3JTdHJpbmcoZm9ybWF0OiBzdHJpbmcsIGlucHV0OiBzdHJpbmcpOiBzdHJpbmcge1xuXHRjb25zdCBjb2xvciA9IGFzQ29sb3JTdHJpbmcoZm9ybWF0LCBpbnB1dCk7XG5cblx0c3dpdGNoIChjb2xvci5mb3JtYXQpIHtcblx0XHRjYXNlICdjbXlrJzpcblx0XHRcdGNvbnN0IGNteWsgPSBjb2xvci52YWx1ZSBhcyBDTVlLWyd2YWx1ZSddO1xuXHRcdFx0cmV0dXJuIGBjbXlrKCR7Y215ay5jeWFuICogMTAwfSUsICR7Y215ay5tYWdlbnRhICogMTAwfSUsICR7Y215ay55ZWxsb3cgKiAxMDB9JSwgJHtjbXlrLmtleSAqIDEwMH0ke1xuXHRcdFx0XHRjbXlrLmFscGhhICE9PSAxID8gYCwgJHtjbXlrLmFscGhhfWAgOiAnJ1xuXHRcdFx0fSlgO1xuXG5cdFx0Y2FzZSAnaGV4Jzpcblx0XHRcdGNvbnN0IGhleCA9IGNvbG9yLnZhbHVlIGFzIEhleFsndmFsdWUnXTtcblx0XHRcdHJldHVybiBgIyR7aGV4LmhleH0ke1N0cmluZyhoZXguYWxwaGEpICE9PSAnRkYnID8gaGV4LmFscGhhIDogJyd9YDtcblxuXHRcdGNhc2UgJ2hzbCc6XG5cdFx0XHRjb25zdCBoc2wgPSBjb2xvci52YWx1ZSBhcyBIU0xbJ3ZhbHVlJ107XG5cdFx0XHRyZXR1cm4gYGhzbCgke2hzbC5odWV9LCAke2hzbC5zYXR1cmF0aW9uICogMTAwfSUsICR7aHNsLmxpZ2h0bmVzcyAqIDEwMH0lJHtcblx0XHRcdFx0aHNsLmFscGhhICE9PSAxID8gYCwgJHtoc2wuYWxwaGF9YCA6ICcnXG5cdFx0XHR9KWA7XG5cblx0XHRjYXNlICdoc3YnOlxuXHRcdFx0Y29uc3QgaHN2ID0gY29sb3IudmFsdWUgYXMgSFNWWyd2YWx1ZSddO1xuXHRcdFx0cmV0dXJuIGBoc3YoJHtoc3YuaHVlfSwgJHtoc3Yuc2F0dXJhdGlvbiAqIDEwMH0lLCAke2hzdi52YWx1ZSAqIDEwMH0lJHtcblx0XHRcdFx0aHN2LmFscGhhICE9PSAxID8gYCwgJHtoc3YuYWxwaGF9YCA6ICcnXG5cdFx0XHR9KWA7XG5cblx0XHRjYXNlICdsYWInOlxuXHRcdFx0Y29uc3QgbGFiID0gY29sb3IudmFsdWUgYXMgTEFCWyd2YWx1ZSddO1xuXHRcdFx0cmV0dXJuIGBsYWIoJHtsYWIubH0sICR7bGFiLmF9LCAke2xhYi5ifSR7XG5cdFx0XHRcdGxhYi5hbHBoYSAhPT0gMSA/IGAsICR7bGFiLmFscGhhfWAgOiAnJ1xuXHRcdFx0fSlgO1xuXG5cdFx0Y2FzZSAncmdiJzpcblx0XHRcdGNvbnN0IHJnYiA9IGNvbG9yLnZhbHVlIGFzIFJHQlsndmFsdWUnXTtcblx0XHRcdHJldHVybiBgcmdiKCR7cmdiLnJlZH0sICR7cmdiLmdyZWVufSwgJHtyZ2IuYmx1ZX0ke1xuXHRcdFx0XHRyZ2IuYWxwaGEgIT09IDEgPyBgLCAke3JnYi5hbHBoYX1gIDogJydcblx0XHRcdH0pYDtcblxuXHRcdGNhc2UgJ3h5eic6XG5cdFx0XHRjb25zdCB4eXogPSBjb2xvci52YWx1ZSBhcyBYWVpbJ3ZhbHVlJ107XG5cdFx0XHRyZXR1cm4gYHh5eigke3h5ei54fSwgJHt4eXoueX0sICR7eHl6Lnp9JHtcblx0XHRcdFx0eHl6LmFscGhhICE9PSAxID8gYCwgJHt4eXouYWxwaGF9YCA6ICcnXG5cdFx0XHR9KWA7XG5cblx0XHRkZWZhdWx0OlxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBjb2xvciBmb3JtYXQ6ICR7Y29sb3IuZm9ybWF0fWApO1xuXHR9XG59XG4iXX0=