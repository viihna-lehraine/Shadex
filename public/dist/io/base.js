// File: io/base.js
import { deserialize } from './deserialize.js';
import { serialize } from './serialize.js';
import { utils as domUtils } from '../dom/utils.js';
// *DEV-NOTE* improve error handling and logging throughout
export const file = {
    async importFromFile(file) {
        return file.text().then(importPalette);
    },
    async exportToFile(palette, format) {
        const data = await exportPalette(palette, format);
        const mimeType = {
            css: 'text/css',
            json: 'application/json',
            xml: 'application/xml'
        }[format];
        domUtils.file.download(data, `palette_${palette.id}.${format}`, mimeType);
    }
};
function detectFileType(data) {
    if (data.trim().startsWith('{'))
        return 'json';
    if (data.trim().startsWith('<'))
        return 'xml';
    return 'css';
}
export async function exportPalette(palette, format) {
    switch (format) {
        case 'css':
            const cssData = await serialize.toCSS(palette);
            return cssData;
        case 'json':
            const jsonData = await serialize.toJSON(palette);
            return jsonData;
        case 'xml':
            const xmlData = await serialize.toXML(palette);
            return xmlData;
        default:
            throw new Error('Unsupported export format');
    }
}
export async function importPalette(data) {
    const fileType = detectFileType(data);
    switch (fileType) {
        case 'css':
            const cssPalette = await deserialize.fromCSS(data);
            if (!cssPalette)
                throw new Error('Invalid CSS');
            return cssPalette;
        case 'json':
            const jsonPalette = await deserialize.fromJSON(data);
            if (!jsonPalette)
                throw new Error('Invalid JSON');
            return jsonPalette;
        case 'xml':
            const xmlPalette = await deserialize.fromXML(data);
            if (!xmlPalette)
                throw new Error('Invalid XML');
            return xmlPalette;
        default:
            throw new Error('Unsupported file format');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9pby9iYXNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLG1CQUFtQjtBQUduQixPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDL0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxLQUFLLElBQUksUUFBUSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFcEQsMkRBQTJEO0FBRTNELE1BQU0sQ0FBQyxNQUFNLElBQUksR0FBRztJQUNuQixLQUFLLENBQUMsY0FBYyxDQUFDLElBQVU7UUFDOUIsT0FBTyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFDRCxLQUFLLENBQUMsWUFBWSxDQUNqQixPQUFnQixFQUNoQixNQUE4QjtRQUU5QixNQUFNLElBQUksR0FBRyxNQUFNLGFBQWEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbEQsTUFBTSxRQUFRLEdBQUc7WUFDaEIsR0FBRyxFQUFFLFVBQVU7WUFDZixJQUFJLEVBQUUsa0JBQWtCO1lBQ3hCLEdBQUcsRUFBRSxpQkFBaUI7U0FDdEIsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUVWLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUNyQixJQUFJLEVBQ0osV0FBVyxPQUFPLENBQUMsRUFBRSxJQUFJLE1BQU0sRUFBRSxFQUNqQyxRQUFRLENBQ1IsQ0FBQztJQUNILENBQUM7Q0FDRCxDQUFDO0FBRUYsU0FBUyxjQUFjLENBQUMsSUFBWTtJQUNuQyxJQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDO1FBQUUsT0FBTyxNQUFNLENBQUM7SUFDL0MsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQztRQUFFLE9BQU8sS0FBSyxDQUFDO0lBRTlDLE9BQU8sS0FBSyxDQUFDO0FBQ2QsQ0FBQztBQUVELE1BQU0sQ0FBQyxLQUFLLFVBQVUsYUFBYSxDQUNsQyxPQUFnQixFQUNoQixNQUE4QjtJQUU5QixRQUFRLE1BQU0sRUFBRSxDQUFDO1FBQ2hCLEtBQUssS0FBSztZQUNULE1BQU0sT0FBTyxHQUFHLE1BQU0sU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUUvQyxPQUFPLE9BQU8sQ0FBQztRQUNoQixLQUFLLE1BQU07WUFDVixNQUFNLFFBQVEsR0FBRyxNQUFNLFNBQVMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7WUFFakQsT0FBTyxRQUFRLENBQUM7UUFDakIsS0FBSyxLQUFLO1lBQ1QsTUFBTSxPQUFPLEdBQUcsTUFBTSxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRS9DLE9BQU8sT0FBTyxDQUFDO1FBQ2hCO1lBQ0MsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxDQUFDO0lBQy9DLENBQUM7QUFDRixDQUFDO0FBRUQsTUFBTSxDQUFDLEtBQUssVUFBVSxhQUFhLENBQUMsSUFBWTtJQUMvQyxNQUFNLFFBQVEsR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFdEMsUUFBUSxRQUFRLEVBQUUsQ0FBQztRQUNsQixLQUFLLEtBQUs7WUFDVCxNQUFNLFVBQVUsR0FBRyxNQUFNLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbkQsSUFBSSxDQUFDLFVBQVU7Z0JBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUVoRCxPQUFPLFVBQVUsQ0FBQztRQUNuQixLQUFLLE1BQU07WUFDVixNQUFNLFdBQVcsR0FBRyxNQUFNLFdBQVcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFckQsSUFBSSxDQUFDLFdBQVc7Z0JBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUVsRCxPQUFPLFdBQVcsQ0FBQztRQUNwQixLQUFLLEtBQUs7WUFDVCxNQUFNLFVBQVUsR0FBRyxNQUFNLFdBQVcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFbkQsSUFBSSxDQUFDLFVBQVU7Z0JBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUVoRCxPQUFPLFVBQVUsQ0FBQztRQUNuQjtZQUNDLE1BQU0sSUFBSSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUM3QyxDQUFDO0FBQ0YsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IGlvL2Jhc2UuanNcblxuaW1wb3J0IHsgUGFsZXR0ZSB9IGZyb20gJy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGRlc2VyaWFsaXplIH0gZnJvbSAnLi9kZXNlcmlhbGl6ZS5qcyc7XG5pbXBvcnQgeyBzZXJpYWxpemUgfSBmcm9tICcuL3NlcmlhbGl6ZS5qcyc7XG5pbXBvcnQgeyB1dGlscyBhcyBkb21VdGlscyB9IGZyb20gJy4uL2RvbS91dGlscy5qcyc7XG5cbi8vICpERVYtTk9URSogaW1wcm92ZSBlcnJvciBoYW5kbGluZyBhbmQgbG9nZ2luZyB0aHJvdWdob3V0XG5cbmV4cG9ydCBjb25zdCBmaWxlID0ge1xuXHRhc3luYyBpbXBvcnRGcm9tRmlsZShmaWxlOiBGaWxlKTogUHJvbWlzZTxQYWxldHRlPiB7XG5cdFx0cmV0dXJuIGZpbGUudGV4dCgpLnRoZW4oaW1wb3J0UGFsZXR0ZSk7XG5cdH0sXG5cdGFzeW5jIGV4cG9ydFRvRmlsZShcblx0XHRwYWxldHRlOiBQYWxldHRlLFxuXHRcdGZvcm1hdDogJ2NzcycgfCAnanNvbicgfCAneG1sJ1xuXHQpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRjb25zdCBkYXRhID0gYXdhaXQgZXhwb3J0UGFsZXR0ZShwYWxldHRlLCBmb3JtYXQpO1xuXHRcdGNvbnN0IG1pbWVUeXBlID0ge1xuXHRcdFx0Y3NzOiAndGV4dC9jc3MnLFxuXHRcdFx0anNvbjogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHRcdFx0eG1sOiAnYXBwbGljYXRpb24veG1sJ1xuXHRcdH1bZm9ybWF0XTtcblxuXHRcdGRvbVV0aWxzLmZpbGUuZG93bmxvYWQoXG5cdFx0XHRkYXRhLFxuXHRcdFx0YHBhbGV0dGVfJHtwYWxldHRlLmlkfS4ke2Zvcm1hdH1gLFxuXHRcdFx0bWltZVR5cGVcblx0XHQpO1xuXHR9XG59O1xuXG5mdW5jdGlvbiBkZXRlY3RGaWxlVHlwZShkYXRhOiBzdHJpbmcpOiAnY3NzJyB8ICdqc29uJyB8ICd4bWwnIHtcblx0aWYgKGRhdGEudHJpbSgpLnN0YXJ0c1dpdGgoJ3snKSkgcmV0dXJuICdqc29uJztcblx0aWYgKGRhdGEudHJpbSgpLnN0YXJ0c1dpdGgoJzwnKSkgcmV0dXJuICd4bWwnO1xuXG5cdHJldHVybiAnY3NzJztcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGV4cG9ydFBhbGV0dGUoXG5cdHBhbGV0dGU6IFBhbGV0dGUsXG5cdGZvcm1hdDogJ2NzcycgfCAnanNvbicgfCAneG1sJ1xuKTogUHJvbWlzZTxzdHJpbmc+IHtcblx0c3dpdGNoIChmb3JtYXQpIHtcblx0XHRjYXNlICdjc3MnOlxuXHRcdFx0Y29uc3QgY3NzRGF0YSA9IGF3YWl0IHNlcmlhbGl6ZS50b0NTUyhwYWxldHRlKTtcblxuXHRcdFx0cmV0dXJuIGNzc0RhdGE7XG5cdFx0Y2FzZSAnanNvbic6XG5cdFx0XHRjb25zdCBqc29uRGF0YSA9IGF3YWl0IHNlcmlhbGl6ZS50b0pTT04ocGFsZXR0ZSk7XG5cblx0XHRcdHJldHVybiBqc29uRGF0YTtcblx0XHRjYXNlICd4bWwnOlxuXHRcdFx0Y29uc3QgeG1sRGF0YSA9IGF3YWl0IHNlcmlhbGl6ZS50b1hNTChwYWxldHRlKTtcblxuXHRcdFx0cmV0dXJuIHhtbERhdGE7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdHRocm93IG5ldyBFcnJvcignVW5zdXBwb3J0ZWQgZXhwb3J0IGZvcm1hdCcpO1xuXHR9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbXBvcnRQYWxldHRlKGRhdGE6IHN0cmluZyk6IFByb21pc2U8UGFsZXR0ZT4ge1xuXHRjb25zdCBmaWxlVHlwZSA9IGRldGVjdEZpbGVUeXBlKGRhdGEpO1xuXG5cdHN3aXRjaCAoZmlsZVR5cGUpIHtcblx0XHRjYXNlICdjc3MnOlxuXHRcdFx0Y29uc3QgY3NzUGFsZXR0ZSA9IGF3YWl0IGRlc2VyaWFsaXplLmZyb21DU1MoZGF0YSk7XG5cblx0XHRcdGlmICghY3NzUGFsZXR0ZSkgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIENTUycpO1xuXG5cdFx0XHRyZXR1cm4gY3NzUGFsZXR0ZTtcblx0XHRjYXNlICdqc29uJzpcblx0XHRcdGNvbnN0IGpzb25QYWxldHRlID0gYXdhaXQgZGVzZXJpYWxpemUuZnJvbUpTT04oZGF0YSk7XG5cblx0XHRcdGlmICghanNvblBhbGV0dGUpIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBKU09OJyk7XG5cblx0XHRcdHJldHVybiBqc29uUGFsZXR0ZTtcblx0XHRjYXNlICd4bWwnOlxuXHRcdFx0Y29uc3QgeG1sUGFsZXR0ZSA9IGF3YWl0IGRlc2VyaWFsaXplLmZyb21YTUwoZGF0YSk7XG5cblx0XHRcdGlmICgheG1sUGFsZXR0ZSkgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFhNTCcpO1xuXG5cdFx0XHRyZXR1cm4geG1sUGFsZXR0ZTtcblx0XHRkZWZhdWx0OlxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdVbnN1cHBvcnRlZCBmaWxlIGZvcm1hdCcpO1xuXHR9XG59XG4iXX0=