{"version":3,"file":"registry.js","sources":["../../../../src/app/registry.ts"],"sourcesContent":["// File: app/dependencyRegistry.ts\n\nimport {\n\tAppDependencies,\n\tCommonFunctions,\n\tHelpers,\n\tServices,\n\tUtilities\n} from '../types/index.js';\nimport { EventManager } from '../events/EventManager.js';\nimport { PaletteEvents } from '../events/PaletteEvents.js';\nimport { UIEvents } from '../events/UIEvents.js';\n\nexport async function registerDependencies(\n\thelpers: Helpers,\n\tservices: Services\n): Promise<AppDependencies> {\n\tconst { errors, log } = services;\n\tconst caller = '[REGISTER_DEPENDENCIES]';\n\n\t// 1. Execute the function\n\tlog(`Executing registerDependencies...`, { caller });\n\n\treturn await errors.handleAsync(async () => {\n\t\tlet events: { palette: PaletteEvents; ui: UIEvents } | null = null;\n\n\t\t// 2. Create empty utils placeholder\n\t\tconst utils = {} as Utilities;\n\n\t\t// 3. Initialize utilities\n\t\tconst { initializeUtilities } = await import('./init.js');\n\t\tlog('Initializing Utilities.', { caller });\n\t\tObject.assign(utils, await initializeUtilities(helpers, services));\n\n\t\t// 4. Initialize CommonFunctions with required properties\n\t\tlog('Initializing CommonFunctions with required properties.', {\n\t\t\tcaller\n\t\t});\n\t\tconst common: Required<CommonFunctions> = {\n\t\t\thelpers,\n\t\t\tservices,\n\t\t\tutils\n\t\t};\n\n\t\t// 5. Initialize StateManager\n\t\tconst { initializeStateManager } = await import('./init.js');\n\t\tlog('Initializing StateManager.', {\n\t\t\tcaller: '[REGISTER_DEPENDENCIES]'\n\t\t});\n\t\tconst stateManager = await initializeStateManager(\n\t\t\thelpers,\n\t\t\tservices,\n\t\t\tutils!\n\t\t);\n\n\t\t// 6. Initialize PaletteState\n\t\tconst { initializePaletteState } = await import('./init.js');\n\t\tlog(`Initializing PaletteState.`, { caller });\n\t\tconst paletteState = await initializePaletteState(\n\t\t\tservices,\n\t\t\tstateManager,\n\t\t\tutils\n\t\t);\n\n\t\t// 7. Initialize PaletteManager\n\t\tconst { generateHuesFnGroup } = await import(\n\t\t\t'../palette/partials/hues.js'\n\t\t);\n\t\tconst { generatePaletteFnGroup } = await import(\n\t\t\t'../palette/partials/types.js'\n\t\t);\n\t\tconst { generatePalette } = await import('../palette/generate.js');\n\t\tconst { initializePaletteManager } = await import('./init.js');\n\t\tlog(`Initializing PaletteManager.`, { caller });\n\t\tconst paletteManager = await initializePaletteManager(\n\t\t\tcommon,\n\t\t\tgenerateHuesFnGroup,\n\t\t\tgeneratePaletteFnGroup,\n\t\t\tgeneratePalette,\n\t\t\tstateManager\n\t\t);\n\n\t\t// 8. Initialize EventManager\n\t\tlog(`Initializing EventManager.`, { caller });\n\t\tconst eventManager = EventManager.getInstance(services);\n\n\t\t// 9. Initialize event classes object\n\t\tconst { initializeEvents } = await import('./init.js');\n\t\tconsole.log(`${caller}: initializeEvents function imported.`);\n\t\tlog(`Initializing event classes object.`, { caller });\n\t\tevents = (await initializeEvents(\n\t\t\thelpers,\n\t\t\tpaletteManager,\n\t\t\tpaletteState,\n\t\t\tservices,\n\t\t\tstateManager,\n\t\t\tutils\n\t\t))!;\n\n\t\t// 10.; Ensure state is fully initialized before rendering palette\n\t\tlog(`Calling stateManager.ensureStateReady`, { caller });\n\t\tawait stateManager.ensureStateReady();\n\n\t\t// 11. Render initial palette\n\t\tlog(`Rendering initial palette.`, { caller });\n\t\tawait paletteManager!.loadPalette();\n\t\tlog(`Initial palette rendered.`, { caller });\n\n\t\t// 12. Log success and return dependencies\n\t\tlog(`Dependencies registered.`, { caller });\n\t\treturn {\n\t\t\tcommon,\n\t\t\teventManager,\n\t\t\tevents,\n\t\t\tpaletteManager: paletteManager,\n\t\t\tpaletteState: paletteState,\n\t\t\tstateManager: stateManager\n\t\t} as AppDependencies;\n\t}, 'Error registering dependencies');\n}\n"],"names":[],"mappings":"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"}