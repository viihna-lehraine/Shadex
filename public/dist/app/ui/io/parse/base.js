// File: app/ui/io/parse/base.js
import { commonFn } from '../../../../common/index.js';
import { configData } from '../../../../data/config.js';
import { createLogger } from '../../../../logger/index.js';
import { modeData as mode } from '../../../../data/mode.js';
const brand = commonFn.core.brand;
const logMode = mode.logging;
const regex = {
    cmyk: configData.regex.colors.cmyk,
    hex: configData.regex.colors.hex,
    hsl: configData.regex.colors.hsl,
    hsv: configData.regex.colors.hsv,
    lab: configData.regex.colors.lab,
    rgb: configData.regex.colors.rgb,
    xyz: configData.regex.colors.xyz
};
const thisModule = 'io/parse/base.js';
const logger = await createLogger();
function parseCMYKColorValue(rawCMYK) {
    const caller = 'parseCMYKColorValue()';
    if (!rawCMYK) {
        if (logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A CMYK element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing CMYK element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            cyan: brand.asPercentile(0),
            magenta: brand.asPercentile(0),
            yellow: brand.asPercentile(0),
            key: brand.asPercentile(0)
        };
    }
    const match = rawCMYK.match(regex.cmyk);
    return match
        ? {
            cyan: brand.asPercentile(parseFloat(match[1])),
            magenta: brand.asPercentile(parseFloat(match[2])),
            yellow: brand.asPercentile(parseFloat(match[3])),
            key: brand.asPercentile(parseFloat(match[4]))
        }
        : {
            cyan: brand.asPercentile(0),
            magenta: brand.asPercentile(0),
            yellow: brand.asPercentile(0),
            key: brand.asPercentile(0)
        };
}
function parseHexColorValue(rawHex) {
    const caller = 'parseHexColorValue()';
    if (!rawHex) {
        if (logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A Hex element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing Hex element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return { hex: brand.asHexSet('#000000') };
    }
    const match = rawHex.match(regex.hex);
    return match
        ? {
            hex: brand.asHexSet(`#${match[1]}`)
        }
        : {
            hex: brand.asHexSet('#000000')
        };
}
function parseHSLColorValue(rawHSL) {
    const caller = 'parseHSLColorValue()';
    if (!rawHSL) {
        if (logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An HSL element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing HSL element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            lightness: brand.asPercentile(0)
        };
    }
    const match = rawHSL.match(regex.hsl);
    return match
        ? {
            hue: brand.asRadial(parseFloat(match[1])),
            saturation: brand.asPercentile(parseFloat(match[2])),
            lightness: brand.asPercentile(parseFloat(match[3]))
        }
        : {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            lightness: brand.asPercentile(0)
        };
}
function parseHSVColorValue(rawHSV) {
    const caller = 'parseHSVColorValue()';
    if (!rawHSV) {
        if (logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An HSV element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing HSV element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            value: brand.asPercentile(0)
        };
    }
    const match = rawHSV.match(regex.hsv);
    return match
        ? {
            hue: brand.asRadial(parseFloat(match[1])),
            saturation: brand.asPercentile(parseFloat(match[2])),
            value: brand.asPercentile(parseFloat(match[3]))
        }
        : {
            hue: brand.asRadial(0),
            saturation: brand.asPercentile(0),
            value: brand.asPercentile(0)
        };
}
function parseLABColorValue(rawLAB) {
    const caller = 'parseLABColorValue()';
    if (!rawLAB) {
        if (logMode.warn && logMode.verbosity >= 2) {
            logger.warn('A LAB element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing LAB element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            l: brand.asLAB_L(0),
            a: brand.asLAB_A(0),
            b: brand.asLAB_B(0)
        };
    }
    const match = rawLAB.match(regex.lab);
    return match
        ? {
            l: brand.asLAB_L(parseFloat(match[1])),
            a: brand.asLAB_A(parseFloat(match[2])),
            b: brand.asLAB_B(parseFloat(match[3]))
        }
        : {
            l: brand.asLAB_L(0),
            a: brand.asLAB_A(0),
            b: brand.asLAB_B(0)
        };
}
function parseRGBColorValue(rawRGB) {
    const caller = 'parseRGBColorValue()';
    if (!rawRGB) {
        if (logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An RGB element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing RGB element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            red: brand.asByteRange(0),
            green: brand.asByteRange(0),
            blue: brand.asByteRange(0)
        };
    }
    const match = rawRGB.match(regex.rgb);
    return match
        ? {
            red: brand.asByteRange(parseFloat(match[1])),
            green: brand.asByteRange(parseFloat(match[2])),
            blue: brand.asByteRange(parseFloat(match[3]))
        }
        : {
            red: brand.asByteRange(0),
            green: brand.asByteRange(0),
            blue: brand.asByteRange(0)
        };
}
function parseXYZColorValue(rawXYZ) {
    const caller = 'parseXYZColorValue()';
    if (!rawXYZ) {
        if (logMode.warn && logMode.verbosity >= 2) {
            logger.warn('An XYZ element could not be found while parsing palette file. Injecting default values.', `${thisModule} > ${caller}`);
        }
        else {
            logger.debug('Missing XYZ element in palette file.', `${thisModule} > ${caller}`);
        }
        if (mode.stackTrace)
            console.trace('Stack Trace:');
        return {
            x: brand.asXYZ_X(0),
            y: brand.asXYZ_Y(0),
            z: brand.asXYZ_Z(0)
        };
    }
    const match = rawXYZ.match(regex.xyz);
    return match
        ? {
            x: brand.asXYZ_X(parseFloat(match[1])),
            y: brand.asXYZ_Y(parseFloat(match[2])),
            z: brand.asXYZ_Z(parseFloat(match[3]))
        }
        : {
            x: brand.asXYZ_X(0),
            y: brand.asXYZ_Y(0),
            z: brand.asXYZ_Z(0)
        };
}
export const color = {
    cmyk: parseCMYKColorValue,
    hex: parseHexColorValue,
    hsl: parseHSLColorValue,
    hsv: parseHSVColorValue,
    lab: parseLABColorValue,
    rgb: parseRGBColorValue,
    xyz: parseXYZColorValue
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3NyYy9hcHAvdWkvaW8vcGFyc2UvYmFzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnQ0FBZ0M7QUFZaEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFFBQVEsSUFBSSxJQUFJLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUU1RCxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUNsQyxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBQzdCLE1BQU0sS0FBSyxHQUFHO0lBQ2IsSUFBSSxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUk7SUFDbEMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDaEMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDaEMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDaEMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDaEMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7SUFDaEMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUc7Q0FDaEMsQ0FBQztBQUVGLE1BQU0sVUFBVSxHQUFHLGtCQUFrQixDQUFDO0FBRXRDLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxFQUFFLENBQUM7QUFFcEMsU0FBUyxtQkFBbUIsQ0FBQyxPQUFzQjtJQUNsRCxNQUFNLE1BQU0sR0FBRyx1QkFBdUIsQ0FBQztJQUV2QyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDZCxJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLFNBQVMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUM1QyxNQUFNLENBQUMsSUFBSSxDQUNWLHlGQUF5RixFQUN6RixHQUFHLFVBQVUsTUFBTSxNQUFNLEVBQUUsQ0FDM0IsQ0FBQztRQUNILENBQUM7YUFBTSxDQUFDO1lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FDWCx1Q0FBdUMsRUFDdkMsR0FBRyxVQUFVLE1BQU0sTUFBTSxFQUFFLENBQzNCLENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxJQUFJLENBQUMsVUFBVTtZQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFbkQsT0FBTztZQUNOLElBQUksRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUMzQixPQUFPLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDOUIsTUFBTSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzdCLEdBQUcsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUMxQixDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXhDLE9BQU8sS0FBSztRQUNYLENBQUMsQ0FBQztZQUNBLElBQUksRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QyxPQUFPLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDakQsTUFBTSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hELEdBQUcsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUM3QztRQUNGLENBQUMsQ0FBQztZQUNBLElBQUksRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUMzQixPQUFPLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDOUIsTUFBTSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQzdCLEdBQUcsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUMxQixDQUFDO0FBQ0wsQ0FBQztBQUVELFNBQVMsa0JBQWtCLENBQUMsTUFBcUI7SUFDaEQsTUFBTSxNQUFNLEdBQUcsc0JBQXNCLENBQUM7SUFFdEMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2IsSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDNUMsTUFBTSxDQUFDLElBQUksQ0FDVix3RkFBd0YsRUFDeEYsR0FBRyxVQUFVLE1BQU0sTUFBTSxFQUFFLENBQzNCLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLEdBQUcsVUFBVSxNQUFNLE1BQU0sRUFBRSxDQUMzQixDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU8sRUFBRSxHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO0lBQzNDLENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1NBQ25DO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDO1NBQzlCLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxNQUFxQjtJQUNoRCxNQUFNLE1BQU0sR0FBRyxzQkFBc0IsQ0FBQztJQUV0QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLFNBQVMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUM1QyxNQUFNLENBQUMsSUFBSSxDQUNWLHlGQUF5RixFQUN6RixHQUFHLFVBQVUsTUFBTSxNQUFNLEVBQUUsQ0FDM0IsQ0FBQztRQUNILENBQUM7YUFBTSxDQUFDO1lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FDWCxzQ0FBc0MsRUFDdEMsR0FBRyxVQUFVLE1BQU0sTUFBTSxFQUFFLENBQzNCLENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxJQUFJLENBQUMsVUFBVTtZQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFbkQsT0FBTztZQUNOLEdBQUcsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUN0QixVQUFVLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7WUFDakMsU0FBUyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1NBQ2hDLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsT0FBTyxLQUFLO1FBQ1gsQ0FBQyxDQUFDO1lBQ0EsR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLFVBQVUsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRCxTQUFTLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkQ7UUFDRixDQUFDLENBQUM7WUFDQSxHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdEIsVUFBVSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLFNBQVMsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUNoQyxDQUFDO0FBQ0wsQ0FBQztBQUVELFNBQVMsa0JBQWtCLENBQUMsTUFBcUI7SUFDaEQsTUFBTSxNQUFNLEdBQUcsc0JBQXNCLENBQUM7SUFFdEMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2IsSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDNUMsTUFBTSxDQUFDLElBQUksQ0FDVix5RkFBeUYsRUFDekYsR0FBRyxVQUFVLE1BQU0sTUFBTSxFQUFFLENBQzNCLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLEdBQUcsVUFBVSxNQUFNLE1BQU0sRUFBRSxDQUMzQixDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU87WUFDTixHQUFHLEVBQUUsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDdEIsVUFBVSxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLEtBQUssRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztTQUM1QixDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXRDLE9BQU8sS0FBSztRQUNYLENBQUMsQ0FBQztZQUNBLEdBQUcsRUFBRSxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QyxVQUFVLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEQsS0FBSyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQy9DO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLFVBQVUsRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztZQUNqQyxLQUFLLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7U0FDNUIsQ0FBQztBQUNMLENBQUM7QUFFRCxTQUFTLGtCQUFrQixDQUFDLE1BQXFCO0lBQ2hELE1BQU0sTUFBTSxHQUFHLHNCQUFzQixDQUFDO0lBRXRDLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNiLElBQUksT0FBTyxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsU0FBUyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQ1Ysd0ZBQXdGLEVBQ3hGLEdBQUcsVUFBVSxNQUFNLE1BQU0sRUFBRSxDQUMzQixDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDUCxNQUFNLENBQUMsS0FBSyxDQUNYLHNDQUFzQyxFQUN0QyxHQUFHLFVBQVUsTUFBTSxNQUFNLEVBQUUsQ0FDM0IsQ0FBQztRQUNILENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxVQUFVO1lBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUVuRCxPQUFPO1lBQ04sQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDbkIsQ0FBQztJQUNILENBQUM7SUFFRCxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QyxPQUFPLEtBQUs7UUFDWCxDQUFDLENBQUM7WUFDQSxDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RDLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUN0QztRQUNGLENBQUMsQ0FBQztZQUNBLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1NBQ25CLENBQUM7QUFDTCxDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxNQUFxQjtJQUNoRCxNQUFNLE1BQU0sR0FBRyxzQkFBc0IsQ0FBQztJQUV0QyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDYixJQUFJLE9BQU8sQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLFNBQVMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUM1QyxNQUFNLENBQUMsSUFBSSxDQUNWLHlGQUF5RixFQUN6RixHQUFHLFVBQVUsTUFBTSxNQUFNLEVBQUUsQ0FDM0IsQ0FBQztRQUNILENBQUM7YUFBTSxDQUFDO1lBQ1AsTUFBTSxDQUFDLEtBQUssQ0FDWCxzQ0FBc0MsRUFDdEMsR0FBRyxVQUFVLE1BQU0sTUFBTSxFQUFFLENBQzNCLENBQUM7UUFDSCxDQUFDO1FBRUQsSUFBSSxJQUFJLENBQUMsVUFBVTtZQUFFLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7UUFFbkQsT0FBTztZQUNOLEdBQUcsRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUN6QixLQUFLLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDM0IsSUFBSSxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1NBQzFCLENBQUM7SUFDSCxDQUFDO0lBRUQsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsT0FBTyxLQUFLO1FBQ1gsQ0FBQyxDQUFDO1lBQ0EsR0FBRyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVDLEtBQUssRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM5QyxJQUFJLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDN0M7UUFDRixDQUFDLENBQUM7WUFDQSxHQUFHLEVBQUUsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDekIsS0FBSyxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQUksRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztTQUMxQixDQUFDO0FBQ0wsQ0FBQztBQUVELFNBQVMsa0JBQWtCLENBQUMsTUFBcUI7SUFDaEQsTUFBTSxNQUFNLEdBQUcsc0JBQXNCLENBQUM7SUFFdEMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2IsSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDNUMsTUFBTSxDQUFDLElBQUksQ0FDVix5RkFBeUYsRUFDekYsR0FBRyxVQUFVLE1BQU0sTUFBTSxFQUFFLENBQzNCLENBQUM7UUFDSCxDQUFDO2FBQU0sQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0NBQXNDLEVBQ3RDLEdBQUcsVUFBVSxNQUFNLE1BQU0sRUFBRSxDQUMzQixDQUFDO1FBQ0gsQ0FBQztRQUVELElBQUksSUFBSSxDQUFDLFVBQVU7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5ELE9BQU87WUFDTixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkIsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztTQUNuQixDQUFDO0lBQ0gsQ0FBQztJQUVELE1BQU0sS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXRDLE9BQU8sS0FBSztRQUNYLENBQUMsQ0FBQztZQUNBLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QyxDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ3RDO1FBQ0YsQ0FBQyxDQUFDO1lBQ0EsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ25CLENBQUMsRUFBRSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQixDQUFDLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7U0FDbkIsQ0FBQztBQUNMLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxLQUFLLEdBQTJDO0lBQzVELElBQUksRUFBRSxtQkFBbUI7SUFDekIsR0FBRyxFQUFFLGtCQUFrQjtJQUN2QixHQUFHLEVBQUUsa0JBQWtCO0lBQ3ZCLEdBQUcsRUFBRSxrQkFBa0I7SUFDdkIsR0FBRyxFQUFFLGtCQUFrQjtJQUN2QixHQUFHLEVBQUUsa0JBQWtCO0lBQ3ZCLEdBQUcsRUFBRSxrQkFBa0I7Q0FDdkIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IGFwcC91aS9pby9wYXJzZS9iYXNlLmpzXG5cbmltcG9ydCB7XG5cdENNWUssXG5cdEhleCxcblx0SFNMLFxuXHRIU1YsXG5cdElPRm5fTWFzdGVySW50ZXJmYWNlLFxuXHRMQUIsXG5cdFJHQixcblx0WFlaXG59IGZyb20gJy4uLy4uLy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGNvbW1vbkZuIH0gZnJvbSAnLi4vLi4vLi4vLi4vY29tbW9uL2luZGV4LmpzJztcbmltcG9ydCB7IGNvbmZpZ0RhdGEgfSBmcm9tICcuLi8uLi8uLi8uLi9kYXRhL2NvbmZpZy5qcyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9sb2dnZXIvaW5kZXguanMnO1xuaW1wb3J0IHsgbW9kZURhdGEgYXMgbW9kZSB9IGZyb20gJy4uLy4uLy4uLy4uL2RhdGEvbW9kZS5qcyc7XG5cbmNvbnN0IGJyYW5kID0gY29tbW9uRm4uY29yZS5icmFuZDtcbmNvbnN0IGxvZ01vZGUgPSBtb2RlLmxvZ2dpbmc7XG5jb25zdCByZWdleCA9IHtcblx0Y215azogY29uZmlnRGF0YS5yZWdleC5jb2xvcnMuY215ayxcblx0aGV4OiBjb25maWdEYXRhLnJlZ2V4LmNvbG9ycy5oZXgsXG5cdGhzbDogY29uZmlnRGF0YS5yZWdleC5jb2xvcnMuaHNsLFxuXHRoc3Y6IGNvbmZpZ0RhdGEucmVnZXguY29sb3JzLmhzdixcblx0bGFiOiBjb25maWdEYXRhLnJlZ2V4LmNvbG9ycy5sYWIsXG5cdHJnYjogY29uZmlnRGF0YS5yZWdleC5jb2xvcnMucmdiLFxuXHR4eXo6IGNvbmZpZ0RhdGEucmVnZXguY29sb3JzLnh5elxufTtcblxuY29uc3QgdGhpc01vZHVsZSA9ICdpby9wYXJzZS9iYXNlLmpzJztcblxuY29uc3QgbG9nZ2VyID0gYXdhaXQgY3JlYXRlTG9nZ2VyKCk7XG5cbmZ1bmN0aW9uIHBhcnNlQ01ZS0NvbG9yVmFsdWUocmF3Q01ZSzogc3RyaW5nIHwgbnVsbCk6IENNWUtbJ3ZhbHVlJ10ge1xuXHRjb25zdCBjYWxsZXIgPSAncGFyc2VDTVlLQ29sb3JWYWx1ZSgpJztcblxuXHRpZiAoIXJhd0NNWUspIHtcblx0XHRpZiAobG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDIpIHtcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHQnQSBDTVlLIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIENNWUsgZWxlbWVudCBpbiBwYWxldHRlIGZpbGUuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLnN0YWNrVHJhY2UpIGNvbnNvbGUudHJhY2UoJ1N0YWNrIFRyYWNlOicpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGN5YW46IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdG1hZ2VudGE6IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdHllbGxvdzogYnJhbmQuYXNQZXJjZW50aWxlKDApLFxuXHRcdFx0a2V5OiBicmFuZC5hc1BlcmNlbnRpbGUoMClcblx0XHR9O1xuXHR9XG5cblx0Y29uc3QgbWF0Y2ggPSByYXdDTVlLLm1hdGNoKHJlZ2V4LmNteWspO1xuXG5cdHJldHVybiBtYXRjaFxuXHRcdD8ge1xuXHRcdFx0XHRjeWFuOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHRtYWdlbnRhOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHR5ZWxsb3c6IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KG1hdGNoWzNdKSksXG5cdFx0XHRcdGtleTogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobWF0Y2hbNF0pKVxuXHRcdFx0fVxuXHRcdDoge1xuXHRcdFx0XHRjeWFuOiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRcdG1hZ2VudGE6IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdFx0eWVsbG93OiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRcdGtleTogYnJhbmQuYXNQZXJjZW50aWxlKDApXG5cdFx0XHR9O1xufVxuXG5mdW5jdGlvbiBwYXJzZUhleENvbG9yVmFsdWUocmF3SGV4OiBzdHJpbmcgfCBudWxsKTogSGV4Wyd2YWx1ZSddIHtcblx0Y29uc3QgY2FsbGVyID0gJ3BhcnNlSGV4Q29sb3JWYWx1ZSgpJztcblxuXHRpZiAoIXJhd0hleCkge1xuXHRcdGlmIChsb2dNb2RlLndhcm4gJiYgbG9nTW9kZS52ZXJib3NpdHkgPj0gMikge1xuXHRcdFx0bG9nZ2VyLndhcm4oXG5cdFx0XHRcdCdBIEhleCBlbGVtZW50IGNvdWxkIG5vdCBiZSBmb3VuZCB3aGlsZSBwYXJzaW5nIHBhbGV0dGUgZmlsZS4gSW5qZWN0aW5nIGRlZmF1bHQgdmFsdWVzLicsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHtjYWxsZXJ9YFxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnTWlzc2luZyBIZXggZWxlbWVudCBpbiBwYWxldHRlIGZpbGUuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLnN0YWNrVHJhY2UpIGNvbnNvbGUudHJhY2UoJ1N0YWNrIFRyYWNlOicpO1xuXG5cdFx0cmV0dXJuIHsgaGV4OiBicmFuZC5hc0hleFNldCgnIzAwMDAwMCcpIH07XG5cdH1cblxuXHRjb25zdCBtYXRjaCA9IHJhd0hleC5tYXRjaChyZWdleC5oZXgpO1xuXG5cdHJldHVybiBtYXRjaFxuXHRcdD8ge1xuXHRcdFx0XHRoZXg6IGJyYW5kLmFzSGV4U2V0KGAjJHttYXRjaFsxXX1gKVxuXHRcdFx0fVxuXHRcdDoge1xuXHRcdFx0XHRoZXg6IGJyYW5kLmFzSGV4U2V0KCcjMDAwMDAwJylcblx0XHRcdH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlSFNMQ29sb3JWYWx1ZShyYXdIU0w6IHN0cmluZyB8IG51bGwpOiBIU0xbJ3ZhbHVlJ10ge1xuXHRjb25zdCBjYWxsZXIgPSAncGFyc2VIU0xDb2xvclZhbHVlKCknO1xuXG5cdGlmICghcmF3SFNMKSB7XG5cdFx0aWYgKGxvZ01vZGUud2FybiAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSAyKSB7XG5cdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0J0FuIEhTTCBlbGVtZW50IGNvdWxkIG5vdCBiZSBmb3VuZCB3aGlsZSBwYXJzaW5nIHBhbGV0dGUgZmlsZS4gSW5qZWN0aW5nIGRlZmF1bHQgdmFsdWVzLicsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHtjYWxsZXJ9YFxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnTWlzc2luZyBIU0wgZWxlbWVudCBpbiBwYWxldHRlIGZpbGUuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLnN0YWNrVHJhY2UpIGNvbnNvbGUudHJhY2UoJ1N0YWNrIFRyYWNlOicpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwoMCksXG5cdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRsaWdodG5lc3M6IGJyYW5kLmFzUGVyY2VudGlsZSgwKVxuXHRcdH07XG5cdH1cblxuXHRjb25zdCBtYXRjaCA9IHJhd0hTTC5tYXRjaChyZWdleC5oc2wpO1xuXG5cdHJldHVybiBtYXRjaFxuXHRcdD8ge1xuXHRcdFx0XHRodWU6IGJyYW5kLmFzUmFkaWFsKHBhcnNlRmxvYXQobWF0Y2hbMV0pKSxcblx0XHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobWF0Y2hbMl0pKSxcblx0XHRcdFx0bGlnaHRuZXNzOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFszXSkpXG5cdFx0XHR9XG5cdFx0OiB7XG5cdFx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwoMCksXG5cdFx0XHRcdHNhdHVyYXRpb246IGJyYW5kLmFzUGVyY2VudGlsZSgwKSxcblx0XHRcdFx0bGlnaHRuZXNzOiBicmFuZC5hc1BlcmNlbnRpbGUoMClcblx0XHRcdH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlSFNWQ29sb3JWYWx1ZShyYXdIU1Y6IHN0cmluZyB8IG51bGwpOiBIU1ZbJ3ZhbHVlJ10ge1xuXHRjb25zdCBjYWxsZXIgPSAncGFyc2VIU1ZDb2xvclZhbHVlKCknO1xuXG5cdGlmICghcmF3SFNWKSB7XG5cdFx0aWYgKGxvZ01vZGUud2FybiAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSAyKSB7XG5cdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0J0FuIEhTViBlbGVtZW50IGNvdWxkIG5vdCBiZSBmb3VuZCB3aGlsZSBwYXJzaW5nIHBhbGV0dGUgZmlsZS4gSW5qZWN0aW5nIGRlZmF1bHQgdmFsdWVzLicsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHtjYWxsZXJ9YFxuXHRcdFx0KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bG9nZ2VyLmRlYnVnKFxuXHRcdFx0XHQnTWlzc2luZyBIU1YgZWxlbWVudCBpbiBwYWxldHRlIGZpbGUuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH1cblxuXHRcdGlmIChtb2RlLnN0YWNrVHJhY2UpIGNvbnNvbGUudHJhY2UoJ1N0YWNrIFRyYWNlOicpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwoMCksXG5cdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHR2YWx1ZTogYnJhbmQuYXNQZXJjZW50aWxlKDApXG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IG1hdGNoID0gcmF3SFNWLm1hdGNoKHJlZ2V4Lmhzdik7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdGh1ZTogYnJhbmQuYXNSYWRpYWwocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHR2YWx1ZTogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobWF0Y2hbM10pKVxuXHRcdFx0fVxuXHRcdDoge1xuXHRcdFx0XHRodWU6IGJyYW5kLmFzUmFkaWFsKDApLFxuXHRcdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUoMCksXG5cdFx0XHRcdHZhbHVlOiBicmFuZC5hc1BlcmNlbnRpbGUoMClcblx0XHRcdH07XG59XG5cbmZ1bmN0aW9uIHBhcnNlTEFCQ29sb3JWYWx1ZShyYXdMQUI6IHN0cmluZyB8IG51bGwpOiBMQUJbJ3ZhbHVlJ10ge1xuXHRjb25zdCBjYWxsZXIgPSAncGFyc2VMQUJDb2xvclZhbHVlKCknO1xuXG5cdGlmICghcmF3TEFCKSB7XG5cdFx0aWYgKGxvZ01vZGUud2FybiAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+PSAyKSB7XG5cdFx0XHRsb2dnZXIud2Fybihcblx0XHRcdFx0J0EgTEFCIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIExBQiBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0bDogYnJhbmQuYXNMQUJfTCgwKSxcblx0XHRcdGE6IGJyYW5kLmFzTEFCX0EoMCksXG5cdFx0XHRiOiBicmFuZC5hc0xBQl9CKDApXG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IG1hdGNoID0gcmF3TEFCLm1hdGNoKHJlZ2V4LmxhYik7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdGw6IGJyYW5kLmFzTEFCX0wocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHRhOiBicmFuZC5hc0xBQl9BKHBhcnNlRmxvYXQobWF0Y2hbMl0pKSxcblx0XHRcdFx0YjogYnJhbmQuYXNMQUJfQihwYXJzZUZsb2F0KG1hdGNoWzNdKSlcblx0XHRcdH1cblx0XHQ6IHtcblx0XHRcdFx0bDogYnJhbmQuYXNMQUJfTCgwKSxcblx0XHRcdFx0YTogYnJhbmQuYXNMQUJfQSgwKSxcblx0XHRcdFx0YjogYnJhbmQuYXNMQUJfQigwKVxuXHRcdFx0fTtcbn1cblxuZnVuY3Rpb24gcGFyc2VSR0JDb2xvclZhbHVlKHJhd1JHQjogc3RyaW5nIHwgbnVsbCk6IFJHQlsndmFsdWUnXSB7XG5cdGNvbnN0IGNhbGxlciA9ICdwYXJzZVJHQkNvbG9yVmFsdWUoKSc7XG5cblx0aWYgKCFyYXdSR0IpIHtcblx0XHRpZiAobG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDIpIHtcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHQnQW4gUkdCIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIFJHQiBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0cmVkOiBicmFuZC5hc0J5dGVSYW5nZSgwKSxcblx0XHRcdGdyZWVuOiBicmFuZC5hc0J5dGVSYW5nZSgwKSxcblx0XHRcdGJsdWU6IGJyYW5kLmFzQnl0ZVJhbmdlKDApXG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IG1hdGNoID0gcmF3UkdCLm1hdGNoKHJlZ2V4LnJnYik7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdHJlZDogYnJhbmQuYXNCeXRlUmFuZ2UocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHRncmVlbjogYnJhbmQuYXNCeXRlUmFuZ2UocGFyc2VGbG9hdChtYXRjaFsyXSkpLFxuXHRcdFx0XHRibHVlOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KG1hdGNoWzNdKSlcblx0XHRcdH1cblx0XHQ6IHtcblx0XHRcdFx0cmVkOiBicmFuZC5hc0J5dGVSYW5nZSgwKSxcblx0XHRcdFx0Z3JlZW46IGJyYW5kLmFzQnl0ZVJhbmdlKDApLFxuXHRcdFx0XHRibHVlOiBicmFuZC5hc0J5dGVSYW5nZSgwKVxuXHRcdFx0fTtcbn1cblxuZnVuY3Rpb24gcGFyc2VYWVpDb2xvclZhbHVlKHJhd1hZWjogc3RyaW5nIHwgbnVsbCk6IFhZWlsndmFsdWUnXSB7XG5cdGNvbnN0IGNhbGxlciA9ICdwYXJzZVhZWkNvbG9yVmFsdWUoKSc7XG5cblx0aWYgKCFyYXdYWVopIHtcblx0XHRpZiAobG9nTW9kZS53YXJuICYmIGxvZ01vZGUudmVyYm9zaXR5ID49IDIpIHtcblx0XHRcdGxvZ2dlci53YXJuKFxuXHRcdFx0XHQnQW4gWFlaIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kIHdoaWxlIHBhcnNpbmcgcGFsZXR0ZSBmaWxlLiBJbmplY3RpbmcgZGVmYXVsdCB2YWx1ZXMuJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke2NhbGxlcn1gXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRsb2dnZXIuZGVidWcoXG5cdFx0XHRcdCdNaXNzaW5nIFhZWiBlbGVtZW50IGluIHBhbGV0dGUgZmlsZS4nLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7Y2FsbGVyfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKG1vZGUuc3RhY2tUcmFjZSkgY29uc29sZS50cmFjZSgnU3RhY2sgVHJhY2U6Jyk7XG5cblx0XHRyZXR1cm4ge1xuXHRcdFx0eDogYnJhbmQuYXNYWVpfWCgwKSxcblx0XHRcdHk6IGJyYW5kLmFzWFlaX1koMCksXG5cdFx0XHR6OiBicmFuZC5hc1hZWl9aKDApXG5cdFx0fTtcblx0fVxuXG5cdGNvbnN0IG1hdGNoID0gcmF3WFlaLm1hdGNoKHJlZ2V4Lnh5eik7XG5cblx0cmV0dXJuIG1hdGNoXG5cdFx0PyB7XG5cdFx0XHRcdHg6IGJyYW5kLmFzWFlaX1gocGFyc2VGbG9hdChtYXRjaFsxXSkpLFxuXHRcdFx0XHR5OiBicmFuZC5hc1hZWl9ZKHBhcnNlRmxvYXQobWF0Y2hbMl0pKSxcblx0XHRcdFx0ejogYnJhbmQuYXNYWVpfWihwYXJzZUZsb2F0KG1hdGNoWzNdKSlcblx0XHRcdH1cblx0XHQ6IHtcblx0XHRcdFx0eDogYnJhbmQuYXNYWVpfWCgwKSxcblx0XHRcdFx0eTogYnJhbmQuYXNYWVpfWSgwKSxcblx0XHRcdFx0ejogYnJhbmQuYXNYWVpfWigwKVxuXHRcdFx0fTtcbn1cblxuZXhwb3J0IGNvbnN0IGNvbG9yOiBJT0ZuX01hc3RlckludGVyZmFjZVsncGFyc2UnXVsnY29sb3InXSA9IHtcblx0Y215azogcGFyc2VDTVlLQ29sb3JWYWx1ZSxcblx0aGV4OiBwYXJzZUhleENvbG9yVmFsdWUsXG5cdGhzbDogcGFyc2VIU0xDb2xvclZhbHVlLFxuXHRoc3Y6IHBhcnNlSFNWQ29sb3JWYWx1ZSxcblx0bGFiOiBwYXJzZUxBQkNvbG9yVmFsdWUsXG5cdHJnYjogcGFyc2VSR0JDb2xvclZhbHVlLFxuXHR4eXo6IHBhcnNlWFlaQ29sb3JWYWx1ZVxufTtcbiJdfQ==