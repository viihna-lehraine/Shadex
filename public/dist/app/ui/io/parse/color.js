// File: app/ui/io/parse/color.js
import { commonFn } from '../../../../common/index.js';
import { configData as config } from '../../../../data/config.js';
const brand = commonFn.core.brand;
const regex = config.regex;
const colorParsers = {};
const cmykParser = {
    parse(input) {
        const match = input.match(regex.colors.cmyk);
        if (!match) {
            throw new Error(`Invalid CMYK string format: ${input}`);
        }
        const [_, cyan, magenta, yellow, key = '1'] = match;
        const value = {
            cyan: brand.asPercentile(parseFloat(cyan) / 100),
            magenta: brand.asPercentile(parseFloat(magenta) / 100),
            yellow: brand.asPercentile(parseFloat(yellow) / 100),
            key: brand.asPercentile(parseFloat(key) / 100)
        };
        return { format: 'cmyk', value };
    }
};
const hexParser = {
    parse(input) {
        const match = input.match(regex.colors.hex);
        if (!match) {
            throw new Error(`Invalid Hex string format: ${input}`);
        }
        const hex = brand.asHexSet(match[1].substring(0, 6));
        return {
            format: 'hex',
            value: { hex }
        };
    }
};
const hslParser = {
    parse(input) {
        const match = input.match(regex.colors.hsl);
        if (!match) {
            throw new Error(`Invalid HSL string format: ${input}`);
        }
        const [_, hue, saturation, lightness] = match;
        const value = {
            hue: brand.asRadial(parseFloat(hue)),
            saturation: brand.asPercentile(parseFloat(saturation) / 100),
            lightness: brand.asPercentile(parseFloat(lightness) / 100)
        };
        return { format: 'hsl', value };
    }
};
const hsvParser = {
    parse(input) {
        const match = input.match(regex.colors.hsv);
        if (!match) {
            throw new Error(`Invalid HSV string format: ${input}`);
        }
        const [_, hue, saturation, value] = match;
        const hsvValue = {
            hue: brand.asRadial(parseFloat(hue)),
            saturation: brand.asPercentile(parseFloat(saturation) / 100),
            value: brand.asPercentile(parseFloat(value) / 100)
        };
        return { format: 'hsv', value: hsvValue };
    }
};
const labParser = {
    parse(input) {
        const match = input.match(regex.colors.lab);
        if (!match) {
            throw new Error(`Invalid LAB string format: ${input}`);
        }
        const [_, l, a, b] = match;
        const labValue = {
            l: brand.asLAB_L(parseFloat(l)),
            a: brand.asLAB_A(parseFloat(a)),
            b: brand.asLAB_B(parseFloat(b))
        };
        return { format: 'lab', value: labValue };
    }
};
const rgbParser = {
    parse(input) {
        const match = input.match(regex.colors.rgb);
        if (!match) {
            throw new Error(`Invalid RGB string format: ${input}`);
        }
        const [_, red, green, blue] = match;
        const rgbValue = {
            red: brand.asByteRange(parseFloat(red)),
            green: brand.asByteRange(parseFloat(green)),
            blue: brand.asByteRange(parseFloat(blue))
        };
        return { format: 'rgb', value: rgbValue };
    }
};
const xyzParser = {
    parse(input) {
        const match = input.match(regex.colors.xyz);
        if (!match) {
            throw new Error(`Invalid XYZ string format: ${input}`);
        }
        const [_, x, y, z] = match;
        const xyzValue = {
            x: brand.asXYZ_X(parseFloat(x)),
            y: brand.asXYZ_Y(parseFloat(y)),
            z: brand.asXYZ_Z(parseFloat(z))
        };
        return { format: 'xyz', value: xyzValue };
    }
};
colorParsers['cmyk'] = cmykParser;
colorParsers['hex'] = hexParser;
colorParsers['hsl'] = hslParser;
colorParsers['hsv'] = hsvParser;
colorParsers['lab'] = labParser;
colorParsers['rgb'] = rgbParser;
colorParsers['xyz'] = xyzParser;
export function asColorString(format, input) {
    const parser = colorParsers[format.toLowerCase()];
    if (!parser) {
        throw new Error(`No parser available for format: ${format}`);
    }
    return parser.parse(input);
}
// ******** CSS COLOR STRINGS ********
export function asCSSColorString(format, input) {
    const color = asColorString(format, input);
    switch (color.format) {
        case 'cmyk':
            const cmyk = color.value;
            return `cmyk(${cmyk.cyan * 100}%, ${cmyk.magenta * 100}%, ${cmyk.yellow * 100}%, ${cmyk.key * 100}`;
        case 'hex':
            const hex = color.value;
            return `#${hex.hex}}`;
        case 'hsl':
            const hsl = color.value;
            return `hsl(${hsl.hue}, ${hsl.saturation * 100}%, ${hsl.lightness * 100}%})`;
        case 'hsv':
            const hsv = color.value;
            return `hsv(${hsv.hue}, ${hsv.saturation * 100}%, ${hsv.value * 100}%})`;
        case 'lab':
            const lab = color.value;
            return `lab(${lab.l}, ${lab.a}, ${lab.b}})`;
        case 'rgb':
            const rgb = color.value;
            return `rgb(${rgb.red}, ${rgb.green}, ${rgb.blue})`;
        case 'xyz':
            const xyz = color.value;
            return `xyz(${xyz.x}, ${xyz.y}, ${xyz.z})`;
        default:
            throw new Error(`Unsupported color format: ${color.format}`);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvYXBwL3VpL2lvL3BhcnNlL2NvbG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLGlDQUFpQztBQWFqQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sNkJBQTZCLENBQUM7QUFDdkQsT0FBTyxFQUFFLFVBQVUsSUFBSSxNQUFNLEVBQUUsTUFBTSw0QkFBNEIsQ0FBQztBQUVsRSxNQUFNLEtBQUssR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUNsQyxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBRTNCLE1BQU0sWUFBWSxHQUFnQyxFQUFFLENBQUM7QUFFckQsTUFBTSxVQUFVLEdBQWdCO0lBQy9CLEtBQUssQ0FBQyxLQUFhO1FBQ2xCLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU3QyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7WUFDWixNQUFNLElBQUksS0FBSyxDQUFDLCtCQUErQixLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ3pELENBQUM7UUFFRCxNQUFNLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLEdBQUcsR0FBRyxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7UUFFcEQsTUFBTSxLQUFLLEdBQWtCO1lBQzVCLElBQUksRUFBRSxLQUFLLENBQUMsWUFBWSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDaEQsT0FBTyxFQUFFLEtBQUssQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUN0RCxNQUFNLEVBQUUsS0FBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxDQUFD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QUFHLEtBQUssQ0FBQyxLQUFxQixDQUFDO1lBQ3hDLE9BQU8sT0FBTyxHQUFHLENBQUMsR0FBRyxLQUFLLEdBQUcsQ0FBQyxVQUFVLEdBQUcsR0FBRyxNQUFNLEdBQUcsQ0FBQyxTQUFTLEdBQUcsR0FBRyxLQUFLLENBQUM7UUFFOUUsS0FBSyxLQUFLO1lBQ1QsTUFBTSxHQUFHLEdBQUcsS0FBSyxDQUFDLEtBQXFCLENBQUM7WUFDeEMsT0FBTyxPQUFPLEdBQUcsQ0FBQyxHQUFHLEtBQUssR0FBRyxDQUFDLFVBQVUsR0FBRyxHQUFHLE1BQU0sR0FBRyxDQUFDLEtBQUssR0FBRyxHQUFHLEtBQUssQ0FBQztRQUUxRSxLQUFLLEtBQUs7WUFDVCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsS0FBcUIsQ0FBQztZQUN4QyxPQUFPLE9BQU8sR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztRQUU3QyxLQUFLLEtBQUs7WUFDVCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsS0FBcUIsQ0FBQztZQUN4QyxPQUFPLE9BQU8sR0FBRyxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsS0FBSyxLQUFLLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQztRQUVyRCxLQUFLLEtBQUs7WUFDVCxNQUFNLEdBQUcsR0FBRyxLQUFLLENBQUMsS0FBcUIsQ0FBQztZQUN4QyxPQUFPLE9BQU8sR0FBRyxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztRQUU1QztZQUNDLE1BQU0sSUFBSSxLQUFLLENBQUMsNkJBQTZCLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7QUFDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogYXBwL3VpL2lvL3BhcnNlL2NvbG9yLmpzXG5cbmltcG9ydCB7XG5cdENNWUssXG5cdENvbG9yLFxuXHRDb2xvclBhcnNlcixcblx0SGV4LFxuXHRIU0wsXG5cdEhTVixcblx0TEFCLFxuXHRSR0IsXG5cdFhZWlxufSBmcm9tICcuLi8uLi8uLi8uLi90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBjb21tb25GbiB9IGZyb20gJy4uLy4uLy4uLy4uL2NvbW1vbi9pbmRleC5qcyc7XG5pbXBvcnQgeyBjb25maWdEYXRhIGFzIGNvbmZpZyB9IGZyb20gJy4uLy4uLy4uLy4uL2RhdGEvY29uZmlnLmpzJztcblxuY29uc3QgYnJhbmQgPSBjb21tb25Gbi5jb3JlLmJyYW5kO1xuY29uc3QgcmVnZXggPSBjb25maWcucmVnZXg7XG5cbmNvbnN0IGNvbG9yUGFyc2VyczogUmVjb3JkPHN0cmluZywgQ29sb3JQYXJzZXI+ID0ge307XG5cbmNvbnN0IGNteWtQYXJzZXI6IENvbG9yUGFyc2VyID0ge1xuXHRwYXJzZShpbnB1dDogc3RyaW5nKTogQ01ZSyB7XG5cdFx0Y29uc3QgbWF0Y2ggPSBpbnB1dC5tYXRjaChyZWdleC5jb2xvcnMuY215ayk7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgQ01ZSyBzdHJpbmcgZm9ybWF0OiAke2lucHV0fWApO1xuXHRcdH1cblxuXHRcdGNvbnN0IFtfLCBjeWFuLCBtYWdlbnRhLCB5ZWxsb3csIGtleSA9ICcxJ10gPSBtYXRjaDtcblxuXHRcdGNvbnN0IHZhbHVlOiBDTVlLWyd2YWx1ZSddID0ge1xuXHRcdFx0Y3lhbjogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQoY3lhbikgLyAxMDApLFxuXHRcdFx0bWFnZW50YTogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQobWFnZW50YSkgLyAxMDApLFxuXHRcdFx0eWVsbG93OiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdCh5ZWxsb3cpIC8gMTAwKSxcblx0XHRcdGtleTogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQoa2V5KSAvIDEwMClcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHsgZm9ybWF0OiAnY215aycsIHZhbHVlIH07XG5cdH1cbn07XG5cbmNvbnN0IGhleFBhcnNlcjogQ29sb3JQYXJzZXIgPSB7XG5cdHBhcnNlKGlucHV0OiBzdHJpbmcpOiBIZXgge1xuXHRcdGNvbnN0IG1hdGNoID0gaW5wdXQubWF0Y2gocmVnZXguY29sb3JzLmhleCk7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgSGV4IHN0cmluZyBmb3JtYXQ6ICR7aW5wdXR9YCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgaGV4ID0gYnJhbmQuYXNIZXhTZXQobWF0Y2hbMV0uc3Vic3RyaW5nKDAsIDYpKTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRmb3JtYXQ6ICdoZXgnLFxuXHRcdFx0dmFsdWU6IHsgaGV4IH1cblx0XHR9O1xuXHR9XG59O1xuXG5jb25zdCBoc2xQYXJzZXI6IENvbG9yUGFyc2VyID0ge1xuXHRwYXJzZShpbnB1dDogc3RyaW5nKTogSFNMIHtcblx0XHRjb25zdCBtYXRjaCA9IGlucHV0Lm1hdGNoKHJlZ2V4LmNvbG9ycy5oc2wpO1xuXG5cdFx0aWYgKCFtYXRjaCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIEhTTCBzdHJpbmcgZm9ybWF0OiAke2lucHV0fWApO1xuXHRcdH1cblxuXHRcdGNvbnN0IFtfLCBodWUsIHNhdHVyYXRpb24sIGxpZ2h0bmVzc10gPSBtYXRjaDtcblxuXHRcdGNvbnN0IHZhbHVlOiBIU0xbJ3ZhbHVlJ10gPSB7XG5cdFx0XHRodWU6IGJyYW5kLmFzUmFkaWFsKHBhcnNlRmxvYXQoaHVlKSksXG5cdFx0XHRzYXR1cmF0aW9uOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChzYXR1cmF0aW9uKSAvIDEwMCksXG5cdFx0XHRsaWdodG5lc3M6IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KGxpZ2h0bmVzcykgLyAxMDApXG5cdFx0fTtcblxuXHRcdHJldHVybiB7IGZvcm1hdDogJ2hzbCcsIHZhbHVlIH07XG5cdH1cbn07XG5cbmNvbnN0IGhzdlBhcnNlcjogQ29sb3JQYXJzZXIgPSB7XG5cdHBhcnNlKGlucHV0OiBzdHJpbmcpOiBIU1Yge1xuXHRcdGNvbnN0IG1hdGNoID0gaW5wdXQubWF0Y2gocmVnZXguY29sb3JzLmhzdik7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgSFNWIHN0cmluZyBmb3JtYXQ6ICR7aW5wdXR9YCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgW18sIGh1ZSwgc2F0dXJhdGlvbiwgdmFsdWVdID0gbWF0Y2g7XG5cblx0XHRjb25zdCBoc3ZWYWx1ZTogSFNWWyd2YWx1ZSddID0ge1xuXHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbChwYXJzZUZsb2F0KGh1ZSkpLFxuXHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQoc2F0dXJhdGlvbikgLyAxMDApLFxuXHRcdFx0dmFsdWU6IGJyYW5kLmFzUGVyY2VudGlsZShwYXJzZUZsb2F0KHZhbHVlKSAvIDEwMClcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHsgZm9ybWF0OiAnaHN2JywgdmFsdWU6IGhzdlZhbHVlIH07XG5cdH1cbn07XG5cbmNvbnN0IGxhYlBhcnNlcjogQ29sb3JQYXJzZXIgPSB7XG5cdHBhcnNlKGlucHV0OiBzdHJpbmcpOiBMQUIge1xuXHRcdGNvbnN0IG1hdGNoID0gaW5wdXQubWF0Y2gocmVnZXguY29sb3JzLmxhYik7XG5cblx0XHRpZiAoIW1hdGNoKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgTEFCIHN0cmluZyBmb3JtYXQ6ICR7aW5wdXR9YCk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgW18sIGwsIGEsIGJdID0gbWF0Y2g7XG5cblx0XHRjb25zdCBsYWJWYWx1ZTogTEFCWyd2YWx1ZSddID0ge1xuXHRcdFx0bDogYnJhbmQuYXNMQUJfTChwYXJzZUZsb2F0KGwpKSxcblx0XHRcdGE6IGJyYW5kLmFzTEFCX0EocGFyc2VGbG9hdChhKSksXG5cdFx0XHRiOiBicmFuZC5hc0xBQl9CKHBhcnNlRmxvYXQoYikpXG5cdFx0fTtcblxuXHRcdHJldHVybiB7IGZvcm1hdDogJ2xhYicsIHZhbHVlOiBsYWJWYWx1ZSB9O1xuXHR9XG59O1xuXG5jb25zdCByZ2JQYXJzZXI6IENvbG9yUGFyc2VyID0ge1xuXHRwYXJzZShpbnB1dDogc3RyaW5nKTogUkdCIHtcblx0XHRjb25zdCBtYXRjaCA9IGlucHV0Lm1hdGNoKHJlZ2V4LmNvbG9ycy5yZ2IpO1xuXG5cdFx0aWYgKCFtYXRjaCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIFJHQiBzdHJpbmcgZm9ybWF0OiAke2lucHV0fWApO1xuXHRcdH1cblxuXHRcdGNvbnN0IFtfLCByZWQsIGdyZWVuLCBibHVlXSA9IG1hdGNoO1xuXG5cdFx0Y29uc3QgcmdiVmFsdWU6IFJHQlsndmFsdWUnXSA9IHtcblx0XHRcdHJlZDogYnJhbmQuYXNCeXRlUmFuZ2UocGFyc2VGbG9hdChyZWQpKSxcblx0XHRcdGdyZWVuOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KGdyZWVuKSksXG5cdFx0XHRibHVlOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUZsb2F0KGJsdWUpKVxuXHRcdH07XG5cblx0XHRyZXR1cm4geyBmb3JtYXQ6ICdyZ2InLCB2YWx1ZTogcmdiVmFsdWUgfTtcblx0fVxufTtcblxuY29uc3QgeHl6UGFyc2VyOiBDb2xvclBhcnNlciA9IHtcblx0cGFyc2UoaW5wdXQ6IHN0cmluZyk6IFhZWiB7XG5cdFx0Y29uc3QgbWF0Y2ggPSBpbnB1dC5tYXRjaChyZWdleC5jb2xvcnMueHl6KTtcblxuXHRcdGlmICghbWF0Y2gpIHtcblx0XHRcdHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBYWVogc3RyaW5nIGZvcm1hdDogJHtpbnB1dH1gKTtcblx0XHR9XG5cblx0XHRjb25zdCBbXywgeCwgeSwgel0gPSBtYXRjaDtcblxuXHRcdGNvbnN0IHh5elZhbHVlOiBYWVpbJ3ZhbHVlJ10gPSB7XG5cdFx0XHR4OiBicmFuZC5hc1hZWl9YKHBhcnNlRmxvYXQoeCkpLFxuXHRcdFx0eTogYnJhbmQuYXNYWVpfWShwYXJzZUZsb2F0KHkpKSxcblx0XHRcdHo6IGJyYW5kLmFzWFlaX1oocGFyc2VGbG9hdCh6KSlcblx0XHR9O1xuXG5cdFx0cmV0dXJuIHsgZm9ybWF0OiAneHl6JywgdmFsdWU6IHh5elZhbHVlIH07XG5cdH1cbn07XG5cbmNvbG9yUGFyc2Vyc1snY215ayddID0gY215a1BhcnNlcjtcbmNvbG9yUGFyc2Vyc1snaGV4J10gPSBoZXhQYXJzZXI7XG5jb2xvclBhcnNlcnNbJ2hzbCddID0gaHNsUGFyc2VyO1xuY29sb3JQYXJzZXJzWydoc3YnXSA9IGhzdlBhcnNlcjtcbmNvbG9yUGFyc2Vyc1snbGFiJ10gPSBsYWJQYXJzZXI7XG5jb2xvclBhcnNlcnNbJ3JnYiddID0gcmdiUGFyc2VyO1xuY29sb3JQYXJzZXJzWyd4eXonXSA9IHh5elBhcnNlcjtcblxuZXhwb3J0IGZ1bmN0aW9uIGFzQ29sb3JTdHJpbmcoZm9ybWF0OiBzdHJpbmcsIGlucHV0OiBzdHJpbmcpOiBDb2xvciB7XG5cdGNvbnN0IHBhcnNlciA9IGNvbG9yUGFyc2Vyc1tmb3JtYXQudG9Mb3dlckNhc2UoKV07XG5cblx0aWYgKCFwYXJzZXIpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYE5vIHBhcnNlciBhdmFpbGFibGUgZm9yIGZvcm1hdDogJHtmb3JtYXR9YCk7XG5cdH1cblxuXHRyZXR1cm4gcGFyc2VyLnBhcnNlKGlucHV0KTtcbn1cblxuLy8gKioqKioqKiogQ1NTIENPTE9SIFNUUklOR1MgKioqKioqKipcblxuZXhwb3J0IGZ1bmN0aW9uIGFzQ1NTQ29sb3JTdHJpbmcoZm9ybWF0OiBzdHJpbmcsIGlucHV0OiBzdHJpbmcpOiBzdHJpbmcge1xuXHRjb25zdCBjb2xvciA9IGFzQ29sb3JTdHJpbmcoZm9ybWF0LCBpbnB1dCk7XG5cblx0c3dpdGNoIChjb2xvci5mb3JtYXQpIHtcblx0XHRjYXNlICdjbXlrJzpcblx0XHRcdGNvbnN0IGNteWsgPSBjb2xvci52YWx1ZSBhcyBDTVlLWyd2YWx1ZSddO1xuXHRcdFx0cmV0dXJuIGBjbXlrKCR7Y215ay5jeWFuICogMTAwfSUsICR7Y215ay5tYWdlbnRhICogMTAwfSUsICR7Y215ay55ZWxsb3cgKiAxMDB9JSwgJHtjbXlrLmtleSAqIDEwMH1gO1xuXG5cdFx0Y2FzZSAnaGV4Jzpcblx0XHRcdGNvbnN0IGhleCA9IGNvbG9yLnZhbHVlIGFzIEhleFsndmFsdWUnXTtcblx0XHRcdHJldHVybiBgIyR7aGV4LmhleH19YDtcblxuXHRcdGNhc2UgJ2hzbCc6XG5cdFx0XHRjb25zdCBoc2wgPSBjb2xvci52YWx1ZSBhcyBIU0xbJ3ZhbHVlJ107XG5cdFx0XHRyZXR1cm4gYGhzbCgke2hzbC5odWV9LCAke2hzbC5zYXR1cmF0aW9uICogMTAwfSUsICR7aHNsLmxpZ2h0bmVzcyAqIDEwMH0lfSlgO1xuXG5cdFx0Y2FzZSAnaHN2Jzpcblx0XHRcdGNvbnN0IGhzdiA9IGNvbG9yLnZhbHVlIGFzIEhTVlsndmFsdWUnXTtcblx0XHRcdHJldHVybiBgaHN2KCR7aHN2Lmh1ZX0sICR7aHN2LnNhdHVyYXRpb24gKiAxMDB9JSwgJHtoc3YudmFsdWUgKiAxMDB9JX0pYDtcblxuXHRcdGNhc2UgJ2xhYic6XG5cdFx0XHRjb25zdCBsYWIgPSBjb2xvci52YWx1ZSBhcyBMQUJbJ3ZhbHVlJ107XG5cdFx0XHRyZXR1cm4gYGxhYigke2xhYi5sfSwgJHtsYWIuYX0sICR7bGFiLmJ9fSlgO1xuXG5cdFx0Y2FzZSAncmdiJzpcblx0XHRcdGNvbnN0IHJnYiA9IGNvbG9yLnZhbHVlIGFzIFJHQlsndmFsdWUnXTtcblx0XHRcdHJldHVybiBgcmdiKCR7cmdiLnJlZH0sICR7cmdiLmdyZWVufSwgJHtyZ2IuYmx1ZX0pYDtcblxuXHRcdGNhc2UgJ3h5eic6XG5cdFx0XHRjb25zdCB4eXogPSBjb2xvci52YWx1ZSBhcyBYWVpbJ3ZhbHVlJ107XG5cdFx0XHRyZXR1cm4gYHh5eigke3h5ei54fSwgJHt4eXoueX0sICR7eHl6Lnp9KWA7XG5cblx0XHRkZWZhdWx0OlxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGBVbnN1cHBvcnRlZCBjb2xvciBmb3JtYXQ6ICR7Y29sb3IuZm9ybWF0fWApO1xuXHR9XG59XG4iXX0=