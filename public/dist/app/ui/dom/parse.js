// File: app/ui/dom/parse.js
import { createLogger } from '../../../logger/index.js';
import { commonFn } from '../../../common/index.js';
import { configData as config } from '../../../data/config.js';
import { domData } from '../../../data/dom.js';
import { modeData as mode } from '../../../data/mode.js';
const ids = domData.ids.static;
const logMode = mode.logging;
const regex = config.regex.dom;
const thisModule = 'dom/parse.js';
const brand = commonFn.core.brand;
const logger = await createLogger();
function checkbox(id) {
    const thisFunction = 'checkbox()';
    const checkbox = document.getElementById(id);
    if (!checkbox) {
        if (logMode.error && logMode.verbosity > 2) {
            logger.error(`Checkbox element ${id} not found`, `${thisModule} > ${thisFunction}`);
        }
        return;
    }
    if (!(checkbox instanceof HTMLInputElement)) {
        if (logMode.error && logMode.verbosity > 2) {
            logger.error(`Element ${id} is not a checkbox`, `${thisModule} > ${thisFunction}`);
        }
        return;
    }
    return checkbox ? checkbox.checked : undefined;
}
function colorInput(input) {
    const thisFunction = 'colorInput()';
    const colorStr = input.value.trim().toLowerCase();
    const hexMatch = colorStr.match(regex.hex);
    const hslMatch = colorStr.match(regex.hsl);
    const rgbMatch = colorStr.match(regex.rgb);
    if (hexMatch) {
        let hex = hexMatch[1];
        if (hex.length === 3) {
            hex = hex
                .split('')
                .map(c => c + c)
                .join('');
        }
        return {
            format: 'hex',
            value: { hex: brand.asHexSet(`#${hex}`) }
        };
    }
    if (hslMatch) {
        return {
            format: 'hsl',
            value: {
                hue: brand.asRadial(parseInt(hslMatch[1], 10)),
                saturation: brand.asPercentile(parseFloat(hslMatch[2])),
                lightness: brand.asPercentile(parseFloat(hslMatch[3]))
            }
        };
    }
    if (rgbMatch) {
        return {
            format: 'rgb',
            value: {
                red: brand.asByteRange(parseInt(rgbMatch[1], 10)),
                green: brand.asByteRange(parseInt(rgbMatch[2], 10)),
                blue: brand.asByteRange(parseInt(rgbMatch[3], 10))
            }
        };
    }
    // for Named Colors (convert to RGB using CSS canvas)
    const testElement = document.createElement('div');
    testElement.style.color = colorStr;
    if (testElement.style.color !== '') {
        const ctx = document.createElement('canvas').getContext('2d');
        if (ctx) {
            ctx.fillStyle = colorStr;
            const rgb = ctx.fillStyle.match(/\d+/g)?.map(Number);
            if (rgb && rgb.length === 3) {
                return {
                    format: 'rgb',
                    value: {
                        red: brand.asByteRange(rgb[0]),
                        green: brand.asByteRange(rgb[1]),
                        blue: brand.asByteRange(rgb[2])
                    }
                };
            }
        }
    }
    if (logMode.error && logMode.verbosity > 3) {
        logger.error('Invalid color input', `${thisModule} > ${thisFunction}`);
    }
    return null;
}
function paletteExportFormat() {
    const thisFunction = 'paletteExportFormat()';
    const formatSelectionMenu = document.getElementById(ids.selects.exportFormatOption);
    if (!formatSelectionMenu) {
        if (logMode.error && logMode.verbosity > 3)
            logger.error('Export format selection dropdown not found', `${thisModule} > ${thisFunction}`);
    }
    const selectedFormat = formatSelectionMenu.value;
    if (selectedFormat !== 'CSS' &&
        selectedFormat !== 'JSON' &&
        selectedFormat !== 'XML') {
        if (logMode.error && logMode.verbosity > 3)
            logger.error('Invalid export format selected', `${thisModule} > ${thisFunction}`);
        return;
    }
    else {
        return selectedFormat;
    }
}
export const parse = {
    checkbox,
    colorInput,
    paletteExportFormat
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvYXBwL3VpL2RvbS9wYXJzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw0QkFBNEI7QUFHNUIsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsVUFBVSxJQUFJLE1BQU0sRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQy9ELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUMvQyxPQUFPLEVBQUUsUUFBUSxJQUFJLElBQUksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRXpELE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO0FBQy9CLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7QUFDN0IsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7QUFFL0IsTUFBTSxVQUFVLEdBQUcsY0FBYyxDQUFDO0FBRWxDLE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO0FBRWxDLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxFQUFFLENBQUM7QUFFcEMsU0FBUyxRQUFRLENBQUMsRUFBVTtJQUMzQixNQUFNLFlBQVksR0FBRyxZQUFZLENBQUM7SUFDbEMsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQXFCLENBQUM7SUFFakUsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2YsSUFBSSxPQUFPLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEdBQUcsQ0FBQyxFQUFFLENBQUM7WUFDNUMsTUFBTSxDQUFDLEtBQUssQ0FDWCxvQkFBb0IsRUFBRSxZQUFZLEVBQ2xDLEdBQUcs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QUFFRCxTQUFTLG1CQUFtQjtJQUMzQixNQUFNLFlBQVksR0FBRyx1QkFBdUIsQ0FBQztJQUM3QyxNQUFNLG1CQUFtQixHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQ2xELEdBQUcsQ0FBQyxPQUFPLENBQUMsa0JBQWtCLENBQ1QsQ0FBQztJQUV2QixJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUMxQixJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFNBQVMsR0FBRyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxLQUFLLENBQ1gsNENBQTRDLEVBQzVDLEdBQUcsVUFBVSxNQUFNLFlBQVksRUFBRSxDQUNqQyxDQUFDO0lBQ0osQ0FBQztJQUVELE1BQU0sY0FBYyxHQUFHLG1CQUFtQixDQUFDLEtBQUssQ0FBQztJQUVqRCxJQUNDLGNBQWMsS0FBSyxLQUFLO1FBQ3hCLGNBQWMsS0FBSyxNQUFNO1FBQ3pCLGNBQWMsS0FBSyxLQUFLLEVBQ3ZCLENBQUM7UUFDRixJQUFJLE9BQU8sQ0FBQyxLQUFLLElBQUksT0FBTyxDQUFDLFNBQVMsR0FBRyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxLQUFLLENBQ1gsZ0NBQWdDLEVBQ2hDLEdBQUcsVUFBVSxNQUFNLFlBQVksRUFBRSxDQUNqQyxDQUFDO1FBRUgsT0FBTztJQUNSLENBQUM7U0FBTSxDQUFDO1FBQ1AsT0FBTyxjQUFjLENBQUM7SUFDdkIsQ0FBQztBQUNGLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxLQUFLLEdBQW1DO0lBQ3BELFFBQVE7SUFDUixVQUFVO0lBQ1YsbUJBQW1CO0NBQ25CLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBhcHAvdWkvZG9tL3BhcnNlLmpzXG5cbmltcG9ydCB7IERPTUZuX01hc3RlckludGVyZmFjZSwgSGV4LCBIU0wsIFJHQiB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGNyZWF0ZUxvZ2dlciB9IGZyb20gJy4uLy4uLy4uL2xvZ2dlci9pbmRleC5qcyc7XG5pbXBvcnQgeyBjb21tb25GbiB9IGZyb20gJy4uLy4uLy4uL2NvbW1vbi9pbmRleC5qcyc7XG5pbXBvcnQgeyBjb25maWdEYXRhIGFzIGNvbmZpZyB9IGZyb20gJy4uLy4uLy4uL2RhdGEvY29uZmlnLmpzJztcbmltcG9ydCB7IGRvbURhdGEgfSBmcm9tICcuLi8uLi8uLi9kYXRhL2RvbS5qcyc7XG5pbXBvcnQgeyBtb2RlRGF0YSBhcyBtb2RlIH0gZnJvbSAnLi4vLi4vLi4vZGF0YS9tb2RlLmpzJztcblxuY29uc3QgaWRzID0gZG9tRGF0YS5pZHMuc3RhdGljO1xuY29uc3QgbG9nTW9kZSA9IG1vZGUubG9nZ2luZztcbmNvbnN0IHJlZ2V4ID0gY29uZmlnLnJlZ2V4LmRvbTtcblxuY29uc3QgdGhpc01vZHVsZSA9ICdkb20vcGFyc2UuanMnO1xuXG5jb25zdCBicmFuZCA9IGNvbW1vbkZuLmNvcmUuYnJhbmQ7XG5cbmNvbnN0IGxvZ2dlciA9IGF3YWl0IGNyZWF0ZUxvZ2dlcigpO1xuXG5mdW5jdGlvbiBjaGVja2JveChpZDogc3RyaW5nKTogYm9vbGVhbiB8IHZvaWQge1xuXHRjb25zdCB0aGlzRnVuY3Rpb24gPSAnY2hlY2tib3goKSc7XG5cdGNvbnN0IGNoZWNrYm94ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG5cblx0aWYgKCFjaGVja2JveCkge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMikge1xuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgQ2hlY2tib3ggZWxlbWVudCAke2lkfSBub3QgZm91bmRgLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc0Z1bmN0aW9ufWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0aWYgKCEoY2hlY2tib3ggaW5zdGFuY2VvZiBIVE1MSW5wdXRFbGVtZW50KSkge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMikge1xuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRWxlbWVudCAke2lkfSBpcyBub3QgYSBjaGVja2JveGAsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzRnVuY3Rpb259YFxuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXR1cm47XG5cdH1cblxuXHRyZXR1cm4gY2hlY2tib3ggPyBjaGVja2JveC5jaGVja2VkIDogdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBjb2xvcklucHV0KGlucHV0OiBIVE1MSW5wdXRFbGVtZW50KTogSGV4IHwgSFNMIHwgUkdCIHwgbnVsbCB7XG5cdGNvbnN0IHRoaXNGdW5jdGlvbiA9ICdjb2xvcklucHV0KCknO1xuXG5cdGNvbnN0IGNvbG9yU3RyID0gaW5wdXQudmFsdWUudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG5cblx0Y29uc3QgaGV4TWF0Y2ggPSBjb2xvclN0ci5tYXRjaChyZWdleC5oZXgpO1xuXHRjb25zdCBoc2xNYXRjaCA9IGNvbG9yU3RyLm1hdGNoKHJlZ2V4LmhzbCk7XG5cdGNvbnN0IHJnYk1hdGNoID0gY29sb3JTdHIubWF0Y2gocmVnZXgucmdiKTtcblxuXHRpZiAoaGV4TWF0Y2gpIHtcblx0XHRsZXQgaGV4ID0gaGV4TWF0Y2hbMV07XG5cdFx0aWYgKGhleC5sZW5ndGggPT09IDMpIHtcblx0XHRcdGhleCA9IGhleFxuXHRcdFx0XHQuc3BsaXQoJycpXG5cdFx0XHRcdC5tYXAoYyA9PiBjICsgYylcblx0XHRcdFx0LmpvaW4oJycpO1xuXHRcdH1cblx0XHRyZXR1cm4ge1xuXHRcdFx0Zm9ybWF0OiAnaGV4Jyxcblx0XHRcdHZhbHVlOiB7IGhleDogYnJhbmQuYXNIZXhTZXQoYCMke2hleH1gKSB9XG5cdFx0fTtcblx0fVxuXG5cdGlmIChoc2xNYXRjaCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRmb3JtYXQ6ICdoc2wnLFxuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0aHVlOiBicmFuZC5hc1JhZGlhbChwYXJzZUludChoc2xNYXRjaFsxXSwgMTApKSxcblx0XHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKHBhcnNlRmxvYXQoaHNsTWF0Y2hbMl0pKSxcblx0XHRcdFx0bGlnaHRuZXNzOiBicmFuZC5hc1BlcmNlbnRpbGUocGFyc2VGbG9hdChoc2xNYXRjaFszXSkpXG5cdFx0XHR9XG5cdFx0fTtcblx0fVxuXG5cdGlmIChyZ2JNYXRjaCkge1xuXHRcdHJldHVybiB7XG5cdFx0XHRmb3JtYXQ6ICdyZ2InLFxuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0cmVkOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUludChyZ2JNYXRjaFsxXSwgMTApKSxcblx0XHRcdFx0Z3JlZW46IGJyYW5kLmFzQnl0ZVJhbmdlKHBhcnNlSW50KHJnYk1hdGNoWzJdLCAxMCkpLFxuXHRcdFx0XHRibHVlOiBicmFuZC5hc0J5dGVSYW5nZShwYXJzZUludChyZ2JNYXRjaFszXSwgMTApKVxuXHRcdFx0fVxuXHRcdH07XG5cdH1cblxuXHQvLyBmb3IgTmFtZWQgQ29sb3JzIChjb252ZXJ0IHRvIFJHQiB1c2luZyBDU1MgY2FudmFzKVxuXHRjb25zdCB0ZXN0RWxlbWVudCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG5cdHRlc3RFbGVtZW50LnN0eWxlLmNvbG9yID0gY29sb3JTdHI7XG5cblx0aWYgKHRlc3RFbGVtZW50LnN0eWxlLmNvbG9yICE9PSAnJykge1xuXHRcdGNvbnN0IGN0eCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLmdldENvbnRleHQoJzJkJyk7XG5cblx0XHRpZiAoY3R4KSB7XG5cdFx0XHRjdHguZmlsbFN0eWxlID0gY29sb3JTdHI7XG5cblx0XHRcdGNvbnN0IHJnYiA9IGN0eC5maWxsU3R5bGUubWF0Y2goL1xcZCsvZyk/Lm1hcChOdW1iZXIpO1xuXG5cdFx0XHRpZiAocmdiICYmIHJnYi5sZW5ndGggPT09IDMpIHtcblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHRmb3JtYXQ6ICdyZ2InLFxuXHRcdFx0XHRcdHZhbHVlOiB7XG5cdFx0XHRcdFx0XHRyZWQ6IGJyYW5kLmFzQnl0ZVJhbmdlKHJnYlswXSksXG5cdFx0XHRcdFx0XHRncmVlbjogYnJhbmQuYXNCeXRlUmFuZ2UocmdiWzFdKSxcblx0XHRcdFx0XHRcdGJsdWU6IGJyYW5kLmFzQnl0ZVJhbmdlKHJnYlsyXSlcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH07XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0aWYgKGxvZ01vZGUuZXJyb3IgJiYgbG9nTW9kZS52ZXJib3NpdHkgPiAzKSB7XG5cdFx0bG9nZ2VyLmVycm9yKCdJbnZhbGlkIGNvbG9yIGlucHV0JywgYCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gKTtcblx0fVxuXG5cdHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBwYWxldHRlRXhwb3J0Rm9ybWF0KCk6IHN0cmluZyB8IHZvaWQge1xuXHRjb25zdCB0aGlzRnVuY3Rpb24gPSAncGFsZXR0ZUV4cG9ydEZvcm1hdCgpJztcblx0Y29uc3QgZm9ybWF0U2VsZWN0aW9uTWVudSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdGlkcy5zZWxlY3RzLmV4cG9ydEZvcm1hdE9wdGlvblxuXHQpIGFzIEhUTUxTZWxlY3RFbGVtZW50O1xuXG5cdGlmICghZm9ybWF0U2VsZWN0aW9uTWVudSkge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0J0V4cG9ydCBmb3JtYXQgc2VsZWN0aW9uIGRyb3Bkb3duIG5vdCBmb3VuZCcsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzRnVuY3Rpb259YFxuXHRcdFx0KTtcblx0fVxuXG5cdGNvbnN0IHNlbGVjdGVkRm9ybWF0ID0gZm9ybWF0U2VsZWN0aW9uTWVudS52YWx1ZTtcblxuXHRpZiAoXG5cdFx0c2VsZWN0ZWRGb3JtYXQgIT09ICdDU1MnICYmXG5cdFx0c2VsZWN0ZWRGb3JtYXQgIT09ICdKU09OJyAmJlxuXHRcdHNlbGVjdGVkRm9ybWF0ICE9PSAnWE1MJ1xuXHQpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvciAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDMpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdCdJbnZhbGlkIGV4cG9ydCBmb3JtYXQgc2VsZWN0ZWQnLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc0Z1bmN0aW9ufWBcblx0XHRcdCk7XG5cblx0XHRyZXR1cm47XG5cdH0gZWxzZSB7XG5cdFx0cmV0dXJuIHNlbGVjdGVkRm9ybWF0O1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCBwYXJzZTogRE9NRm5fTWFzdGVySW50ZXJmYWNlWydwYXJzZSddID0ge1xuXHRjaGVja2JveCxcblx0Y29sb3JJbnB1dCxcblx0cGFsZXR0ZUV4cG9ydEZvcm1hdFxufTtcbiJdfQ==