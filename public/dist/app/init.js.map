{"version":3,"file":"init.js","sources":["../../../../src/app/init.ts"],"sourcesContent":["// File: app/init.js\n\nimport {\n\tCommonFunctionsInterface,\n\tGenerateHuesFnGroup,\n\tGeneratePaletteFn,\n\tGeneratePaletteFnGroup,\n\tHelpersInterface,\n\tRequiredCommonFunctions,\n\tServicesInterface,\n\tUtilitiesInterface\n} from '../types/index.js';\nimport { EventManager } from '../events/EventManager.js';\nimport { PaletteEvents } from '../events/PaletteEvents.js';\nimport { PaletteManager } from '../palette/PaletteManager.js';\nimport { PaletteState } from '../state/PaletteState.js';\nimport { StateManager } from '../state/StateManager.js';\nimport { UIEvents } from '../events/UIEvents.js';\nimport { createHelpers } from '../common/factories/helpers.js';\nimport { createServices } from '../common/factories/services.js';\nimport { createUtils } from '../common/factories/utils.js';\nimport { generateHuesFnGroup } from '../palette/partials/hues.js';\nimport { generatePalette } from '../palette/generate.js';\nimport { generatePaletteFnGroup } from '../palette/partials/types.js';\nimport { data } from '../data/index.js';\n\nconst mode = data.mode;\n\nexport async function initialize(): Promise<{\n\tcommon: RequiredCommonFunctions;\n\tevents: {\n\t\tpalette: PaletteEvents;\n\t\tui: UIEvents;\n\t};\n\tpaletteManager: PaletteManager;\n\tpaletteState: PaletteState;\n\tstateManager: StateManager;\n}> {\n\ttry {\n\t\tconsole.log('[initialize-1] Starting initialization...');\n\n\t\tlet events: { palette: PaletteEvents; ui: UIEvents } | null = null;\n\n\t\t// 1️. initialize services first\n\t\tconsole.log('[initialize-2] Calling initializeServices...');\n\t\tconst services = await initializeServices();\n\n\t\t// 2️. create empty placeholders for utils and helpers (to prevent circular dependency issues)\n\t\tconsole.log(\n\t\t\t'[initialize-3] Creating placeholders for utils and helpers...'\n\t\t);\n\t\tconst utils = {} as UtilitiesInterface;\n\t\tconst helpers = {} as HelpersInterface;\n\n\t\t// 3️. initialize utils (pass placeholders)\n\t\tconsole.log('[initialize-4] Calling initializeUtils...');\n\t\tObject.assign(utils, await initializeUtils(helpers, services));\n\n\t\t// 4️. initialize helpers (pass placeholders and utils)\n\t\tconsole.log('[initialize-5] Calling initializeHelpers...');\n\t\tObject.assign(helpers, await initializeHelpers(services, utils));\n\n\t\t// 5. create the Common Functions object with all properties marked as required\n\t\tconst common: RequiredCommonFunctions = { helpers, services, utils };\n\t\tconsole.log('[initialize-6] Common functions object created.');\n\n\t\t// 6. initialize StateManager\n\t\tconsole.log('[initialize-7] Calling initializeStateManager...');\n\t\tconst stateManager = await initializeStateManager(services, utils);\n\n\t\t// 7. initialize PaletteState\n\t\tconsole.log('[initialize-8] Calling initializePaletteState...');\n\t\tconst paletteState = await initializePaletteState(stateManager, utils);\n\n\t\t// 8. initialize PaletteManager\n\t\tconsole.log('[initialize-9] Calling initializePaletteManager...');\n\t\tconst paletteManager = await initializePaletteManager(\n\t\t\tstateManager,\n\t\t\tcommon,\n\t\t\tgenerateHuesFnGroup,\n\t\t\tgeneratePaletteFnGroup,\n\t\t\tgeneratePalette\n\t\t);\n\t\tconsole.log(\n\t\t\t'[initialize-9.5] After initializePaletteManager() but before initializeEvents...'\n\t\t);\n\t\tconsole.log('[initialize-10] PaletteManager initialized successfully.');\n\n\t\t// 9. instantiate Event Manager\n\t\tconsole.log('[initialize-11] Calling EventManager.getInstance()...');\n\t\tconst eventManager = EventManager.getInstance();\n\n\t\t// 10. initialize Events\n\t\ttry {\n\t\t\tconsole.log('[initialize-12] Calling initializeEvents...');\n\t\t\tevents = await initializeEvents(\n\t\t\t\tpaletteManager,\n\t\t\t\tpaletteState,\n\t\t\t\tservices,\n\t\t\t\tstateManager,\n\t\t\t\tutils\n\t\t\t);\n\t\t\tconsole.log('[initialize-13] Events initialized successfully.');\n\t\t} catch (err) {\n\t\t\tconsole.error(`[initialize-E] Error initializing events: ${err}`);\n\t\t\tevents = {\n\t\t\t\tpalette: new PaletteEvents(\n\t\t\t\t\tpaletteManager,\n\t\t\t\t\tpaletteState,\n\t\t\t\t\tservices,\n\t\t\t\t\tstateManager,\n\t\t\t\t\tutils\n\t\t\t\t),\n\t\t\t\tui: new UIEvents(services, utils)\n\t\t\t};\n\t\t}\n\n\t\t// 11. expose classes to window\n\t\tif (mode.exposeToWindow) {\n\t\t\tconsole.log('[initialize-14] Calling exposeToWindow...');\n\t\t\tawait exposeToWindow(\n\t\t\t\teventManager,\n\t\t\t\tevents!.palette,\n\t\t\t\tpaletteManager,\n\t\t\t\tstateManager,\n\t\t\t\tevents!.ui\n\t\t\t);\n\t\t}\n\n\t\tconsole.log('[initialize-15] Initialization complete.');\n\n\t\treturn {\n\t\t\tcommon,\n\t\t\tevents,\n\t\t\tpaletteManager,\n\t\t\tpaletteState,\n\t\t\tstateManager\n\t\t};\n\t} catch (error) {\n\t\tconsole.error(\n\t\t\t`[initialize-E] Initialization failed: ${error instanceof Error ? error.message : error}`\n\t\t);\n\n\t\tthrow error;\n\t}\n}\n\nasync function exposeToWindow(\n\teventManager: EventManager,\n\tpaletteEvents: PaletteEvents,\n\tpaletteManager: PaletteManager,\n\tstateManager: StateManager,\n\tuiEvents: UIEvents\n): Promise<void> {\n\tconsole.log('[exposeToWindow-1] Exposing functions to window...');\n\n\twindow.eventManager = eventManager;\n\twindow.paletteEvents = paletteEvents;\n\twindow.paletteManager = paletteManager;\n\twindow.stateManager = stateManager;\n\twindow.uiEvents = uiEvents;\n\n\twindow.EventManager = EventManager;\n\n\tconsole.log('[exposeToWindow-2] Functions exposed to window.');\n}\n\nasync function initializeEvents(\n\tpaletteManager: PaletteManager,\n\tpaletteState: PaletteState,\n\tservices: ServicesInterface,\n\tstateManager: StateManager,\n\tutils: UtilitiesInterface\n): Promise<{\n\tpalette: PaletteEvents;\n\tui: UIEvents;\n}> {\n\tconsole.log('[initializeEvents] Creating event handlers...');\n\n\tconst paletteEvents = new PaletteEvents(\n\t\tpaletteManager,\n\t\tpaletteState,\n\t\tservices,\n\t\tstateManager,\n\t\tutils\n\t);\n\tconst uiEvents = new UIEvents(services, utils);\n\n\tpaletteEvents.init();\n\n\tuiEvents.init();\n\tuiEvents.initButtons();\n\n\tconsole.log('[initializeEvents] Events initialized.');\n\n\treturn { palette: paletteEvents, ui: uiEvents };\n}\n\nasync function initializeHelpers(\n\tservices: ServicesInterface,\n\tutils: UtilitiesInterface\n): Promise<HelpersInterface> {\n\ttry {\n\t\tconsole.log('[initializeHelpers-1] Creating helpers...');\n\t\tconst helpers = await createHelpers(services, utils);\n\t\tconsole.log('[initializeHelpers-2] Helpers initialized.');\n\t\treturn helpers;\n\t} catch (err) {\n\t\tconsole.error(`[initializeHelpers-E] Error: ${err}`);\n\t\tthrow err;\n\t}\n}\n\nasync function initializePaletteManager(\n\tstateManager: StateManager,\n\tcommon: CommonFunctionsInterface,\n\tgenerateHuesFnGroup: GenerateHuesFnGroup,\n\tgeneratePaletteFnGroup: GeneratePaletteFnGroup,\n\tgeneratePalette: GeneratePaletteFn\n): Promise<PaletteManager> {\n\ttry {\n\t\tconsole.log('[initializePaletteManager-1] Creating palette manager...');\n\n\t\t// Fix: Just instantiate without recursion\n\t\tconst paletteManager = new PaletteManager(\n\t\t\tstateManager,\n\t\t\tcommon,\n\t\t\tgenerateHuesFnGroup,\n\t\t\tgeneratePaletteFnGroup,\n\t\t\tgeneratePalette\n\t\t);\n\n\t\tconsole.log(`[initializePaletteManager-2] PaletteManager initialized.`);\n\t\treturn paletteManager;\n\t} catch (err) {\n\t\tconsole.error(`[initializePaletteManager-E] Error: ${err}`);\n\t\tthrow err;\n\t}\n}\n\nasync function initializePaletteState(\n\tstateManager: StateManager,\n\tutils: UtilitiesInterface\n): Promise<PaletteState> {\n\ttry {\n\t\tconsole.log('[initializePaletteState-1] Creating palette state...');\n\t\tconst palettestate = new PaletteState(stateManager, utils);\n\t\tconsole.log('[initializePaletteState-2] PaletteState initialized.');\n\t\treturn palettestate;\n\t} catch (err) {\n\t\tconsole.error(`[initializePaletteState-E] Error: ${err}`);\n\t\tthrow err;\n\t}\n}\n\nasync function initializeServices(): Promise<ServicesInterface> {\n\ttry {\n\t\tconsole.log(`[initializeServices-1] Creating services....`);\n\t\tconst services = await createServices();\n\t\tconsole.log(`[initializeServices-2] Services initialized.`);\n\t\treturn services;\n\t} catch (err) {\n\t\tconsole.error(`[initializeServices-E] Error: ${err}`);\n\t\tthrow err;\n\t}\n}\n\nasync function initializeStateManager(\n\tservices: ServicesInterface,\n\tutils: UtilitiesInterface\n): Promise<StateManager> {\n\ttry {\n\t\tconsole.log('[initializeStateManager-1] Creating state manager...');\n\t\tconst stateManager = StateManager.getInstance(services, utils);\n\t\tconsole.log('[initializeStateManager-2] StateManager initialized.');\n\t\treturn stateManager;\n\t} catch (err) {\n\t\tconsole.error(`[initializeStateManager-E] Error: ${err}`);\n\t\tthrow err;\n\t}\n}\n\nasync function initializeUtils(\n\thelpers: HelpersInterface,\n\tservices: ServicesInterface\n): Promise<UtilitiesInterface> {\n\ttry {\n\t\tconsole.log('[initializeUtils-1] Creating utils...');\n\t\tconst utils = await createUtils(helpers, services);\n\t\tconsole.log('[initializeUtils-2] Utils initialized.');\n\t\treturn utils;\n\t} catch (err) {\n\t\tconsole.error(`[initializeUtils-E] Error: ${err}`);\n\t\tthrow err;\n\t}\n}\n"],"names":[],"mappings":"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"}