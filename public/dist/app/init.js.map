{"version":3,"file":"init.js","sources":["../../../../src/app/init.ts"],"sourcesContent":["// File: app/init.ts\n\nimport type {\n\tCommonFunctions,\n\tGenerateHuesFnGroup,\n\tGeneratePaletteFn,\n\tGeneratePaletteFnGroup,\n\tHelpersInterface,\n\tServicesInterface,\n\tUtilitiesInterface\n} from '../types/index.js';\nimport { EventManager } from '../events/EventManager.js';\nimport { PaletteEvents } from '../events/PaletteEvents.js';\nimport { PaletteManager } from '../palette/PaletteManager.js';\nimport { PaletteState } from '../state/PaletteState.js';\nimport { StateManager } from '../state/StateManager.js';\nimport { UIEvents } from '../events/UIEvents.js';\nimport { createHelpers } from '../common/factories/helpers.js';\nimport { createServices } from '../common/factories/services.js';\nimport { createUtils } from '../common/factories/utils.js';\nimport { generateHuesFnGroup } from '../palette/partials/hues.js';\nimport { generatePalette } from '../palette/generate.js';\nimport { generatePaletteFnGroup } from '../palette/partials/types.js';\nimport { config } from '../config/index.js';\n\nconst mode = config.mode;\n\nexport async function initializeApp(services: ServicesInterface): Promise<{\n\tcommon: Required<CommonFunctions>;\n\tevents: {\n\t\tpalette: PaletteEvents;\n\t\tui: UIEvents;\n\t};\n\tpaletteManager: PaletteManager;\n\tpaletteState: PaletteState;\n\tstateManager: StateManager;\n} | void> {\n\tconst { errors, log } = services;\n\n\treturn await errors.handleAsync(async () => {\n\t\tlet events: { palette: PaletteEvents; ui: UIEvents } | null = null;\n\n\t\t// 1. create empty placeholders for utils and helpers\n\t\tlog('[1] Creating placeholders for utils and helpers...');\n\t\tconst utils = {} as UtilitiesInterface;\n\t\tconst helpers = {} as HelpersInterface;\n\n\t\t// 2. initialize utils (pass placeholders)\n\t\tlog('[2] Calling initializeUtils...');\n\t\tObject.assign(utils, await initializeUtils(helpers, services));\n\n\t\t// 3. initialize helpers (pass placeholders and utils)\n\t\tlog('[3] Calling initializeHelpers...');\n\t\tObject.assign(helpers, await initializeHelpers(services, utils));\n\n\t\t// 4. create the Common Fns object with all properties required\n\t\tconst common: Required<CommonFunctions> = {\n\t\t\thelpers,\n\t\t\tservices,\n\t\t\tutils\n\t\t};\n\t\tlog('[4] Common functions object created.');\n\n\t\t// 5. initialize StateManager\n\t\tlog('[5] Calling initializeStateManager...');\n\t\tconst stateManager = await initializeStateManager(services, utils);\n\n\t\t// 6. initialize PaletteState\n\t\tlog('[6] Calling initializePaletteState...');\n\t\tconst paletteState = await initializePaletteState(\n\t\t\tservices,\n\t\t\tstateManager!,\n\t\t\tutils\n\t\t);\n\n\t\t// 7. initialize PaletteManager\n\t\tlog('[7] Calling initializePaletteManager...');\n\t\tconst paletteManager = await initializePaletteManager(\n\t\t\tstateManager!,\n\t\t\tcommon,\n\t\t\tgenerateHuesFnGroup,\n\t\t\tgeneratePaletteFnGroup,\n\t\t\tgeneratePalette\n\t\t);\n\t\tlog('[7-D] PaletteManager initialized successfully.', 'debug', 3);\n\n\t\t// 8. instantiate Event Manager\n\t\tlog('[8] Calling EventManager.getInstance()...');\n\t\tconst eventManager = EventManager.getInstance();\n\n\t\t// 9. initialize Events\n\t\tlog('[9] Calling initializeEvents...');\n\t\tevents = (await initializeEvents(\n\t\t\tpaletteManager!,\n\t\t\tpaletteState!,\n\t\t\tservices,\n\t\t\tstateManager!,\n\t\t\tutils\n\t\t))!;\n\n\t\t// 9a. expose classes to window\n\t\tif (mode.exposeClasses) {\n\t\t\tlog('[9a] Calling exposeToWindow...');\n\t\t\tawait exposeToWindow(\n\t\t\t\teventManager,\n\t\t\t\tevents!.palette,\n\t\t\t\tpaletteManager!,\n\t\t\t\tservices,\n\t\t\t\tstateManager!,\n\t\t\t\tevents!.ui\n\t\t\t);\n\t\t}\n\n\t\t// 10. Ensure state is fully initialized before rendering initial palette\n\t\tlog('[10] Calling stateManager.ensureStateReady()...');\n\t\tawait stateManager!.ensureStateReady();\n\n\t\t// 11. Render initial palette\n\t\tlog('[11] Calling paletteManager.loadPalette()...');\n\t\tawait paletteManager!.loadPalette();\n\t\tlog('[11-D] After paletteManager.loadPalette()...', 'debug');\n\n\t\t// 12. Log initialization complete\n\t\tconsole.log('[12] Initialization complete.');\n\n\t\treturn {\n\t\t\tcommon,\n\t\t\tevents,\n\t\t\tpaletteManager: paletteManager!,\n\t\t\tpaletteState: paletteState!,\n\t\t\tstateManager: stateManager!\n\t\t};\n\t}, 'Error initializing application');\n}\n\nexport function initializeServices(): ServicesInterface {\n\ttry {\n\t\tconsole.log(`[initializeServices-1] Creating services....`);\n\t\tconst services = createServices();\n\t\tservices.log(`[2] Services initialized.`);\n\t\treturn services;\n\t} catch (err) {\n\t\tconsole.error(`[initializeServices-ERR] Error: ${err}`);\n\t\tthrow err;\n\t}\n}\n\n//\n/// *********************************************\n//// ******** HOISTED HELPER FUNCTIONS ********\n/// *********************************************\n//\n\nasync function exposeToWindow(\n\teventManager: EventManager,\n\tpaletteEvents: PaletteEvents,\n\tpaletteManager: PaletteManager,\n\tservices: ServicesInterface,\n\tstateManager: StateManager,\n\tuiEvents: UIEvents\n): Promise<void> {\n\tconst { log, errors } = services;\n\n\tawait errors.handleAsync(async () => {\n\t\tlog('[exposeToWindow-1] Exposing functions to window...');\n\t\twindow.eventManager = eventManager;\n\t\twindow.paletteEvents = paletteEvents;\n\t\twindow.paletteManager = paletteManager;\n\t\twindow.stateManager = stateManager;\n\t\twindow.uiEvents = uiEvents;\n\t\twindow.EventManager = EventManager;\n\t\tlog('[exposeToWindow-2] Functions exposed to window.');\n\t}, 'Error exposing functions to window');\n}\n\nasync function initializeEvents(\n\tpaletteManager: PaletteManager,\n\tpaletteState: PaletteState,\n\tservices: ServicesInterface,\n\tstateManager: StateManager,\n\tutils: UtilitiesInterface\n): Promise<{\n\tpalette: PaletteEvents;\n\tui: UIEvents;\n} | void> {\n\tconst { errors, log } = services;\n\tlog('[1] Creating event handlers...');\n\n\tawait errors.handleAsync(async () => {\n\t\tconst paletteEvents = new PaletteEvents(\n\t\t\tpaletteManager,\n\t\t\tpaletteState,\n\t\t\tservices,\n\t\t\tstateManager,\n\t\t\tutils\n\t\t);\n\t\tconst uiEvents = new UIEvents(paletteManager, services, utils);\n\n\t\tpaletteEvents.init();\n\n\t\tuiEvents.init();\n\t\tuiEvents.initButtons();\n\n\t\tlog('[2] Events initialized.');\n\n\t\treturn { palette: paletteEvents, ui: uiEvents };\n\t}, 'Error initializing events');\n}\n\nasync function initializeHelpers(\n\tservices: ServicesInterface,\n\tutils: UtilitiesInterface\n): Promise<HelpersInterface | void> {\n\tconst { log, errors } = services;\n\n\tawait errors.handleAsync(async () => {\n\t\tlog('[1] Creating helpers...');\n\t\tconst helpers = await createHelpers(services, utils);\n\t\tlog('[2] Helpers initialized.');\n\t\treturn helpers;\n\t}, 'Error initializing helpers');\n}\n\nasync function initializePaletteManager(\n\tstateManager: StateManager,\n\tcommon: CommonFunctions,\n\tgenerateHuesFnGroup: GenerateHuesFnGroup,\n\tgeneratePaletteFnGroup: GeneratePaletteFnGroup,\n\tgeneratePalette: GeneratePaletteFn\n): Promise<PaletteManager | void> {\n\tconst { log, errors } = common.services;\n\n\tawait errors.handleAsync(async () => {\n\t\tlog('[1] Creating palette manager...');\n\n\t\t// Fix: Just instantiate without recursion\n\t\tconst paletteManager = new PaletteManager(\n\t\t\tstateManager,\n\t\t\tcommon,\n\t\t\tgenerateHuesFnGroup,\n\t\t\tgeneratePaletteFnGroup,\n\t\t\tgeneratePalette\n\t\t);\n\n\t\tlog(`[2] PaletteManager initialized.`);\n\t\treturn paletteManager;\n\t}, 'Error initializing PaletteManager');\n}\n\nasync function initializePaletteState(\n\tservices: ServicesInterface,\n\tstateManager: StateManager,\n\tutils: UtilitiesInterface\n): Promise<PaletteState | void> {\n\tconst { log, errors } = services;\n\tawait errors.handleAsync(async () => {\n\t\tlog('[1] Creating palette state...');\n\t\tconst palettestate = new PaletteState(stateManager, services, utils);\n\t\tlog('[2] PaletteState initialized.');\n\t\treturn palettestate;\n\t}, 'Error initializing PaletteState');\n}\n\nasync function initializeStateManager(\n\tservices: ServicesInterface,\n\tutils: UtilitiesInterface\n): Promise<StateManager | void> {\n\tconst { log, errors } = services;\n\tawait errors.handleAsync(async () => {\n\t\tlog('[1] Creating state manager...');\n\t\tconst stateManager = StateManager.getInstance(services, utils);\n\t\tlog('[2] StateManager initialized.');\n\t\treturn stateManager;\n\t}, 'Error initializing StateManager');\n}\n\nasync function initializeUtils(\n\thelpers: HelpersInterface,\n\tservices: ServicesInterface\n): Promise<UtilitiesInterface | void> {\n\tconst { log, errors } = services;\n\tawait errors.handleAsync(async () => {\n\t\tlog('[initUtils-1] Creating utils...');\n\t\tconst utils = await createUtils(helpers, services);\n\t\tlog('[initUtils-2] Utils initialized.');\n\t\treturn utils;\n\t}, 'Error initializing utils');\n}\n"],"names":[],"mappings":"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"}