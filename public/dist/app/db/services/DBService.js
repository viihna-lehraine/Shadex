// File: app/db/services/DBService.js
import { configData as config } from '../../../data/config.js';
import { dbUtils } from '../dbUtils.js';
export class DBService {
    static instance = null;
    defaultSettings = config.db.DEFAULT_SETTINGS;
    storeNames = config.db.STORE_NAMES;
    dbUtils;
    constructor() {
        this.dbUtils = dbUtils;
    }
    static async getInstance() {
        if (!this.instance) {
            this.instance = new DBService();
        }
        return this.instance;
    }
    async deleteDatabase() {
        await this.dbUtils.handleAsync(async () => {
            const dbName = 'paletteDB';
            const dbExists = await new Promise(resolve => {
                const request = indexedDB.open(dbName);
                request.onsuccess = () => {
                    request.result.close();
                    resolve(true);
                };
                request.onerror = () => resolve(false);
            });
            if (dbExists) {
                const deleteRequest = indexedDB.deleteDatabase(dbName);
                deleteRequest.onsuccess = () => this.dbUtils.log('debug', `Database "${dbName}" deleted successfully.`, 'deleteDatabase');
                deleteRequest.onerror = event => this.dbUtils.log('error', `Error deleting database "${dbName}":\nEvent: ${event}`, 'deleteDatabase');
                deleteRequest.onblocked = () => this.dbUtils.log('warn', `Delete operation blocked for "${dbName}".`, 'deleteDatabase');
            }
            else {
                this.dbUtils.log('warn', `Database "${dbName}" does not exist.`, 'deleteDatabase');
            }
        }, 'Failed to delete database', 'DBService.deleteDatabase');
    }
    async deleteEntries(store, keys) {
        await this.dbUtils.handleAsync(async () => {
            await this.dbUtils.withDB(async (db) => {
                const storeRef = db
                    .transaction(store, 'readwrite')
                    .objectStore(store);
                for (const key of keys) {
                    if ((await this.dbUtils.handleData(store, key, 'get')) !== null) {
                        await storeRef.delete(key);
                    }
                }
            });
        }, `Failed to delete entries in store "${store}"`, 'DBService.deleteEntries');
    }
    async resetDatabase() {
        await this.dbUtils.handleAsync(async () => {
            await this.dbUtils.withDB(async (db) => {
                await Promise.all(Object.values(this.storeNames).map(store => db
                    .transaction(store, 'readwrite')
                    .objectStore(store)
                    .clear()));
                await this.dbUtils.handleData(this.storeNames.SETTINGS, this.dbUtils.getDefaultKey('APP_SETTINGS'), 'put', this.defaultSettings);
            });
        }, 'Failed to reset database', 'DBService.resetDatabase');
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiREJTZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2FwcC9kYi9zZXJ2aWNlcy9EQlNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEscUNBQXFDO0FBUXJDLE9BQU8sRUFBRSxVQUFVLElBQUksTUFBTSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFDL0QsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUV4QyxNQUFNLE9BQU8sU0FBUztJQUNiLE1BQU0sQ0FBQyxRQUFRLEdBQXFCLElBQUksQ0FBQztJQUV6QyxlQUFlLEdBQ3RCLE1BQU0sQ0FBQyxFQUFFLENBQUMsZ0JBQWdCLENBQUM7SUFDcEIsVUFBVSxHQUNqQixNQUFNLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQztJQUVmLE9BQU8sQ0FBbUI7SUFFbEM7UUFDQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUN4QixDQUFDO0lBRU0sTUFBTSxDQUFDLEtBQUssQ0FBQyxXQUFXO1FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLFNBQVMsRUFBRSxDQUFDO1FBQ2pDLENBQUM7UUFFRCxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUM7SUFDdEIsQ0FBQztJQUVNLEtBQUssQ0FBQyxjQUFjO1FBQzFCLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQzdCLEtBQUssSUFBSSxFQUFFO1lBQ1YsTUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDO1lBQzNCLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBSSxPQUFPLENBQVUsT0FBTyxDQUFDLEVBQUU7Z0JBQ3JELE1BQU0sT0FBTyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBRXZDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsR0FBRyxFQUFFO29CQUN4QixPQUFP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LENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsRUFDMUMsS0FBSyxFQUNMLElBQUksQ0FBQyxlQUFlLENBQ3BCLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNKLENBQUMsRUFDRCwwQkFBMEIsRUFDMUIseUJBQXlCLENBQ3pCLENBQUM7SUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogYXBwL2RiL3NlcnZpY2VzL0RCU2VydmljZS5qc1xuXG5pbXBvcnQge1xuXHRDb25maWdEYXRhSW50ZXJmYWNlLFxuXHREQlNlcnZpY2VfQ2xhc3NJbnRlcmZhY2UsXG5cdERCVXRpbHNJbnRlcmZhY2UsXG5cdFBhbGV0dGVTY2hlbWFcbn0gZnJvbSAnLi4vLi4vLi4vdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgY29uZmlnRGF0YSBhcyBjb25maWcgfSBmcm9tICcuLi8uLi8uLi9kYXRhL2NvbmZpZy5qcyc7XG5pbXBvcnQgeyBkYlV0aWxzIH0gZnJvbSAnLi4vZGJVdGlscy5qcyc7XG5cbmV4cG9ydCBjbGFzcyBEQlNlcnZpY2UgaW1wbGVtZW50cyBEQlNlcnZpY2VfQ2xhc3NJbnRlcmZhY2Uge1xuXHRwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogREJTZXJ2aWNlIHwgbnVsbCA9IG51bGw7XG5cblx0cHJpdmF0ZSBkZWZhdWx0U2V0dGluZ3M6IENvbmZpZ0RhdGFJbnRlcmZhY2VbJ2RiJ11bJ0RFRkFVTFRfU0VUVElOR1MnXSA9XG5cdFx0Y29uZmlnLmRiLkRFRkFVTFRfU0VUVElOR1M7XG5cdHByaXZhdGUgc3RvcmVOYW1lczogQ29uZmlnRGF0YUludGVyZmFjZVsnZGInXVsnU1RPUkVfTkFNRVMnXSA9XG5cdFx0Y29uZmlnLmRiLlNUT1JFX05BTUVTO1xuXG5cdHByaXZhdGUgZGJVdGlsczogREJVdGlsc0ludGVyZmFjZTtcblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLmRiVXRpbHMgPSBkYlV0aWxzO1xuXHR9XG5cblx0cHVibGljIHN0YXRpYyBhc3luYyBnZXRJbnN0YW5jZSgpIHtcblx0XHRpZiAoIXRoaXMuaW5zdGFuY2UpIHtcblx0XHRcdHRoaXMuaW5zdGFuY2UgPSBuZXcgREJTZXJ2aWNlKCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHRoaXMuaW5zdGFuY2U7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZGVsZXRlRGF0YWJhc2UoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0YXdhaXQgdGhpcy5kYlV0aWxzLmhhbmRsZUFzeW5jKFxuXHRcdFx0YXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRjb25zdCBkYk5hbWUgPSAncGFsZXR0ZURCJztcblx0XHRcdFx0Y29uc3QgZGJFeGlzdHMgPSBhd2FpdCBuZXcgUHJvbWlzZTxib29sZWFuPihyZXNvbHZlID0+IHtcblx0XHRcdFx0XHRjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4oZGJOYW1lKTtcblxuXHRcdFx0XHRcdHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xuXHRcdFx0XHRcdFx0cmVxdWVzdC5yZXN1bHQuY2xvc2UoKTtcblx0XHRcdFx0XHRcdHJlc29sdmUodHJ1ZSk7XG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRyZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiByZXNvbHZlKGZhbHNlKTtcblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0aWYgKGRiRXhpc3RzKSB7XG5cdFx0XHRcdFx0Y29uc3QgZGVsZXRlUmVxdWVzdCA9IGluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShkYk5hbWUpO1xuXHRcdFx0XHRcdGRlbGV0ZVJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT5cblx0XHRcdFx0XHRcdHRoaXMuZGJVdGlscy5sb2coXG5cdFx0XHRcdFx0XHRcdCdkZWJ1ZycsXG5cdFx0XHRcdFx0XHRcdGBEYXRhYmFzZSBcIiR7ZGJOYW1lfVwiIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5LmAsXG5cdFx0XHRcdFx0XHRcdCdkZWxldGVEYXRhYmFzZSdcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0ZGVsZXRlUmVxdWVzdC5vbmVycm9yID0gZXZlbnQgPT5cblx0XHRcdFx0XHRcdHRoaXMuZGJVdGlscy5sb2coXG5cdFx0XHRcdFx0XHRcdCdlcnJvcicsXG5cdFx0XHRcdFx0XHRcdGBFcnJvciBkZWxldGluZyBkYXRhYmFzZSBcIiR7ZGJOYW1lfVwiOlxcbkV2ZW50OiAke2V2ZW50fWAsXG5cdFx0XHRcdFx0XHRcdCdkZWxldGVEYXRhYmFzZSdcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0ZGVsZXRlUmVxdWVzdC5vbmJsb2NrZWQgPSAoKSA9PlxuXHRcdFx0XHRcdFx0dGhpcy5kYlV0aWxzLmxvZyhcblx0XHRcdFx0XHRcdFx0J3dhcm4nLFxuXHRcdFx0XHRcdFx0XHRgRGVsZXRlIG9wZXJhdGlvbiBibG9ja2VkIGZvciBcIiR7ZGJOYW1lfVwiLmAsXG5cdFx0XHRcdFx0XHRcdCdkZWxldGVEYXRhYmFzZSdcblx0XHRcdFx0XHRcdCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5kYlV0aWxzLmxvZyhcblx0XHRcdFx0XHRcdCd3YXJuJyxcblx0XHRcdFx0XHRcdGBEYXRhYmFzZSBcIiR7ZGJOYW1lfVwiIGRvZXMgbm90IGV4aXN0LmAsXG5cdFx0XHRcdFx0XHQnZGVsZXRlRGF0YWJhc2UnXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdCdGYWlsZWQgdG8gZGVsZXRlIGRhdGFiYXNlJyxcblx0XHRcdCdEQlNlcnZpY2UuZGVsZXRlRGF0YWJhc2UnXG5cdFx0KTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBkZWxldGVFbnRyaWVzKFxuXHRcdHN0b3JlOiBrZXlvZiBQYWxldHRlU2NoZW1hLFxuXHRcdGtleXM6IHN0cmluZ1tdXG5cdCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGF3YWl0IHRoaXMuZGJVdGlscy5oYW5kbGVBc3luYyhcblx0XHRcdGFzeW5jICgpID0+IHtcblx0XHRcdFx0YXdhaXQgdGhpcy5kYlV0aWxzLndpdGhEQihhc3luYyBkYiA9PiB7XG5cdFx0XHRcdFx0Y29uc3Qgc3RvcmVSZWYgPSBkYlxuXHRcdFx0XHRcdFx0LnRyYW5zYWN0aW9uKHN0b3JlLCAncmVhZHdyaXRlJylcblx0XHRcdFx0XHRcdC5vYmplY3RTdG9yZShzdG9yZSk7XG5cblx0XHRcdFx0XHRmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG5cdFx0XHRcdFx0XHRpZiAoXG5cdFx0XHRcdFx0XHRcdChhd2FpdCB0aGlzLmRiVXRpbHMuaGFuZGxlRGF0YShcblx0XHRcdFx0XHRcdFx0XHRzdG9yZSxcblx0XHRcdFx0XHRcdFx0XHRrZXksXG5cdFx0XHRcdFx0XHRcdFx0J2dldCdcblx0XHRcdFx0XHRcdFx0KSkgIT09IG51bGxcblx0XHRcdFx0XHRcdCkge1xuXHRcdFx0XHRcdFx0XHRhd2FpdCBzdG9yZVJlZi5kZWxldGUoa2V5KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSxcblx0XHRcdGBGYWlsZWQgdG8gZGVsZXRlIGVudHJpZXMgaW4gc3RvcmUgXCIke3N0b3JlfVwiYCxcblx0XHRcdCdEQlNlcnZpY2UuZGVsZXRlRW50cmllcydcblx0XHQpO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIHJlc2V0RGF0YWJhc2UoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0YXdhaXQgdGhpcy5kYlV0aWxzLmhhbmRsZUFzeW5jKFxuXHRcdFx0YXN5bmMgKCkgPT4ge1xuXHRcdFx0XHRhd2FpdCB0aGlzLmRiVXRpbHMud2l0aERCKGFzeW5jIGRiID0+IHtcblx0XHRcdFx0XHRhd2FpdCBQcm9taXNlLmFsbChcblx0XHRcdFx0XHRcdE9iamVjdC52YWx1ZXModGhpcy5zdG9yZU5hbWVzKS5tYXAoc3RvcmUgPT5cblx0XHRcdFx0XHRcdFx0ZGJcblx0XHRcdFx0XHRcdFx0XHQudHJhbnNhY3Rpb24oc3RvcmUsICdyZWFkd3JpdGUnKVxuXHRcdFx0XHRcdFx0XHRcdC5vYmplY3RTdG9yZShzdG9yZSlcblx0XHRcdFx0XHRcdFx0XHQuY2xlYXIoKVxuXHRcdFx0XHRcdFx0KVxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0YXdhaXQgdGhpcy5kYlV0aWxzLmhhbmRsZURhdGEoXG5cdFx0XHRcdFx0XHR0aGlzLnN0b3JlTmFtZXMuU0VUVElOR1MgYXMga2V5b2YgUGFsZXR0ZVNjaGVtYSxcblx0XHRcdFx0XHRcdHRoaXMuZGJVdGlscy5nZXREZWZhdWx0S2V5KCdBUFBfU0VUVElOR1MnKSxcblx0XHRcdFx0XHRcdCdwdXQnLFxuXHRcdFx0XHRcdFx0dGhpcy5kZWZhdWx0U2V0dGluZ3Ncblx0XHRcdFx0XHQpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH0sXG5cdFx0XHQnRmFpbGVkIHRvIHJlc2V0IGRhdGFiYXNlJyxcblx0XHRcdCdEQlNlcnZpY2UucmVzZXREYXRhYmFzZSdcblx0XHQpO1xuXHR9XG59XG4iXX0=