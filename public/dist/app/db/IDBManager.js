// File: app/db/IDBManager.js
import { DBService } from './services/DBService.js';
import { HistoryService } from './services/HistoryService.js';
import { MutationService } from './services/MutationService.js';
import { PaletteService } from './services/PaletteService.js';
import { SettingsService } from './services/SettingsService.js';
import { dbUtils, setIDBManagerInstance } from './dbUtils.js';
import { initializeDB } from './initialize.js';
export class IDBManager {
    static instance = null;
    dbPromise;
    dbUtils;
    dbService;
    historyService;
    mutationService;
    paletteService;
    settingsService;
    constructor() {
        this.dbPromise = initializeDB();
        this.dbUtils = dbUtils;
        this.initializeServices();
    }
    /// * * * * * * STATIC METHODS * * * * * * *
    // * * * * * * * * * * * * * * * * * * * * * *
    static async getInstance() {
        if (!this.instance) {
            this.instance = new IDBManager();
            await this.instance.dbPromise;
        }
        return this.instance;
    }
    static resetInstance() {
        this.instance = null;
    }
    /// * * * * * * * PUBLIC METHODS * * * * * * *
    // * * * * * * * * * * * * * * * * * * * * * *
    async addPaletteToHistory(palette) {
        await this.historyService.addPaletteToHistory(palette);
    }
    async createMutationLogger(obj, key) {
        return await this.mutationService.createMutationLogger(obj, key);
    }
    async deleteDatabase() {
        await this.dbService.deleteDatabase();
    }
    async deleteEntries(store, keys) {
        await this.dbService.deleteEntries(store, keys);
    }
    async getCurrentPaletteID() {
        return await this.paletteService.getCurrentPaletteID();
    }
    async getDB() {
        return this.dbPromise;
    }
    async getCachedSettings() {
        return await this.settingsService.getCachedSettings();
    }
    async getNextTableID() {
        return await this.paletteService.getNextTableID();
    }
    async getMutations() {
        return await this.mutationService.getMutations();
    }
    async getPaletteHistory() {
        return await this.historyService.getPaletteHistory();
    }
    async getSettings() {
        return await this.settingsService.getSettings();
    }
    async getStore(storeName, mode) {
        return this.dbUtils.withDB(async (db) => db.transaction(storeName, mode).objectStore(storeName));
    }
    async persistMutation(data) {
        await this.mutationService.persistMutation(data);
    }
    async resetDatabase() {
        await this.dbService.resetDatabase();
    }
    async resetPaletteID() {
        await this.paletteService.resetPaletteID();
    }
    async savePalette(id, newPalette) {
        await this.paletteService.savePalette(id, newPalette);
    }
    async savePaletteToDB(args) {
        return await this.paletteService.savePaletteToDB(args);
    }
    async savePaletteHistory(paletteHistory) {
        await this.historyService.savePaletteHistory(paletteHistory);
    }
    async saveSettings(newSettings) {
        await this.settingsService.saveSettings(newSettings);
    }
    async updateEntryInPalette(tableID, entryIndex, newEntry) {
        await this.paletteService.updateEntryInPalette(tableID, entryIndex, newEntry);
    }
    //// * * * * * * PRIVATE METHODS * * * * * *
    /// * * * *  * * * * * * * * * * * * * * * *
    async initializeServices() {
        setIDBManagerInstance(this);
        this.dbService = await DBService.getInstance();
        this.historyService = await HistoryService.getInstance();
        this.mutationService = await MutationService.getInstance();
        this.paletteService = await PaletteService.getInstance();
        this.settingsService = await SettingsService.getInstance();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSURCTWFuYWdlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcHAvZGIvSURCTWFuYWdlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw2QkFBNkI7QUFjN0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQ3BELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sK0JBQStCLENBQUM7QUFDaEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDhCQUE4QixDQUFDO0FBQzlELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUNoRSxPQUFPLEVBQUUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sY0FBYyxDQUFDO0FBQzlELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUvQyxNQUFNLE9BQU8sVUFBVTtJQUNkLE1BQU0sQ0FBQyxRQUFRLEdBQXNCLElBQUksQ0FBQztJQUUxQyxTQUFTLENBQXVDO0lBRWhELE9BQU8sQ0FBbUI7SUFFMUIsU0FBUyxDQUFhO0lBQ3RCLGNBQWMsQ0FBa0I7SUFDaEMsZUFBZSxDQUFtQjtJQUNsQyxjQUFjLENBQWtCO0lBQ2hDLGVBQWUsQ0FBbUI7SUFFMUM7UUFDQyxJQUFJLENBQUMsU0FBUyxHQUFHLFlBQVksRUFBRSxDQUFDO1FBRWhDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBRXZCLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBQzNCLENBQUM7SUFFRCw0Q0FBNEM7SUFDNUMsOENBQThDO0lBRXZDLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVztRQUM5QixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUVqQyxN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QUFjLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3hELENBQUM7SUFFTSxLQUFLLENBQUMsa0JBQWtCLENBQUMsY0FBeUI7UUFDeEQsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLGtCQUFrQixDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFTSxLQUFLLENBQUMsWUFBWSxDQUFDLFdBQXFCO1FBQzlDLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDdEQsQ0FBQztJQUVNLEtBQUssQ0FBQyxvQkFBb0IsQ0FDaEMsT0FBZSxFQUNmLFVBQWtCLEVBQ2xCLFFBQXFCO1FBRXJCLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxvQkFBb0IsQ0FDN0MsT0FBTyxFQUNQLFVBQVUsRUFDVixRQUFRLENBQ1IsQ0FBQztJQUNILENBQUM7SUFFRCw0Q0FBNEM7SUFDNUMsNENBQTRDO0lBRXBDLEtBQUssQ0FBQyxrQkFBa0I7UUFDL0IscUJBQXFCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFNUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxNQUFNLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUMvQyxJQUFJLENBQUMsY0FBYyxHQUFHLE1BQU0sY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3pELElBQUksQ0FBQyxlQUFlLEdBQUcsTUFBTSxlQUFlLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0QsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLGNBQWMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUN6RCxJQUFJLENBQUMsZUFBZSxHQUFHLE1BQU0sZUFBZSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQzVELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBhcHAvZGIvSURCTWFuYWdlci5qc1xuXG5pbXBvcnQgeyBJREJQRGF0YWJhc2UsIElEQlBPYmplY3RTdG9yZSB9IGZyb20gJ2lkYic7XG5pbXBvcnQge1xuXHREQlV0aWxzSW50ZXJmYWNlLFxuXHRJREJNYW5hZ2VyX0NsYXNzSW50ZXJmYWNlLFxuXHRNdXRhdGlvbkxvZyxcblx0UGFsZXR0ZSxcblx0UGFsZXR0ZUFyZ3MsXG5cdFBhbGV0dGVEQixcblx0UGFsZXR0ZUl0ZW0sXG5cdFBhbGV0dGVTY2hlbWEsXG5cdFNldHRpbmdzXG59IGZyb20gJy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IERCU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvREJTZXJ2aWNlLmpzJztcbmltcG9ydCB7IEhpc3RvcnlTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9IaXN0b3J5U2VydmljZS5qcyc7XG5pbXBvcnQgeyBNdXRhdGlvblNlcnZpY2UgfSBmcm9tICcuL3NlcnZpY2VzL011dGF0aW9uU2VydmljZS5qcyc7XG5pbXBvcnQgeyBQYWxldHRlU2VydmljZSB9IGZyb20gJy4vc2VydmljZXMvUGFsZXR0ZVNlcnZpY2UuanMnO1xuaW1wb3J0IHsgU2V0dGluZ3NTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy9TZXR0aW5nc1NlcnZpY2UuanMnO1xuaW1wb3J0IHsgZGJVdGlscywgc2V0SURCTWFuYWdlckluc3RhbmNlIH0gZnJvbSAnLi9kYlV0aWxzLmpzJztcbmltcG9ydCB7IGluaXRpYWxpemVEQiB9IGZyb20gJy4vaW5pdGlhbGl6ZS5qcyc7XG5cbmV4cG9ydCBjbGFzcyBJREJNYW5hZ2VyIGltcGxlbWVudHMgSURCTWFuYWdlcl9DbGFzc0ludGVyZmFjZSB7XG5cdHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBJREJNYW5hZ2VyIHwgbnVsbCA9IG51bGw7XG5cblx0cHJpdmF0ZSBkYlByb21pc2U6IFByb21pc2U8SURCUERhdGFiYXNlPFBhbGV0dGVTY2hlbWE+PjtcblxuXHRwcml2YXRlIGRiVXRpbHM6IERCVXRpbHNJbnRlcmZhY2U7XG5cblx0cHJpdmF0ZSBkYlNlcnZpY2UhOiBEQlNlcnZpY2U7XG5cdHByaXZhdGUgaGlzdG9yeVNlcnZpY2UhOiBIaXN0b3J5U2VydmljZTtcblx0cHJpdmF0ZSBtdXRhdGlvblNlcnZpY2UhOiBNdXRhdGlvblNlcnZpY2U7XG5cdHByaXZhdGUgcGFsZXR0ZVNlcnZpY2UhOiBQYWxldHRlU2VydmljZTtcblx0cHJpdmF0ZSBzZXR0aW5nc1NlcnZpY2UhOiBTZXR0aW5nc1NlcnZpY2U7XG5cblx0cHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcblx0XHR0aGlzLmRiUHJvbWlzZSA9IGluaXRpYWxpemVEQigpO1xuXG5cdFx0dGhpcy5kYlV0aWxzID0gZGJVdGlscztcblxuXHRcdHRoaXMuaW5pdGlhbGl6ZVNlcnZpY2VzKCk7XG5cdH1cblxuXHQvLy8gKiAqICogKiAqICogU1RBVElDIE1FVEhPRFMgKiAqICogKiAqICogKlxuXHQvLyAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqXG5cblx0cHVibGljIHN0YXRpYyBhc3luYyBnZXRJbnN0YW5jZSgpOiBQcm9taXNlPElEQk1hbmFnZXI+IHtcblx0XHRpZiAoIXRoaXMuaW5zdGFuY2UpIHtcblx0XHRcdHRoaXMuaW5zdGFuY2UgPSBuZXcgSURCTWFuYWdlcigpO1xuXG5cdFx0XHRhd2FpdCB0aGlzLmluc3RhbmNlLmRiUHJvbWlzZTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdGhpcy5pbnN0YW5jZTtcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgcmVzZXRJbnN0YW5jZSgpOiB2b2lkIHtcblx0XHR0aGlzLmluc3RhbmNlID0gbnVsbDtcblx0fVxuXG5cdC8vLyAqICogKiAqICogKiAqIFBVQkxJQyBNRVRIT0RTICogKiAqICogKiAqICpcblx0Ly8gKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICogKlxuXG5cdHB1YmxpYyBhc3luYyBhZGRQYWxldHRlVG9IaXN0b3J5KHBhbGV0dGU6IFBhbGV0dGUpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRhd2FpdCB0aGlzLmhpc3RvcnlTZXJ2aWNlLmFkZFBhbGV0dGVUb0hpc3RvcnkocGFsZXR0ZSk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgY3JlYXRlTXV0YXRpb25Mb2dnZXI8VCBleHRlbmRzIG9iamVjdD4oXG5cdFx0b2JqOiBULFxuXHRcdGtleTogc3RyaW5nXG5cdCk6IFByb21pc2U8VD4ge1xuXHRcdHJldHVybiBhd2FpdCB0aGlzLm11dGF0aW9uU2VydmljZS5jcmVhdGVNdXRhdGlvbkxvZ2dlcihvYmosIGtleSk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZGVsZXRlRGF0YWJhc2UoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0YXdhaXQgdGhpcy5kYlNlcnZpY2UuZGVsZXRlRGF0YWJhc2UoKTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBkZWxldGVFbnRyaWVzKFxuXHRcdHN0b3JlOiBrZXlvZiBQYWxldHRlU2NoZW1hLFxuXHRcdGtleXM6IHN0cmluZ1tdXG5cdCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGF3YWl0IHRoaXMuZGJTZXJ2aWNlLmRlbGV0ZUVudHJpZXMoc3RvcmUsIGtleXMpO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIGdldEN1cnJlbnRQYWxldHRlSUQoKTogUHJvbWlzZTxudW1iZXI+IHtcblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5wYWxldHRlU2VydmljZS5nZXRDdXJyZW50UGFsZXR0ZUlEKCk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZ2V0REIoKTogUHJvbWlzZTxQYWxldHRlREI+IHtcblx0XHRyZXR1cm4gdGhpcy5kYlByb21pc2U7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZ2V0Q2FjaGVkU2V0dGluZ3MoKTogUHJvbWlzZTxTZXR0aW5ncz4ge1xuXHRcdHJldHVybiBhd2FpdCB0aGlzLnNldHRpbmdzU2VydmljZS5nZXRDYWNoZWRTZXR0aW5ncygpO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIGdldE5leHRUYWJsZUlEKCk6IFByb21pc2U8c3RyaW5nPiB7XG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMucGFsZXR0ZVNlcnZpY2UuZ2V0TmV4dFRhYmxlSUQoKTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBnZXRNdXRhdGlvbnMoKTogUHJvbWlzZTxNdXRhdGlvbkxvZ1tdPiB7XG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMubXV0YXRpb25TZXJ2aWNlLmdldE11dGF0aW9ucygpO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIGdldFBhbGV0dGVIaXN0b3J5KCk6IFByb21pc2U8UGFsZXR0ZVtdPiB7XG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuaGlzdG9yeVNlcnZpY2UuZ2V0UGFsZXR0ZUhpc3RvcnkoKTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBnZXRTZXR0aW5ncygpOiBQcm9taXNlPFNldHRpbmdzPiB7XG5cdFx0cmV0dXJuIGF3YWl0IHRoaXMuc2V0dGluZ3NTZXJ2aWNlLmdldFNldHRpbmdzKCk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgZ2V0U3RvcmU8U3RvcmVOYW1lIGV4dGVuZHMga2V5b2YgUGFsZXR0ZVNjaGVtYT4oXG5cdFx0c3RvcmVOYW1lOiBTdG9yZU5hbWUsXG5cdFx0bW9kZTogJ3JlYWRvbmx5J1xuXHQpOiBQcm9taXNlPFxuXHRcdElEQlBPYmplY3RTdG9yZTxQYWxldHRlU2NoZW1hLCBbU3RvcmVOYW1lXSwgU3RvcmVOYW1lLCAncmVhZG9ubHknPlxuXHQ+O1xuXG5cdHB1YmxpYyBhc3luYyBnZXRTdG9yZTxTdG9yZU5hbWUgZXh0ZW5kcyBrZXlvZiBQYWxldHRlU2NoZW1hPihcblx0XHRzdG9yZU5hbWU6IFN0b3JlTmFtZSxcblx0XHRtb2RlOiAncmVhZHdyaXRlJ1xuXHQpOiBQcm9taXNlPFxuXHRcdElEQlBPYmplY3RTdG9yZTxQYWxldHRlU2NoZW1hLCBbU3RvcmVOYW1lXSwgU3RvcmVOYW1lLCAncmVhZHdyaXRlJz5cblx0PjtcblxuXHRwdWJsaWMgYXN5bmMgZ2V0U3RvcmU8U3RvcmVOYW1lIGV4dGVuZHMga2V5b2YgUGFsZXR0ZVNjaGVtYT4oXG5cdFx0c3RvcmVOYW1lOiBTdG9yZU5hbWUsXG5cdFx0bW9kZTogJ3JlYWRvbmx5JyB8ICdyZWFkd3JpdGUnXG5cdCk6IFByb21pc2U8XG5cdFx0SURCUE9iamVjdFN0b3JlPFBhbGV0dGVTY2hlbWEsIFtTdG9yZU5hbWVdLCBTdG9yZU5hbWUsIHR5cGVvZiBtb2RlPlxuXHQ+IHtcblx0XHRyZXR1cm4gdGhpcy5kYlV0aWxzLndpdGhEQihhc3luYyBkYiA9PlxuXHRcdFx0ZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBtb2RlKS5vYmplY3RTdG9yZShzdG9yZU5hbWUpXG5cdFx0KTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBwZXJzaXN0TXV0YXRpb24oZGF0YTogTXV0YXRpb25Mb2cpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRhd2FpdCB0aGlzLm11dGF0aW9uU2VydmljZS5wZXJzaXN0TXV0YXRpb24oZGF0YSk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgcmVzZXREYXRhYmFzZSgpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRhd2FpdCB0aGlzLmRiU2VydmljZS5yZXNldERhdGFiYXNlKCk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgcmVzZXRQYWxldHRlSUQoKTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0YXdhaXQgdGhpcy5wYWxldHRlU2VydmljZS5yZXNldFBhbGV0dGVJRCgpO1xuXHR9XG5cblx0cHVibGljIGFzeW5jIHNhdmVQYWxldHRlKGlkOiBzdHJpbmcsIG5ld1BhbGV0dGU6IFBhbGV0dGUpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRhd2FpdCB0aGlzLnBhbGV0dGVTZXJ2aWNlLnNhdmVQYWxldHRlKGlkLCBuZXdQYWxldHRlKTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBzYXZlUGFsZXR0ZVRvREIoYXJnczogUGFsZXR0ZUFyZ3MpOiBQcm9taXNlPFBhbGV0dGU+IHtcblx0XHRyZXR1cm4gYXdhaXQgdGhpcy5wYWxldHRlU2VydmljZS5zYXZlUGFsZXR0ZVRvREIoYXJncyk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgc2F2ZVBhbGV0dGVIaXN0b3J5KHBhbGV0dGVIaXN0b3J5OiBQYWxldHRlW10pOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRhd2FpdCB0aGlzLmhpc3RvcnlTZXJ2aWNlLnNhdmVQYWxldHRlSGlzdG9yeShwYWxldHRlSGlzdG9yeSk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgc2F2ZVNldHRpbmdzKG5ld1NldHRpbmdzOiBTZXR0aW5ncyk6IFByb21pc2U8dm9pZD4ge1xuXHRcdGF3YWl0IHRoaXMuc2V0dGluZ3NTZXJ2aWNlLnNhdmVTZXR0aW5ncyhuZXdTZXR0aW5ncyk7XG5cdH1cblxuXHRwdWJsaWMgYXN5bmMgdXBkYXRlRW50cnlJblBhbGV0dGUoXG5cdFx0dGFibGVJRDogc3RyaW5nLFxuXHRcdGVudHJ5SW5kZXg6IG51bWJlcixcblx0XHRuZXdFbnRyeTogUGFsZXR0ZUl0ZW1cblx0KTogUHJvbWlzZTx2b2lkPiB7XG5cdFx0YXdhaXQgdGhpcy5wYWxldHRlU2VydmljZS51cGRhdGVFbnRyeUluUGFsZXR0ZShcblx0XHRcdHRhYmxlSUQsXG5cdFx0XHRlbnRyeUluZGV4LFxuXHRcdFx0bmV3RW50cnlcblx0XHQpO1xuXHR9XG5cblx0Ly8vLyAqICogKiAqICogKiBQUklWQVRFIE1FVEhPRFMgKiAqICogKiAqICpcblx0Ly8vICogKiAqICogICogKiAqICogKiAqICogKiAqICogKiAqICogKiAqICpcblxuXHRwcml2YXRlIGFzeW5jIGluaXRpYWxpemVTZXJ2aWNlcygpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHRzZXRJREJNYW5hZ2VySW5zdGFuY2UodGhpcyk7XG5cblx0XHR0aGlzLmRiU2VydmljZSA9IGF3YWl0IERCU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXHRcdHRoaXMuaGlzdG9yeVNlcnZpY2UgPSBhd2FpdCBIaXN0b3J5U2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXHRcdHRoaXMubXV0YXRpb25TZXJ2aWNlID0gYXdhaXQgTXV0YXRpb25TZXJ2aWNlLmdldEluc3RhbmNlKCk7XG5cdFx0dGhpcy5wYWxldHRlU2VydmljZSA9IGF3YWl0IFBhbGV0dGVTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG5cdFx0dGhpcy5zZXR0aW5nc1NlcnZpY2UgPSBhd2FpdCBTZXR0aW5nc1NlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcblx0fVxufVxuIl19