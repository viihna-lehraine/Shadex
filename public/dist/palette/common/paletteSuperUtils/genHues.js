// File: src/palette/common/paletteSuperUtils/genHues.js
import { core, utils } from '../../../common/index.js';
import { createLogger } from '../../../logger/index.js';
import { mode } from '../../../common/data/base.js';
import { paletteUtils } from '../paletteUtils/index.js';
const logger = await createLogger();
const logMode = mode.logging;
const genAllColorValues = utils.conversion.genAllColorValues;
const getWeightedRandomInterval = paletteUtils.probability.getWeightedRandomInterval;
const validateColorValues = core.validate.colorValues;
function analogous(color, numBoxes) {
    try {
        if (!validateColorValues(color)) {
            if (logMode.error)
                logger.error(`Invalid color value ${JSON.stringify(color)}`, 'palette > common > paletteSuperUtils > genHues > analogous()');
            return [];
        }
        const clonedColor = core.base.clone(color);
        const analogousHues = [];
        const baseHue = clonedColor.value.hue;
        const maxTotalDistance = 60;
        const minTotalDistance = Math.max(20, 10 + (numBoxes - 2) * 12);
        const totalIncrement = Math.floor(Math.random() * (maxTotalDistance - minTotalDistance + 1)) + minTotalDistance;
        const increment = Math.floor(totalIncrement / (numBoxes - 1));
        for (let i = 1; i < numBoxes; i++) {
            analogousHues.push((baseHue + increment * i) % 360);
        }
        return analogousHues;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating analogous hues: ${error}`, 'palette > common > paletteSuperUtils > genHues > analogous()');
        return [];
    }
}
function diadic(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        const diadicHues = [];
        const randomDistance = getWeightedRandomInterval();
        const hue1 = clonedBaseHue;
        const hue2 = (hue1 + randomDistance) % 360;
        diadicHues.push(hue1, hue2);
        return diadicHues;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating diadic hues: ${error}`, 'palette > common > paletteSuperUtils > genHues > diadic()');
        return [];
    }
}
function hexadic(color) {
    try {
        const clonedColor = core.base.clone(color);
        if (!validateColorValues(clonedColor)) {
            if (logMode.error)
                logger.error(`Invalid color value ${JSON.stringify(clonedColor)}`, 'palette > common > paletteSuperUtils > genHues > hexadic()');
            return [];
        }
        const clonedBaseHSL = genAllColorValues(clonedColor).hsl;
        if (!clonedBaseHSL) {
            if (!mode.gracefulErrors)
                throw new Error('Unable to generate hexadic hues - missing HSL values');
            else if (logMode.error)
                logger.error('Unable to generate hexadic hues - missing HSL values', 'palette > common > paletteSuperUtils > genHues > hexadic()');
            else if (!mode.quiet && logMode.verbosity > 0)
                logger.error('Error generating hexadic hues', 'palette > common > paletteSuperUtils > genHues > hexadic()');
            return [];
        }
        const hexadicHues = [];
        const baseHue = clonedBaseHSL.value.hue;
        const hue1 = baseHue;
        const hue2 = (hue1 + 180) % 360;
        const randomDistance = Math.floor(Math.random() * 61 + 30);
        const hue3 = (hue1 + randomDistance) % 360;
        const hue4 = (hue3 + 180) % 360;
        const hue5 = (hue1 + 360 - randomDistance) % 360;
        const hue6 = (hue5 + 180) % 360;
        hexadicHues.push(hue1, hue2, hue3, hue4, hue5, hue6);
        return hexadicHues;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating hexadic hues: ${error}`, 'palette > common > paletteSuperUtils > genHues > hexadic()');
        return [];
    }
}
function splitComplementary(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        const modifier = Math.floor(Math.random() * 11) + 20;
        return [
            (clonedBaseHue + 180 + modifier) % 360,
            (clonedBaseHue + 180 - modifier + 360) % 360
        ];
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating split complementary hues: ${error}`, 'palette > common > paletteSuperUtils > genHues > splitComplementary()');
        return [];
    }
}
function tetradic(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        const randomOffset = Math.floor(Math.random() * 46) + 20;
        const distance = 90 + (Math.random() < 0.5 ? -randomOffset : randomOffset);
        return [
            clonedBaseHue,
            (clonedBaseHue + 180) % 360,
            (clonedBaseHue + distance) % 360,
            (clonedBaseHue + distance + 180) % 360
        ];
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating tetradic hues: ${error}`);
        return [];
    }
}
function triadic(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        return [120, 240].map(increment => (clonedBaseHue + increment) % 360);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating triadic hues: ${error}`);
        return [];
    }
}
export const genHues = {
    analogous,
    diadic,
    hexadic,
    splitComplementary,
    tetradic,
    triadic
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuSHVlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wYWxldHRlL2NvbW1vbi9wYWxldHRlU3VwZXJVdGlscy9nZW5IdWVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHdEQUF3RDtBQUd4RCxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN4RCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDcEQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXhELE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxFQUFFLENBQUM7QUFFcEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUU3QixNQUFNLGlCQUFpQixHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsaUJBQWlCLENBQUM7QUFDN0QsTUFBTSx5QkFBeUIsR0FDOUIsWUFBWSxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQztBQUNwRCxNQUFNLG1CQUFtQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDO0FBRXRELFNBQVMsU0FBUyxDQUFDLEtBQVUsRUFBRSxRQUFnQjtJQUM5QyxJQUFJLENBQUM7UUFDSixJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNqQyxJQUFJLE9BQU8sQ0FBQyxLQUFLO2dCQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLHVCQUF1QixJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsOERBQThELENBQUMsQ0FBQztZQUU5SCxPQUFPLEVBQUUsQ0FBQztRQUNYLENBQUM7UUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQVEsQ0FB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QyxZQUFZLENBQUMsQ0FBQztRQUUzRCxPQUFPO1lBQ04sYUFBYTtZQUNiLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUc7WUFDM0IsQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFDLEdBQUcsR0FBRztZQUNoQyxDQUFDLGFBQWEsR0FBRyxRQUFRLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRztTQUN0QyxDQUFDO0lBQ0gsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxPQUFPLENBQUMsS0FBSztZQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLG1DQUFtQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBRTFELE9BQU8sRUFBRSxDQUFDO0lBQ1gsQ0FBQztBQUNGLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxPQUFlO0lBQy9CLElBQUksQ0FBQztRQUNKLE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRS9DLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxhQUFhLEdBQUcsU0FBUyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDdkUsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxPQUFPLENBQUMsS0FBSztZQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBRXpELE9BQU8sRUFBRSxDQUFDO0lBQ1gsQ0FBQztBQUNGLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUc7SUFDdEIsU0FBUztJQUNULE1BQU07SUFDTixPQUFPO0lBQ1Asa0JBQWtCO0lBQ2xCLFFBQVE7SUFDUixPQUFPO0NBQ0UsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IHNyYy9wYWxldHRlL2NvbW1vbi9wYWxldHRlU3VwZXJVdGlscy9nZW5IdWVzLmpzXG5cbmltcG9ydCB7IEhTTCB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGNvcmUsIHV0aWxzIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2luZGV4LmpzJztcbmltcG9ydCB7IGNyZWF0ZUxvZ2dlciB9IGZyb20gJy4uLy4uLy4uL2xvZ2dlci9pbmRleC5qcyc7XG5pbXBvcnQgeyBtb2RlIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2RhdGEvYmFzZS5qcyc7XG5pbXBvcnQgeyBwYWxldHRlVXRpbHMgfSBmcm9tICcuLi9wYWxldHRlVXRpbHMvaW5kZXguanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxuY29uc3QgbG9nTW9kZSA9IG1vZGUubG9nZ2luZztcblxuY29uc3QgZ2VuQWxsQ29sb3JWYWx1ZXMgPSB1dGlscy5jb252ZXJzaW9uLmdlbkFsbENvbG9yVmFsdWVzO1xuY29uc3QgZ2V0V2VpZ2h0ZWRSYW5kb21JbnRlcnZhbCA9XG5cdHBhbGV0dGVVdGlscy5wcm9iYWJpbGl0eS5nZXRXZWlnaHRlZFJhbmRvbUludGVydmFsO1xuY29uc3QgdmFsaWRhdGVDb2xvclZhbHVlcyA9IGNvcmUudmFsaWRhdGUuY29sb3JWYWx1ZXM7XG5cbmZ1bmN0aW9uIGFuYWxvZ291cyhjb2xvcjogSFNMLCBudW1Cb3hlczogbnVtYmVyKTogbnVtYmVyW10ge1xuXHR0cnkge1xuXHRcdGlmICghdmFsaWRhdGVDb2xvclZhbHVlcyhjb2xvcikpIHtcblx0XHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0XHRsb2dnZXIuZXJyb3IoYEludmFsaWQgY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShjb2xvcil9YCwgJ3BhbGV0dGUgPiBjb21tb24gPiBwYWxldHRlU3VwZXJVdGlscyA+IGdlbkh1ZXMgPiBhbmFsb2dvdXMoKScpO1xuXG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXG5cdFx0Y29uc3QgY2xvbmVkQ29sb3IgPSBjb3JlLmJhc2UuY2xvbmUoY29sb3IpIGFzIEhTTDtcblxuXHRcdGNvbnN0IGFuYWxvZ291c0h1ZXM6IG51bWJlcltdID0gW107XG5cdFx0Y29uc3QgYmFzZUh1ZSA9IGNsb25lZENvbG9yLnZhbHVlLmh1ZTtcblx0XHRjb25zdCBtYXhUb3RhbERpc3RhbmNlID0gNjA7XG5cdFx0Y29uc3QgbWluVG90YWxEaXN0YW5jZSA9IE1hdGgubWF4KDIwLCAxMCArIChudW1Cb3hlcyAtIDIpICogMTIpO1xuXHRcdGNvbnN0IHRvdGFsSW5jcmVtZW50ID1cblx0XHRcdE1hdGguZmxvb3IoXG5cdFx0XHRcdE1hdGgucmFuZG9tKCkgKiAobWF4VG90YWxEaXN0YW5jZSAtIG1pblRvdGFsRGlzdGFuY2UgKyAxKVxuXHRcdFx0KSArIG1pblRvdGFsRGlzdGFuY2U7XG5cdFx0Y29uc3QgaW5jcmVtZW50ID0gTWF0aC5mbG9vcih0b3RhbEluY3JlbWVudCAvIChudW1Cb3hlcyAtIDEpKTtcblxuXHRcdGZvciAobGV0IGkgPSAxOyBpIDwgbnVtQm94ZXM7IGkrKykge1xuXHRcdFx0YW5hbG9nb3VzSHVlcy5wdXNoKChiYXNlSHVlICsgaW5jcmVtZW50ICogaSkgJSAzNjApO1xuXHRcdH1cblxuXHRcdHJldHVybiBhbmFsb2dvdXNIdWVzO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIGFuYWxvZ291cyBodWVzOiAke2Vycm9yfWAsICdwYWxldHRlID4gY29tbW9uID4gcGFsZXR0ZVN1cGVyVXRpbHMgPiBnZW5IdWVzID4gYW5hbG9nb3VzKCknKTtcblxuXHRcdHJldHVybiBbXTtcblx0fVxufVxuXG5mdW5jdGlvbiBkaWFkaWMoYmFzZUh1ZTogbnVtYmVyKTogbnVtYmVyW10ge1xuXHR0cnkge1xuXHRcdGNvbnN0IGNsb25lZEJhc2VIdWUgPSBjb3JlLmJhc2UuY2xvbmUoYmFzZUh1ZSk7XG5cdFx0Y29uc3QgZGlhZGljSHVlcyA9IFtdO1xuXHRcdGNvbnN0IHJhbmRvbURpc3RhbmNlID0gZ2V0V2VpZ2h0ZWRSYW5kb21JbnRlcnZhbCgpO1xuXHRcdGNvbnN0IGh1ZTEgPSBjbG9uZWRCYXNlSHVlO1xuXHRcdGNvbnN0IGh1ZTIgPSAoaHVlMSArIHJhbmRvbURpc3RhbmNlKSAlIDM2MDtcblxuXHRcdGRpYWRpY0h1ZXMucHVzaChodWUxLCBodWUyKTtcblxuXHRcdHJldHVybiBkaWFkaWNIdWVzO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIGRpYWRpYyBodWVzOiAke2Vycm9yfWAsICdwYWxldHRlID4gY29tbW9uID4gcGFsZXR0ZVN1cGVyVXRpbHMgPiBnZW5IdWVzID4gZGlhZGljKCknKTtcblxuXHRcdHJldHVybiBbXTtcblx0fVxufVxuXG5mdW5jdGlvbiBoZXhhZGljKGNvbG9yOiBIU0wpOiBudW1iZXJbXSB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgY2xvbmVkQ29sb3IgPSBjb3JlLmJhc2UuY2xvbmUoY29sb3IpO1xuXG5cdFx0aWYgKCF2YWxpZGF0ZUNvbG9yVmFsdWVzKGNsb25lZENvbG9yKSkge1xuXHRcdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHRgSW52YWxpZCBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGNsb25lZENvbG9yKX1gLFxuXHRcdFx0XHRcdCdwYWxldHRlID4gY29tbW9uID4gcGFsZXR0ZVN1cGVyVXRpbHMgPiBnZW5IdWVzID4gaGV4YWRpYygpJ1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXG5cdFx0Y29uc3QgY2xvbmVkQmFzZUhTTCA9IGdlbkFsbENvbG9yVmFsdWVzKGNsb25lZENvbG9yKS5oc2wgYXMgSFNMO1xuXG5cdFx0aWYgKCFjbG9uZWRCYXNlSFNMKSB7XG5cdFx0XHRpZiAoIW1vZGUuZ3JhY2VmdWxFcnJvcnMpXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHQnVW5hYmxlIHRvIGdlbmVyYXRlIGhleGFkaWMgaHVlcyAtIG1pc3NpbmcgSFNMIHZhbHVlcydcblx0XHRcdFx0KTtcblx0XHRcdGVsc2UgaWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHQnVW5hYmxlIHRvIGdlbmVyYXRlIGhleGFkaWMgaHVlcyAtIG1pc3NpbmcgSFNMIHZhbHVlcycsXG5cdFx0XHRcdFx0J3BhbGV0dGUgPiBjb21tb24gPiBwYWxldHRlU3VwZXJVdGlscyA+IGdlbkh1ZXMgPiBoZXhhZGljKCknXG5cdFx0XHRcdCk7XG5cdFx0XHRlbHNlIGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDApXG5cdFx0XHRcdGxvZ2dlci5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBoZXhhZGljIGh1ZXMnLCAncGFsZXR0ZSA+IGNvbW1vbiA+IHBhbGV0dGVTdXBlclV0aWxzID4gZ2VuSHVlcyA+IGhleGFkaWMoKScpO1xuXG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXG5cdFx0Y29uc3QgaGV4YWRpY0h1ZXM6IG51bWJlcltdID0gW107XG5cdFx0Y29uc3QgYmFzZUh1ZSA9IGNsb25lZEJhc2VIU0wudmFsdWUuaHVlO1xuXHRcdGNvbnN0IGh1ZTEgPSBiYXNlSHVlO1xuXHRcdGNvbnN0IGh1ZTIgPSAoaHVlMSArIDE4MCkgJSAzNjA7XG5cdFx0Y29uc3QgcmFuZG9tRGlzdGFuY2UgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2MSArIDMwKTtcblx0XHRjb25zdCBodWUzID0gKGh1ZTEgKyByYW5kb21EaXN0YW5jZSkgJSAzNjA7XG5cdFx0Y29uc3QgaHVlNCA9IChodWUzICsgMTgwKSAlIDM2MDtcblx0XHRjb25zdCBodWU1ID0gKGh1ZTEgKyAzNjAgLSByYW5kb21EaXN0YW5jZSkgJSAzNjA7XG5cdFx0Y29uc3QgaHVlNiA9IChodWU1ICsgMTgwKSAlIDM2MDtcblxuXHRcdGhleGFkaWNIdWVzLnB1c2goaHVlMSwgaHVlMiwgaHVlMywgaHVlNCwgaHVlNSwgaHVlNik7XG5cblx0XHRyZXR1cm4gaGV4YWRpY0h1ZXM7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgaGV4YWRpYyBodWVzOiAke2Vycm9yfWAsICdwYWxldHRlID4gY29tbW9uID4gcGFsZXR0ZVN1cGVyVXRpbHMgPiBnZW5IdWVzID4gaGV4YWRpYygpJyk7XG5cblx0XHRyZXR1cm4gW107XG5cdH1cbn1cblxuZnVuY3Rpb24gc3BsaXRDb21wbGVtZW50YXJ5KGJhc2VIdWU6IG51bWJlcik6IG51bWJlcltdIHtcblx0dHJ5IHtcblx0XHRjb25zdCBjbG9uZWRCYXNlSHVlID0gY29yZS5iYXNlLmNsb25lKGJhc2VIdWUpO1xuXHRcdGNvbnN0IG1vZGlmaWVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTEpICsgMjA7XG5cblx0XHRyZXR1cm4gW1xuXHRcdFx0KGNsb25lZEJhc2VIdWUgKyAxODAgKyBtb2RpZmllcikgJSAzNjAsXG5cdFx0XHQoY2xvbmVkQmFzZUh1ZSArIDE4MCAtIG1vZGlmaWVyICsgMzYwKSAlIDM2MFxuXHRcdF07XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgc3BsaXQgY29tcGxlbWVudGFyeSBodWVzOiAke2Vycm9yfWAsICdwYWxldHRlID4gY29tbW9uID4gcGFsZXR0ZVN1cGVyVXRpbHMgPiBnZW5IdWVzID4gc3BsaXRDb21wbGVtZW50YXJ5KCknKTtcblxuXHRcdHJldHVybiBbXTtcblx0fVxufVxuXG5mdW5jdGlvbiB0ZXRyYWRpYyhiYXNlSHVlOiBudW1iZXIpOiBudW1iZXJbXSB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgY2xvbmVkQmFzZUh1ZSA9IGNvcmUuYmFzZS5jbG9uZShiYXNlSHVlKTtcblx0XHRjb25zdCByYW5kb21PZmZzZXQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA0NikgKyAyMDtcblx0XHRjb25zdCBkaXN0YW5jZSA9XG5cdFx0XHQ5MCArIChNYXRoLnJhbmRvbSgpIDwgMC41ID8gLXJhbmRvbU9mZnNldCA6IHJhbmRvbU9mZnNldCk7XG5cblx0XHRyZXR1cm4gW1xuXHRcdFx0Y2xvbmVkQmFzZUh1ZSxcblx0XHRcdChjbG9uZWRCYXNlSHVlICsgMTgwKSAlIDM2MCxcblx0XHRcdChjbG9uZWRCYXNlSHVlICsgZGlzdGFuY2UpICUgMzYwLFxuXHRcdFx0KGNsb25lZEJhc2VIdWUgKyBkaXN0YW5jZSArIDE4MCkgJSAzNjBcblx0XHRdO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIHRldHJhZGljIGh1ZXM6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gW107XG5cdH1cbn1cblxuZnVuY3Rpb24gdHJpYWRpYyhiYXNlSHVlOiBudW1iZXIpOiBudW1iZXJbXSB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgY2xvbmVkQmFzZUh1ZSA9IGNvcmUuYmFzZS5jbG9uZShiYXNlSHVlKTtcblxuXHRcdHJldHVybiBbMTIwLCAyNDBdLm1hcChpbmNyZW1lbnQgPT4gKGNsb25lZEJhc2VIdWUgKyBpbmNyZW1lbnQpICUgMzYwKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyB0cmlhZGljIGh1ZXM6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gW107XG5cdH1cbn1cblxuZXhwb3J0IGNvbnN0IGdlbkh1ZXMgPSB7XG5cdGFuYWxvZ291cyxcblx0ZGlhZGljLFxuXHRoZXhhZGljLFxuXHRzcGxpdENvbXBsZW1lbnRhcnksXG5cdHRldHJhZGljLFxuXHR0cmlhZGljXG59IGFzIGNvbnN0O1xuIl19