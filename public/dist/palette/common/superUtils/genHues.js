// File: palette/common/superUtils/genHues.js
import { coreUtils, utils } from '../../../common/index.js';
import { createLogger } from '../../../logger/index.js';
import { modeData as mode } from '../../../data/mode.js';
import { utils as paletteUtils } from '../utils/index.js';
const logMode = mode.logging;
const thisModule = 'palette/common/superUtils/genHues.js';
const logger = await createLogger();
const genAllColorValues = utils.conversion.genAllColorValues;
const getWeightedRandomInterval = paletteUtils.probability.getWeightedRandomInterval;
const validateColorValues = coreUtils.validate.colorValues;
function analogous(color, numBoxes) {
    const thisFunction = 'analogous()';
    try {
        if (!validateColorValues(color)) {
            if (logMode.error)
                logger.error(`Invalid color value ${JSON.stringify(color)}`, `${thisModule} > ${thisFunction}`);
            return [];
        }
        const clonedColor = coreUtils.base.clone(color);
        const analogousHues = [];
        const baseHue = clonedColor.value.hue;
        const maxTotalDistance = 60;
        const minTotalDistance = Math.max(20, 10 + (numBoxes - 2) * 12);
        const totalIncrement = Math.floor(Math.random() * (maxTotalDistance - minTotalDistance + 1)) + minTotalDistance;
        const increment = Math.floor(totalIncrement / (numBoxes - 1));
        for (let i = 1; i < numBoxes; i++) {
            analogousHues.push((baseHue + increment * i) % 360);
        }
        return analogousHues;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating analogous hues: ${error}`, `${thisModule} > ${thisFunction}`);
        return [];
    }
}
function diadic(baseHue) {
    const thisFunction = 'diadic()';
    try {
        const clonedBaseHue = coreUtils.base.clone(baseHue);
        const diadicHues = [];
        const randomDistance = getWeightedRandomInterval();
        const hue1 = clonedBaseHue;
        const hue2 = (hue1 + randomDistance) % 360;
        diadicHues.push(hue1, hue2);
        return diadicHues;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating diadic hues: ${error}`, `${thisModule} > ${thisFunction}`);
        return [];
    }
}
function hexadic(color) {
    const thisFunction = 'hexadic()';
    try {
        const clonedColor = coreUtils.base.clone(color);
        if (!validateColorValues(clonedColor)) {
            if (logMode.error)
                logger.error(`Invalid color value ${JSON.stringify(clonedColor)}`, `${thisModule} > ${thisFunction}`);
            return [];
        }
        const clonedBaseHSL = genAllColorValues(clonedColor).hsl;
        if (!clonedBaseHSL) {
            if (!mode.gracefulErrors)
                throw new Error('Unable to generate hexadic hues - missing HSL values');
            else if (logMode.error)
                logger.error('Unable to generate hexadic hues - missing HSL values', `${thisModule} > ${thisFunction}`);
            else if (!mode.quiet && logMode.verbosity > 0)
                logger.error('Error generating hexadic hues', `${thisModule} > ${thisFunction}`);
            return [];
        }
        const hexadicHues = [];
        const baseHue = clonedBaseHSL.value.hue;
        const hue1 = baseHue;
        const hue2 = (hue1 + 180) % 360;
        const randomDistance = Math.floor(Math.random() * 61 + 30);
        const hue3 = (hue1 + randomDistance) % 360;
        const hue4 = (hue3 + 180) % 360;
        const hue5 = (hue1 + 360 - randomDistance) % 360;
        const hue6 = (hue5 + 180) % 360;
        hexadicHues.push(hue1, hue2, hue3, hue4, hue5, hue6);
        return hexadicHues;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating hexadic hues: ${error}`, `${thisModule} > ${thisFunction}`);
        return [];
    }
}
function splitComplementary(baseHue) {
    const thisFunction = 'splitComplementary()';
    try {
        const clonedBaseHue = coreUtils.base.clone(baseHue);
        const modifier = Math.floor(Math.random() * 11) + 20;
        return [
            (clonedBaseHue + 180 + modifier) % 360,
            (clonedBaseHue + 180 - modifier + 360) % 360
        ];
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating split complementary hues: ${error}`, `${thisModule} > ${thisFunction}`);
        return [];
    }
}
function tetradic(baseHue) {
    const thisFunction = 'tetradic()';
    try {
        const clonedBaseHue = coreUtils.base.clone(baseHue);
        const randomOffset = Math.floor(Math.random() * 46) + 20;
        const distance = 90 + (Math.random() < 0.5 ? -randomOffset : randomOffset);
        return [
            clonedBaseHue,
            (clonedBaseHue + 180) % 360,
            (clonedBaseHue + distance) % 360,
            (clonedBaseHue + distance + 180) % 360
        ];
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating tetradic hues: ${error}`, `${thisModule} > ${thisFunction}`);
        return [];
    }
}
function triadic(baseHue) {
    const thisFunction = 'triadic()';
    try {
        const clonedBaseHue = coreUtils.base.clone(baseHue);
        return [120, 240].map(increment => (clonedBaseHue + increment) % 360);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error generating triadic hues: ${error}`, `${thisModule} > ${thisFunction}`);
        return [];
    }
}
export const genHues = {
    analogous,
    diadic,
    hexadic,
    splitComplementary,
    tetradic,
    triadic
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuSHVlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wYWxldHRlL2NvbW1vbi9zdXBlclV0aWxzL2dlbkh1ZXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNkNBQTZDO0FBRzdDLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDNUQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3hELE9BQU8sRUFBRSxRQUFRLElBQUksSUFBSSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDekQsT0FBTyxFQUFFLEtBQUssSUFBSSxZQUFZLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUUxRCxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBQzdCLE1BQU0sVUFBVSxHQUFHLHNDQUFzQyxDQUFDO0FBRTFELE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxFQUFFLENBQUM7QUFFcEMsTUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDO0FBQzdELE1BQU0seUJBQXlCLEdBQzlCLFlBQVksQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUM7QUFDcEQsTUFBTSxtQkFBbUIsR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztBQUUzRCxTQUFTLFNBQVMsQ0FBQyxLQUFVLEVBQUUsUUFBZ0I7SUFDOUMsTUFBTSxZQUFZLEdBQUcsYUFBYSxDQUFDO0lBRW5DLElBQUksQ0FBQztRQUNKLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ2pDLElBQUksT0FBTyxDQUFDLEtBQUs7Z0JBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsdUJBQXVCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFDOUMsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7WUFFSCxPQUFPLEVBQUUsQ0FBQztRQUNYLENBQUM7UUFFRCxNQUFNLFdBQVcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQVEsQ0FBQztRQUV2RCxNQUFNLGFBQWEsR0FBYSxFQUFFLENBQUM7UUFDbkMsTUFBTSxPQUFPLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7UUFDdEMsTUFBTSxnQkFBZ0IsR0FBRyxFQUFFLENBQUM7UUFDNUIsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDaEUsTUFBTSxjQUFjLEdBQ25CLElBQUksQ0FBQyxLQUFLLENBQ1QsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsZ0JBQWdCLEdBQUcsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDLENBQ3pELEdBQUcsZ0JBQWdCLENBQUM7UUFDdEIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLEdBQUcsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUU5RCxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDbkMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sR0FBRyxTQUFTLEdBQUcsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDckQsQ0FBQztRQUVELE9BQU8sYUFBYSxDQUFDO0lBQ3RCLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLElBQUksT0FBTyxDQUFDLEtBQUs7WUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FDWCxvQ0FBb0MsS0FBSyxFQUFFLEVBQzNDLEdBQUcsVUFBVSxNQUFNLFlBQVksRUFBRSxDQUNqQyxDQUFDO1FBRUgsT0FBTyxFQUFFLENBQUM7SUFDWCxDQUFDO0FBQ0YsQ0FBQztBQUVELFNBQVMsTUFBTSxDQUFDLE9BQWU7SUFDOUIsTUFBTSxZQUFZLEdBQUcsVUFBVSxDQUFDO0lBRWhDLElBQUksQ0FBQztRQUNKLE1BQU0sYUFBYSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3BELE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUN0QixNQUFNLGNBQWMsR0FBRyx5QkFBeUIsRUFBRSxDQUFDO1FBQ25ELE1BQU0sSUFBSSxHQUFHLGFBQWEsQ0FBQztRQUMzQixNQUFNLElBQUksR0FBRyxDQUFDLElBQUksR0FBRyxjQUFjLENBQUMsR0FBRyxHQUFHLENBQUM7UUFFM0MsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFNUIsT0FBTyxVQUFVLENBQUM7SUFDbkIsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxPQUFPLENBQUMsS0FBSztZQUNoQixNQUFNLENBQUMsS0FBSyxDQUNYLGlDQUFpQyxLQUFLLEVBQUUsRUFDeEMsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7UUFFSCxPQUFPLEVBQUUsQ0FBQztJQUNYLENBQUM7QUFDRixDQUFDO0FBRUQsU0FBUyxPQUFPLENBQUMsS0FBVTtJQUMxQixNQUFNLFlBQVksR0FBRyxXQUFXLENBQUM7SUFFakMsSUFBSSxDQUFDO1FBQ0osTUFBTSxXQUFXLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFaEQsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7WUFDdkMsSUFBSSxPQUFPLENBQUMsS0FBSztnQkFDaEIsTUFBTSxDQUFDLEtBQUssQ0FDWCx1QkFBdUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsRUFBRSxFQUNwRCxHQUFHLFVBQVUsTUFBTSxZQUFZLEVBQUUsQ0FDakMsQ0FBQztZQUVILE9BQU8sRUFBRSxDQUFDO1FBQ1gsQ0FBQztRQUVELE1BQU0sYUFBYSxHQUFHLGlCQUFpQixDQUFDLFdBQVcsQ0FBQyxDQUFDLEdBQVUsQ0FBQztRQUVoRSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjO2dCQUN2QixNQUFNLElBQUksS0FBSyxDQUNkLHNEQUFzRCxDQUN0RCxDQUFDO2lCQUNFLElBQUksT0FBTyxDQUFDLEtBQUs7Z0JBQ3JCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsc0RBQXNELEVBQ3RELEdBQUcsVUFBVSxNQUFNLFlBQVksRUFBRSxDQUNqQyxDQUFDO2lCQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxTQUFTLEdBQUcsQ0FBQztnQkFDNUMsTUFBTSxDQUFDLEtBQUssQ0FDWCwrQkFBK0IsRUFDL0IsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7WUFFSCxPQUFPLEVBQUUsQ0FBQztRQUNYLENBQUM7UUFFRCxNQUFNLFdBQVcsR0FBYSxFQUFFLENBQUM7UUFDakMsTUFBTSxPQUFPLEdBQUcsYUFBYSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7UUFDeEMsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDO1FBQ3JCLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUNoQyxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDM0QsTUFBTSxJQUFJLEdBQUcsQ0FBQyxJQUFJLEdBQUcsY0FBYyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQzNDLE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUNoQyxNQUFNLElBQUksR0FBRyxDQUFDLElBQUksR0FBRyxHQUFHLEdBQUcsY0FBYyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ2pELE1BQU0sSUFBSSxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUVoQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFFckQsT0FBTyxXQUFXLENBQUM7SUFDcEIsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxPQUFPLENBQUMsS0FBSztZQUNoQixNQUFNLENBQUMsS0FBSyxDQUNYLGtDQUFrQyxLQUFLLEVBQUUsRUFDekMsR0FBRyxVQUFVLE1BQU0sWUFBWSxFQUFFLENBQ2pDLENBQUM7UUFFSCxPQUFPLEVBQUUsQ0FBQztJQUNYLENBQUM7QUFDRixDQUFDO0FBRUQsU0FBUyxrQkFBa0IsQ0FBQyxPQUFlO0lBQzFDLE1BQU0sWUFBWSxHQUFHLHNCQUFzQixDQUFDO0lBRTVDLElBQUksQ0FBQztRQUNKLE1BQU0sYUFBYSxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3BELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUVyRCxPQUFPO1lBQ04sQ0FBQyxhQUFhLEdBQUcsR0FBRyxHQUFHLFFBQVEsQ0FBQyxHQUFHLEdBQUc7WUFDdEMsQ0FBQyxhQUFhLEdBQUcsR0FBRyxHQUFHLFFBQVEsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHO1NBQzVDLENBQUM7SUFDSCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLE9BQU8sQ0FBQyxLQUFLO1lBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsOENBQThDLEtBQUssRUFBRSxFQUNyRCxHQUFHLFVBQVUsTUFBTSxZQUFZLEVBQUUsQ0FDakMsQ0FBQztRQUVILE9BQU8sRUFBRSxDQUFDO0lBQ1gsQ0FBQztBQUNGLENBQUM7QUFFRCxTQUFTLFFBQVEsQ0FBQyxPQUFlO0lBQ2hDLE1BQU0sWUFBWSxHQUFHLFlBQVksQ0FBQztJQUVsQyxJQUFJLENBQUM7UUFDSixNQUFNLGFBQWEsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNwRCxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDekQsTUFBTSxRQUFRLEdBQ2IsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRTNELE9BQU87WUFDTixhQUFhO1lBQ2IsQ0FBQyxhQUFhLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRztZQUMzQixDQUFDLGFBQWEsR0FBRyxRQUFRLENBQUMsR0FBRyxHQUFHO1lBQ2hDLENBQUMsYUFBYSxHQUFHLFFBQVEsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHO1NBQ3RDLENBQUM7SUFDSCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLE9BQU8sQ0FBQyxLQUFLO1lBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsbUNBQW1DLEtBQUssRUFBRSxFQUMxQyxHQUFHLFVBQVUsTUFBTSxZQUFZLEVBQUUsQ0FDakMsQ0FBQztRQUVILE9BQU8sRUFBRSxDQUFDO0lBQ1gsQ0FBQztBQUNGLENBQUM7QUFFRCxTQUFTLE9BQU8sQ0FBQyxPQUFlO0lBQy9CLE1BQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQztJQUVqQyxJQUFJLENBQUM7UUFDSixNQUFNLGFBQWEsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUVwRCxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLElBQUksT0FBTyxDQUFDLEtBQUs7WUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FDWCxrQ0FBa0MsS0FBSyxFQUFFLEVBQ3pDLEdBQUcsVUFBVSxNQUFNLFlBQVksRUFBRSxDQUNqQyxDQUFDO1FBRUgsT0FBTyxFQUFFLENBQUM7SUFDWCxDQUFDO0FBQ0YsQ0FBQztBQUVELE1BQU0sQ0FBQyxNQUFNLE9BQU8sR0FBRztJQUN0QixTQUFTO0lBQ1QsTUFBTTtJQUNOLE9BQU87SUFDUCxrQkFBa0I7SUFDbEIsUUFBUTtJQUNSLE9BQU87Q0FDRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogcGFsZXR0ZS9jb21tb24vc3VwZXJVdGlscy9nZW5IdWVzLmpzXG5cbmltcG9ydCB7IEhTTCB9IGZyb20gJy4uLy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGNvcmVVdGlscywgdXRpbHMgfSBmcm9tICcuLi8uLi8uLi9jb21tb24vaW5kZXguanMnO1xuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnLi4vLi4vLi4vbG9nZ2VyL2luZGV4LmpzJztcbmltcG9ydCB7IG1vZGVEYXRhIGFzIG1vZGUgfSBmcm9tICcuLi8uLi8uLi9kYXRhL21vZGUuanMnO1xuaW1wb3J0IHsgdXRpbHMgYXMgcGFsZXR0ZVV0aWxzIH0gZnJvbSAnLi4vdXRpbHMvaW5kZXguanMnO1xuXG5jb25zdCBsb2dNb2RlID0gbW9kZS5sb2dnaW5nO1xuY29uc3QgdGhpc01vZHVsZSA9ICdwYWxldHRlL2NvbW1vbi9zdXBlclV0aWxzL2dlbkh1ZXMuanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxuY29uc3QgZ2VuQWxsQ29sb3JWYWx1ZXMgPSB1dGlscy5jb252ZXJzaW9uLmdlbkFsbENvbG9yVmFsdWVzO1xuY29uc3QgZ2V0V2VpZ2h0ZWRSYW5kb21JbnRlcnZhbCA9XG5cdHBhbGV0dGVVdGlscy5wcm9iYWJpbGl0eS5nZXRXZWlnaHRlZFJhbmRvbUludGVydmFsO1xuY29uc3QgdmFsaWRhdGVDb2xvclZhbHVlcyA9IGNvcmVVdGlscy52YWxpZGF0ZS5jb2xvclZhbHVlcztcblxuZnVuY3Rpb24gYW5hbG9nb3VzKGNvbG9yOiBIU0wsIG51bUJveGVzOiBudW1iZXIpOiBudW1iZXJbXSB7XG5cdGNvbnN0IHRoaXNGdW5jdGlvbiA9ICdhbmFsb2dvdXMoKSc7XG5cblx0dHJ5IHtcblx0XHRpZiAoIXZhbGlkYXRlQ29sb3JWYWx1ZXMoY29sb3IpKSB7XG5cdFx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRcdGBJbnZhbGlkIGNvbG9yIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoY29sb3IpfWAsXG5cdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHRjb25zdCBjbG9uZWRDb2xvciA9IGNvcmVVdGlscy5iYXNlLmNsb25lKGNvbG9yKSBhcyBIU0w7XG5cblx0XHRjb25zdCBhbmFsb2dvdXNIdWVzOiBudW1iZXJbXSA9IFtdO1xuXHRcdGNvbnN0IGJhc2VIdWUgPSBjbG9uZWRDb2xvci52YWx1ZS5odWU7XG5cdFx0Y29uc3QgbWF4VG90YWxEaXN0YW5jZSA9IDYwO1xuXHRcdGNvbnN0IG1pblRvdGFsRGlzdGFuY2UgPSBNYXRoLm1heCgyMCwgMTAgKyAobnVtQm94ZXMgLSAyKSAqIDEyKTtcblx0XHRjb25zdCB0b3RhbEluY3JlbWVudCA9XG5cdFx0XHRNYXRoLmZsb29yKFxuXHRcdFx0XHRNYXRoLnJhbmRvbSgpICogKG1heFRvdGFsRGlzdGFuY2UgLSBtaW5Ub3RhbERpc3RhbmNlICsgMSlcblx0XHRcdCkgKyBtaW5Ub3RhbERpc3RhbmNlO1xuXHRcdGNvbnN0IGluY3JlbWVudCA9IE1hdGguZmxvb3IodG90YWxJbmNyZW1lbnQgLyAobnVtQm94ZXMgLSAxKSk7XG5cblx0XHRmb3IgKGxldCBpID0gMTsgaSA8IG51bUJveGVzOyBpKyspIHtcblx0XHRcdGFuYWxvZ291c0h1ZXMucHVzaCgoYmFzZUh1ZSArIGluY3JlbWVudCAqIGkpICUgMzYwKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gYW5hbG9nb3VzSHVlcztcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGdlbmVyYXRpbmcgYW5hbG9nb3VzIGh1ZXM6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIFtdO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRpYWRpYyhiYXNlSHVlOiBudW1iZXIpOiBudW1iZXJbXSB7XG5cdGNvbnN0IHRoaXNGdW5jdGlvbiA9ICdkaWFkaWMoKSc7XG5cblx0dHJ5IHtcblx0XHRjb25zdCBjbG9uZWRCYXNlSHVlID0gY29yZVV0aWxzLmJhc2UuY2xvbmUoYmFzZUh1ZSk7XG5cdFx0Y29uc3QgZGlhZGljSHVlcyA9IFtdO1xuXHRcdGNvbnN0IHJhbmRvbURpc3RhbmNlID0gZ2V0V2VpZ2h0ZWRSYW5kb21JbnRlcnZhbCgpO1xuXHRcdGNvbnN0IGh1ZTEgPSBjbG9uZWRCYXNlSHVlO1xuXHRcdGNvbnN0IGh1ZTIgPSAoaHVlMSArIHJhbmRvbURpc3RhbmNlKSAlIDM2MDtcblxuXHRcdGRpYWRpY0h1ZXMucHVzaChodWUxLCBodWUyKTtcblxuXHRcdHJldHVybiBkaWFkaWNIdWVzO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRXJyb3IgZ2VuZXJhdGluZyBkaWFkaWMgaHVlczogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc0Z1bmN0aW9ufWBcblx0XHRcdCk7XG5cblx0XHRyZXR1cm4gW107XG5cdH1cbn1cblxuZnVuY3Rpb24gaGV4YWRpYyhjb2xvcjogSFNMKTogbnVtYmVyW10ge1xuXHRjb25zdCB0aGlzRnVuY3Rpb24gPSAnaGV4YWRpYygpJztcblxuXHR0cnkge1xuXHRcdGNvbnN0IGNsb25lZENvbG9yID0gY29yZVV0aWxzLmJhc2UuY2xvbmUoY29sb3IpO1xuXG5cdFx0aWYgKCF2YWxpZGF0ZUNvbG9yVmFsdWVzKGNsb25lZENvbG9yKSkge1xuXHRcdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHRgSW52YWxpZCBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGNsb25lZENvbG9yKX1gLFxuXHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzRnVuY3Rpb259YFxuXHRcdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXG5cdFx0Y29uc3QgY2xvbmVkQmFzZUhTTCA9IGdlbkFsbENvbG9yVmFsdWVzKGNsb25lZENvbG9yKS5oc2wgYXMgSFNMO1xuXG5cdFx0aWYgKCFjbG9uZWRCYXNlSFNMKSB7XG5cdFx0XHRpZiAoIW1vZGUuZ3JhY2VmdWxFcnJvcnMpXG5cdFx0XHRcdHRocm93IG5ldyBFcnJvcihcblx0XHRcdFx0XHQnVW5hYmxlIHRvIGdlbmVyYXRlIGhleGFkaWMgaHVlcyAtIG1pc3NpbmcgSFNMIHZhbHVlcydcblx0XHRcdFx0KTtcblx0XHRcdGVsc2UgaWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHQnVW5hYmxlIHRvIGdlbmVyYXRlIGhleGFkaWMgaHVlcyAtIG1pc3NpbmcgSFNMIHZhbHVlcycsXG5cdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHRcdCk7XG5cdFx0XHRlbHNlIGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDApXG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHQnRXJyb3IgZ2VuZXJhdGluZyBoZXhhZGljIGh1ZXMnLFxuXHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzRnVuY3Rpb259YFxuXHRcdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXG5cdFx0Y29uc3QgaGV4YWRpY0h1ZXM6IG51bWJlcltdID0gW107XG5cdFx0Y29uc3QgYmFzZUh1ZSA9IGNsb25lZEJhc2VIU0wudmFsdWUuaHVlO1xuXHRcdGNvbnN0IGh1ZTEgPSBiYXNlSHVlO1xuXHRcdGNvbnN0IGh1ZTIgPSAoaHVlMSArIDE4MCkgJSAzNjA7XG5cdFx0Y29uc3QgcmFuZG9tRGlzdGFuY2UgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2MSArIDMwKTtcblx0XHRjb25zdCBodWUzID0gKGh1ZTEgKyByYW5kb21EaXN0YW5jZSkgJSAzNjA7XG5cdFx0Y29uc3QgaHVlNCA9IChodWUzICsgMTgwKSAlIDM2MDtcblx0XHRjb25zdCBodWU1ID0gKGh1ZTEgKyAzNjAgLSByYW5kb21EaXN0YW5jZSkgJSAzNjA7XG5cdFx0Y29uc3QgaHVlNiA9IChodWU1ICsgMTgwKSAlIDM2MDtcblxuXHRcdGhleGFkaWNIdWVzLnB1c2goaHVlMSwgaHVlMiwgaHVlMywgaHVlNCwgaHVlNSwgaHVlNik7XG5cblx0XHRyZXR1cm4gaGV4YWRpY0h1ZXM7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBnZW5lcmF0aW5nIGhleGFkaWMgaHVlczogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc0Z1bmN0aW9ufWBcblx0XHRcdCk7XG5cblx0XHRyZXR1cm4gW107XG5cdH1cbn1cblxuZnVuY3Rpb24gc3BsaXRDb21wbGVtZW50YXJ5KGJhc2VIdWU6IG51bWJlcik6IG51bWJlcltdIHtcblx0Y29uc3QgdGhpc0Z1bmN0aW9uID0gJ3NwbGl0Q29tcGxlbWVudGFyeSgpJztcblxuXHR0cnkge1xuXHRcdGNvbnN0IGNsb25lZEJhc2VIdWUgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZShiYXNlSHVlKTtcblx0XHRjb25zdCBtb2RpZmllciA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDExKSArIDIwO1xuXG5cdFx0cmV0dXJuIFtcblx0XHRcdChjbG9uZWRCYXNlSHVlICsgMTgwICsgbW9kaWZpZXIpICUgMzYwLFxuXHRcdFx0KGNsb25lZEJhc2VIdWUgKyAxODAgLSBtb2RpZmllciArIDM2MCkgJSAzNjBcblx0XHRdO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRXJyb3IgZ2VuZXJhdGluZyBzcGxpdCBjb21wbGVtZW50YXJ5IGh1ZXM6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIFtdO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHRldHJhZGljKGJhc2VIdWU6IG51bWJlcik6IG51bWJlcltdIHtcblx0Y29uc3QgdGhpc0Z1bmN0aW9uID0gJ3RldHJhZGljKCknO1xuXG5cdHRyeSB7XG5cdFx0Y29uc3QgY2xvbmVkQmFzZUh1ZSA9IGNvcmVVdGlscy5iYXNlLmNsb25lKGJhc2VIdWUpO1xuXHRcdGNvbnN0IHJhbmRvbU9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQ2KSArIDIwO1xuXHRcdGNvbnN0IGRpc3RhbmNlID1cblx0XHRcdDkwICsgKE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtcmFuZG9tT2Zmc2V0IDogcmFuZG9tT2Zmc2V0KTtcblxuXHRcdHJldHVybiBbXG5cdFx0XHRjbG9uZWRCYXNlSHVlLFxuXHRcdFx0KGNsb25lZEJhc2VIdWUgKyAxODApICUgMzYwLFxuXHRcdFx0KGNsb25lZEJhc2VIdWUgKyBkaXN0YW5jZSkgJSAzNjAsXG5cdFx0XHQoY2xvbmVkQmFzZUh1ZSArIGRpc3RhbmNlICsgMTgwKSAlIDM2MFxuXHRcdF07XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBnZW5lcmF0aW5nIHRldHJhZGljIGh1ZXM6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNGdW5jdGlvbn1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIFtdO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHRyaWFkaWMoYmFzZUh1ZTogbnVtYmVyKTogbnVtYmVyW10ge1xuXHRjb25zdCB0aGlzRnVuY3Rpb24gPSAndHJpYWRpYygpJztcblxuXHR0cnkge1xuXHRcdGNvbnN0IGNsb25lZEJhc2VIdWUgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZShiYXNlSHVlKTtcblxuXHRcdHJldHVybiBbMTIwLCAyNDBdLm1hcChpbmNyZW1lbnQgPT4gKGNsb25lZEJhc2VIdWUgKyBpbmNyZW1lbnQpICUgMzYwKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGdlbmVyYXRpbmcgdHJpYWRpYyBodWVzOiAke2Vycm9yfWAsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzRnVuY3Rpb259YFxuXHRcdFx0KTtcblxuXHRcdHJldHVybiBbXTtcblx0fVxufVxuXG5leHBvcnQgY29uc3QgZ2VuSHVlcyA9IHtcblx0YW5hbG9nb3VzLFxuXHRkaWFkaWMsXG5cdGhleGFkaWMsXG5cdHNwbGl0Q29tcGxlbWVudGFyeSxcblx0dGV0cmFkaWMsXG5cdHRyaWFkaWNcbn0gYXMgY29uc3Q7XG4iXX0=