// File: core/utils/adjust.ts
import { config, defaults, paletteConfig } from '../../config/index.js';
const adjustments = paletteConfig.adjustment;
const defaultColors = defaults.colors;
const math = config.math;
export function adjustmentUtilitiesFactory(brand, services, validate) {
    const { errors, log } = services;
    function applyGammaCorrection(value) {
        return errors.handleSync(() => {
            return value > 0.0031308
                ? 1.055 * Math.pow(value, 1 / 2.4) - 0.055
                : 12.92 * value;
        }, 'Error occurred while applying gamma correction.');
    }
    function clampRGB(rgb) {
        return errors.handleSync(() => {
            const defaultRGB = defaultColors.rgb;
            if (!validate.colorValue(rgb)) {
                log.error(`Invalid RGB value ${JSON.stringify(rgb)}`, 'adjustmentUtils.clampRGB');
                return defaultRGB;
            }
            return {
                value: {
                    red: brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.red), 1) * 255)),
                    green: brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.green), 1) * 255)),
                    blue: brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.blue), 1) * 255))
                },
                format: 'rgb'
            };
        }, 'Error occurred while clamping RGB value.');
    }
    function clampXYZ(value, maxValue) {
        return errors.handleSync(() => {
            return Math.max(0, Math.min(maxValue + math.epsilon, value));
        }, 'Error occurred while clamping XYZ value.');
    }
    function normalizeXYZ(value, reference) {
        return errors.handleSync(() => {
            return value / reference;
        }, 'Error occurred while normalizing XYZ value.');
    }
    function sl(color) {
        return errors.handleSync(() => {
            if (!validate.colorValue(color)) {
                log.error('Invalid color valus for adjustment.', `adjustmentUtils.sl`);
                return color;
            }
            const adjustedSaturation = Math.min(Math.max(color.value.saturation + adjustments.slaValue, 0), 100);
            const adjustedLightness = Math.min(100);
            return {
                value: {
                    hue: color.value.hue,
                    saturation: brand.asPercentile(adjustedSaturation),
                    lightness: brand.asPercentile(adjustedLightness)
                },
                format: 'hsl'
            };
        }, 'Error occurred while adjusting saturation and lightness.');
    }
    const adjustmentUtilities = {
        applyGammaCorrection,
        clampRGB,
        clampXYZ,
        normalizeXYZ,
        sl
    };
    return errors.handleSync(() => {
        return adjustmentUtilities;
    }, 'Error occurred while creating adjustment utils.');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWRqdXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvcmUvdXRpbHMvYWRqdXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLDZCQUE2QjtBQVU3QixPQUFPLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxhQUFhLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUV4RSxNQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsVUFBVSxDQUFDO0FBQzdDLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7QUFDdEMsTUFBTSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztBQUV6QixNQUFNLFVBQVUsMEJBQTBCLENBQ3pDLEtBQXdCLEVBQ3hCLFFBQWtCLEVBQ2xCLFFBQTZCO0lBRTdCLE1BQU0sRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLEdBQUcsUUFBUSxDQUFDO0lBRWpDLFNBQVMsb0JBQW9CLENBQUMsS0FBYTtRQUMxQyxPQUFPLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFO1lBQzdCLE9BQU8sS0FBSyxHQUFHLFNBQVM7Z0JBQ3ZCLENBQUMsQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEtBQUs7Z0JBQzFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ2xCLENBQUMsRUFBRSxpREFBaUQsQ0FBQyxDQUFDO0lBQ3ZELENBQUM7SUFFRCxTQUFTLFFBQVEsQ0FBQyxHQUFRO1FBQ3pCLE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDN0IsTUFBTSxVQUFVLEdBQUcsYUFBYSxDQUFDLEdBQUcsQ0FBQztZQUVyQyxJQUFJLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUMvQixHQUFHLENBQUMsS0FBSyxDQUNSLHFCQUFxQixJQUFJLENBQUMs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LFFBQVE7UUFDUixZQUFZO1FBQ1osRUFBRTtLQUNGLENBQUM7SUFFRixPQUFPLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQzdCLE9BQU8sbUJBQW1CLENBQUM7SUFDNUIsQ0FBQyxFQUFFLGlEQUFpRCxDQUFDLENBQUM7QUFDdkQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IGNvcmUvdXRpbHMvYWRqdXN0LnRzXG5cbmltcG9ydCB7XG5cdEFkanVzdG1lbnRVdGlsaXRpZXMsXG5cdEJyYW5kaW5nVXRpbGl0aWVzLFxuXHRIU0wsXG5cdFJHQixcblx0U2VydmljZXMsXG5cdFZhbGlkYXRpb25VdGlsaXRpZXNcbn0gZnJvbSAnLi4vLi4vdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgY29uZmlnLCBkZWZhdWx0cywgcGFsZXR0ZUNvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZy9pbmRleC5qcyc7XG5cbmNvbnN0IGFkanVzdG1lbnRzID0gcGFsZXR0ZUNvbmZpZy5hZGp1c3RtZW50O1xuY29uc3QgZGVmYXVsdENvbG9ycyA9IGRlZmF1bHRzLmNvbG9ycztcbmNvbnN0IG1hdGggPSBjb25maWcubWF0aDtcblxuZXhwb3J0IGZ1bmN0aW9uIGFkanVzdG1lbnRVdGlsaXRpZXNGYWN0b3J5KFxuXHRicmFuZDogQnJhbmRpbmdVdGlsaXRpZXMsXG5cdHNlcnZpY2VzOiBTZXJ2aWNlcyxcblx0dmFsaWRhdGU6IFZhbGlkYXRpb25VdGlsaXRpZXNcbik6IEFkanVzdG1lbnRVdGlsaXRpZXMge1xuXHRjb25zdCB7IGVycm9ycywgbG9nIH0gPSBzZXJ2aWNlcztcblxuXHRmdW5jdGlvbiBhcHBseUdhbW1hQ29ycmVjdGlvbih2YWx1ZTogbnVtYmVyKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gZXJyb3JzLmhhbmRsZVN5bmMoKCkgPT4ge1xuXHRcdFx0cmV0dXJuIHZhbHVlID4gMC4wMDMxMzA4XG5cdFx0XHRcdD8gMS4wNTUgKiBNYXRoLnBvdyh2YWx1ZSwgMSAvIDIuNCkgLSAwLjA1NVxuXHRcdFx0XHQ6IDEyLjkyICogdmFsdWU7XG5cdFx0fSwgJ0Vycm9yIG9jY3VycmVkIHdoaWxlIGFwcGx5aW5nIGdhbW1hIGNvcnJlY3Rpb24uJyk7XG5cdH1cblxuXHRmdW5jdGlvbiBjbGFtcFJHQihyZ2I6IFJHQik6IFJHQiB7XG5cdFx0cmV0dXJuIGVycm9ycy5oYW5kbGVTeW5jKCgpID0+IHtcblx0XHRcdGNvbnN0IGRlZmF1bHRSR0IgPSBkZWZhdWx0Q29sb3JzLnJnYjtcblxuXHRcdFx0aWYgKCF2YWxpZGF0ZS5jb2xvclZhbHVlKHJnYikpIHtcblx0XHRcdFx0bG9nLmVycm9yKFxuXHRcdFx0XHRcdGBJbnZhbGlkIFJHQiB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHJnYil9YCxcblx0XHRcdFx0XHQnYWRqdXN0bWVudFV0aWxzLmNsYW1wUkdCJ1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRcdHJldHVybiBkZWZhdWx0UkdCO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRcdHJlZDogYnJhbmQuYXNCeXRlUmFuZ2UoXG5cdFx0XHRcdFx0XHRNYXRoLnJvdW5kKFxuXHRcdFx0XHRcdFx0XHRNYXRoLm1pbihNYXRoLm1heCgwLCByZ2IudmFsdWUucmVkKSwgMSkgKiAyNTVcblx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHQpLFxuXHRcdFx0XHRcdGdyZWVuOiBicmFuZC5hc0J5dGVSYW5nZShcblx0XHRcdFx0XHRcdE1hdGgucm91bmQoXG5cdFx0XHRcdFx0XHRcdE1hdGgubWluKE1hdGgubWF4KDAsIHJnYi52YWx1ZS5ncmVlbiksIDEpICogMjU1XG5cdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0KSxcblx0XHRcdFx0XHRibHVlOiBicmFuZC5hc0J5dGVSYW5nZShcblx0XHRcdFx0XHRcdE1hdGgucm91bmQoXG5cdFx0XHRcdFx0XHRcdE1hdGgubWluKE1hdGgubWF4KDAsIHJnYi52YWx1ZS5ibHVlKSwgMSkgKiAyNTVcblx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHQpXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGZvcm1hdDogJ3JnYidcblx0XHRcdH07XG5cdFx0fSwgJ0Vycm9yIG9jY3VycmVkIHdoaWxlIGNsYW1waW5nIFJHQiB2YWx1ZS4nKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGNsYW1wWFlaKHZhbHVlOiBudW1iZXIsIG1heFZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuXHRcdHJldHVybiBlcnJvcnMuaGFuZGxlU3luYygoKSA9PiB7XG5cdFx0XHRyZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4obWF4VmFsdWUgKyBtYXRoLmVwc2lsb24sIHZhbHVlKSk7XG5cdFx0fSwgJ0Vycm9yIG9jY3VycmVkIHdoaWxlIGNsYW1waW5nIFhZWiB2YWx1ZS4nKTtcblx0fVxuXG5cdGZ1bmN0aW9uIG5vcm1hbGl6ZVhZWih2YWx1ZTogbnVtYmVyLCByZWZlcmVuY2U6IG51bWJlcik6IG51bWJlciB7XG5cdFx0cmV0dXJuIGVycm9ycy5oYW5kbGVTeW5jKCgpID0+IHtcblx0XHRcdHJldHVybiB2YWx1ZSAvIHJlZmVyZW5jZTtcblx0XHR9LCAnRXJyb3Igb2NjdXJyZWQgd2hpbGUgbm9ybWFsaXppbmcgWFlaIHZhbHVlLicpO1xuXHR9XG5cblx0ZnVuY3Rpb24gc2woY29sb3I6IEhTTCk6IEhTTCB7XG5cdFx0cmV0dXJuIGVycm9ycy5oYW5kbGVTeW5jKCgpID0+IHtcblx0XHRcdGlmICghdmFsaWRhdGUuY29sb3JWYWx1ZShjb2xvcikpIHtcblx0XHRcdFx0bG9nLmVycm9yKFxuXHRcdFx0XHRcdCdJbnZhbGlkIGNvbG9yIHZhbHVzIGZvciBhZGp1c3RtZW50LicsXG5cdFx0XHRcdFx0YGFkanVzdG1lbnRVdGlscy5zbGBcblx0XHRcdFx0KTtcblxuXHRcdFx0XHRyZXR1cm4gY29sb3I7XG5cdFx0XHR9XG5cblx0XHRcdGNvbnN0IGFkanVzdGVkU2F0dXJhdGlvbiA9IE1hdGgubWluKFxuXHRcdFx0XHRNYXRoLm1heChjb2xvci52YWx1ZS5zYXR1cmF0aW9uICsgYWRqdXN0bWVudHMuc2xhVmFsdWUsIDApLFxuXHRcdFx0XHQxMDBcblx0XHRcdCk7XG5cdFx0XHRjb25zdCBhZGp1c3RlZExpZ2h0bmVzcyA9IE1hdGgubWluKDEwMCk7XG5cblx0XHRcdHJldHVybiB7XG5cdFx0XHRcdHZhbHVlOiB7XG5cdFx0XHRcdFx0aHVlOiBjb2xvci52YWx1ZS5odWUsXG5cdFx0XHRcdFx0c2F0dXJhdGlvbjogYnJhbmQuYXNQZXJjZW50aWxlKGFkanVzdGVkU2F0dXJhdGlvbiksXG5cdFx0XHRcdFx0bGlnaHRuZXNzOiBicmFuZC5hc1BlcmNlbnRpbGUoYWRqdXN0ZWRMaWdodG5lc3MpXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGZvcm1hdDogJ2hzbCdcblx0XHRcdH07XG5cdFx0fSwgJ0Vycm9yIG9jY3VycmVkIHdoaWxlIGFkanVzdGluZyBzYXR1cmF0aW9uIGFuZCBsaWdodG5lc3MuJyk7XG5cdH1cblxuXHRjb25zdCBhZGp1c3RtZW50VXRpbGl0aWVzOiBBZGp1c3RtZW50VXRpbGl0aWVzID0ge1xuXHRcdGFwcGx5R2FtbWFDb3JyZWN0aW9uLFxuXHRcdGNsYW1wUkdCLFxuXHRcdGNsYW1wWFlaLFxuXHRcdG5vcm1hbGl6ZVhZWixcblx0XHRzbFxuXHR9O1xuXG5cdHJldHVybiBlcnJvcnMuaGFuZGxlU3luYygoKSA9PiB7XG5cdFx0cmV0dXJuIGFkanVzdG1lbnRVdGlsaXRpZXM7XG5cdH0sICdFcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyBhZGp1c3RtZW50IHV0aWxzLicpO1xufVxuIl19