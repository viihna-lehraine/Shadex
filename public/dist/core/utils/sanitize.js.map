{"version":3,"file":"sanitize.js","sources":["../../../../../src/core/utils/sanitize.ts"],"sourcesContent":["import {\n\tBrandingUtilities,\n\tByteRange,\n\tLAB_A,\n\tLAB_B,\n\tLAB_L,\n\tPercentile,\n\tRadial,\n\tRangeKeyMap,\n\tSanitationUtilities,\n\tServices,\n\tValidationUtilities\n} from '../../types/index.js';\n\nexport function sanitationUtilitiesFactory(\n\tbrand: BrandingUtilities,\n\tservices: Services,\n\tvalidate: ValidationUtilities\n): SanitationUtilities {\n\tconst { errors } = services;\n\n\tfunction getSafeQueryParam(param: string): string | null {\n\t\treturn errors.handleSync(() => {\n\t\t\tconst urlParams = new URLSearchParams(window.location.search);\n\t\t\tconst rawValue = urlParams.get(param);\n\n\t\t\treturn rawValue ? sanitizeInput(rawValue) : null;\n\t\t}, 'Error occurred while getting safe query parameter');\n\t}\n\n\tfunction toColorValueRange<T extends keyof RangeKeyMap>(\n\t\tvalue: string | number,\n\t\trangeKey: T\n\t): RangeKeyMap[T] {\n\t\treturn errors.handleSync(\n\t\t\t() => {\n\t\t\t\tvalidate.range(value, rangeKey);\n\n\t\t\t\treturn rangeKey === 'HexSet'\n\t\t\t\t\t? (brand.asHexSet(\n\t\t\t\t\t\t\tvalue as string\n\t\t\t\t\t\t) as unknown as RangeKeyMap[T])\n\t\t\t\t\t: brand.asBranded(value as number, rangeKey);\n\t\t\t},\n\t\t\t'Error occurred while validating color value range.',\n\t\t\t{ context: { rangeKey } }\n\t\t);\n\t}\n\n\tfunction lab(\n\t\tvalue: number,\n\t\toutput: 'l' | 'a' | 'b'\n\t): LAB_L | LAB_A | LAB_B {\n\t\treturn errors.handleSync(() => {\n\t\t\tif (output === 'l') {\n\t\t\t\treturn brand.asLAB_L(\n\t\t\t\t\tMath.round(Math.min(Math.max(value, 0), 100))\n\t\t\t\t);\n\t\t\t} else if (output === 'a') {\n\t\t\t\treturn brand.asLAB_A(\n\t\t\t\t\tMath.round(Math.min(Math.max(value, -125), 125))\n\t\t\t\t);\n\t\t\t} else if (output === 'b') {\n\t\t\t\treturn brand.asLAB_B(\n\t\t\t\t\tMath.round(Math.min(Math.max(value, -125), 125))\n\t\t\t\t);\n\t\t\t} else throw new Error('Unable to return LAB value');\n\t\t}, 'Error occurred while sanitizing LAB value');\n\t}\n\n\tfunction percentile(value: number): Percentile {\n\t\treturn errors.handleSync(() => {\n\t\t\tconst rawPercentile = Math.round(Math.min(Math.max(value, 0), 100));\n\n\t\t\treturn brand.asPercentile(rawPercentile);\n\t\t}, 'Error occurred while sanitizing percentile value');\n\t}\n\n\tfunction radial(value: number): Radial {\n\t\treturn errors.handleSync(() => {\n\t\t\tconst rawRadial =\n\t\t\t\tMath.round(Math.min(Math.max(value, 0), 360)) & 360;\n\n\t\t\treturn brand.asRadial(rawRadial);\n\t\t}, 'Error occurred while sanitizing radial value');\n\t}\n\n\tfunction rgb(value: number): ByteRange {\n\t\treturn errors.handleSync(() => {\n\t\t\tconst rawByteRange = Math.round(Math.min(Math.max(value, 0), 255));\n\n\t\t\treturn toColorValueRange(rawByteRange, 'ByteRange')!;\n\t\t}, 'Error occurred while sanitizing RGB value');\n\t}\n\n\tfunction sanitizeInput(str: string): string {\n\t\treturn errors.handleSync(() => {\n\t\t\treturn str.replace(\n\t\t\t\t/[&<>\"'`/=():]/g,\n\t\t\t\tchar =>\n\t\t\t\t\t({\n\t\t\t\t\t\t'&': '&amp;',\n\t\t\t\t\t\t'<': '&lt;',\n\t\t\t\t\t\t'>': '&gt;',\n\t\t\t\t\t\t'\"': '&quot;',\n\t\t\t\t\t\t\"'\": '&#039;',\n\t\t\t\t\t\t'`': '&#x60;',\n\t\t\t\t\t\t'/': '&#x2F;',\n\t\t\t\t\t\t'=': '&#x3D;',\n\t\t\t\t\t\t'(': '&#40;',\n\t\t\t\t\t\t')': '&#41;',\n\t\t\t\t\t\t':': '&#58;'\n\t\t\t\t\t})[char] || char\n\t\t\t);\n\t\t}, 'Error occurred while sanitizing input');\n\t}\n\n\tconst sanitationUtilities: SanitationUtilities = {\n\t\tgetSafeQueryParam,\n\t\tlab,\n\t\tpercentile,\n\t\tradial,\n\t\trgb,\n\t\tsanitizeInput,\n\t\ttoColorValueRange\n\t};\n\n\treturn errors.handleSync(\n\t\t() => sanitationUtilities,\n\t\t'Error creating sanitation utilities group.'\n\t);\n}\n"],"names":[],"mappings":"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"}