{"version":3,"file":"ErrorHandlerService.js","sources":["../../../../../src/core/services/ErrorHandlerService.ts"],"sourcesContent":["import {\n\tErrorHandlerContract,\n\tErrorHandlerOptions,\n\tHelpers\n} from '../../types/index.js';\nimport { UserFacingError } from './ErrorClasses.js';\nimport { LoggerService } from './LoggerService.js';\nimport { config } from '../../config/index.js';\n\nconst caller = 'ErrorHandlerService';\nconst mode = config.mode;\n\nexport class ErrorHandlerService implements ErrorHandlerContract {\n\tstatic #instance: ErrorHandlerService | null = null;\n\t#getCallerInfo: Helpers['data']['getCallerInfo'];\n\t#logger: LoggerService;\n\n\tprivate constructor(helpers: Helpers, logger: LoggerService) {\n\t\ttry {\n\t\t\tconsole.log(`[${caller}]: Constructing ErrorHandler instance`);\n\n\t\t\tthis.#getCallerInfo = helpers.data.getCallerInfo;\n\n\t\t\tthis.#logger = logger;\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller} constructor]: ${error instanceof Error ? error.message : error}`\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic getInstance(\n\t\thelpers: Helpers,\n\t\tlogger: LoggerService\n\t): ErrorHandlerService {\n\t\ttry {\n\t\t\tif (!ErrorHandlerService.#instance) {\n\t\t\t\tconsole.debug(\n\t\t\t\t\t`[${caller}] No ErrorHandler instance exists yet. Creating new instance.`\n\t\t\t\t);\n\t\t\t\tErrorHandlerService.#instance = new ErrorHandlerService(\n\t\t\t\t\thelpers,\n\t\t\t\t\tlogger\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconsole.debug(`[${caller}] Returning ErrorHandler instance.`);\n\n\t\t\treturn ErrorHandlerService.#instance;\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller}.getInstance]: ${error instanceof Error ? error.message : error}`\n\t\t\t);\n\t\t}\n\t}\n\n\thandleAndReturn<T>(\n\t\taction: () => T | Promise<T>,\n\t\terrorMessage: string,\n\t\toptions: ErrorHandlerOptions = {}\n\t): T | Promise<T> {\n\t\ttry {\n\t\t\tconst result = action();\n\n\t\t\tif (result instanceof Promise) {\n\t\t\t\treturn result.catch(error => {\n\t\t\t\t\tthis.#handle(error, errorMessage, options);\n\n\t\t\t\t\treturn (options.fallback as T) ?? Promise.reject(error);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn result;\n\t\t} catch (error) {\n\t\t\tthis.#handle(error, errorMessage, options);\n\n\t\t\treturn options.fallback as T;\n\t\t}\n\t}\n\n\tasync handleAsync<T>(\n\t\taction: () => Promise<T>,\n\t\terrorMessage: string,\n\t\toptions: ErrorHandlerOptions = {}\n\t): Promise<T> {\n\t\ttry {\n\t\t\treturn await action();\n\t\t} catch (error) {\n\t\t\tthis.#handle(error, errorMessage, options);\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\thandleSync<T>(\n\t\taction: () => T,\n\t\terrorMessage: string,\n\t\toptions: ErrorHandlerOptions = {}\n\t): T {\n\t\ttry {\n\t\t\treturn action();\n\t\t} catch (error) {\n\t\t\tthis.#handle(error, errorMessage, options);\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t#formatError(\n\t\terror: unknown,\n\t\tmessage: string,\n\t\tcontext: Record<string, unknown>\n\t): string {\n\t\ttry {\n\t\t\treturn error instanceof Error\n\t\t\t\t? `${message}: ${error.message}. Context: ${JSON.stringify(context)}`\n\t\t\t\t: `${message}: ${error}. Context: ${JSON.stringify(context)}`;\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller}]: Error formatting error message: ${\n\t\t\t\t\terror instanceof Error ? error.message : error\n\t\t\t\t}`\n\t\t\t);\n\t\t}\n\t}\n\n\t#getStackTrace(error?: Error): string {\n\t\ttry {\n\t\t\treturn (\n\t\t\t\terror?.stack ??\n\t\t\t\tnew Error().stack ??\n\t\t\t\t`[${caller}]: No stack trace available.`\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller}]: Error getting stack trace: ${\n\t\t\t\t\terror instanceof Error ? error.message : error\n\t\t\t\t}`\n\t\t\t);\n\t\t}\n\t}\n\n\t#handle(\n\t\terror: unknown,\n\t\terrorMessage: string,\n\t\toptions: ErrorHandlerOptions = {}\n\t): void {\n\t\ttry {\n\t\t\tconst caller = this.#getCallerInfo();\n\t\t\tconst formattedError = this.#formatError(\n\t\t\t\terror,\n\t\t\t\terrorMessage,\n\t\t\t\toptions.context ?? {}\n\t\t\t);\n\n\t\t\tthis.#logger.error(formattedError, caller);\n\n\t\t\tif (mode.stackTrace) {\n\t\t\t\tthis.#logger.debug(\n\t\t\t\t\t`Stack trace:\\n${this.#getStackTrace(error instanceof Error ? error : undefined)}`,\n\t\t\t\t\t`${caller}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst userMessage =\n\t\t\t\toptions.userMessage ??\n\t\t\t\t(error instanceof UserFacingError\n\t\t\t\t\t? error.userMessage\n\t\t\t\t\t: undefined);\n\n\t\t\tif (userMessage) {\n\t\t\t\talert(userMessage);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller}]: Error handling error: ${\n\t\t\t\t\terror instanceof Error ? error.message : error\n\t\t\t\t}`\n\t\t\t);\n\t\t}\n\t}\n}\n"],"names":[],"mappings":"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"}