// File: logger/AppLogger.js
export class AppLogger {
    static instance = null;
    mode;
    constructor(mode) {
        this.mode = mode;
    }
    static getInstance(mode) {
        if (!AppLogger.instance) {
            AppLogger.instance = new AppLogger(mode);
        }
        return AppLogger.instance;
    }
    log(message, level = 'info', debugLevel = 0, caller) {
        this.logMessage(message, level, debugLevel, caller);
    }
    async logAsync(message, level = 'info', debugLevel = 0, caller) {
        this.logMessage(message, level, debugLevel, caller);
    }
    logMutation(data, logCallback = () => { }) {
        this.log(this.formatMutationLog(data), 'info');
        logCallback(data);
    }
    logMessage(message, level, debugLevel, caller) {
        if (level === 'info' || debugLevel < this.getDebugThreshold(level)) {
            return;
        }
        const callerInfo = caller || this.getCallerInfo();
        const timestamp = this.getFormattedTimestamp();
        try {
            console.log(`%c[${level.toUpperCase()}]%c ${timestamp} [${callerInfo}] %c${message}`, this.getLevelColor(level), 'color: gray', 'color: inherit');
        }
        catch (error) {
            console.error(`AppLogger encountered an unexpected error: ${error}`);
        }
        if (callerInfo === 'Unknown caller' &&
            debugLevel > 1 &&
            this.mode.stackTrace) {
            console.trace('Full Stack Trace:');
        }
    }
    formatMutationLog(data) {
        return `Mutation logged: ${JSON.stringify(data)}`;
    }
    getDebugThreshold(level) {
        switch (level) {
            case 'debug':
                return 2;
            case 'info':
                return 1;
            case 'warn':
                return 0;
            case 'error':
                return 0;
            default:
                return 0;
        }
    }
    getCallerInfo() {
        const stack = new Error().stack;
        if (stack) {
            const stackLines = stack.split('\n');
            for (const line of stackLines) {
                if (!line.includes('AppLogger') && line.includes('at ')) {
                    const match = line.match(/at\s+(.*)\s+\((.*):(\d+):(\d+)\)/) ||
                        line.match(/at\s+(.*):(\d+):(\d+)/);
                    if (match) {
                        return match[1]
                            ? `${match[1]} (${match[2]}:${match[3]})`
                            : `${match[2]}:${match[3]}`;
                    }
                }
            }
        }
        return 'Unknown caller';
    }
    getFormattedTimestamp() {
        return new Date().toLocaleString('en-US', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false
        });
    }
    getLevelColor(level) {
        switch (level) {
            case 'debug':
                return 'color: green';
            case 'info':
                return 'color: blue';
            case 'warn':
                return 'color: orange';
            case 'error':
                return 'color: red';
            default:
                return 'color: black';
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXBwTG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xvZ2dlci9BcHBMb2dnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNEJBQTRCO0FBUTVCLE1BQU0sT0FBTyxTQUFTO0lBQ2IsTUFBTSxDQUFDLFFBQVEsR0FBcUIsSUFBSSxDQUFDO0lBQ3pDLElBQUksQ0FBb0I7SUFFaEMsWUFBb0IsSUFBdUI7UUFDMUMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDbEIsQ0FBQztJQUVNLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBdUI7UUFDaEQsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUN6QixTQUFTLENBQUMsUUFBUSxHQUFHLElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFDRCxPQUFPLFNBQVMsQ0FBQyxRQUFRLENBQUM7SUFDM0IsQ0FBQztJQUVNLEdBQUcsQ0FDVCxPQUFlLEVBQ2YsUUFBNkMsTUFBTSxFQUNuRCxhQUFxQixDQUFDLEVBQ3RCLE1BQWU7UUFFZixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFTSxLQUFLLENBQUMsUUFBUSxDQUNwQixPQUFlLEVBQ2YsUUFBNkMsTUFBTSxFQUNuRCxhQUFxQixDQUFDLEVBQ3RCLE1BQWU7UUFFZixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFFTSxXQUFXLENBQ2pCLElBQWlCLEVBQ2pCLGNBQTJDLEdBQUcsRUFBRSxHQUFFLENBQUM7UUFFbkQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFL0MsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFFTyxVQUFVLENBQ2pCLE9BQWUsRUFDZixLQUEwQyxFQUMxQyxVQUFrQixFQUNsQixNQUFlO1FBRWYsSUFBSSxLQUFLLEtBQUssTUFBTSxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUNwRSxPQUFPO1FBQ1IsQ0FBQztRQUVELE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDbEQsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7UUFFL0MsSUFBSSxDQUFDO1lBQ0osT0FBTyxDQUFDLEdBQUcsQ0FDVixNQUFNLEtBQUssQ0FBQyxXQUFXLEVBQUUsT0FBTyxTQUFTLEtBQUssVUFBVSxPQUFPLE9BQU8sRUFBRSxFQUN4RSxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxFQUN6QixhQUFhLEVBQ2IsZ0JBQWdCLENBQ2hCLENBQUM7UUFDSCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNoQixPQUFPLENBQUMsS0FBSyxDQUNaLDhDQUE4QyxLQUFLLEVBQUUsQ0FDckQsQ0FBQztRQUNILENBQUM7UUFFRCxJQUNDLFVBQVUsS0FBSyxnQkFBZ0I7WUFDL0IsVUFBVSxHQUFHLENBQUM7WUFDZCxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFDbkIsQ0FBQztZQUNGLE9BQU8sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUNwQyxDQUFDO0lBQ0YsQ0FBQztJQUVPLGlCQUFpQixDQUFDLElBQWlCO1FBQzFDLE9BQU8sb0JBQW9CLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztJQUNuRCxDQUFDO0lBRU8saUJBQWlCLENBQ3hCLEtBQTBDO1FBRTFDLFFBQVEsS0FBSyxFQUFFLENBQUM7WUFDZixLQUFLLE9BQU87Z0JBQ1gsT0FBTyxDQUFDLENBQUM7WUFDVixLQUFLLE1BQU07Z0JBQ1YsT0FBTyxDQUFDLENBQUM7WUFDVixLQUFLLE1BQU07Z0JBQ1YsT0FBTyxDQUFDLENBQUM7WUFDVixLQUFLLE9BQU87Z0JBQ1gsT0FBTyxDQUFDLENBQUM7WUFDVjtnQkFDQyxPQUFPLENBQUMsQ0FBQztRQUNYLENBQUM7SUFDRixDQUFDO0lBRU8sYUFBYTtRQUNwQixNQUFNLEtBQUssR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDLEtBQUssQ0FBQztRQUVoQyxJQUFJLEtBQUssRUFBRSxDQUFDO1lBQ1gsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVyQyxLQUFLLE1BQU0sSUFBSSxJQUFJLFVBQVUsRUFBRSxDQUFDO2dCQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7b0JBQ3pELE1BQU0sS0FBSyxHQUNWLElBQUksQ0FBQyxLQUFLLENBQUMsa0NBQWtDLENBQUM7d0JBQzlDLElBQUksQ0FBQyxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztvQkFDckMsSUFBSSxLQUFLLEVBQUUsQ0FBQzt3QkFDWCxPQUFPLEtBQUssQ0FBQyxDQUFDLENBQUM7NEJBQ2QsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUc7NEJBQ3pDLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztvQkFDOUIsQ0FBQztnQkFDRixDQUFDO1lBQ0YsQ0FBQztRQUNGLENBQUM7UUFFRCxPQUFPLGdCQUFnQixDQUFDO0lBQ3pCLENBQUM7SUFFTyxxQkFBcUI7UUFDNUIsT0FBTyxJQUFJLElBQUksRUFBRSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUU7WUFDekMsSUFBSSxFQUFFLFNBQVM7WUFDZixLQUFLLEVBQUUsU0FBUztZQUNoQixHQUFHLEVBQUUsU0FBUztZQUNkLElBQUksRUFBRSxTQUFTO1lBQ2YsTUFBTSxFQUFFLFNBQVM7WUFDakIsTUFBTSxFQUFFLFNBQVM7WUFDakIsTUFBTSxFQUFFLEtBQUs7U0FDYixDQUFDLENBQUM7SUFDSixDQUFDO0lBRU8sYUFBYSxDQUFDLEtBQTBDO1FBQy9ELFFBQVEsS0FBSyxFQUFFLENBQUM7WUFDZixLQUFLLE9BQU87Z0JBQ1gsT0FBTyxjQUFjLENBQUM7WUFDdkIsS0FBSyxNQUFNO2dCQUNWLE9BQU8sYUFBYSxDQUFDO1lBQ3RCLEtBQUssTUFBTTtnQkFDVixPQUFPLGVBQWUsQ0FBQztZQUN4QixLQUFLLE9BQU87Z0JBQ1gsT0FBTyxZQUFZLENBQUM7WUFDckI7Z0JBQ0MsT0FBTyxjQUFjLENBQUM7UUFDeEIsQ0FBQztJQUNGLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBsb2dnZXIvQXBwTG9nZ2VyLmpzXG5cbmltcG9ydCB7XG5cdEFwcExvZ2dlcl9DbGFzc0ludGVyZmFjZSxcblx0TW9kZURhdGFJbnRlcmZhY2UsXG5cdE11dGF0aW9uTG9nXG59IGZyb20gJy4uL3R5cGVzL2luZGV4LmpzJztcblxuZXhwb3J0IGNsYXNzIEFwcExvZ2dlciBpbXBsZW1lbnRzIEFwcExvZ2dlcl9DbGFzc0ludGVyZmFjZSB7XG5cdHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBBcHBMb2dnZXIgfCBudWxsID0gbnVsbDtcblx0cHJpdmF0ZSBtb2RlOiBNb2RlRGF0YUludGVyZmFjZTtcblxuXHRwcml2YXRlIGNvbnN0cnVjdG9yKG1vZGU6IE1vZGVEYXRhSW50ZXJmYWNlKSB7XG5cdFx0dGhpcy5tb2RlID0gbW9kZTtcblx0fVxuXG5cdHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UobW9kZTogTW9kZURhdGFJbnRlcmZhY2UpOiBBcHBMb2dnZXIge1xuXHRcdGlmICghQXBwTG9nZ2VyLmluc3RhbmNlKSB7XG5cdFx0XHRBcHBMb2dnZXIuaW5zdGFuY2UgPSBuZXcgQXBwTG9nZ2VyKG1vZGUpO1xuXHRcdH1cblx0XHRyZXR1cm4gQXBwTG9nZ2VyLmluc3RhbmNlO1xuXHR9XG5cblx0cHVibGljIGxvZyhcblx0XHRtZXNzYWdlOiBzdHJpbmcsXG5cdFx0bGV2ZWw6ICdkZWJ1ZycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InID0gJ2luZm8nLFxuXHRcdGRlYnVnTGV2ZWw6IG51bWJlciA9IDAsXG5cdFx0Y2FsbGVyPzogc3RyaW5nXG5cdCk6IHZvaWQge1xuXHRcdHRoaXMubG9nTWVzc2FnZShtZXNzYWdlLCBsZXZlbCwgZGVidWdMZXZlbCwgY2FsbGVyKTtcblx0fVxuXG5cdHB1YmxpYyBhc3luYyBsb2dBc3luYyhcblx0XHRtZXNzYWdlOiBzdHJpbmcsXG5cdFx0bGV2ZWw6ICdkZWJ1ZycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InID0gJ2luZm8nLFxuXHRcdGRlYnVnTGV2ZWw6IG51bWJlciA9IDAsXG5cdFx0Y2FsbGVyPzogc3RyaW5nXG5cdCk6IFByb21pc2U8dm9pZD4ge1xuXHRcdHRoaXMubG9nTWVzc2FnZShtZXNzYWdlLCBsZXZlbCwgZGVidWdMZXZlbCwgY2FsbGVyKTtcblx0fVxuXG5cdHB1YmxpYyBsb2dNdXRhdGlvbihcblx0XHRkYXRhOiBNdXRhdGlvbkxvZyxcblx0XHRsb2dDYWxsYmFjazogKGRhdGE6IE11dGF0aW9uTG9nKSA9PiB2b2lkID0gKCkgPT4ge31cblx0KTogdm9pZCB7XG5cdFx0dGhpcy5sb2codGhpcy5mb3JtYXRNdXRhdGlvbkxvZyhkYXRhKSwgJ2luZm8nKTtcblxuXHRcdGxvZ0NhbGxiYWNrKGRhdGEpO1xuXHR9XG5cblx0cHJpdmF0ZSBsb2dNZXNzYWdlKFxuXHRcdG1lc3NhZ2U6IHN0cmluZyxcblx0XHRsZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcicsXG5cdFx0ZGVidWdMZXZlbDogbnVtYmVyLFxuXHRcdGNhbGxlcj86IHN0cmluZ1xuXHQpOiB2b2lkIHtcblx0XHRpZiAobGV2ZWwgPT09ICdpbmZvJyB8fCBkZWJ1Z0xldmVsIDwgdGhpcy5nZXREZWJ1Z1RocmVzaG9sZChsZXZlbCkpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCBjYWxsZXJJbmZvID0gY2FsbGVyIHx8IHRoaXMuZ2V0Q2FsbGVySW5mbygpO1xuXHRcdGNvbnN0IHRpbWVzdGFtcCA9IHRoaXMuZ2V0Rm9ybWF0dGVkVGltZXN0YW1wKCk7XG5cblx0XHR0cnkge1xuXHRcdFx0Y29uc29sZS5sb2coXG5cdFx0XHRcdGAlY1ske2xldmVsLnRvVXBwZXJDYXNlKCl9XSVjICR7dGltZXN0YW1wfSBbJHtjYWxsZXJJbmZvfV0gJWMke21lc3NhZ2V9YCxcblx0XHRcdFx0dGhpcy5nZXRMZXZlbENvbG9yKGxldmVsKSxcblx0XHRcdFx0J2NvbG9yOiBncmF5Jyxcblx0XHRcdFx0J2NvbG9yOiBpbmhlcml0J1xuXHRcdFx0KTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0YEFwcExvZ2dlciBlbmNvdW50ZXJlZCBhbiB1bmV4cGVjdGVkIGVycm9yOiAke2Vycm9yfWBcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKFxuXHRcdFx0Y2FsbGVySW5mbyA9PT0gJ1Vua25vd24gY2FsbGVyJyAmJlxuXHRcdFx0ZGVidWdMZXZlbCA+IDEgJiZcblx0XHRcdHRoaXMubW9kZS5zdGFja1RyYWNlXG5cdFx0KSB7XG5cdFx0XHRjb25zb2xlLnRyYWNlKCdGdWxsIFN0YWNrIFRyYWNlOicpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgZm9ybWF0TXV0YXRpb25Mb2coZGF0YTogTXV0YXRpb25Mb2cpOiBzdHJpbmcge1xuXHRcdHJldHVybiBgTXV0YXRpb24gbG9nZ2VkOiAke0pTT04uc3RyaW5naWZ5KGRhdGEpfWA7XG5cdH1cblxuXHRwcml2YXRlIGdldERlYnVnVGhyZXNob2xkKFxuXHRcdGxldmVsOiAnZGVidWcnIHwgJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJ1xuXHQpOiBudW1iZXIge1xuXHRcdHN3aXRjaCAobGV2ZWwpIHtcblx0XHRcdGNhc2UgJ2RlYnVnJzpcblx0XHRcdFx0cmV0dXJuIDI7XG5cdFx0XHRjYXNlICdpbmZvJzpcblx0XHRcdFx0cmV0dXJuIDE7XG5cdFx0XHRjYXNlICd3YXJuJzpcblx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0XHRjYXNlICdlcnJvcic6XG5cdFx0XHRcdHJldHVybiAwO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0cmV0dXJuIDA7XG5cdFx0fVxuXHR9XG5cblx0cHJpdmF0ZSBnZXRDYWxsZXJJbmZvKCk6IHN0cmluZyB7XG5cdFx0Y29uc3Qgc3RhY2sgPSBuZXcgRXJyb3IoKS5zdGFjaztcblxuXHRcdGlmIChzdGFjaykge1xuXHRcdFx0Y29uc3Qgc3RhY2tMaW5lcyA9IHN0YWNrLnNwbGl0KCdcXG4nKTtcblxuXHRcdFx0Zm9yIChjb25zdCBsaW5lIG9mIHN0YWNrTGluZXMpIHtcblx0XHRcdFx0aWYgKCFsaW5lLmluY2x1ZGVzKCdBcHBMb2dnZXInKSAmJiBsaW5lLmluY2x1ZGVzKCdhdCAnKSkge1xuXHRcdFx0XHRcdGNvbnN0IG1hdGNoID1cblx0XHRcdFx0XHRcdGxpbmUubWF0Y2goL2F0XFxzKyguKilcXHMrXFwoKC4qKTooXFxkKyk6KFxcZCspXFwpLykgfHxcblx0XHRcdFx0XHRcdGxpbmUubWF0Y2goL2F0XFxzKyguKik6KFxcZCspOihcXGQrKS8pO1xuXHRcdFx0XHRcdGlmIChtYXRjaCkge1xuXHRcdFx0XHRcdFx0cmV0dXJuIG1hdGNoWzFdXG5cdFx0XHRcdFx0XHRcdD8gYCR7bWF0Y2hbMV19ICgke21hdGNoWzJdfToke21hdGNoWzNdfSlgXG5cdFx0XHRcdFx0XHRcdDogYCR7bWF0Y2hbMl19OiR7bWF0Y2hbM119YDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gJ1Vua25vd24gY2FsbGVyJztcblx0fVxuXG5cdHByaXZhdGUgZ2V0Rm9ybWF0dGVkVGltZXN0YW1wKCk6IHN0cmluZyB7XG5cdFx0cmV0dXJuIG5ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoJ2VuLVVTJywge1xuXHRcdFx0eWVhcjogJ251bWVyaWMnLFxuXHRcdFx0bW9udGg6ICcyLWRpZ2l0Jyxcblx0XHRcdGRheTogJzItZGlnaXQnLFxuXHRcdFx0aG91cjogJzItZGlnaXQnLFxuXHRcdFx0bWludXRlOiAnMi1kaWdpdCcsXG5cdFx0XHRzZWNvbmQ6ICcyLWRpZ2l0Jyxcblx0XHRcdGhvdXIxMjogZmFsc2Vcblx0XHR9KTtcblx0fVxuXG5cdHByaXZhdGUgZ2V0TGV2ZWxDb2xvcihsZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcicpOiBzdHJpbmcge1xuXHRcdHN3aXRjaCAobGV2ZWwpIHtcblx0XHRcdGNhc2UgJ2RlYnVnJzpcblx0XHRcdFx0cmV0dXJuICdjb2xvcjogZ3JlZW4nO1xuXHRcdFx0Y2FzZSAnaW5mbyc6XG5cdFx0XHRcdHJldHVybiAnY29sb3I6IGJsdWUnO1xuXHRcdFx0Y2FzZSAnd2Fybic6XG5cdFx0XHRcdHJldHVybiAnY29sb3I6IG9yYW5nZSc7XG5cdFx0XHRjYXNlICdlcnJvcic6XG5cdFx0XHRcdHJldHVybiAnY29sb3I6IHJlZCc7XG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRyZXR1cm4gJ2NvbG9yOiBibGFjayc7XG5cdFx0fVxuXHR9XG59XG4iXX0=