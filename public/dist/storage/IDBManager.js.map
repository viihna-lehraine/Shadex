{"version":3,"file":"IDBManager.js","sources":["../../../../src/storage/IDBManager.ts"],"sourcesContent":["// File: storage/IDBManager.ts\n\nimport { IDBManagerInterface, Services } from '../types/index.js';\nimport { config, env } from '../config/index.js';\n\nconst caller = 'IDBManager';\nconst dbName = config.storage.idbDBName;\nconst defaultVerson = config.storage.idbDefaultVersion;\nconst idbRetryDelay = env.idb.retryDelay;\nconst storeName = config.storage.idbStoreName;\n\nexport class IDBManager implements IDBManagerInterface {\n\tstatic #instance: IDBManager | null = null;\n\n\t#defaultVersion: number;\n\t#version: number;\n\t#db: IDBDatabase | null = null;\n\n\t#errors: Services['errors'];\n\t#log: Services['log'];\n\n\tprivate constructor(services: Services) {\n\t\ttry {\n\t\t\tservices.log(`Constructing IDBManager instance`, {\n\t\t\t\tcaller: `${caller} constructor`\n\t\t\t});\n\n\t\t\tthis.#defaultVersion = defaultVerson;\n\t\t\tthis.#version = this.#defaultVersion;\n\t\t\tthis.#errors = services.errors;\n\t\t\tthis.#log = services.log;\n\t\t} catch (error) {\n\t\t\tthrow new Error(\n\t\t\t\t`[${caller} constructor]: ${\n\t\t\t\t\terror instanceof Error ? error.message : error\n\t\t\t\t}`\n\t\t\t);\n\t\t}\n\t}\n\n\tstatic async getInstance(services: Services): Promise<IDBManager> {\n\t\treturn services.errors.handleSync(() => {\n\t\t\tif (!IDBManager.#instance) {\n\t\t\t\tservices.log(\n\t\t\t\t\t'No IDBManager instance exists yet. Creating new instance.',\n\t\t\t\t\t{\n\t\t\t\t\t\tcaller: `${caller}.getInstance`,\n\t\t\t\t\t\tlevel: 'debug'\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tIDBManager.#instance = new IDBManager(services);\n\t\t\t}\n\n\t\t\tservices.log('Returning existing IDBManager instance.', {\n\t\t\t\tcaller: `${caller}.getInstance`,\n\t\t\t\tlevel: 'debug'\n\t\t\t});\n\n\t\t\treturn IDBManager.#instance;\n\t\t}, `[${caller}]: Failed to create IDBManager instance.`);\n\t}\n\n\tasync init(): Promise<boolean> {\n\t\treturn this.#errors.handleAsync(async () => {\n\t\t\tif (!window.indexedDB) {\n\t\t\t\tthrow new Error('IndexedDB is not supported in this browser');\n\t\t\t}\n\n\t\t\tthis.#log(`Opening IndexedDB...`, {\n\t\t\t\tcaller: `${caller}.init`\n\t\t\t});\n\n\t\t\tconst request = indexedDB.open(dbName, this.#version);\n\n\t\t\treturn await new Promise((resolve, reject) => {\n\t\t\t\tlet upgradeComplete = false;\n\n\t\t\t\trequest.onupgradeneeded = event => {\n\t\t\t\t\tconst db = (event.target as IDBOpenDBRequest).result;\n\n\t\t\t\t\tthis.#log(\n\t\t\t\t\t\t`Upgrading IndexedDB to version: ${this.#version}`,\n\t\t\t\t\t\t{ caller: `${caller}.init`, level: 'warn' }\n\t\t\t\t\t);\n\n\t\t\t\t\tif (!db.objectStoreNames.contains(storeName)) {\n\t\t\t\t\t\tdb.createObjectStore(storeName, {\n\t\t\t\t\t\t\tkeyPath: 'id',\n\t\t\t\t\t\t\tautoIncrement: true\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tthis.#log(`Created object store: ${storeName}`, {\n\t\t\t\t\t\t\tcaller: `${caller}.init`\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tupgradeComplete = true;\n\t\t\t\t};\n\n\t\t\t\trequest.onsuccess = event => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t!upgradeComplete &&\n\t\t\t\t\t\trequest.result.version !== this.#version\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.#log('Waiting for upgrade to finish.', {\n\t\t\t\t\t\t\tcaller: `${caller}.init`,\n\t\t\t\t\t\t\tlevel: 'warn'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.#db = (event.target as IDBOpenDBRequest).result;\n\n\t\t\t\t\tthis.#db.onversionchange = () => {\n\t\t\t\t\t\tthis.#db?.close();\n\n\t\t\t\t\t\tthis.#log(\n\t\t\t\t\t\t\t'IndexedDB version changed. Closing database',\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcaller: `${caller}.init`,\n\t\t\t\t\t\t\t\tlevel: 'warn'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t};\n\n\t\t\t\t\tthis.#log(`IndexedDB opened successfully`, {\n\t\t\t\t\t\tcaller: `${caller}.init`\n\t\t\t\t\t});\n\n\t\t\t\t\tresolve(true);\n\t\t\t\t};\n\n\t\t\t\trequest.onerror = event => {\n\t\t\t\t\treject(\n\t\t\t\t\t\t(event.target as IDBOpenDBRequest).error?.message ||\n\t\t\t\t\t\t\t`Unknown ${caller}.init error.`\n\t\t\t\t\t);\n\t\t\t\t};\n\n\t\t\t\trequest.onblocked = () => {\n\t\t\t\t\tthis.#log(`IndexedDB upgade blocked!`, {\n\t\t\t\t\t\tcaller: `${caller}.init`,\n\t\t\t\t\t\tlevel: 'warn'\n\t\t\t\t\t});\n\n\t\t\t\t\treject(\n\t\t\t\t\t\t`Upgrade blocked. Close other tabs using this database.`\n\t\t\t\t\t);\n\t\t\t\t};\n\t\t\t});\n\t\t}, `[${caller}]: Failed to initialize IndexedDB`);\n\t}\n\n\tasync clear(): Promise<void> {\n\t\treturn await this.#errors.handleAsync(async () => {\n\t\t\tconst store = this.getTransaction('readwrite');\n\n\t\t\tif (!store) throw new Error(`${caller} is not initialized.`);\n\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tconst request = store.clear();\n\n\t\t\t\trequest.onsuccess = () => resolve();\n\n\t\t\t\trequest.onerror = event =>\n\t\t\t\t\treject(\n\t\t\t\t\t\t(event.target as IDBRequest).error?.message ||\n\t\t\t\t\t\t\t`Unknown ${caller}.clear error`\n\t\t\t\t\t);\n\t\t\t});\n\t\t}, `[${caller}]: Failed to clear IndexedDB.`);\n\t}\n\n\tasync ensureDBReady(): Promise<void> {\n\t\tthis.#errors.handleAsync(async () => {\n\t\t\twhile (!this.#db) {\n\t\t\t\tthis.#log(`Waiting for ${caller} to initialize...`, {\n\t\t\t\t\tcaller: `${caller}.ensureDBReady`,\n\t\t\t\t\tlevel: 'warn'\n\t\t\t\t});\n\n\t\t\t\t// TODO: replace with a better solution??\n\t\t\t\tawait new Promise(resolve =>\n\t\t\t\t\tsetTimeout(resolve, idbRetryDelay)\n\t\t\t\t);\n\t\t\t}\n\t\t}, `[${caller}]: Failed to ensure IndexedDB is ready`);\n\t}\n\n\tasync getItem<T>(key: string): Promise<T | null> {\n\t\tawait this.ensureDBReady();\n\n\t\treturn this.#errors.handleAsync(async () => {\n\t\t\tconst store = this.getTransaction('readonly');\n\n\t\t\tif (!store) throw new Error(`${caller} is not initialized.`);\n\n\t\t\treturn await new Promise<T | null>((resolve, reject) => {\n\t\t\t\tconst request = store.get(key);\n\n\t\t\t\trequest.onsuccess = () =>\n\t\t\t\t\tresolve(request.result?.value ?? null);\n\n\t\t\t\trequest.onerror = event =>\n\t\t\t\t\treject(\n\t\t\t\t\t\t(event.target as IDBRequest).error?.message ||\n\t\t\t\t\t\t\t`Unknown ${caller}.getItem() error`\n\t\t\t\t\t);\n\t\t\t});\n\t\t}, `[${caller}]: Failed to retrieve item ${key} from IndexedDB`);\n\t}\n\n\tasync setItem(key: string, value: unknown): Promise<void> {\n\t\treturn await this.#errors.handleAsync(async () => {\n\t\t\tconst store = this.getTransaction('readwrite');\n\n\t\t\tif (!store) throw new Error(`${caller} is not initialized.`);\n\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tconst request = store.put({ id: key, value });\n\n\t\t\t\trequest.onsuccess = () => resolve();\n\n\t\t\t\trequest.onerror = event =>\n\t\t\t\t\treject(\n\t\t\t\t\t\t(event.target as IDBRequest).error?.message ||\n\t\t\t\t\t\t\t`Unknown ${caller}.setItem error`\n\t\t\t\t\t);\n\t\t\t});\n\t\t}, `[${caller}]: Failed to store item ${key} in IndexedDB`);\n\t}\n\n\tasync removeItem(key: string): Promise<void> {\n\t\treturn await this.#errors.handleAsync(async () => {\n\t\t\tconst store = this.getTransaction('readwrite');\n\n\t\t\tif (!store) throw new Error(`${caller} is not initialized.`);\n\n\t\t\tawait new Promise<void>((resolve, reject) => {\n\t\t\t\tconst request = store.delete(key);\n\n\t\t\t\trequest.onsuccess = () => resolve();\n\n\t\t\t\trequest.onerror = event =>\n\t\t\t\t\treject(\n\t\t\t\t\t\t(event.target as IDBRequest).error?.message ||\n\t\t\t\t\t\t\t`Unknown ${caller}.removeItem error.`\n\t\t\t\t\t);\n\t\t\t});\n\t\t}, `[${caller}]: Failed to remove item ${key} from IndexedDB`);\n\t}\n\n\tprivate getTransaction(mode: IDBTransactionMode): IDBObjectStore | void {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tif (!this.#db) throw new Error(`${caller} is not initialized.`);\n\n\t\t\tconst transaction = this.#db.transaction(storeName, mode);\n\n\t\t\treturn transaction.objectStore(storeName);\n\t\t}, `[${caller}]: Failed to get IndexedDB transaction (${mode})`);\n\t}\n}\n"],"names":[],"mappings":"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"}