{"version":3,"file":"parse.js","sources":["../../../../../src/common/utils/parse.ts"],"sourcesContent":["// File: common/utils/parse.js\n\nimport {\n\tHex,\n\tHSL,\n\tParseUtilsInterface,\n\tRGB,\n\tServicesInterface,\n\tUtilitiesInterface\n} from '../../types/index.js';\nimport { configData as config } from '../../data/config.js';\n\nconst regex = config.regex.dom;\n\nexport function createParsingUtils(\n\tservices: ServicesInterface,\n\tutils: UtilitiesInterface\n): ParseUtilsInterface {\n\treturn {\n\t\tcheckbox(id: string): boolean | void {\n\t\t\tconst log = services.app.log;\n\n\t\t\tconst checkbox = document.getElementById(\n\t\t\t\tid\n\t\t\t) as HTMLInputElement | null;\n\n\t\t\tif (!checkbox) {\n\t\t\t\tlog(\n\t\t\t\t\t'warn',\n\t\t\t\t\t`Checkbox element ${id} not found`,\n\t\t\t\t\t'parseUtils.checkbox()',\n\t\t\t\t\t1\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn checkbox ? checkbox.checked : undefined;\n\t\t},\n\t\tcolorInput(input: HTMLInputElement): Hex | HSL | RGB | null {\n\t\t\tconst log = services.app.log;\n\n\t\t\tconst colorStr = input.value.trim().toLowerCase();\n\t\t\tconst hexMatch = colorStr.match(regex.hex);\n\t\t\tconst hslMatch = colorStr.match(regex.hsl);\n\t\t\tconst rgbMatch = colorStr.match(regex.rgb);\n\n\t\t\tif (hexMatch) {\n\t\t\t\tlet hex = hexMatch[1];\n\t\t\t\tif (hex.length === 3) {\n\t\t\t\t\thex = hex\n\t\t\t\t\t\t.split('')\n\t\t\t\t\t\t.map(c => c + c)\n\t\t\t\t\t\t.join('');\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tformat: 'hex',\n\t\t\t\t\tvalue: { hex: utils.brand.asHexSet(`#${hex}`) }\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (hslMatch) {\n\t\t\t\treturn {\n\t\t\t\t\tformat: 'hsl',\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\thue: utils.brand.asRadial(parseInt(hslMatch[1], 10)),\n\t\t\t\t\t\tsaturation: utils.brand.asPercentile(\n\t\t\t\t\t\t\tparseFloat(hslMatch[2])\n\t\t\t\t\t\t),\n\t\t\t\t\t\tlightness: utils.brand.asPercentile(\n\t\t\t\t\t\t\tparseFloat(hslMatch[3])\n\t\t\t\t\t\t)\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (rgbMatch) {\n\t\t\t\treturn {\n\t\t\t\t\tformat: 'rgb',\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tred: utils.brand.asByteRange(parseInt(rgbMatch[1], 10)),\n\t\t\t\t\t\tgreen: utils.brand.asByteRange(\n\t\t\t\t\t\t\tparseInt(rgbMatch[2], 10)\n\t\t\t\t\t\t),\n\t\t\t\t\t\tblue: utils.brand.asByteRange(parseInt(rgbMatch[3], 10))\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// handle named colors\n\t\t\tconst testElement = document.createElement('div');\n\t\t\ttestElement.style.color = colorStr;\n\n\t\t\tif (testElement.style.color !== '') {\n\t\t\t\tconst ctx = document.createElement('canvas').getContext('2d');\n\n\t\t\t\tif (ctx) {\n\t\t\t\t\tctx.fillStyle = colorStr;\n\n\t\t\t\t\tconst rgb = ctx.fillStyle.match(/\\d+/g)?.map(Number);\n\n\t\t\t\t\tif (rgb && rgb.length === 3) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tformat: 'rgb',\n\t\t\t\t\t\t\tvalue: {\n\t\t\t\t\t\t\t\tred: utils.brand.asByteRange(rgb[0]),\n\t\t\t\t\t\t\t\tgreen: utils.brand.asByteRange(rgb[1]),\n\t\t\t\t\t\t\t\tblue: utils.brand.asByteRange(rgb[2])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tlog(\n\t\t\t\t'warn',\n\t\t\t\t`Invalid color input: ${colorStr}`,\n\t\t\t\t'parseUtils.colorInput()',\n\t\t\t\t1\n\t\t\t);\n\n\t\t\treturn null;\n\t\t},\n\t\tdropdownSelection(id: string, validOptions: string[]): string | void {\n\t\t\tconst log = services.app.log;\n\n\t\t\tconst dropdown = document.getElementById(\n\t\t\t\tid\n\t\t\t) as HTMLSelectElement | null;\n\n\t\t\tif (!dropdown) return;\n\n\t\t\tconst selectedValue = dropdown.value;\n\n\t\t\tif (!validOptions.includes(selectedValue)) {\n\t\t\t\tlog(\n\t\t\t\t\t'warn',\n\t\t\t\t\t`Invalid selection in ${id}: \"${selectedValue}\" is not one of ${validOptions.join(\n\t\t\t\t\t\t', '\n\t\t\t\t\t)}`,\n\t\t\t\t\t'parse > dropdownSelection()',\n\t\t\t\t\t1\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn validOptions.includes(selectedValue)\n\t\t\t\t? selectedValue\n\t\t\t\t: undefined;\n\t\t},\n\t\tnumberInput(\n\t\t\tinput: HTMLInputElement,\n\t\t\tmin?: number,\n\t\t\tmax?: number\n\t\t): number | null {\n\t\t\tconst log = services.app.log;\n\n\t\t\tconst value = parseFloat(input.value.trim());\n\n\t\t\tif (isNaN(value)) {\n\t\t\t\tlog(\n\t\t\t\t\t'warn',\n\t\t\t\t\t`Invalid number input: ${input.value}`,\n\t\t\t\t\t'parseUtils > numberInput()',\n\t\t\t\t\t1\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (isNaN(value)) return null;\n\n\t\t\tif (min !== undefined && value < min) return min;\n\t\t\tif (max !== undefined && value > max) return max;\n\n\t\t\treturn value;\n\t\t},\n\t\ttextInput(input: HTMLInputElement, regex?: RegExp): string | null {\n\t\t\tconst log = services.app.log;\n\n\t\t\tconst text = input.value.trim();\n\n\t\t\tif (regex && !regex.test(text)) {\n\t\t\t\tlog(\n\t\t\t\t\t'warn',\n\t\t\t\t\t`Invalid text input: ${text}`,\n\t\t\t\t\t'parseUtils > textInput()',\n\t\t\t\t\t1\n\t\t\t\t);\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn text || null;\n\t\t}\n\t};\n}\n"],"names":["config"],"mappings":"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"}