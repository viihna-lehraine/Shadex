{"version":3,"file":"adjust.js","sources":["../../../../../src/common/utils/adjust.ts"],"sourcesContent":["// File: common/utils/adjust.js\n\nimport {\n\tAdjustmentUtils,\n\tHSL,\n\tRGB,\n\tServices,\n\tUtilities\n} from '../../types/index.js';\nimport { config, defaults, paletteConfig } from '../../config/index.js';\n\nconst adjustments = paletteConfig.adjustment;\nconst defaultColors = defaults.colors;\nconst math = config.math;\n\nexport function adjustmentUtilsFactory(\n\tservices: Services,\n\tutils: Utilities\n): AdjustmentUtils {\n\tconst { log } = services;\n\n\treturn {\n\t\tapplyGammaCorrection(value: number): number {\n\t\t\ttry {\n\t\t\t\treturn value > 0.0031308\n\t\t\t\t\t? 1.055 * Math.pow(value, 1 / 2.4) - 0.055\n\t\t\t\t\t: 12.92 * value;\n\t\t\t} catch (error) {\n\t\t\t\tlog(`Error applying gamma correction: ${error}`, 'error');\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t},\n\t\tclampRGB(rgb: RGB): RGB {\n\t\t\tconst defaultRGB = defaultColors.rgb;\n\n\t\t\tif (!utils.validate.colorValue(rgb)) {\n\t\t\t\tlog(`Invalid RGB value ${JSON.stringify(rgb)}`, 'error');\n\n\t\t\t\treturn defaultRGB;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tred: utils.brand.asByteRange(\n\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\tMath.min(Math.max(0, rgb.value.red), 1) * 255\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t),\n\t\t\t\t\t\tgreen: utils.brand.asByteRange(\n\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\tMath.min(Math.max(0, rgb.value.green), 1) * 255\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t),\n\t\t\t\t\t\tblue: utils.brand.asByteRange(\n\t\t\t\t\t\t\tMath.round(\n\t\t\t\t\t\t\t\tMath.min(Math.max(0, rgb.value.blue), 1) * 255\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t},\n\t\t\t\t\tformat: 'rgb'\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlog(`Error clamping RGB values: ${error}`, 'error');\n\n\t\t\t\treturn rgb;\n\t\t\t}\n\t\t},\n\t\tclampXYZ(value: number, maxValue: number): number {\n\t\t\treturn Math.max(0, Math.min(maxValue + math.epsilon, value));\n\t\t},\n\t\tnormalizeXYZ(value: number, reference: number): number {\n\t\t\treturn value / reference;\n\t\t},\n\t\tsl(color: HSL): HSL {\n\t\t\ttry {\n\t\t\t\tif (!utils.validate.colorValue(color)) {\n\t\t\t\t\tlog('Invalid color valus for adjustment.', 'error');\n\n\t\t\t\t\treturn color;\n\t\t\t\t}\n\n\t\t\t\tconst adjustedSaturation = Math.min(\n\t\t\t\t\tMath.max(color.value.saturation + adjustments.slaValue, 0),\n\t\t\t\t\t100\n\t\t\t\t);\n\t\t\t\tconst adjustedLightness = Math.min(100);\n\n\t\t\t\treturn {\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\thue: color.value.hue,\n\t\t\t\t\t\tsaturation:\n\t\t\t\t\t\t\tutils.brand.asPercentile(adjustedSaturation),\n\t\t\t\t\t\tlightness: utils.brand.asPercentile(adjustedLightness)\n\t\t\t\t\t},\n\t\t\t\t\tformat: 'hsl'\n\t\t\t\t};\n\t\t\t} catch (error) {\n\t\t\t\tlog(\n\t\t\t\t\t`Error adjusting saturation and lightness: ${error}`,\n\t\t\t\t\t'error'\n\t\t\t\t);\n\n\t\t\t\treturn color;\n\t\t\t}\n\t\t}\n\t};\n}\n"],"names":[],"mappings":"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"}