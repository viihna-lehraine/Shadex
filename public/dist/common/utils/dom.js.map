{"version":3,"file":"dom.js","sources":["../../../../../src/common/utils/dom.ts"],"sourcesContent":["// File: common/utils/dom.js\n\nimport {\n\tColorInputElement,\n\tColorSpace,\n\tDOMElements,\n\tDOMIndex,\n\tDOMUtilsInterface,\n\tHSL,\n\tPalette,\n\tServicesInterface,\n\tState,\n\tUtilitiesInterface\n} from '../../types/index.js';\nimport { config, domConfig, domIndex } from '../../config/index.js';\n\nconst classes = domIndex.classes;\nconst ids = domIndex.ids;\nconst mode = config.mode;\n\nexport function createDOMUtils(\n\tservices: ServicesInterface,\n\tutils: UtilitiesInterface\n): DOMUtilsInterface {\n\tconst addConversionListener = (id: string, colorSpace: string) => {\n\t\tconst log = services.log;\n\t\tconst btn = document.getElementById(id) as HTMLButtonElement | null;\n\n\t\tif (btn) {\n\t\t\tif (utils.typeGuards.isColorSpace(colorSpace)) {\n\t\t\t\tbtn.addEventListener('click', () =>\n\t\t\t\t\tswitchColorSpaceInDOM(colorSpace as ColorSpace)\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tlog(`Invalid color space provided: ${colorSpace}`, 'warn');\n\t\t\t}\n\t\t} else {\n\t\t\tlog(`Element with id \"${id}\" not found.`, 'warn');\n\t\t}\n\t};\n\n\tfunction positionTooltip(element: HTMLElement, tooltip: HTMLElement): void {\n\t\tconst rect = element.getBoundingClientRect();\n\n\t\ttooltip.style.position = 'absolute';\n\t\ttooltip.style.left = `${rect.left + window.scrollX}px`;\n\t\ttooltip.style.top = `${rect.top + window.scrollY - tooltip.offsetHeight - 5}px`;\n\t\ttooltip.style.zIndex = '1000';\n\t\ttooltip.style.pointerEvents = 'none';\n\t\ttooltip.style.opacity = '0';\n\t\ttooltip.style.transition = 'opacity 0.2s ease-in-out';\n\t}\n\n\tfunction removeTooltip(element: HTMLElement): void {\n\t\tconst tooltipId = element.dataset.tooltipId;\n\n\t\tif (!tooltipId) return;\n\n\t\tconst tooltip = document.getElementById(tooltipId);\n\t\tif (tooltip) {\n\t\t\ttooltip.style.opacity = '0';\n\t\t\tsetTimeout(() => {\n\t\t\t\ttooltip?.remove();\n\t\t\t}, 300);\n\t\t}\n\n\t\tdelete element.dataset.tooltipId;\n\t}\n\n\tfunction switchColorSpaceInDOM(targetFormat: ColorSpace): void {\n\t\tconst log = services.log;\n\n\t\ttry {\n\t\t\tconst colorTextOutputBoxes =\n\t\t\t\tdocument.querySelectorAll<HTMLInputElement>(\n\t\t\t\t\t'.color-text-output-box'\n\t\t\t\t);\n\n\t\t\tfor (const box of colorTextOutputBoxes) {\n\t\t\t\tconst inputBox = box as ColorInputElement;\n\t\t\t\tconst colorValues = inputBox.colorValues;\n\n\t\t\t\tif (!colorValues || !utils.validate.colorValue(colorValues)) {\n\t\t\t\t\tlog('Invalid color values. Cannot display toast.', 'error');\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst currentFormat = inputBox.getAttribute(\n\t\t\t\t\t'data-format'\n\t\t\t\t) as ColorSpace;\n\n\t\t\t\tlog(\n\t\t\t\t\t`Converting from ${currentFormat} to ${targetFormat}`,\n\t\t\t\t\t'debug'\n\t\t\t\t);\n\n\t\t\t\tconst convertFn = utils.color.getConversionFn(\n\t\t\t\t\tcurrentFormat,\n\t\t\t\t\ttargetFormat\n\t\t\t\t);\n\n\t\t\t\tif (!convertFn) {\n\t\t\t\t\tlog(\n\t\t\t\t\t\t`Conversion from ${currentFormat} to ${targetFormat} is not supported.`,\n\t\t\t\t\t\t'warn'\n\t\t\t\t\t);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (colorValues.format === 'xyz') {\n\t\t\t\t\tlog(\n\t\t\t\t\t\t'Cannot convert from XYZ to another color space.',\n\t\t\t\t\t\t'warn'\n\t\t\t\t\t);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst clonedColor = utils.color.narrowToColor(colorValues);\n\n\t\t\t\tif (\n\t\t\t\t\t!clonedColor ||\n\t\t\t\t\tutils.typeGuards.isSLColor(clonedColor) ||\n\t\t\t\t\tutils.typeGuards.isSVColor(clonedColor) ||\n\t\t\t\t\tutils.typeGuards.isXYZ(clonedColor)\n\t\t\t\t) {\n\t\t\t\t\tlog(\n\t\t\t\t\t\t'Cannot convert from SL, SV, or XYZ color spaces. Please convert to a supported format first.',\n\t\t\t\t\t\t'error'\n\t\t\t\t\t);\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (!clonedColor) {\n\t\t\t\t\tlog(`Conversion to ${targetFormat} failed.`, 'error');\n\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tconst newColor = utils.core.clone(convertFn(clonedColor));\n\t\t\t\tif (!newColor) {\n\t\t\t\t\tlog(`Conversion to ${targetFormat} failed.`, 'error');\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tinputBox.value = String(newColor);\n\n\t\t\t\tinputBox.setAttribute('data-format', targetFormat);\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tlog('Color conversion failure.', 'warn');\n\n\t\t\tthrow new Error(`Failed to convert colors: ${error as Error}`);\n\t\t}\n\t}\n\n\treturn {\n\t\taddConversionListener,\n\t\tremoveTooltip,\n\t\tswitchColorSpaceInDOM,\n\t\taddEventListener<K extends keyof HTMLElementEventMap>(\n\t\t\tid: string,\n\t\t\teventType: K,\n\t\t\tcallback: (ev: HTMLElementEventMap[K]) => void\n\t\t): void {\n\t\t\tconst log = services.log;\n\t\t\tconst element = document.getElementById(id);\n\n\t\t\tif (element) {\n\t\t\t\telement.addEventListener(eventType, callback);\n\t\t\t} else {\n\t\t\t\tlog(`Element with id \"${id}\" not found.`, 'warn');\n\t\t\t}\n\t\t},\n\t\tcreateTooltip(element: HTMLElement, text: string): HTMLElement {\n\t\t\t// remove existing tooltip if present\n\t\t\tremoveTooltip(element);\n\n\t\t\tconst tooltip = document.createElement('div');\n\t\t\ttooltip.classList.add('tooltip');\n\t\t\ttooltip.textContent = text;\n\n\t\t\t// add to body\n\t\t\tdocument.body.appendChild(tooltip);\n\n\t\t\t// position it\n\t\t\tpositionTooltip(element, tooltip);\n\n\t\t\t// store reference in dataset for later removal\n\t\t\telement.dataset.tooltipId = tooltip.id;\n\n\t\t\t// show tooltip with fade-in effect\n\t\t\tsetTimeout(() => {\n\t\t\t\ttooltip.style.opacity = '1';\n\t\t\t}, domConfig.tooltipFadeOut);\n\n\t\t\treturn tooltip;\n\t\t},\n\t\tdownloadFile(data: string, filename: string, type: string): void {\n\t\t\tconst blob = new Blob([data], { type });\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\tconst a = document.createElement('a');\n\n\t\t\ta.href = url;\n\t\t\ta.download = filename;\n\t\t\ta.click();\n\n\t\t\tURL.revokeObjectURL(url);\n\t\t},\n\t\tenforceSwatchRules(minSwatches: number, maxSwatches: number): void {\n\t\t\tconst log = services.log;\n\t\t\tconst paletteColumnSelector = document.getElementById(\n\t\t\t\tdomIndex.ids.inputs.paletteColumn\n\t\t\t) as HTMLSelectElement;\n\n\t\t\tif (!paletteColumnSelector) {\n\t\t\t\tlog('paletteColumnSelector not found', 'error');\n\n\t\t\t\tif (mode.stackTrace) {\n\t\t\t\t\tconsole.trace('enforceMinimumSwatches stack trace');\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst currentValue = parseInt(paletteColumnSelector.value, 10);\n\n\t\t\tlet newValue = currentValue;\n\n\t\t\t// ensure the value is within the allowed range\n\t\t\tif (currentValue < minSwatches) {\n\t\t\t\tnewValue = minSwatches;\n\t\t\t} else if (\n\t\t\t\tmaxSwatches !== undefined &&\n\t\t\t\tcurrentValue > maxSwatches\n\t\t\t) {\n\t\t\t\tnewValue = maxSwatches;\n\t\t\t}\n\n\t\t\tif (newValue !== currentValue) {\n\t\t\t\t// update value in the dropdown menu\n\t\t\t\tpaletteColumnSelector.value = newValue.toString();\n\n\t\t\t\t// trigger a change event to notify the application\n\t\t\t\tconst event = new Event('change', { bubbles: true });\n\t\t\t\ttry {\n\t\t\t\t\tpaletteColumnSelector.dispatchEvent(event);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tlog(\n\t\t\t\t\t\t`Failed to dispatch change event to palette-number-options dropdown menu: ${error}`,\n\t\t\t\t\t\t'error'\n\t\t\t\t\t);\n\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Failed to dispatch change event: ${error}`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tgetValidatedDOMElements(\n\t\t\tunvalidatedIDs: DOMIndex['ids'] = domIndex.ids\n\t\t): DOMElements | null {\n\t\t\tconst log = services.log;\n\t\t\tconst missingElements: string[] = [];\n\n\t\t\tconst elementTypeMap: Record<\n\t\t\t\tkeyof DOMIndex['ids'],\n\t\t\t\tkeyof HTMLElementTagNameMap\n\t\t\t> = {\n\t\t\t\tbtns: 'button',\n\t\t\t\tdivs: 'div',\n\t\t\t\tinputs: 'input'\n\t\t\t};\n\n\t\t\tconst elements: Partial<DOMElements> = {\n\t\t\t\tbtns: {} as DOMElements['btns'],\n\t\t\t\tdivs: {} as DOMElements['divs'],\n\t\t\t\tinputs: {} as DOMElements['inputs']\n\t\t\t};\n\n\t\t\tfor (const [category, elementsGroup] of Object.entries(\n\t\t\t\tunvalidatedIDs\n\t\t\t)) {\n\t\t\t\ttype Category = keyof DOMIndex['ids'];\n\t\t\t\tconst tagName = elementTypeMap[category as Category];\n\n\t\t\t\tif (!tagName) {\n\t\t\t\t\tlog(\n\t\t\t\t\t\t`No element type mapping found for category \"${category}\". Skipping...`,\n\t\t\t\t\t\t'warn'\n\t\t\t\t\t);\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (const [key, id] of Object.entries(\n\t\t\t\t\telementsGroup as Record<string, string>\n\t\t\t\t)) {\n\t\t\t\t\tconst element =\n\t\t\t\t\t\tutils.core.getElement<\n\t\t\t\t\t\t\tHTMLElementTagNameMap[typeof tagName]\n\t\t\t\t\t\t>(id);\n\n\t\t\t\t\tif (!element) {\n\t\t\t\t\t\tlog(`Element with ID \"${id}\" not found`, 'error');\n\t\t\t\t\t\tmissingElements.push(id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\telements[category as Category] as Record<\n\t\t\t\t\t\t\t\tstring,\n\t\t\t\t\t\t\t\tHTMLElement\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t)[key] = element;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (missingElements.length) {\n\t\t\t\tlog(`Missing elements: ${missingElements.join(', ')}`, 'warn');\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tlog('All static elements are present.', 'debug');\n\n\t\t\treturn elements as DOMElements;\n\t\t},\n\t\thideTooltip(): void {\n\t\t\tconst tooltip = utils.core.getElement<HTMLDivElement>('.tooltip');\n\t\t\tif (!tooltip) return;\n\n\t\t\ttooltip.style.opacity = '0';\n\n\t\t\tsetTimeout(() => {\n\t\t\t\ttooltip.style.visibility = 'hidden';\n\t\t\t\ttooltip.remove();\n\t\t\t}, domConfig.tooltipFadeOut || 500);\n\t\t},\n\t\tscanPaletteColumns(): State['paletteContainer']['columns'] {\n\t\t\tconst paletteColumns = utils.core.getAllElements<HTMLDivElement>(\n\t\t\t\tclasses.paletteColumn\n\t\t\t);\n\n\t\t\treturn Array.from(paletteColumns).map((column, index) => {\n\t\t\t\tconst id = parseInt(\n\t\t\t\t\tcolumn.id.split('-').pop() || `${index + 1}`,\n\t\t\t\t\t10\n\t\t\t\t);\n\t\t\t\tconst size = column.clientWidth / paletteColumns.length;\n\t\t\t\tconst isLocked = column.classList.contains(classes.locked);\n\n\t\t\t\treturn { id, position: index + 1, size, isLocked };\n\t\t\t});\n\t\t},\n\t\treadFile(file: File): Promise<string> {\n\t\t\treturn new Promise((resolve, reject) => {\n\t\t\t\tconst reader = new FileReader();\n\n\t\t\t\treader.onload = () => resolve(reader.result as string);\n\t\t\t\treader.onerror = () => reject(reader.error);\n\n\t\t\t\treader.readAsText(file);\n\t\t\t});\n\t\t},\n\t\tupdateColorBox(color: HSL, boxId: string): void {\n\t\t\tconst colorBox = document.getElementById(boxId);\n\n\t\t\tif (colorBox) {\n\t\t\t\tcolorBox.style.backgroundColor =\n\t\t\t\t\tutils.color.convertColorToCSS(color);\n\t\t\t}\n\t\t},\n\t\tupdateHistory(history: Palette[]): void {\n\t\t\tconst historyList = utils.core.getElement<HTMLDivElement>(\n\t\t\t\tids.divs.paletteHistory\n\t\t\t);\n\n\t\t\tif (!historyList) return;\n\n\t\t\thistoryList.innerHTML = '';\n\n\t\t\thistory.forEach(palette => {\n\t\t\t\tconst entry = document.createElement('div');\n\n\t\t\t\tentry.classList.add('history-item');\n\t\t\t\tentry.id = `palette_${palette.id}`;\n\t\t\t\tentry.innerHTML = `\n\t\t\t\t\t<p>Palette #${palette.metadata.name || palette.id}</p>\n\t\t\t\t\t<div class=\"color-preview\">\n\t\t\t\t\t\t${palette.items.map(item => `<span class=\"color-box\" style=\"background: ${item.css.hex};\"></span>`).join(' ')}\n\t\t\t\t\t</div>\n\t\t\t\t\t<button class=\"remove-history-item\" data-id=\"${palette.id}-history-remove-btn\">Remove</button>\n\t\t\t\t`;\n\t\t\t\tentry\n\t\t\t\t\t.querySelector('.remove-history-item')\n\t\t\t\t\t?.addEventListener('click', async () => {\n\t\t\t\t\t\t// TODO: save to history somehow\n\t\t\t\t\t});\n\t\t\t\thistoryList.appendChild(entry);\n\t\t\t});\n\t\t},\n\t\tasync validateStaticElements(): Promise<void> {\n\t\t\tconst unvalidatedIDs = domIndex.ids;\n\t\t\tconst log = services.log;\n\t\t\tconst missingElements: string[] = [];\n\n\t\t\tconst elementTypeMap: Record<\n\t\t\t\tkeyof typeof ids,\n\t\t\t\tkeyof HTMLElementTagNameMap\n\t\t\t> = {\n\t\t\t\tbtns: 'button',\n\t\t\t\tdivs: 'div',\n\t\t\t\tinputs: 'input'\n\t\t\t} as const;\n\n\t\t\tObject.entries(unvalidatedIDs).forEach(([category, elements]) => {\n\t\t\t\tconst tagName =\n\t\t\t\t\telementTypeMap[category as keyof typeof elementTypeMap];\n\n\t\t\t\tif (!tagName) {\n\t\t\t\t\tlog(\n\t\t\t\t\t\t`No element type mapping found for category \"${category}\". Skipping...`,\n\t\t\t\t\t\t'warn'\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// validate each ID within each category\n\t\t\t\tObject.values(elements).forEach(unvalidatedIDs => {\n\t\t\t\t\tif (typeof unvalidatedIDs !== 'string') {\n\t\t\t\t\t\tlog(\n\t\t\t\t\t\t\t`Invalid ID \"${unvalidatedIDs}\" in category \"${category}\". Expected string.`,\n\t\t\t\t\t\t\t'error'\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst element =\n\t\t\t\t\t\tutils.core.getElement<\n\t\t\t\t\t\t\tHTMLElementTagNameMap[typeof tagName]\n\t\t\t\t\t\t>(unvalidatedIDs);\n\n\t\t\t\t\tif (!element) {\n\t\t\t\t\t\tlog(\n\t\t\t\t\t\t\t`Element with ID \"${unvalidatedIDs}\" not found`,\n\t\t\t\t\t\t\t'error'\n\t\t\t\t\t\t);\n\t\t\t\t\t\tmissingElements.push(unvalidatedIDs);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (missingElements.length) {\n\t\t\t\tlog(`Missing elements: ${missingElements.join(', ')}`, 'warn');\n\t\t\t} else {\n\t\t\t\tlog('All static elements are present! ðŸ©·', 'debug');\n\t\t\t}\n\t\t}\n\t};\n}\n"],"names":[],"mappings":"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"}