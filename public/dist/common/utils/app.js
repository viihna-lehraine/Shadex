// File: common/utils/app.js
import { data } from '../../config/index.js';
const defaultColors = data.defaults.colors;
export function createAppUtils(services, utils) {
    return {
        generateRandomHSL() {
            const log = services.log;
            try {
                const hsl = {
                    value: {
                        hue: utils.sanitize.radial(Math.floor(Math.random() * 360)),
                        saturation: utils.sanitize.percentile(Math.floor(Math.random() * 101)),
                        lightness: utils.sanitize.percentile(Math.floor(Math.random() * 101))
                    },
                    format: 'hsl'
                };
                if (!utils.validate.colorValue(hsl)) {
                    log(`Invalid random HSL color value ${JSON.stringify(hsl)}`, 'error');
                    return defaultColors.hsl;
                }
                log(`Generated randomHSL: ${JSON.stringify(hsl)}`, 'debug');
                return hsl;
            }
            catch (error) {
                log(`Error generating random HSL color: ${error}`, 'warn');
                return defaultColors.hsl;
            }
        },
        generateRandomSL() {
            const log = services.log;
            try {
                const sl = {
                    value: {
                        saturation: utils.sanitize.percentile(Math.max(0, Math.min(100, Math.random() * 100))),
                        lightness: utils.sanitize.percentile(Math.max(0, Math.min(100, Math.random() * 100)))
                    },
                    format: 'sl'
                };
                if (!utils.validate.colorValue(sl)) {
                    log(`Invalid random SV color value ${JSON.stringify(sl)}`, 'error');
                    return defaultColors.sl;
                }
                log(`Generated randomSL: ${JSON.stringify(sl)}`, 'debug');
                return sl;
            }
            catch (error) {
                log(`Error generating random SL color: ${error}`, 'error');
                return defaultColors.sl;
            }
        },
        getFormattedTimestamp() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        },
        async tracePromise(promise, label) {
            return promise
                .then(result => {
                console.log(`[TRACE SUCCESS] ${label}:`, result);
                return result;
            })
                .catch(error => {
                console.error(`[TRACE ERROR] ${label}:`, error);
                throw error;
            });
        }
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1vbi91dGlscy9hcHAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsNEJBQTRCO0FBUzVCLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUU3QyxNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQztBQUUzQyxNQUFNLFVBQVUsY0FBYyxDQUM3QixRQUEyQixFQUMzQixLQUF5QjtJQUV6QixPQUFPO1FBQ04saUJBQWlCO1lBQ2hCLE1BQU0sR0FBRyxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUM7WUFFekIsSUFBSSxDQUFDO2dCQUNKLE1BQU0sR0FBRyxHQUFRO29CQUNoQixLQUFLLEVBQUU7d0JBQ04sR0FBRyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUN6QixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FDL0I7d0JBQ0QsVUFBVSxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUNwQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FDL0I7d0JBQ0QsU0FBUyxFQUFFLEtBQUssQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUNuQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FDL0I7cUJBQ0Q7b0JBQ0QsTUFBTSxFQUFFLEtBQUs7aUJBQ2IsQ0FBQztnQkFFRixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDckMsR0FBRyxDQUNGLGtDQUFrQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQ3ZELE9BQU8sQ0FDUCxDQUFDO29CQUVG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SUFBSSxPQUFPLElBQUksT0FBTyxFQUFFLENBQUM7UUFDakUsQ0FBQztRQUNELEtBQUssQ0FBQyxZQUFZLENBQ2pCLE9BQXlCLEVBQ3pCLEtBQWE7WUFFYixPQUFPLE9BQU87aUJBQ1osSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dCQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsbUJBQW1CLEtBQUssR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUNqRCxPQUFPLE1BQU0sQ0FBQztZQUNmLENBQUMsQ0FBQztpQkFDRCxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUU7Z0JBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxpQkFBaUIsS0FBSyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQ2hELE1BQU0sS0FBSyxDQUFDO1lBQ2IsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO0tBQ0QsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBjb21tb24vdXRpbHMvYXBwLmpzXG5cbmltcG9ydCB7XG5cdEFwcFV0aWxzSW50ZXJmYWNlLFxuXHRIU0wsXG5cdFNMLFxuXHRTZXJ2aWNlc0ludGVyZmFjZSxcblx0VXRpbGl0aWVzSW50ZXJmYWNlXG59IGZyb20gJy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGRhdGEgfSBmcm9tICcuLi8uLi9jb25maWcvaW5kZXguanMnO1xuXG5jb25zdCBkZWZhdWx0Q29sb3JzID0gZGF0YS5kZWZhdWx0cy5jb2xvcnM7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBcHBVdGlscyhcblx0c2VydmljZXM6IFNlcnZpY2VzSW50ZXJmYWNlLFxuXHR1dGlsczogVXRpbGl0aWVzSW50ZXJmYWNlXG4pOiBBcHBVdGlsc0ludGVyZmFjZSB7XG5cdHJldHVybiB7XG5cdFx0Z2VuZXJhdGVSYW5kb21IU0woKTogSFNMIHtcblx0XHRcdGNvbnN0IGxvZyA9IHNlcnZpY2VzLmxvZztcblxuXHRcdFx0dHJ5IHtcblx0XHRcdFx0Y29uc3QgaHNsOiBIU0wgPSB7XG5cdFx0XHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0XHRcdGh1ZTogdXRpbHMuc2FuaXRpemUucmFkaWFsKFxuXHRcdFx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzNjApXG5cdFx0XHRcdFx0XHQpLFxuXHRcdFx0XHRcdFx0c2F0dXJhdGlvbjogdXRpbHMuc2FuaXRpemUucGVyY2VudGlsZShcblx0XHRcdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHRcdFx0KSxcblx0XHRcdFx0XHRcdGxpZ2h0bmVzczogdXRpbHMuc2FuaXRpemUucGVyY2VudGlsZShcblx0XHRcdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHRcdFx0KVxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Zm9ybWF0OiAnaHNsJ1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGlmICghdXRpbHMudmFsaWRhdGUuY29sb3JWYWx1ZShoc2wpKSB7XG5cdFx0XHRcdFx0bG9nKFxuXHRcdFx0XHRcdFx0YEludmFsaWQgcmFuZG9tIEhTTCBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzbCl9YCxcblx0XHRcdFx0XHRcdCdlcnJvcidcblx0XHRcdFx0XHQpO1xuXG5cdFx0XHRcdFx0cmV0dXJuIGRlZmF1bHRDb2xvcnMuaHNsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bG9nKGBHZW5lcmF0ZWQgcmFuZG9tSFNMOiAke0pTT04uc3RyaW5naWZ5KGhzbCl9YCwgJ2RlYnVnJyk7XG5cblx0XHRcdFx0cmV0dXJuIGhzbDtcblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdGxvZyhgRXJyb3IgZ2VuZXJhdGluZyByYW5kb20gSFNMIGNvbG9yOiAke2Vycm9yfWAsICd3YXJuJyk7XG5cblx0XHRcdFx0cmV0dXJuIGRlZmF1bHRDb2xvcnMuaHNsO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0Z2VuZXJhdGVSYW5kb21TTCgpOiBTTCB7XG5cdFx0XHRjb25zdCBsb2cgPSBzZXJ2aWNlcy5sb2c7XG5cblx0XHRcdHRyeSB7XG5cdFx0XHRcdGNvbnN0IHNsOiBTTCA9IHtcblx0XHRcdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRcdFx0c2F0dXJhdGlvbjogdXRpbHMuc2FuaXRpemUucGVyY2VudGlsZShcblx0XHRcdFx0XHRcdFx0TWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBNYXRoLnJhbmRvbSgpICogMTAwKSlcblx0XHRcdFx0XHRcdCksXG5cdFx0XHRcdFx0XHRsaWdodG5lc3M6IHV0aWxzLnNhbml0aXplLnBlcmNlbnRpbGUoXG5cdFx0XHRcdFx0XHRcdE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgTWF0aC5yYW5kb20oKSAqIDEwMCkpXG5cdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRmb3JtYXQ6ICdzbCdcblx0XHRcdFx0fTtcblxuXHRcdFx0XHRpZiAoIXV0aWxzLnZhbGlkYXRlLmNvbG9yVmFsdWUoc2wgYXMgU0wpKSB7XG5cdFx0XHRcdFx0bG9nKFxuXHRcdFx0XHRcdFx0YEludmFsaWQgcmFuZG9tIFNWIGNvbG9yIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoc2wpfWAsXG5cdFx0XHRcdFx0XHQnZXJyb3InXG5cdFx0XHRcdFx0KTtcblxuXHRcdFx0XHRcdHJldHVybiBkZWZhdWx0Q29sb3JzLnNsO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0bG9nKGBHZW5lcmF0ZWQgcmFuZG9tU0w6ICR7SlNPTi5zdHJpbmdpZnkoc2wpfWAsICdkZWJ1ZycpO1xuXG5cdFx0XHRcdHJldHVybiBzbDtcblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdGxvZyhgRXJyb3IgZ2VuZXJhdGluZyByYW5kb20gU0wgY29sb3I6ICR7ZXJyb3J9YCwgJ2Vycm9yJyk7XG5cblx0XHRcdFx0cmV0dXJuIGRlZmF1bHRDb2xvcnMuc2w7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRnZXRGb3JtYXR0ZWRUaW1lc3RhbXAoKTogc3RyaW5nIHtcblx0XHRcdGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cdFx0XHRjb25zdCB5ZWFyID0gbm93LmdldEZ1bGxZZWFyKCk7XG5cdFx0XHRjb25zdCBtb250aCA9IFN0cmluZyhub3cuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJyk7XG5cdFx0XHRjb25zdCBkYXkgPSBTdHJpbmcobm93LmdldERhdGUoKSkucGFkU3RhcnQoMiwgJzAnKTtcblx0XHRcdGNvbnN0IGhvdXJzID0gU3RyaW5nKG5vdy5nZXRIb3VycygpKS5wYWRTdGFydCgyLCAnMCcpO1xuXHRcdFx0Y29uc3QgbWludXRlcyA9IFN0cmluZyhub3cuZ2V0TWludXRlcygpKS5wYWRTdGFydCgyLCAnMCcpO1xuXHRcdFx0Y29uc3Qgc2Vjb25kcyA9IFN0cmluZyhub3cuZ2V0U2Vjb25kcygpKS5wYWRTdGFydCgyLCAnMCcpO1xuXG5cdFx0XHRyZXR1cm4gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9ICR7aG91cnN9OiR7bWludXRlc306JHtzZWNvbmRzfWA7XG5cdFx0fSxcblx0XHRhc3luYyB0cmFjZVByb21pc2UoXG5cdFx0XHRwcm9taXNlOiBQcm9taXNlPHVua25vd24+LFxuXHRcdFx0bGFiZWw6IHN0cmluZ1xuXHRcdCk6IFByb21pc2U8dW5rbm93bj4ge1xuXHRcdFx0cmV0dXJuIHByb21pc2Vcblx0XHRcdFx0LnRoZW4ocmVzdWx0ID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZyhgW1RSQUNFIFNVQ0NFU1NdICR7bGFiZWx9OmAsIHJlc3VsdCk7XG5cdFx0XHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHRcdFx0fSlcblx0XHRcdFx0LmNhdGNoKGVycm9yID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKGBbVFJBQ0UgRVJST1JdICR7bGFiZWx9OmAsIGVycm9yKTtcblx0XHRcdFx0XHR0aHJvdyBlcnJvcjtcblx0XHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xufVxuIl19