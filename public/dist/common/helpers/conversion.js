// File: common/helpers/conversion.js
import { createLogger } from '../../logger/index.js';
import { coreUtils } from '../core.js';
import { defaultData as defaults } from '../../data/defaults.js';
import { modeData as mode } from '../../data/mode.js';
const logMode = mode.logging;
const thisModule = 'common/helpers/conversion.js';
const logger = await createLogger();
export function applyGammaCorrection(value) {
    const thisMethod = 'applyGammaCorrection()';
    try {
        return value > 0.0031308
            ? 1.055 * Math.pow(value, 1 / 2.4) - 0.055
            : 12.92 * value;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error applying gamma correction: ${error}`, `${thisModule} > ${thisMethod}`);
        return value;
    }
}
export function clampRGB(rgb) {
    const thisMethod = 'clampRGB()';
    const defaultRGBUnbranded = coreUtils.base.clone(defaults.colors.base.unbranded.rgb);
    const defaultRGBBranded = coreUtils.brandColor.asRGB(defaultRGBUnbranded);
    if (!coreUtils.validate.colorValues(rgb)) {
        if (logMode.error)
            logger.error(`Invalid RGB value ${JSON.stringify(rgb)}`, `${thisModule} > ${thisMethod}`);
        return defaultRGBBranded;
    }
    try {
        return {
            value: {
                red: coreUtils.brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.red), 1) * 255)),
                green: coreUtils.brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.green), 1) * 255)),
                blue: coreUtils.brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.blue), 1) * 255))
            },
            format: 'rgb'
        };
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error clamping RGB values: ${error}`, `${thisModule} > ${thisMethod}`);
        return rgb;
    }
}
export function hueToRGB(p, q, t) {
    const thisMethod = 'hueToRGB()';
    try {
        const clonedP = coreUtils.base.clone(p);
        const clonedQ = coreUtils.base.clone(q);
        let clonedT = coreUtils.base.clone(t);
        if (clonedT < 0)
            clonedT += 1;
        if (clonedT > 1)
            clonedT -= 1;
        if (clonedT < 1 / 6)
            return clonedP + (clonedQ - clonedP) * 6 * clonedT;
        if (clonedT < 1 / 2)
            return clonedQ;
        if (clonedT < 2 / 3)
            return clonedP + (clonedQ - clonedP) * (2 / 3 - clonedT) * 6;
        return clonedP;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error converting hue to RGB: ${error}`, `${thisModule} > ${thisMethod}`);
        return 0;
    }
}
export function hslAddFormat(value) {
    const thisMethod = 'hslAddFormat()';
    const defaultHSLUnbranded = coreUtils.base.clone(defaults.colors.base.unbranded.hsl);
    const defaultHSLBranded = coreUtils.brandColor.asHSL(defaultHSLUnbranded);
    try {
        if (!coreUtils.validate.colorValues({ value: value, format: 'hsl' })) {
            if (logMode.error)
                logger.error(`Invalid HSL value ${JSON.stringify(value)}`, `${thisModule} > ${thisMethod}`);
            return defaultHSLBranded;
        }
        return { value: value, format: 'hsl' };
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error adding HSL format: ${error}`, `${thisModule} > ${thisMethod}`);
        return defaultHSLBranded;
    }
}
export const conversionHelpers = {
    applyGammaCorrection,
    clampRGB,
    hslAddFormat,
    hueToRGB
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVyc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21tb24vaGVscGVycy9jb252ZXJzaW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHFDQUFxQztBQUdyQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDckQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN2QyxPQUFPLEVBQUUsV0FBVyxJQUFJLFFBQVEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxRQUFRLElBQUksSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFdEQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUU3QixNQUFNLFVBQVUsR0FBRyw4QkFBOEIsQ0FBQztBQUVsRCxNQUFNLE1BQU0sR0FBRyxNQUFNLFlBQVksRUFBRSxDQUFDO0FBRXBDLE1BQU0sVUFBVSxvQkFBb0IsQ0FBQyxLQUFhO0lBQ2pELE1BQU0sVUFBVSxHQUFHLHdCQUF3QixDQUFDO0lBRTVDLElBQUksQ0FBQztRQUNKLE9BQU8sS0FBSyxHQUFHLFNBQVM7WUFDdkIsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsS0FBSztZQUMxQyxDQUFDLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNsQixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLE9BQU8sQ0FBQyxLQUFLO1lBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsb0NBQW9DLEtBQUssRUFBRSxFQUMzQyxHQUFHLFVBQVUsTUFBTSxVQUFVLEVBQUUsQ0FDL0IsQ0FBQztRQUVILE9BQU8sS0FBSyxDQUFDO0lBQ2QsQ0FBQztBQUNGLENBQUM7QUFFRCxNQUFNLFVBQVUsUUFBUSxDQUFDLEdBQVE7SUFD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QUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBUyxDQUFDO0lBQy9DLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLElBQUksT0FBTyxDQUFDLEtBQUs7WUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FDWCw0QkFBNEIsS0FBSyxFQUFFLEVBQ25DLEdBQUcsVUFBVSxNQUFNLFVBQVUsRUFBRSxDQUMvQixDQUFDO1FBRUgsT0FBTyxpQkFBaUIsQ0FBQztJQUMxQixDQUFDO0FBQ0YsQ0FBQztBQUVELE1BQU0sQ0FBQyxNQUFNLGlCQUFpQixHQUM3QjtJQUNDLG9CQUFvQjtJQUNwQixRQUFRO0lBQ1IsWUFBWTtJQUNaLFFBQVE7Q0FDQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogY29tbW9uL2hlbHBlcnMvY29udmVyc2lvbi5qc1xuXG5pbXBvcnQgeyBDb21tb25Gbl9NYXN0ZXJJbnRlcmZhY2UsIEhTTCwgUkdCIH0gZnJvbSAnLi4vLi4vdHlwZXMvaW5kZXguanMnO1xuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnLi4vLi4vbG9nZ2VyL2luZGV4LmpzJztcbmltcG9ydCB7IGNvcmVVdGlscyB9IGZyb20gJy4uL2NvcmUuanMnO1xuaW1wb3J0IHsgZGVmYXVsdERhdGEgYXMgZGVmYXVsdHMgfSBmcm9tICcuLi8uLi9kYXRhL2RlZmF1bHRzLmpzJztcbmltcG9ydCB7IG1vZGVEYXRhIGFzIG1vZGUgfSBmcm9tICcuLi8uLi9kYXRhL21vZGUuanMnO1xuXG5jb25zdCBsb2dNb2RlID0gbW9kZS5sb2dnaW5nO1xuXG5jb25zdCB0aGlzTW9kdWxlID0gJ2NvbW1vbi9oZWxwZXJzL2NvbnZlcnNpb24uanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5R2FtbWFDb3JyZWN0aW9uKHZhbHVlOiBudW1iZXIpOiBudW1iZXIge1xuXHRjb25zdCB0aGlzTWV0aG9kID0gJ2FwcGx5R2FtbWFDb3JyZWN0aW9uKCknO1xuXG5cdHRyeSB7XG5cdFx0cmV0dXJuIHZhbHVlID4gMC4wMDMxMzA4XG5cdFx0XHQ/IDEuMDU1ICogTWF0aC5wb3codmFsdWUsIDEgLyAyLjQpIC0gMC4wNTVcblx0XHRcdDogMTIuOTIgKiB2YWx1ZTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGFwcGx5aW5nIGdhbW1hIGNvcnJlY3Rpb246ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblxuXHRcdHJldHVybiB2YWx1ZTtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY2xhbXBSR0IocmdiOiBSR0IpOiBSR0Ige1xuXHRjb25zdCB0aGlzTWV0aG9kID0gJ2NsYW1wUkdCKCknO1xuXHRjb25zdCBkZWZhdWx0UkdCVW5icmFuZGVkID0gY29yZVV0aWxzLmJhc2UuY2xvbmUoXG5cdFx0ZGVmYXVsdHMuY29sb3JzLmJhc2UudW5icmFuZGVkLnJnYlxuXHQpO1xuXHRjb25zdCBkZWZhdWx0UkdCQnJhbmRlZCA9IGNvcmVVdGlscy5icmFuZENvbG9yLmFzUkdCKGRlZmF1bHRSR0JVbmJyYW5kZWQpO1xuXG5cdGlmICghY29yZVV0aWxzLnZhbGlkYXRlLmNvbG9yVmFsdWVzKHJnYikpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEludmFsaWQgUkdCIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkocmdiKX1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIGRlZmF1bHRSR0JCcmFuZGVkO1xuXHR9XG5cblx0dHJ5IHtcblx0XHRyZXR1cm4ge1xuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0cmVkOiBjb3JlVXRpbHMuYnJhbmQuYXNCeXRlUmFuZ2UoXG5cdFx0XHRcdFx0TWF0aC5yb3VuZChNYXRoLm1pbihNYXRoLm1heCgwLCByZ2IudmFsdWUucmVkKSwgMSkgKiAyNTUpXG5cdFx0XHRcdCksXG5cdFx0XHRcdGdyZWVuOiBjb3JlVXRpbHMuYnJhbmQuYXNCeXRlUmFuZ2UoXG5cdFx0XHRcdFx0TWF0aC5yb3VuZChNYXRoLm1pbihNYXRoLm1heCgwLCByZ2IudmFsdWUuZ3JlZW4pLCAxKSAqIDI1NSlcblx0XHRcdFx0KSxcblx0XHRcdFx0Ymx1ZTogY29yZVV0aWxzLmJyYW5kLmFzQnl0ZVJhbmdlKFxuXHRcdFx0XHRcdE1hdGgucm91bmQoTWF0aC5taW4oTWF0aC5tYXgoMCwgcmdiLnZhbHVlLmJsdWUpLCAxKSAqIDI1NSlcblx0XHRcdFx0KVxuXHRcdFx0fSxcblx0XHRcdGZvcm1hdDogJ3JnYidcblx0XHR9O1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRXJyb3IgY2xhbXBpbmcgUkdCIHZhbHVlczogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIHJnYjtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaHVlVG9SR0IocDogbnVtYmVyLCBxOiBudW1iZXIsIHQ6IG51bWJlcik6IG51bWJlciB7XG5cdGNvbnN0IHRoaXNNZXRob2QgPSAnaHVlVG9SR0IoKSc7XG5cblx0dHJ5IHtcblx0XHRjb25zdCBjbG9uZWRQID0gY29yZVV0aWxzLmJhc2UuY2xvbmUocCk7XG5cdFx0Y29uc3QgY2xvbmVkUSA9IGNvcmVVdGlscy5iYXNlLmNsb25lKHEpO1xuXG5cdFx0bGV0IGNsb25lZFQgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZSh0KTtcblxuXHRcdGlmIChjbG9uZWRUIDwgMCkgY2xvbmVkVCArPSAxO1xuXHRcdGlmIChjbG9uZWRUID4gMSkgY2xvbmVkVCAtPSAxO1xuXHRcdGlmIChjbG9uZWRUIDwgMSAvIDYpIHJldHVybiBjbG9uZWRQICsgKGNsb25lZFEgLSBjbG9uZWRQKSAqIDYgKiBjbG9uZWRUO1xuXHRcdGlmIChjbG9uZWRUIDwgMSAvIDIpIHJldHVybiBjbG9uZWRRO1xuXHRcdGlmIChjbG9uZWRUIDwgMiAvIDMpXG5cdFx0XHRyZXR1cm4gY2xvbmVkUCArIChjbG9uZWRRIC0gY2xvbmVkUCkgKiAoMiAvIDMgLSBjbG9uZWRUKSAqIDY7XG5cblx0XHRyZXR1cm4gY2xvbmVkUDtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGNvbnZlcnRpbmcgaHVlIHRvIFJHQjogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIDA7XG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhzbEFkZEZvcm1hdCh2YWx1ZTogSFNMWyd2YWx1ZSddKTogSFNMIHtcblx0Y29uc3QgdGhpc01ldGhvZCA9ICdoc2xBZGRGb3JtYXQoKSc7XG5cdGNvbnN0IGRlZmF1bHRIU0xVbmJyYW5kZWQgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZShcblx0XHRkZWZhdWx0cy5jb2xvcnMuYmFzZS51bmJyYW5kZWQuaHNsXG5cdCk7XG5cdGNvbnN0IGRlZmF1bHRIU0xCcmFuZGVkID0gY29yZVV0aWxzLmJyYW5kQ29sb3IuYXNIU0woZGVmYXVsdEhTTFVuYnJhbmRlZCk7XG5cblx0dHJ5IHtcblx0XHRpZiAoIWNvcmVVdGlscy52YWxpZGF0ZS5jb2xvclZhbHVlcyh7IHZhbHVlOiB2YWx1ZSwgZm9ybWF0OiAnaHNsJyB9KSkge1xuXHRcdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHRgSW52YWxpZCBIU0wgdmFsdWUgJHtKU09OLnN0cmluZ2lmeSh2YWx1ZSl9YCxcblx0XHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBkZWZhdWx0SFNMQnJhbmRlZDtcblx0XHR9XG5cblx0XHRyZXR1cm4geyB2YWx1ZTogdmFsdWUsIGZvcm1hdDogJ2hzbCcgfSBhcyBIU0w7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBhZGRpbmcgSFNMIGZvcm1hdDogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIGRlZmF1bHRIU0xCcmFuZGVkO1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCBjb252ZXJzaW9uSGVscGVyczogQ29tbW9uRm5fTWFzdGVySW50ZXJmYWNlWydoZWxwZXJzJ11bJ2NvbnZlcnNpb24nXSA9XG5cdHtcblx0XHRhcHBseUdhbW1hQ29ycmVjdGlvbixcblx0XHRjbGFtcFJHQixcblx0XHRoc2xBZGRGb3JtYXQsXG5cdFx0aHVlVG9SR0Jcblx0fSBhcyBjb25zdDtcbiJdfQ==