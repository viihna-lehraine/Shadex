// File: common/helpers/conversion.js
import { createLogger } from '../../logger/index.js';
import { coreUtils } from '../core.js';
import { defaultData as defaults } from '../../data/defaults.js';
import { modeData as mode } from '../../data/mode.js';
const logMode = mode.logging;
const thisModule = 'common/helpers/conversion.js';
const logger = await createLogger();
export function applyGammaCorrection(value) {
    const thisMethod = 'applyGammaCorrection()';
    try {
        return value > 0.0031308
            ? 1.055 * Math.pow(value, 1 / 2.4) - 0.055
            : 12.92 * value;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error applying gamma correction: ${error}`, `${thisModule} > ${thisMethod}`);
        return value;
    }
}
export function clampRGB(rgb) {
    const thisMethod = 'clampRGB()';
    const defaultRGBUnbranded = coreUtils.base.clone(defaults.colors.base.unbranded.rgb);
    const defaultRGBBranded = coreUtils.brandColor.asRGB(defaultRGBUnbranded);
    if (!coreUtils.validate.colorValues(rgb)) {
        if (logMode.error)
            logger.error(`Invalid RGB value ${JSON.stringify(rgb)}`, `${thisModule} > ${thisMethod}`);
        return defaultRGBBranded;
    }
    try {
        return {
            value: {
                red: coreUtils.brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.red), 1) * 255)),
                green: coreUtils.brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.green), 1) * 255)),
                blue: coreUtils.brand.asByteRange(Math.round(Math.min(Math.max(0, rgb.value.blue), 1) * 255)),
                alpha: coreUtils.brand.asAlphaRange(parseFloat(Math.min(Math.max(0, rgb.value.alpha), 1).toFixed(2)))
            },
            format: 'rgb'
        };
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error clamping RGB values: ${error}`, `${thisModule} > ${thisMethod}`);
        return rgb;
    }
}
export function hueToRGB(p, q, t) {
    const thisMethod = 'hueToRGB()';
    try {
        const clonedP = coreUtils.base.clone(p);
        const clonedQ = coreUtils.base.clone(q);
        let clonedT = coreUtils.base.clone(t);
        if (clonedT < 0)
            clonedT += 1;
        if (clonedT > 1)
            clonedT -= 1;
        if (clonedT < 1 / 6)
            return clonedP + (clonedQ - clonedP) * 6 * clonedT;
        if (clonedT < 1 / 2)
            return clonedQ;
        if (clonedT < 2 / 3)
            return clonedP + (clonedQ - clonedP) * (2 / 3 - clonedT) * 6;
        return clonedP;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error converting hue to RGB: ${error}`, `${thisModule} > ${thisMethod}`);
        return 0;
    }
}
export function hslAddFormat(value) {
    const thisMethod = 'hslAddFormat()';
    const defaultHSLUnbranded = coreUtils.base.clone(defaults.colors.base.unbranded.hsl);
    const defaultHSLBranded = coreUtils.brandColor.asHSL(defaultHSLUnbranded);
    try {
        if (!coreUtils.validate.colorValues({ value: value, format: 'hsl' })) {
            if (logMode.error)
                logger.error(`Invalid HSL value ${JSON.stringify(value)}`, `${thisModule} > ${thisMethod}`);
            return defaultHSLBranded;
        }
        return { value: value, format: 'hsl' };
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error adding HSL format: ${error}`, `${thisModule} > ${thisMethod}`);
        return defaultHSLBranded;
    }
}
export const conversionHelpers = {
    applyGammaCorrection,
    clampRGB,
    hslAddFormat,
    hueToRGB
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udmVyc2lvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21tb24vaGVscGVycy9jb252ZXJzaW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHFDQUFxQztBQUdyQyxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFDckQsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQUN2QyxPQUFPLEVBQUUsV0FBVyxJQUFJLFFBQVEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ2pFLE9BQU8sRUFBRSxRQUFRLElBQUksSUFBSSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFdEQsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUU3QixNQUFNLFVBQVUsR0FBRyw4QkFBOEIsQ0FBQztBQUVsRCxNQUFNLE1BQU0sR0FBRyxNQUFNLFlBQVksRUFBRSxDQUFDO0FBRXBDLE1BQU0sVUFBVSxvQkFBb0IsQ0FBQyxLQUFhO0lBQ2pELE1BQU0sVUFBVSxHQUFHLHdCQUF3QixDQUFDO0lBRTVDLElBQUksQ0FBQztRQUNKLE9BQU8sS0FBSyxHQUFHLFNBQVM7WUFDdkIsQ0FBQyxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsS0FBSztZQUMxQyxDQUFDLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUNsQixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLE9BQU8sQ0FBQyxLQUFLO1lBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsb0NBQW9DLEtBQUssRUFBRSxFQUMzQyxHQUFHLFVBQVUsTUFBTSxVQUFVLEVBQUUsQ0FDL0IsQ0FBQztRQUVILE9BQU8sS0FBSyxDQUFDO0lBQ2QsQ0FBQztBQUNGLENBQUM7QUFFRCxNQUFNLFVBQVUsUUFBUSxDQUFDLEdBQVE7SUFD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RSxDQUFDO1lBQ3RFLElBQUksT0FBTyxDQUFDLEtBQUs7Z0JBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gscUJBQXFCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFDNUMsR0FBRyxVQUFVLE1BQU0sVUFBVSxFQUFFLENBQy9CLENBQUM7WUFFSCxPQUFPLGlCQUFpQixDQUFDO1FBQzFCLENBQUM7UUFFRCxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFTLENBQUM7SUFDL0MsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsSUFBSSxPQUFPLENBQUMsS0FBSztZQUNoQixNQUFNLENBQUMsS0FBSyxDQUNYLDRCQUE0QixLQUFLLEVBQUUsRUFDbkMsR0FBRyxVQUFVLE1BQU0sVUFBVSxFQUFFLENBQy9CLENBQUM7UUFFSCxPQUFPLGlCQUFpQixDQUFDO0lBQzFCLENBQUM7QUFDRixDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0saUJBQWlCLEdBQzdCO0lBQ0Msb0JBQW9CO0lBQ3BCLFFBQVE7SUFDUixZQUFZO0lBQ1osUUFBUTtDQUNDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBjb21tb24vaGVscGVycy9jb252ZXJzaW9uLmpzXG5cbmltcG9ydCB7IENvbW1vbkZuX01hc3RlckludGVyZmFjZSwgSFNMLCBSR0IgfSBmcm9tICcuLi8uLi90eXBlcy9pbmRleC5qcyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuLi8uLi9sb2dnZXIvaW5kZXguanMnO1xuaW1wb3J0IHsgY29yZVV0aWxzIH0gZnJvbSAnLi4vY29yZS5qcyc7XG5pbXBvcnQgeyBkZWZhdWx0RGF0YSBhcyBkZWZhdWx0cyB9IGZyb20gJy4uLy4uL2RhdGEvZGVmYXVsdHMuanMnO1xuaW1wb3J0IHsgbW9kZURhdGEgYXMgbW9kZSB9IGZyb20gJy4uLy4uL2RhdGEvbW9kZS5qcyc7XG5cbmNvbnN0IGxvZ01vZGUgPSBtb2RlLmxvZ2dpbmc7XG5cbmNvbnN0IHRoaXNNb2R1bGUgPSAnY29tbW9uL2hlbHBlcnMvY29udmVyc2lvbi5qcyc7XG5cbmNvbnN0IGxvZ2dlciA9IGF3YWl0IGNyZWF0ZUxvZ2dlcigpO1xuXG5leHBvcnQgZnVuY3Rpb24gYXBwbHlHYW1tYUNvcnJlY3Rpb24odmFsdWU6IG51bWJlcik6IG51bWJlciB7XG5cdGNvbnN0IHRoaXNNZXRob2QgPSAnYXBwbHlHYW1tYUNvcnJlY3Rpb24oKSc7XG5cblx0dHJ5IHtcblx0XHRyZXR1cm4gdmFsdWUgPiAwLjAwMzEzMDhcblx0XHRcdD8gMS4wNTUgKiBNYXRoLnBvdyh2YWx1ZSwgMSAvIDIuNCkgLSAwLjA1NVxuXHRcdFx0OiAxMi45MiAqIHZhbHVlO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRXJyb3IgYXBwbHlpbmcgZ2FtbWEgY29ycmVjdGlvbjogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIHZhbHVlO1xuXHR9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGFtcFJHQihyZ2I6IFJHQik6IFJHQiB7XG5cdGNvbnN0IHRoaXNNZXRob2QgPSAnY2xhbXBSR0IoKSc7XG5cdGNvbnN0IGRlZmF1bHRSR0JVbmJyYW5kZWQgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZShcblx0XHRkZWZhdWx0cy5jb2xvcnMuYmFzZS51bmJyYW5kZWQucmdiXG5cdCk7XG5cdGNvbnN0IGRlZmF1bHRSR0JCcmFuZGVkID0gY29yZVV0aWxzLmJyYW5kQ29sb3IuYXNSR0IoZGVmYXVsdFJHQlVuYnJhbmRlZCk7XG5cblx0aWYgKCFjb3JlVXRpbHMudmFsaWRhdGUuY29sb3JWYWx1ZXMocmdiKSkge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgSW52YWxpZCBSR0IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShyZ2IpfWAsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cblx0XHRyZXR1cm4gZGVmYXVsdFJHQkJyYW5kZWQ7XG5cdH1cblxuXHR0cnkge1xuXHRcdHJldHVybiB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRyZWQ6IGNvcmVVdGlscy5icmFuZC5hc0J5dGVSYW5nZShcblx0XHRcdFx0XHRNYXRoLnJvdW5kKE1hdGgubWluKE1hdGgubWF4KDAsIHJnYi52YWx1ZS5yZWQpLCAxKSAqIDI1NSlcblx0XHRcdFx0KSxcblx0XHRcdFx0Z3JlZW46IGNvcmVVdGlscy5icmFuZC5hc0J5dGVSYW5nZShcblx0XHRcdFx0XHRNYXRoLnJvdW5kKE1hdGgubWluKE1hdGgubWF4KDAsIHJnYi52YWx1ZS5ncmVlbiksIDEpICogMjU1KVxuXHRcdFx0XHQpLFxuXHRcdFx0XHRibHVlOiBjb3JlVXRpbHMuYnJhbmQuYXNCeXRlUmFuZ2UoXG5cdFx0XHRcdFx0TWF0aC5yb3VuZChNYXRoLm1pbihNYXRoLm1heCgwLCByZ2IudmFsdWUuYmx1ZSksIDEpICogMjU1KVxuXHRcdFx0XHQpLFxuXHRcdFx0XHRhbHBoYTogY29yZVV0aWxzLmJyYW5kLmFzQWxwaGFSYW5nZShcblx0XHRcdFx0XHRwYXJzZUZsb2F0KFxuXHRcdFx0XHRcdFx0TWF0aC5taW4oTWF0aC5tYXgoMCwgcmdiLnZhbHVlLmFscGhhKSwgMSkudG9GaXhlZCgyKVxuXHRcdFx0XHRcdClcblx0XHRcdFx0KVxuXHRcdFx0fSxcblx0XHRcdGZvcm1hdDogJ3JnYidcblx0XHR9O1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRXJyb3IgY2xhbXBpbmcgUkdCIHZhbHVlczogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIHJnYjtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gaHVlVG9SR0IocDogbnVtYmVyLCBxOiBudW1iZXIsIHQ6IG51bWJlcik6IG51bWJlciB7XG5cdGNvbnN0IHRoaXNNZXRob2QgPSAnaHVlVG9SR0IoKSc7XG5cblx0dHJ5IHtcblx0XHRjb25zdCBjbG9uZWRQID0gY29yZVV0aWxzLmJhc2UuY2xvbmUocCk7XG5cdFx0Y29uc3QgY2xvbmVkUSA9IGNvcmVVdGlscy5iYXNlLmNsb25lKHEpO1xuXG5cdFx0bGV0IGNsb25lZFQgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZSh0KTtcblxuXHRcdGlmIChjbG9uZWRUIDwgMCkgY2xvbmVkVCArPSAxO1xuXHRcdGlmIChjbG9uZWRUID4gMSkgY2xvbmVkVCAtPSAxO1xuXHRcdGlmIChjbG9uZWRUIDwgMSAvIDYpIHJldHVybiBjbG9uZWRQICsgKGNsb25lZFEgLSBjbG9uZWRQKSAqIDYgKiBjbG9uZWRUO1xuXHRcdGlmIChjbG9uZWRUIDwgMSAvIDIpIHJldHVybiBjbG9uZWRRO1xuXHRcdGlmIChjbG9uZWRUIDwgMiAvIDMpXG5cdFx0XHRyZXR1cm4gY2xvbmVkUCArIChjbG9uZWRRIC0gY2xvbmVkUCkgKiAoMiAvIDMgLSBjbG9uZWRUKSAqIDY7XG5cblx0XHRyZXR1cm4gY2xvbmVkUDtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGNvbnZlcnRpbmcgaHVlIHRvIFJHQjogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIDA7XG5cdH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhzbEFkZEZvcm1hdCh2YWx1ZTogSFNMWyd2YWx1ZSddKTogSFNMIHtcblx0Y29uc3QgdGhpc01ldGhvZCA9ICdoc2xBZGRGb3JtYXQoKSc7XG5cdGNvbnN0IGRlZmF1bHRIU0xVbmJyYW5kZWQgPSBjb3JlVXRpbHMuYmFzZS5jbG9uZShcblx0XHRkZWZhdWx0cy5jb2xvcnMuYmFzZS51bmJyYW5kZWQuaHNsXG5cdCk7XG5cdGNvbnN0IGRlZmF1bHRIU0xCcmFuZGVkID0gY29yZVV0aWxzLmJyYW5kQ29sb3IuYXNIU0woZGVmYXVsdEhTTFVuYnJhbmRlZCk7XG5cblx0dHJ5IHtcblx0XHRpZiAoIWNvcmVVdGlscy52YWxpZGF0ZS5jb2xvclZhbHVlcyh7IHZhbHVlOiB2YWx1ZSwgZm9ybWF0OiAnaHNsJyB9KSkge1xuXHRcdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHRgSW52YWxpZCBIU0wgdmFsdWUgJHtKU09OLnN0cmluZ2lmeSh2YWx1ZSl9YCxcblx0XHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBkZWZhdWx0SFNMQnJhbmRlZDtcblx0XHR9XG5cblx0XHRyZXR1cm4geyB2YWx1ZTogdmFsdWUsIGZvcm1hdDogJ2hzbCcgfSBhcyBIU0w7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBhZGRpbmcgSFNMIGZvcm1hdDogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIGRlZmF1bHRIU0xCcmFuZGVkO1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCBjb252ZXJzaW9uSGVscGVyczogQ29tbW9uRm5fTWFzdGVySW50ZXJmYWNlWydoZWxwZXJzJ11bJ2NvbnZlcnNpb24nXSA9XG5cdHtcblx0XHRhcHBseUdhbW1hQ29ycmVjdGlvbixcblx0XHRjbGFtcFJHQixcblx0XHRoc2xBZGRGb3JtYXQsXG5cdFx0aHVlVG9SR0Jcblx0fSBhcyBjb25zdDtcbiJdfQ==