// File: common/helpers/dom.js
import { constsData as consts } from '../../data/consts.js';
import { coreUtils } from '../core.js';
import { createLogger } from '../../logger/index.js';
import { modeData as mode } from '../../data/mode.js';
const thisModule = 'common/helpers/dom.js';
const logger = await createLogger();
const logMode = mode.logging;
const timeouts = consts.timeouts;
let dragSrcEl = null;
function attachDragAndDropListeners(element) {
    const thisMethod = 'attachDragAndDropEventListeners()';
    try {
        if (element) {
            element.addEventListener('dragstart', dragStart);
            element.addEventListener('dragover', dragOver);
            element.addEventListener('drop', drop);
            element.addEventListener('dragend', dragEnd);
        }
        if (!mode.quiet)
            logger.info('Drag and drop event listeners successfully attached', `${thisModule} > ${thisMethod}`);
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Failed to execute attachDragAndDropEventListeners: ${error}`, `${thisModule} > ${thisMethod}`);
    }
}
function dragStart(e) {
    const thisMethod = 'handleDragStart()';
    try {
        dragSrcEl = e.currentTarget;
        if (e.dataTransfer) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', dragSrcEl.outerHTML);
        }
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDragStart complete', `${thisModule} > ${thisMethod}`);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragStart: ${error}`, `${thisModule} > ${thisMethod}`);
    }
}
function dragOver(e) {
    const thisMethod = 'handleDragOver()';
    try {
        e.preventDefault();
        if (e.dataTransfer) {
            e.dataTransfer.dropEffect = 'move';
        }
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDragOver complete', `${thisModule} > ${thisMethod}`);
        return false;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragOver: ${error}`, `${thisModule} > ${thisMethod}`);
        return false;
    }
}
function dragEnd(e) {
    const thisMethod = 'handleDragEnd()';
    try {
        const target = e.currentTarget;
        target.classList.remove('dragging');
        document.querySelectorAll('.color-stripe').forEach(el => {
            el.classList.remove('dragging');
        });
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDragEnd complete', `${thisModule} > ${thisMethod}`);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragEnd: ${error}`, `${thisModule} > ${thisMethod}`);
    }
}
function drop(e) {
    const thisMethod = 'drop()';
    try {
        e.stopPropagation();
        const target = e.currentTarget;
        if (dragSrcEl && dragSrcEl !== target) {
            const dragSrcId = dragSrcEl.id;
            const dropTargetId = target.id;
            const dragSrcText = dragSrcEl.querySelector('.color-text-output-box').value;
            const dropTargetText = target.querySelector('.color-text-output-box').value;
            const dragSrcOuterHTML = dragSrcEl.outerHTML;
            const dropTargetOuterHTML = target.outerHTML;
            dragSrcEl.outerHTML = dropTargetOuterHTML;
            target.outerHTML = dragSrcOuterHTML;
            const newDragSrcEl = document.getElementById(dropTargetId);
            const newDropTargetEl = document.getElementById(dragSrcId);
            newDragSrcEl.id = dragSrcId;
            newDropTargetEl.id = dropTargetId;
            newDragSrcEl.querySelector('.color-text-output-box').value = dropTargetText;
            newDropTargetEl.querySelector('.color-text-output-box').value = dragSrcText;
            if (!mode.quiet && mode.debug && logMode.verbosity > 3)
                logger.info('calling attachDragAndDropEventListeners for new elements', `${thisModule} > ${thisMethod}`);
            attachDragAndDropListeners(newDragSrcEl);
            attachDragAndDropListeners(newDropTargetEl);
        }
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDrop complete', `${thisModule} > ${thisMethod}`);
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Error in handleDrop: ${error}`, `${thisModule} > ${thisMethod}`);
    }
}
async function makePaletteBox(color, paletteBoxCount) {
    const thisMethod = 'makePaletteBox()';
    try {
        if (!coreUtils.validate.colorValues(color)) {
            if (!logMode.error)
                logger.error(`Invalid ${color.format} color value ${JSON.stringify(color)}`, `${thisModule} > ${thisMethod}`);
            return {
                colorStripe: document.createElement('div'),
                paletteBoxCount
            };
        }
        const clonedColor = coreUtils.base.clone(color);
        const paletteBox = document.createElement('div');
        paletteBox.className = 'palette-box';
        paletteBox.id = `palette-box-${paletteBoxCount}`;
        const paletteBoxTopHalf = document.createElement('div');
        paletteBoxTopHalf.className = 'palette-box-half palette-box-top-half';
        paletteBoxTopHalf.id = `palette-box-top-half-${paletteBoxCount}`;
        const colorTextOutputBox = document.createElement('input');
        colorTextOutputBox.type = 'text';
        colorTextOutputBox.className = 'color-text-output-box tooltip';
        colorTextOutputBox.id = `color-text-output-box-${paletteBoxCount}`;
        colorTextOutputBox.setAttribute('data-format', 'hex');
        const colorString = await coreUtils.convert.colorToCSSColorString(clonedColor);
        colorTextOutputBox.value = colorString || '';
        colorTextOutputBox.colorValues = clonedColor;
        colorTextOutputBox.readOnly = false;
        colorTextOutputBox.style.cursor = 'text';
        colorTextOutputBox.style.pointerEvents = 'none';
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-button';
        copyButton.textContent = 'Copy';
        const tooltipText = document.createElement('span');
        tooltipText.className = 'tooltiptext';
        tooltipText.textContent = 'Copied to clipboard!';
        copyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(colorTextOutputBox.value);
                showTooltip(colorTextOutputBox);
                clearTimeout(consts.timeouts.tooltip || 1000);
                copyButton.textContent = 'Copied!';
                setTimeout(() => (copyButton.textContent = 'Copy'), consts.timeouts.copyButtonText || 1000);
            }
            catch (error) {
                if (!logMode.error)
                    logger.error(`Failed to copy: ${error}`, `${thisModule} > ${thisMethod}`);
            }
        });
        colorTextOutputBox.addEventListener('input', coreUtils.base.debounce((e) => {
            const target = e.target;
            if (target) {
                const cssColor = target.value.trim();
                const boxElement = document.getElementById(`color-box-${paletteBoxCount}`);
                const stripeElement = document.getElementById(`color-stripe-${paletteBoxCount}`);
                if (boxElement)
                    boxElement.style.backgroundColor = cssColor;
                if (stripeElement)
                    stripeElement.style.backgroundColor = cssColor;
            }
        }, consts.debounce.input || 200));
        paletteBoxTopHalf.appendChild(colorTextOutputBox);
        paletteBoxTopHalf.appendChild(copyButton);
        const paletteBoxBottomHalf = document.createElement('div');
        paletteBoxBottomHalf.className =
            'palette-box-half palette-box-bottom-half';
        paletteBoxBottomHalf.id = `palette-box-bottom-half-${paletteBoxCount}`;
        const colorBox = document.createElement('div');
        colorBox.className = 'color-box';
        colorBox.id = `color-box-${paletteBoxCount}`;
        colorBox.style.backgroundColor = colorString || '#ffffff';
        paletteBoxBottomHalf.appendChild(colorBox);
        paletteBox.appendChild(paletteBoxTopHalf);
        paletteBox.appendChild(paletteBoxBottomHalf);
        const colorStripe = document.createElement('div');
        colorStripe.className = 'color-stripe';
        colorStripe.id = `color-stripe-${paletteBoxCount}`;
        colorStripe.style.backgroundColor = colorString || '#ffffff';
        colorStripe.setAttribute('draggable', 'true');
        attachDragAndDropListeners(colorStripe);
        colorStripe.appendChild(paletteBox);
        return {
            colorStripe,
            paletteBoxCount: paletteBoxCount + 1
        };
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Failed to execute makePaletteBox: ${error}`, `${thisModule} > ${thisMethod}`);
        return {
            colorStripe: document.createElement('div'),
            paletteBoxCount
        };
    }
}
function showToast(message) {
    const thisMethod = 'showToast()';
    const toast = document.createElement('div');
    toast.className = 'toast-message';
    toast.textContent = message;
    document.body.appendChild(toast);
    if (!mode.quiet && logMode.verbosity > 3)
        logger.info('Toast message added', `${thisModule} > ${thisMethod}`);
    setTimeout(() => {
        toast.classList.add('fade-out');
        if (!mode.quiet && logMode.verbosity > 3)
            logger.info('Toast message faded out', `${thisModule} > ${thisMethod}`);
        toast.addEventListener('transitioned', () => toast.remove());
    }, timeouts.toast || 3000);
}
function showTooltip(tooltipElement) {
    const thisMethod = 'showTooltip()';
    try {
        const tooltip = tooltipElement.querySelector('.tooltiptext');
        if (tooltip) {
            tooltip.style.visibility = 'visible';
            tooltip.style.opacity = '1';
            setTimeout(() => {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            }, consts.timeouts.tooltip || 1000);
        }
        if (!mode.quiet && logMode.verbosity > 3)
            logger.info('showTooltip executed', `${thisModule} > ${thisMethod}`);
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Failed to execute showTooltip: ${error}`, `${thisModule} > ${thisMethod}`);
    }
}
async function validateAndConvertColor(color) {
    const thisMethod = 'validateAndConvertColor()';
    if (!color)
        return null;
    const convertedColor = coreUtils.guards.isColorString(color)
        ? await coreUtils.convert.colorStringToColor(color)
        : color;
    if (!coreUtils.validate.colorValues(convertedColor)) {
        if (logMode.error)
            logger.error(`Invalid color: ${JSON.stringify(convertedColor)}`, `${thisModule} > ${thisMethod}`);
        return null;
    }
    return convertedColor;
}
export const domHelpers = {
    attachDragAndDropListeners,
    handle: {
        dragStart,
        dragOver,
        dragEnd,
        drop
    },
    makePaletteBox,
    showToast,
    showTooltip,
    validateAndConvertColor
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1vbi9oZWxwZXJzL2RvbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw4QkFBOEI7QUFTOUIsT0FBTyxFQUFFLFVBQVUsSUFBSSxNQUFNLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNyRCxPQUFPLEVBQUUsUUFBUSxJQUFJLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRXRELE1BQU0sVUFBVSxHQUFHLHVCQUF1QixDQUFDO0FBRTNDLE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxFQUFFLENBQUM7QUFFcEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUM3QixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO0FBRWpDLElBQUksU0FBUyxHQUF1QixJQUFJLENBQUM7QUFFekMsU0FBUywwQkFBMEIsQ0FBQyxPQUEyQjtJQUM5RCxNQUFNLFVBQVUsR0FBRyxtQ0FBbUMsQ0FBQztJQUV2RCxJQUFJLENBQUM7UUFDSixJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUNqRCxPQUFPLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDdkMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO1lBQ2QsTUFBTSxDQUFDLElBQUksQ0FDVixxREFBcUQsRUFD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Q25ELENBQUMsQ0FBQyxLQUFLLENBQUM7SUFFVCxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQztRQUNyRCxJQUFJLE9BQU8sQ0FBQyxLQUFLO1lBQ2hCLE1BQU0sQ0FBQyxLQUFLLENBQ1gsa0JBQWtCLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFDbEQsR0FBRyxVQUFVLE1BQU0sVUFBVSxFQUFFLENBQy9CLENBQUM7UUFFSCxPQUFPLElBQUksQ0FBQztJQUNiLENBQUM7SUFFRCxPQUFPLGNBQWMsQ0FBQztBQUN2QixDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUErQztJQUNyRSwwQkFBMEI7SUFDMUIsTUFBTSxFQUFFO1FBQ1AsU0FBUztRQUNULFFBQVE7UUFDUixPQUFPO1FBQ1AsSUFBSTtLQUNKO0lBQ0QsY0FBYztJQUNkLFNBQVM7SUFDVCxXQUFXO0lBQ1gsdUJBQXVCO0NBQ2QsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IGNvbW1vbi9oZWxwZXJzL2RvbS5qc1xuXG5pbXBvcnQge1xuXHRDb2xvcixcblx0Q29sb3JJbnB1dEVsZW1lbnQsXG5cdENvbG9yX1N0cmluZ1Byb3BzLFxuXHRDb21tb25Gbl9NYXN0ZXJJbnRlcmZhY2UsXG5cdE1ha2VQYWxldHRlQm94XG59IGZyb20gJy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGNvbnN0c0RhdGEgYXMgY29uc3RzIH0gZnJvbSAnLi4vLi4vZGF0YS9jb25zdHMuanMnO1xuaW1wb3J0IHsgY29yZVV0aWxzIH0gZnJvbSAnLi4vY29yZS5qcyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuLi8uLi9sb2dnZXIvaW5kZXguanMnO1xuaW1wb3J0IHsgbW9kZURhdGEgYXMgbW9kZSB9IGZyb20gJy4uLy4uL2RhdGEvbW9kZS5qcyc7XG5cbmNvbnN0IHRoaXNNb2R1bGUgPSAnY29tbW9uL2hlbHBlcnMvZG9tLmpzJztcblxuY29uc3QgbG9nZ2VyID0gYXdhaXQgY3JlYXRlTG9nZ2VyKCk7XG5cbmNvbnN0IGxvZ01vZGUgPSBtb2RlLmxvZ2dpbmc7XG5jb25zdCB0aW1lb3V0cyA9IGNvbnN0cy50aW1lb3V0cztcblxubGV0IGRyYWdTcmNFbDogSFRNTEVsZW1lbnQgfCBudWxsID0gbnVsbDtcblxuZnVuY3Rpb24gYXR0YWNoRHJhZ0FuZERyb3BMaXN0ZW5lcnMoZWxlbWVudDogSFRNTEVsZW1lbnQgfCBudWxsKTogdm9pZCB7XG5cdGNvbnN0IHRoaXNNZXRob2QgPSAnYXR0YWNoRHJhZ0FuZERyb3BFdmVudExpc3RlbmVycygpJztcblxuXHR0cnkge1xuXHRcdGlmIChlbGVtZW50KSB7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGRyYWdTdGFydCk7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZHJhZ092ZXIpO1xuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZHJvcCk7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCBkcmFnRW5kKTtcblx0XHR9XG5cblx0XHRpZiAoIW1vZGUucXVpZXQpXG5cdFx0XHRsb2dnZXIuaW5mbyhcblx0XHRcdFx0J0RyYWcgYW5kIGRyb3AgZXZlbnQgbGlzdGVuZXJzIHN1Y2Nlc3NmdWxseSBhdHRhY2hlZCcsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKCFsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRmFpbGVkIHRvIGV4ZWN1dGUgYXR0YWNoRHJhZ0FuZERyb3BFdmVudExpc3RlbmVyczogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRyYWdTdGFydChlOiBEcmFnRXZlbnQpOiB2b2lkIHtcblx0Y29uc3QgdGhpc01ldGhvZCA9ICdoYW5kbGVEcmFnU3RhcnQoKSc7XG5cblx0dHJ5IHtcblx0XHRkcmFnU3JjRWwgPSBlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG5cblx0XHRpZiAoZS5kYXRhVHJhbnNmZXIpIHtcblx0XHRcdGUuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQgPSAnbW92ZSc7XG5cdFx0XHRlLmRhdGFUcmFuc2Zlci5zZXREYXRhKCd0ZXh0L2h0bWwnLCBkcmFnU3JjRWwub3V0ZXJIVE1MKTtcblx0XHR9XG5cblx0XHRpZiAoIW1vZGUucXVpZXQgJiYgbW9kZS5kZWJ1ZyAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDMpXG5cdFx0XHRsb2dnZXIuaW5mbyhcblx0XHRcdFx0J2hhbmRsZURyYWdTdGFydCBjb21wbGV0ZScsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBpbiBoYW5kbGVEcmFnU3RhcnQ6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblx0fVxufVxuXG5mdW5jdGlvbiBkcmFnT3ZlcihlOiBEcmFnRXZlbnQpOiBib29sZWFuIHtcblx0Y29uc3QgdGhpc01ldGhvZCA9ICdoYW5kbGVEcmFnT3ZlcigpJztcblxuXHR0cnkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGlmIChlLmRhdGFUcmFuc2Zlcikge1xuXHRcdFx0ZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICdtb3ZlJztcblx0XHR9XG5cblx0XHRpZiAoIW1vZGUucXVpZXQgJiYgbW9kZS5kZWJ1ZyAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDMpXG5cdFx0XHRsb2dnZXIuaW5mbyhcblx0XHRcdFx0J2hhbmRsZURyYWdPdmVyIGNvbXBsZXRlJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGluIGhhbmRsZURyYWdPdmVyOiAke2Vycm9yfWAsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn1cblxuZnVuY3Rpb24gZHJhZ0VuZChlOiBEcmFnRXZlbnQpOiB2b2lkIHtcblx0Y29uc3QgdGhpc01ldGhvZCA9ICdoYW5kbGVEcmFnRW5kKCknO1xuXG5cdHRyeSB7XG5cdFx0Y29uc3QgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0dGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdnaW5nJyk7XG5cblx0XHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuY29sb3Itc3RyaXBlJykuZm9yRWFjaChlbCA9PiB7XG5cdFx0XHRlbC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xuXHRcdH0pO1xuXG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIG1vZGUuZGVidWcgJiYgbG9nTW9kZS52ZXJib3NpdHkgPiAzKVxuXHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdCdoYW5kbGVEcmFnRW5kIGNvbXBsZXRlJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGluIGhhbmRsZURyYWdFbmQ6ICR7ZXJyb3J9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblx0fVxufVxuXG5mdW5jdGlvbiBkcm9wKGU6IERyYWdFdmVudCk6IHZvaWQge1xuXHRjb25zdCB0aGlzTWV0aG9kID0gJ2Ryb3AoKSc7XG5cblx0dHJ5IHtcblx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0Y29uc3QgdGFyZ2V0ID0gZS5jdXJyZW50VGFyZ2V0IGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0aWYgKGRyYWdTcmNFbCAmJiBkcmFnU3JjRWwgIT09IHRhcmdldCkge1xuXHRcdFx0Y29uc3QgZHJhZ1NyY0lkID0gZHJhZ1NyY0VsLmlkO1xuXHRcdFx0Y29uc3QgZHJvcFRhcmdldElkID0gdGFyZ2V0LmlkO1xuXHRcdFx0Y29uc3QgZHJhZ1NyY1RleHQgPSAoXG5cdFx0XHRcdGRyYWdTcmNFbC5xdWVyeVNlbGVjdG9yKFxuXHRcdFx0XHRcdCcuY29sb3ItdGV4dC1vdXRwdXQtYm94J1xuXHRcdFx0XHQpIGFzIEhUTUxJbnB1dEVsZW1lbnRcblx0XHRcdCkudmFsdWU7XG5cdFx0XHRjb25zdCBkcm9wVGFyZ2V0VGV4dCA9IChcblx0XHRcdFx0dGFyZ2V0LnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdFx0Jy5jb2xvci10ZXh0LW91dHB1dC1ib3gnXG5cdFx0XHRcdCkgYXMgSFRNTElucHV0RWxlbWVudFxuXHRcdFx0KS52YWx1ZTtcblx0XHRcdGNvbnN0IGRyYWdTcmNPdXRlckhUTUwgPSBkcmFnU3JjRWwub3V0ZXJIVE1MO1xuXHRcdFx0Y29uc3QgZHJvcFRhcmdldE91dGVySFRNTCA9IHRhcmdldC5vdXRlckhUTUw7XG5cblx0XHRcdGRyYWdTcmNFbC5vdXRlckhUTUwgPSBkcm9wVGFyZ2V0T3V0ZXJIVE1MO1xuXHRcdFx0dGFyZ2V0Lm91dGVySFRNTCA9IGRyYWdTcmNPdXRlckhUTUw7XG5cblx0XHRcdGNvbnN0IG5ld0RyYWdTcmNFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRkcm9wVGFyZ2V0SWRcblx0XHRcdCkgYXMgSFRNTEVsZW1lbnQ7XG5cdFx0XHRjb25zdCBuZXdEcm9wVGFyZ2V0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHRcdFx0ZHJhZ1NyY0lkXG5cdFx0XHQpIGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0XHRuZXdEcmFnU3JjRWwuaWQgPSBkcmFnU3JjSWQ7XG5cdFx0XHRuZXdEcm9wVGFyZ2V0RWwuaWQgPSBkcm9wVGFyZ2V0SWQ7XG5cblx0XHRcdChcblx0XHRcdFx0bmV3RHJhZ1NyY0VsLnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdFx0Jy5jb2xvci10ZXh0LW91dHB1dC1ib3gnXG5cdFx0XHRcdCkgYXMgSFRNTElucHV0RWxlbWVudFxuXHRcdFx0KS52YWx1ZSA9IGRyb3BUYXJnZXRUZXh0O1xuXHRcdFx0KFxuXHRcdFx0XHRuZXdEcm9wVGFyZ2V0RWwucXVlcnlTZWxlY3Rvcihcblx0XHRcdFx0XHQnLmNvbG9yLXRleHQtb3V0cHV0LWJveCdcblx0XHRcdFx0KSBhcyBIVE1MSW5wdXRFbGVtZW50XG5cdFx0XHQpLnZhbHVlID0gZHJhZ1NyY1RleHQ7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCAmJiBtb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdFx0J2NhbGxpbmcgYXR0YWNoRHJhZ0FuZERyb3BFdmVudExpc3RlbmVycyBmb3IgbmV3IGVsZW1lbnRzJyxcblx0XHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHRcdCk7XG5cblx0XHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKG5ld0RyYWdTcmNFbCk7XG5cblx0XHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKG5ld0Ryb3BUYXJnZXRFbCk7XG5cdFx0fVxuXG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIG1vZGUuZGVidWcgJiYgbG9nTW9kZS52ZXJib3NpdHkgPiAzKVxuXHRcdFx0bG9nZ2VyLmluZm8oJ2hhbmRsZURyb3AgY29tcGxldGUnLCBgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAoIWxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBpbiBoYW5kbGVEcm9wOiAke2Vycm9yfWAsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cdH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gbWFrZVBhbGV0dGVCb3goXG5cdGNvbG9yOiBDb2xvcixcblx0cGFsZXR0ZUJveENvdW50OiBudW1iZXJcbik6IFByb21pc2U8TWFrZVBhbGV0dGVCb3g+IHtcblx0Y29uc3QgdGhpc01ldGhvZCA9ICdtYWtlUGFsZXR0ZUJveCgpJztcblxuXHR0cnkge1xuXHRcdGlmICghY29yZVV0aWxzLnZhbGlkYXRlLmNvbG9yVmFsdWVzKGNvbG9yKSkge1xuXHRcdFx0aWYgKCFsb2dNb2RlLmVycm9yKVxuXHRcdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdFx0YEludmFsaWQgJHtjb2xvci5mb3JtYXR9IGNvbG9yIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoY29sb3IpfWAsXG5cdFx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRjb2xvclN0cmlwZTogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXG5cdFx0XHRcdHBhbGV0dGVCb3hDb3VudFxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRjb25zdCBjbG9uZWRDb2xvciA9IGNvcmVVdGlscy5iYXNlLmNsb25lKGNvbG9yKTtcblxuXHRcdGNvbnN0IHBhbGV0dGVCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRwYWxldHRlQm94LmNsYXNzTmFtZSA9ICdwYWxldHRlLWJveCc7XG5cdFx0cGFsZXR0ZUJveC5pZCA9IGBwYWxldHRlLWJveC0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXG5cdFx0Y29uc3QgcGFsZXR0ZUJveFRvcEhhbGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRwYWxldHRlQm94VG9wSGFsZi5jbGFzc05hbWUgPSAncGFsZXR0ZS1ib3gtaGFsZiBwYWxldHRlLWJveC10b3AtaGFsZic7XG5cdFx0cGFsZXR0ZUJveFRvcEhhbGYuaWQgPSBgcGFsZXR0ZS1ib3gtdG9wLWhhbGYtJHtwYWxldHRlQm94Q291bnR9YDtcblxuXHRcdGNvbnN0IGNvbG9yVGV4dE91dHB1dEJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXG5cdFx0XHQnaW5wdXQnXG5cdFx0KSBhcyBDb2xvcklucHV0RWxlbWVudDtcblx0XHRjb2xvclRleHRPdXRwdXRCb3gudHlwZSA9ICd0ZXh0Jztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guY2xhc3NOYW1lID0gJ2NvbG9yLXRleHQtb3V0cHV0LWJveCB0b29sdGlwJztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guaWQgPSBgY29sb3ItdGV4dC1vdXRwdXQtYm94LSR7cGFsZXR0ZUJveENvdW50fWA7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnNldEF0dHJpYnV0ZSgnZGF0YS1mb3JtYXQnLCAnaGV4Jyk7XG5cblx0XHRjb25zdCBjb2xvclN0cmluZyA9XG5cdFx0XHRhd2FpdCBjb3JlVXRpbHMuY29udmVydC5jb2xvclRvQ1NTQ29sb3JTdHJpbmcoY2xvbmVkQ29sb3IpO1xuXG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnZhbHVlID0gY29sb3JTdHJpbmcgfHwgJyc7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LmNvbG9yVmFsdWVzID0gY2xvbmVkQ29sb3I7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnJlYWRPbmx5ID0gZmFsc2U7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnN0eWxlLmN1cnNvciA9ICd0ZXh0Jztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJztcblxuXHRcdGNvbnN0IGNvcHlCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblx0XHRjb3B5QnV0dG9uLmNsYXNzTmFtZSA9ICdjb3B5LWJ1dHRvbic7XG5cdFx0Y29weUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDb3B5JztcblxuXHRcdGNvbnN0IHRvb2x0aXBUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXHRcdHRvb2x0aXBUZXh0LmNsYXNzTmFtZSA9ICd0b29sdGlwdGV4dCc7XG5cdFx0dG9vbHRpcFRleHQudGV4dENvbnRlbnQgPSAnQ29waWVkIHRvIGNsaXBib2FyZCEnO1xuXG5cdFx0Y29weUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGNvbG9yVGV4dE91dHB1dEJveC52YWx1ZSk7XG5cblx0XHRcdFx0c2hvd1Rvb2x0aXAoY29sb3JUZXh0T3V0cHV0Qm94KTtcblxuXHRcdFx0XHRjbGVhclRpbWVvdXQoY29uc3RzLnRpbWVvdXRzLnRvb2x0aXAgfHwgMTAwMCk7XG5cblx0XHRcdFx0Y29weUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDb3BpZWQhJztcblx0XHRcdFx0c2V0VGltZW91dChcblx0XHRcdFx0XHQoKSA9PiAoY29weUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDb3B5JyksXG5cdFx0XHRcdFx0Y29uc3RzLnRpbWVvdXRzLmNvcHlCdXR0b25UZXh0IHx8IDEwMDBcblx0XHRcdFx0KTtcblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdGlmICghbG9nTW9kZS5lcnJvcilcblx0XHRcdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdFx0XHRgRmFpbGVkIHRvIGNvcHk6ICR7ZXJyb3J9YCxcblx0XHRcdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdFx0XHQpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0XHQnaW5wdXQnLFxuXHRcdFx0Y29yZVV0aWxzLmJhc2UuZGVib3VuY2UoKGU6IEV2ZW50KSA9PiB7XG5cdFx0XHRcdGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsO1xuXHRcdFx0XHRpZiAodGFyZ2V0KSB7XG5cdFx0XHRcdFx0Y29uc3QgY3NzQ29sb3IgPSB0YXJnZXQudmFsdWUudHJpbSgpO1xuXHRcdFx0XHRcdGNvbnN0IGJveEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHRcdFx0XHRcdGBjb2xvci1ib3gtJHtwYWxldHRlQm94Q291bnR9YFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0Y29uc3Qgc3RyaXBlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRcdFx0YGNvbG9yLXN0cmlwZS0ke3BhbGV0dGVCb3hDb3VudH1gXG5cdFx0XHRcdFx0KTtcblxuXHRcdFx0XHRcdGlmIChib3hFbGVtZW50KSBib3hFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNzc0NvbG9yO1xuXHRcdFx0XHRcdGlmIChzdHJpcGVFbGVtZW50KVxuXHRcdFx0XHRcdFx0c3RyaXBlRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjc3NDb2xvcjtcblx0XHRcdFx0fVxuXHRcdFx0fSwgY29uc3RzLmRlYm91bmNlLmlucHV0IHx8IDIwMClcblx0XHQpO1xuXG5cdFx0cGFsZXR0ZUJveFRvcEhhbGYuYXBwZW5kQ2hpbGQoY29sb3JUZXh0T3V0cHV0Qm94KTtcblx0XHRwYWxldHRlQm94VG9wSGFsZi5hcHBlbmRDaGlsZChjb3B5QnV0dG9uKTtcblxuXHRcdGNvbnN0IHBhbGV0dGVCb3hCb3R0b21IYWxmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cGFsZXR0ZUJveEJvdHRvbUhhbGYuY2xhc3NOYW1lID1cblx0XHRcdCdwYWxldHRlLWJveC1oYWxmIHBhbGV0dGUtYm94LWJvdHRvbS1oYWxmJztcblx0XHRwYWxldHRlQm94Qm90dG9tSGFsZi5pZCA9IGBwYWxldHRlLWJveC1ib3R0b20taGFsZi0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXG5cdFx0Y29uc3QgY29sb3JCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRjb2xvckJveC5jbGFzc05hbWUgPSAnY29sb3ItYm94Jztcblx0XHRjb2xvckJveC5pZCA9IGBjb2xvci1ib3gtJHtwYWxldHRlQm94Q291bnR9YDtcblx0XHRjb2xvckJveC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvclN0cmluZyB8fCAnI2ZmZmZmZic7XG5cblx0XHRwYWxldHRlQm94Qm90dG9tSGFsZi5hcHBlbmRDaGlsZChjb2xvckJveCk7XG5cdFx0cGFsZXR0ZUJveC5hcHBlbmRDaGlsZChwYWxldHRlQm94VG9wSGFsZik7XG5cdFx0cGFsZXR0ZUJveC5hcHBlbmRDaGlsZChwYWxldHRlQm94Qm90dG9tSGFsZik7XG5cblx0XHRjb25zdCBjb2xvclN0cmlwZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdGNvbG9yU3RyaXBlLmNsYXNzTmFtZSA9ICdjb2xvci1zdHJpcGUnO1xuXHRcdGNvbG9yU3RyaXBlLmlkID0gYGNvbG9yLXN0cmlwZS0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXHRcdGNvbG9yU3RyaXBlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yU3RyaW5nIHx8ICcjZmZmZmZmJztcblxuXHRcdGNvbG9yU3RyaXBlLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ3RydWUnKTtcblxuXHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKGNvbG9yU3RyaXBlKTtcblxuXHRcdGNvbG9yU3RyaXBlLmFwcGVuZENoaWxkKHBhbGV0dGVCb3gpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNvbG9yU3RyaXBlLFxuXHRcdFx0cGFsZXR0ZUJveENvdW50OiBwYWxldHRlQm94Q291bnQgKyAxXG5cdFx0fTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAoIWxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZXhlY3V0ZSBtYWtlUGFsZXR0ZUJveDogJHtlcnJvcn1gLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNvbG9yU3RyaXBlOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcblx0XHRcdHBhbGV0dGVCb3hDb3VudFxuXHRcdH07XG5cdH1cbn1cblxuZnVuY3Rpb24gc2hvd1RvYXN0KG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuXHRjb25zdCB0aGlzTWV0aG9kID0gJ3Nob3dUb2FzdCgpJztcblx0Y29uc3QgdG9hc3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblxuXHR0b2FzdC5jbGFzc05hbWUgPSAndG9hc3QtbWVzc2FnZSc7XG5cblx0dG9hc3QudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuXG5cdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodG9hc3QpO1xuXG5cdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDMpXG5cdFx0bG9nZ2VyLmluZm8oJ1RvYXN0IG1lc3NhZ2UgYWRkZWQnLCBgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gKTtcblxuXHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHR0b2FzdC5jbGFzc0xpc3QuYWRkKCdmYWRlLW91dCcpO1xuXG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHQnVG9hc3QgbWVzc2FnZSBmYWRlZCBvdXQnLFxuXHRcdFx0XHRgJHt0aGlzTW9kdWxlfSA+ICR7dGhpc01ldGhvZH1gXG5cdFx0XHQpO1xuXG5cdFx0dG9hc3QuYWRkRXZlbnRMaXN0ZW5lcigndHJhbnNpdGlvbmVkJywgKCkgPT4gdG9hc3QucmVtb3ZlKCkpO1xuXHR9LCB0aW1lb3V0cy50b2FzdCB8fCAzMDAwKTtcbn1cblxuZnVuY3Rpb24gc2hvd1Rvb2x0aXAodG9vbHRpcEVsZW1lbnQ6IEhUTUxFbGVtZW50KTogdm9pZCB7XG5cdGNvbnN0IHRoaXNNZXRob2QgPSAnc2hvd1Rvb2x0aXAoKSc7XG5cblx0dHJ5IHtcblx0XHRjb25zdCB0b29sdGlwID1cblx0XHRcdHRvb2x0aXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTEVsZW1lbnQ+KCcudG9vbHRpcHRleHQnKTtcblxuXHRcdGlmICh0b29sdGlwKSB7XG5cdFx0XHR0b29sdGlwLnN0eWxlLnZpc2liaWxpdHkgPSAndmlzaWJsZSc7XG5cdFx0XHR0b29sdGlwLnN0eWxlLm9wYWNpdHkgPSAnMSc7XG5cdFx0XHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHRcdFx0dG9vbHRpcC5zdHlsZS52aXNpYmlsaXR5ID0gJ2hpZGRlbic7XG5cdFx0XHRcdHRvb2x0aXAuc3R5bGUub3BhY2l0eSA9ICcwJztcblx0XHRcdH0sIGNvbnN0cy50aW1lb3V0cy50b29sdGlwIHx8IDEwMDApO1xuXHRcdH1cblxuXHRcdGlmICghbW9kZS5xdWlldCAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDMpXG5cdFx0XHRsb2dnZXIuaW5mbyhcblx0XHRcdFx0J3Nob3dUb29sdGlwIGV4ZWN1dGVkJyxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEZhaWxlZCB0byBleGVjdXRlIHNob3dUb29sdGlwOiAke2Vycm9yfWAsXG5cdFx0XHRcdGAke3RoaXNNb2R1bGV9ID4gJHt0aGlzTWV0aG9kfWBcblx0XHRcdCk7XG5cdH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVBbmRDb252ZXJ0Q29sb3IoXG5cdGNvbG9yOiBDb2xvciB8IENvbG9yX1N0cmluZ1Byb3BzIHwgbnVsbFxuKTogUHJvbWlzZTxDb2xvciB8IG51bGw+IHtcblx0Y29uc3QgdGhpc01ldGhvZCA9ICd2YWxpZGF0ZUFuZENvbnZlcnRDb2xvcigpJztcblxuXHRpZiAoIWNvbG9yKSByZXR1cm4gbnVsbDtcblxuXHRjb25zdCBjb252ZXJ0ZWRDb2xvciA9IGNvcmVVdGlscy5ndWFyZHMuaXNDb2xvclN0cmluZyhjb2xvcilcblx0XHQ/IGF3YWl0IGNvcmVVdGlscy5jb252ZXJ0LmNvbG9yU3RyaW5nVG9Db2xvcihjb2xvcilcblx0XHQ6IGNvbG9yO1xuXG5cdGlmICghY29yZVV0aWxzLnZhbGlkYXRlLmNvbG9yVmFsdWVzKGNvbnZlcnRlZENvbG9yKSkge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgSW52YWxpZCBjb2xvcjogJHtKU09OLnN0cmluZ2lmeShjb252ZXJ0ZWRDb2xvcil9YCxcblx0XHRcdFx0YCR7dGhpc01vZHVsZX0gPiAke3RoaXNNZXRob2R9YFxuXHRcdFx0KTtcblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0cmV0dXJuIGNvbnZlcnRlZENvbG9yO1xufVxuXG5leHBvcnQgY29uc3QgZG9tSGVscGVyczogQ29tbW9uRm5fTWFzdGVySW50ZXJmYWNlWydoZWxwZXJzJ11bJ2RvbSddID0ge1xuXHRhdHRhY2hEcmFnQW5kRHJvcExpc3RlbmVycyxcblx0aGFuZGxlOiB7XG5cdFx0ZHJhZ1N0YXJ0LFxuXHRcdGRyYWdPdmVyLFxuXHRcdGRyYWdFbmQsXG5cdFx0ZHJvcFxuXHR9LFxuXHRtYWtlUGFsZXR0ZUJveCxcblx0c2hvd1RvYXN0LFxuXHRzaG93VG9vbHRpcCxcblx0dmFsaWRhdGVBbmRDb252ZXJ0Q29sb3Jcbn0gYXMgY29uc3Q7XG4iXX0=