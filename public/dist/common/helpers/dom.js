// File: src/common/helpers/dom.js
import { consts, mode } from '../data/base.js';
import { core } from '../core/index.js';
import { createLogger } from '../../logger/index.js';
const logger = await createLogger();
const logMode = mode.logging;
const timeouts = consts.timeouts;
let dragSrcEl = null;
function attachDragAndDropListeners(element) {
    try {
        if (element) {
            element.addEventListener('dragstart', dragStart);
            element.addEventListener('dragover', dragOver);
            element.addEventListener('drop', drop);
            element.addEventListener('dragend', dragEnd);
        }
        if (!mode.quiet)
            logger.info('Drag and drop event listeners successfully attached', 'common > helpers > dom > attachDragAndDropEventListeners()');
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Failed to execute attachDragAndDropEventListeners: ${error}`, 'common > helpers > dom > attachDragAndDropEventListeners()');
    }
}
function dragStart(e) {
    try {
        dragSrcEl = e.currentTarget;
        if (e.dataTransfer) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', dragSrcEl.outerHTML);
        }
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDragStart complete', 'common > helpers > dom > dragStart()');
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragStart: ${error}`, 'common > helpers > dom > dragStart()');
    }
}
function dragOver(e) {
    try {
        e.preventDefault();
        if (e.dataTransfer) {
            e.dataTransfer.dropEffect = 'move';
        }
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDragOver complete', 'common > helpers > dom > dragOver()');
        return false;
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragOver: ${error}`, 'common > helpers > dom > dragOver()');
        return false;
    }
}
function dragEnd(e) {
    try {
        const target = e.currentTarget;
        target.classList.remove('dragging');
        document.querySelectorAll('.color-stripe').forEach(el => {
            el.classList.remove('dragging');
        });
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDragEnd complete', 'common > helpers > dom > dragEnd()');
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Error in handleDragEnd: ${error}`, 'common > helpers > dom > dragEnd()');
    }
}
function drop(e) {
    try {
        e.stopPropagation();
        const target = e.currentTarget;
        if (dragSrcEl && dragSrcEl !== target) {
            const dragSrcId = dragSrcEl.id;
            const dropTargetId = target.id;
            const dragSrcText = dragSrcEl.querySelector('.color-text-output-box').value;
            const dropTargetText = target.querySelector('.color-text-output-box').value;
            const dragSrcOuterHTML = dragSrcEl.outerHTML;
            const dropTargetOuterHTML = target.outerHTML;
            dragSrcEl.outerHTML = dropTargetOuterHTML;
            target.outerHTML = dragSrcOuterHTML;
            const newDragSrcEl = document.getElementById(dropTargetId);
            const newDropTargetEl = document.getElementById(dragSrcId);
            newDragSrcEl.id = dragSrcId;
            newDropTargetEl.id = dropTargetId;
            newDragSrcEl.querySelector('.color-text-output-box').value = dropTargetText;
            newDropTargetEl.querySelector('.color-text-output-box').value = dragSrcText;
            if (!mode.quiet && mode.debug && logMode.verbosity > 3)
                logger.info('calling attachDragAndDropEventListeners for new elements', 'common > helpers > dom > drop()');
            attachDragAndDropListeners(newDragSrcEl);
            attachDragAndDropListeners(newDropTargetEl);
        }
        if (!mode.quiet && mode.debug && logMode.verbosity > 3)
            logger.info('handleDrop complete', 'common > helpers > dom > drop()');
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Error in handleDrop: ${error}`, 'common > helpers > dom > drop()');
    }
}
async function makePaletteBox(color, paletteBoxCount) {
    try {
        if (!core.validate.colorValues(color)) {
            if (!logMode.error)
                logger.error(`Invalid ${color.format} color value ${JSON.stringify(color)}`, 'common > helpers > dom > makePaletteBox()');
            return {
                colorStripe: document.createElement('div'),
                paletteBoxCount
            };
        }
        const clonedColor = core.base.clone(color);
        const paletteBox = document.createElement('div');
        paletteBox.className = 'palette-box';
        paletteBox.id = `palette-box-${paletteBoxCount}`;
        const paletteBoxTopHalf = document.createElement('div');
        paletteBoxTopHalf.className = 'palette-box-half palette-box-top-half';
        paletteBoxTopHalf.id = `palette-box-top-half-${paletteBoxCount}`;
        const colorTextOutputBox = document.createElement('input');
        colorTextOutputBox.type = 'text';
        colorTextOutputBox.className = 'color-text-output-box tooltip';
        colorTextOutputBox.id = `color-text-output-box-${paletteBoxCount}`;
        colorTextOutputBox.setAttribute('data-format', 'hex');
        const colorString = await core.convert.colorToCSSColorString(clonedColor);
        colorTextOutputBox.value = colorString || '';
        colorTextOutputBox.colorValues = clonedColor;
        colorTextOutputBox.readOnly = false;
        colorTextOutputBox.style.cursor = 'text';
        colorTextOutputBox.style.pointerEvents = 'none';
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-button';
        copyButton.textContent = 'Copy';
        const tooltipText = document.createElement('span');
        tooltipText.className = 'tooltiptext';
        tooltipText.textContent = 'Copied to clipboard!';
        copyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(colorTextOutputBox.value);
                showTooltip(colorTextOutputBox);
                clearTimeout(consts.timeouts.tooltip || 1000);
                copyButton.textContent = 'Copied!';
                setTimeout(() => (copyButton.textContent = 'Copy'), consts.timeouts.copyButtonText || 1000);
            }
            catch (error) {
                if (!logMode.error)
                    logger.error(`Failed to copy: ${error}`, 'common > helpers > dom > makePaletteBox()');
            }
        });
        colorTextOutputBox.addEventListener('input', core.base.debounce((e) => {
            const target = e.target;
            if (target) {
                const cssColor = target.value.trim();
                const boxElement = document.getElementById(`color-box-${paletteBoxCount}`);
                const stripeElement = document.getElementById(`color-stripe-${paletteBoxCount}`);
                if (boxElement)
                    boxElement.style.backgroundColor = cssColor;
                if (stripeElement)
                    stripeElement.style.backgroundColor = cssColor;
            }
        }, consts.debounce.input || 200));
        paletteBoxTopHalf.appendChild(colorTextOutputBox);
        paletteBoxTopHalf.appendChild(copyButton);
        const paletteBoxBottomHalf = document.createElement('div');
        paletteBoxBottomHalf.className =
            'palette-box-half palette-box-bottom-half';
        paletteBoxBottomHalf.id = `palette-box-bottom-half-${paletteBoxCount}`;
        const colorBox = document.createElement('div');
        colorBox.className = 'color-box';
        colorBox.id = `color-box-${paletteBoxCount}`;
        colorBox.style.backgroundColor = colorString || '#ffffff';
        paletteBoxBottomHalf.appendChild(colorBox);
        paletteBox.appendChild(paletteBoxTopHalf);
        paletteBox.appendChild(paletteBoxBottomHalf);
        const colorStripe = document.createElement('div');
        colorStripe.className = 'color-stripe';
        colorStripe.id = `color-stripe-${paletteBoxCount}`;
        colorStripe.style.backgroundColor = colorString || '#ffffff';
        colorStripe.setAttribute('draggable', 'true');
        attachDragAndDropListeners(colorStripe);
        colorStripe.appendChild(paletteBox);
        return {
            colorStripe,
            paletteBoxCount: paletteBoxCount + 1
        };
    }
    catch (error) {
        if (!logMode.error)
            logger.error(`Failed to execute makePaletteBox: ${error}`, 'common > helpers > dom > makePaletteBox()');
        return {
            colorStripe: document.createElement('div'),
            paletteBoxCount
        };
    }
}
function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast-message';
    toast.textContent = message;
    document.body.appendChild(toast);
    if (!mode.quiet && logMode.verbosity > 3)
        logger.info('Toast message added', 'common > helpers > dom > showToast()');
    setTimeout(() => {
        toast.classList.add('fade-out');
        if (!mode.quiet && logMode.verbosity > 3)
            logger.info('Toast message faded out', 'common > helpers > dom > showToast()');
        toast.addEventListener('transitioned', () => toast.remove());
    }, timeouts.toast || 3000);
}
function showTooltip(tooltipElement) {
    try {
        const tooltip = tooltipElement.querySelector('.tooltiptext');
        if (tooltip) {
            tooltip.style.visibility = 'visible';
            tooltip.style.opacity = '1';
            setTimeout(() => {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            }, consts.timeouts.tooltip || 1000);
        }
        if (!mode.quiet && logMode.verbosity > 3)
            logger.info('showTooltip executed', 'showTooltip()');
    }
    catch (error) {
        if (logMode.error)
            logger.error(`Failed to execute showTooltip: ${error}`, 'common > helpers > dom > showTooltip()');
    }
}
async function validateAndConvertColor(color) {
    if (!color)
        return null;
    const convertedColor = core.guards.isColorString(color)
        ? await core.convert.colorStringToColor(color)
        : color;
    if (!core.validate.colorValues(convertedColor)) {
        if (logMode.error)
            logger.error(`Invalid color: ${JSON.stringify(convertedColor)}`, 'common > helpers > dom > validateAndConvertColor()');
        return null;
    }
    return convertedColor;
}
export const dom = {
    attachDragAndDropListeners,
    handle: {
        dragStart,
        dragOver,
        dragEnd,
        drop
    },
    makePaletteBox,
    showToast,
    showTooltip,
    validateAndConvertColor
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1vbi9oZWxwZXJzL2RvbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrQ0FBa0M7QUFTbEMsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMvQyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFDeEMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRXJELE1BQU0sTUFBTSxHQUFHLE1BQU0sWUFBWSxFQUFFLENBQUM7QUFFcEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUM3QixNQUFNLFFBQVEsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDO0FBRWpDLElBQUksU0FBUyxHQUF1QixJQUFJLENBQUM7QUFFekMsU0FBUywwQkFBMEIsQ0FBQyxPQUEyQjtJQUM5RCxJQUFJLENBQUM7UUFDSixJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUNqRCxPQUFPLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDdkMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBRUQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLO1lBQ2QsTUFBTSxDQUFDLElBQUksQ0FDVixxREFBcUQsRUFDckQsNERBQTRELENBQzVELENBQUM7SUFDSixDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUs7WUFDakIsTUFBTSxDQUFDLEtBQUssQ0FDWCxzREFB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QUVELEtBQUssVUFBVSx1QkFBdUIsQ0FDckMsS0FBaUM7SUFFakMsSUFBSSxDQUFDLEtBQUs7UUFBRSxPQUFPLElBQUksQ0FBQztJQUV4QixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFDdEQsQ0FBQyxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLENBQUM7UUFDOUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUVULElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1FBQ2hELElBQUksT0FBTyxDQUFDLEtBQUs7WUFDaEIsTUFBTSxDQUFDLEtBQUssQ0FDWCxrQkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsRUFBRSxFQUNsRCxvREFBb0QsQ0FDcEQsQ0FBQztRQUVILE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVELE9BQU8sY0FBYyxDQUFDO0FBQ3ZCLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxHQUFHLEdBQXFEO0lBQ3BFLDBCQUEwQjtJQUMxQixNQUFNLEVBQUU7UUFDUCxTQUFTO1FBQ1QsUUFBUTtRQUNSLE9BQU87UUFDUCxJQUFJO0tBQ0o7SUFDRCxjQUFjO0lBQ2QsU0FBUztJQUNULFdBQVc7SUFDWCx1QkFBdUI7Q0FDZCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogc3JjL2NvbW1vbi9oZWxwZXJzL2RvbS5qc1xuXG5pbXBvcnQge1xuXHRDb2xvcixcblx0Q29sb3JJbnB1dEVsZW1lbnQsXG5cdENvbG9yU3RyaW5nLFxuXHRDb21tb25GdW5jdGlvbnNNYXN0ZXJJbnRlcmZhY2UsXG5cdE1ha2VQYWxldHRlQm94XG59IGZyb20gJy4uLy4uL3R5cGVzL2luZGV4LmpzJztcbmltcG9ydCB7IGNvbnN0cywgbW9kZSB9IGZyb20gJy4uL2RhdGEvYmFzZS5qcyc7XG5pbXBvcnQgeyBjb3JlIH0gZnJvbSAnLi4vY29yZS9pbmRleC5qcyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICcuLi8uLi9sb2dnZXIvaW5kZXguanMnO1xuXG5jb25zdCBsb2dnZXIgPSBhd2FpdCBjcmVhdGVMb2dnZXIoKTtcblxuY29uc3QgbG9nTW9kZSA9IG1vZGUubG9nZ2luZztcbmNvbnN0IHRpbWVvdXRzID0gY29uc3RzLnRpbWVvdXRzO1xuXG5sZXQgZHJhZ1NyY0VsOiBIVE1MRWxlbWVudCB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBhdHRhY2hEcmFnQW5kRHJvcExpc3RlbmVycyhlbGVtZW50OiBIVE1MRWxlbWVudCB8IG51bGwpOiB2b2lkIHtcblx0dHJ5IHtcblx0XHRpZiAoZWxlbWVudCkge1xuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnc3RhcnQnLCBkcmFnU3RhcnQpO1xuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIGRyYWdPdmVyKTtcblx0XHRcdGVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIGRyb3ApO1xuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnZW5kJywgZHJhZ0VuZCk7XG5cdFx0fVxuXG5cdFx0aWYgKCFtb2RlLnF1aWV0KVxuXHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdCdEcmFnIGFuZCBkcm9wIGV2ZW50IGxpc3RlbmVycyBzdWNjZXNzZnVsbHkgYXR0YWNoZWQnLFxuXHRcdFx0XHQnY29tbW9uID4gaGVscGVycyA+IGRvbSA+IGF0dGFjaERyYWdBbmREcm9wRXZlbnRMaXN0ZW5lcnMoKSdcblx0XHRcdCk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKCFsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRmFpbGVkIHRvIGV4ZWN1dGUgYXR0YWNoRHJhZ0FuZERyb3BFdmVudExpc3RlbmVyczogJHtlcnJvcn1gLFxuXHRcdFx0XHQnY29tbW9uID4gaGVscGVycyA+IGRvbSA+IGF0dGFjaERyYWdBbmREcm9wRXZlbnRMaXN0ZW5lcnMoKSdcblx0XHRcdCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gZHJhZ1N0YXJ0KGU6IERyYWdFdmVudCk6IHZvaWQge1xuXHR0cnkge1xuXHRcdGRyYWdTcmNFbCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudDtcblxuXHRcdGlmIChlLmRhdGFUcmFuc2Zlcikge1xuXHRcdFx0ZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdtb3ZlJztcblx0XHRcdGUuZGF0YVRyYW5zZmVyLnNldERhdGEoJ3RleHQvaHRtbCcsIGRyYWdTcmNFbC5vdXRlckhUTUwpO1xuXHRcdH1cblxuXHRcdGlmICghbW9kZS5xdWlldCAmJiBtb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHQnaGFuZGxlRHJhZ1N0YXJ0IGNvbXBsZXRlJyxcblx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBkcmFnU3RhcnQoKSdcblx0XHRcdCk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBFcnJvciBpbiBoYW5kbGVEcmFnU3RhcnQ6ICR7ZXJyb3J9YCxcblx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBkcmFnU3RhcnQoKSdcblx0XHRcdCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gZHJhZ092ZXIoZTogRHJhZ0V2ZW50KTogYm9vbGVhbiB7XG5cdHRyeSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0aWYgKGUuZGF0YVRyYW5zZmVyKSB7XG5cdFx0XHRlLmRhdGFUcmFuc2Zlci5kcm9wRWZmZWN0ID0gJ21vdmUnO1xuXHRcdH1cblxuXHRcdGlmICghbW9kZS5xdWlldCAmJiBtb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHQnaGFuZGxlRHJhZ092ZXIgY29tcGxldGUnLFxuXHRcdFx0XHQnY29tbW9uID4gaGVscGVycyA+IGRvbSA+IGRyYWdPdmVyKCknXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChsb2dNb2RlLmVycm9yKVxuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHRgRXJyb3IgaW4gaGFuZGxlRHJhZ092ZXI6ICR7ZXJyb3J9YCxcblx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBkcmFnT3ZlcigpJ1xuXHRcdFx0KTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5mdW5jdGlvbiBkcmFnRW5kKGU6IERyYWdFdmVudCk6IHZvaWQge1xuXHR0cnkge1xuXHRcdGNvbnN0IHRhcmdldCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudDtcblxuXHRcdHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xuXG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbG9yLXN0cmlwZScpLmZvckVhY2goZWwgPT4ge1xuXHRcdFx0ZWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTtcblx0XHR9KTtcblxuXHRcdGlmICghbW9kZS5xdWlldCAmJiBtb2RlLmRlYnVnICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHQnaGFuZGxlRHJhZ0VuZCBjb21wbGV0ZScsXG5cdFx0XHRcdCdjb21tb24gPiBoZWxwZXJzID4gZG9tID4gZHJhZ0VuZCgpJ1xuXHRcdFx0KTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGluIGhhbmRsZURyYWdFbmQ6ICR7ZXJyb3J9YCxcblx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBkcmFnRW5kKCknXG5cdFx0XHQpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRyb3AoZTogRHJhZ0V2ZW50KTogdm9pZCB7XG5cdHRyeSB7XG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdGNvbnN0IHRhcmdldCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudDtcblxuXHRcdGlmIChkcmFnU3JjRWwgJiYgZHJhZ1NyY0VsICE9PSB0YXJnZXQpIHtcblx0XHRcdGNvbnN0IGRyYWdTcmNJZCA9IGRyYWdTcmNFbC5pZDtcblx0XHRcdGNvbnN0IGRyb3BUYXJnZXRJZCA9IHRhcmdldC5pZDtcblx0XHRcdGNvbnN0IGRyYWdTcmNUZXh0ID0gKFxuXHRcdFx0XHRkcmFnU3JjRWwucXVlcnlTZWxlY3Rvcihcblx0XHRcdFx0XHQnLmNvbG9yLXRleHQtb3V0cHV0LWJveCdcblx0XHRcdFx0KSBhcyBIVE1MSW5wdXRFbGVtZW50XG5cdFx0XHQpLnZhbHVlO1xuXHRcdFx0Y29uc3QgZHJvcFRhcmdldFRleHQgPSAoXG5cdFx0XHRcdHRhcmdldC5xdWVyeVNlbGVjdG9yKFxuXHRcdFx0XHRcdCcuY29sb3ItdGV4dC1vdXRwdXQtYm94J1xuXHRcdFx0XHQpIGFzIEhUTUxJbnB1dEVsZW1lbnRcblx0XHRcdCkudmFsdWU7XG5cdFx0XHRjb25zdCBkcmFnU3JjT3V0ZXJIVE1MID0gZHJhZ1NyY0VsLm91dGVySFRNTDtcblx0XHRcdGNvbnN0IGRyb3BUYXJnZXRPdXRlckhUTUwgPSB0YXJnZXQub3V0ZXJIVE1MO1xuXG5cdFx0XHRkcmFnU3JjRWwub3V0ZXJIVE1MID0gZHJvcFRhcmdldE91dGVySFRNTDtcblx0XHRcdHRhcmdldC5vdXRlckhUTUwgPSBkcmFnU3JjT3V0ZXJIVE1MO1xuXG5cdFx0XHRjb25zdCBuZXdEcmFnU3JjRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHRcdFx0ZHJvcFRhcmdldElkXG5cdFx0XHQpIGFzIEhUTUxFbGVtZW50O1xuXHRcdFx0Y29uc3QgbmV3RHJvcFRhcmdldEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG5cdFx0XHRcdGRyYWdTcmNJZFxuXHRcdFx0KSBhcyBIVE1MRWxlbWVudDtcblxuXHRcdFx0bmV3RHJhZ1NyY0VsLmlkID0gZHJhZ1NyY0lkO1xuXHRcdFx0bmV3RHJvcFRhcmdldEVsLmlkID0gZHJvcFRhcmdldElkO1xuXG5cdFx0XHQoXG5cdFx0XHRcdG5ld0RyYWdTcmNFbC5xdWVyeVNlbGVjdG9yKFxuXHRcdFx0XHRcdCcuY29sb3ItdGV4dC1vdXRwdXQtYm94J1xuXHRcdFx0XHQpIGFzIEhUTUxJbnB1dEVsZW1lbnRcblx0XHRcdCkudmFsdWUgPSBkcm9wVGFyZ2V0VGV4dDtcblx0XHRcdChcblx0XHRcdFx0bmV3RHJvcFRhcmdldEVsLnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdFx0Jy5jb2xvci10ZXh0LW91dHB1dC1ib3gnXG5cdFx0XHRcdCkgYXMgSFRNTElucHV0RWxlbWVudFxuXHRcdFx0KS52YWx1ZSA9IGRyYWdTcmNUZXh0O1xuXG5cdFx0XHRpZiAoIW1vZGUucXVpZXQgJiYgbW9kZS5kZWJ1ZyAmJiBsb2dNb2RlLnZlcmJvc2l0eSA+IDMpXG5cdFx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHRcdCdjYWxsaW5nIGF0dGFjaERyYWdBbmREcm9wRXZlbnRMaXN0ZW5lcnMgZm9yIG5ldyBlbGVtZW50cycsXG5cdFx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBkcm9wKCknXG5cdFx0XHRcdCk7XG5cblx0XHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKG5ld0RyYWdTcmNFbCk7XG5cblx0XHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKG5ld0Ryb3BUYXJnZXRFbCk7XG5cdFx0fVxuXG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIG1vZGUuZGVidWcgJiYgbG9nTW9kZS52ZXJib3NpdHkgPiAzKVxuXHRcdFx0bG9nZ2VyLmluZm8oXG5cdFx0XHRcdCdoYW5kbGVEcm9wIGNvbXBsZXRlJyxcblx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBkcm9wKCknXG5cdFx0XHQpO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmICghbG9nTW9kZS5lcnJvcilcblx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0YEVycm9yIGluIGhhbmRsZURyb3A6ICR7ZXJyb3J9YCxcblx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBkcm9wKCknXG5cdFx0XHQpO1xuXHR9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIG1ha2VQYWxldHRlQm94KFxuXHRjb2xvcjogQ29sb3IsXG5cdHBhbGV0dGVCb3hDb3VudDogbnVtYmVyXG4pOiBQcm9taXNlPE1ha2VQYWxldHRlQm94PiB7XG5cdHRyeSB7XG5cdFx0aWYgKCFjb3JlLnZhbGlkYXRlLmNvbG9yVmFsdWVzKGNvbG9yKSkge1xuXHRcdFx0aWYgKCFsb2dNb2RlLmVycm9yKVxuXHRcdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdFx0YEludmFsaWQgJHtjb2xvci5mb3JtYXR9IGNvbG9yIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoY29sb3IpfWAsXG5cdFx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBtYWtlUGFsZXR0ZUJveCgpJ1xuXHRcdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRjb2xvclN0cmlwZTogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXG5cdFx0XHRcdHBhbGV0dGVCb3hDb3VudFxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRjb25zdCBjbG9uZWRDb2xvciA9IGNvcmUuYmFzZS5jbG9uZShjb2xvcik7XG5cblx0XHRjb25zdCBwYWxldHRlQm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cGFsZXR0ZUJveC5jbGFzc05hbWUgPSAncGFsZXR0ZS1ib3gnO1xuXHRcdHBhbGV0dGVCb3guaWQgPSBgcGFsZXR0ZS1ib3gtJHtwYWxldHRlQm94Q291bnR9YDtcblxuXHRcdGNvbnN0IHBhbGV0dGVCb3hUb3BIYWxmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cGFsZXR0ZUJveFRvcEhhbGYuY2xhc3NOYW1lID0gJ3BhbGV0dGUtYm94LWhhbGYgcGFsZXR0ZS1ib3gtdG9wLWhhbGYnO1xuXHRcdHBhbGV0dGVCb3hUb3BIYWxmLmlkID0gYHBhbGV0dGUtYm94LXRvcC1oYWxmLSR7cGFsZXR0ZUJveENvdW50fWA7XG5cblx0XHRjb25zdCBjb2xvclRleHRPdXRwdXRCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFxuXHRcdFx0J2lucHV0J1xuXHRcdCkgYXMgQ29sb3JJbnB1dEVsZW1lbnQ7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnR5cGUgPSAndGV4dCc7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LmNsYXNzTmFtZSA9ICdjb2xvci10ZXh0LW91dHB1dC1ib3ggdG9vbHRpcCc7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LmlkID0gYGNvbG9yLXRleHQtb3V0cHV0LWJveC0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXHRcdGNvbG9yVGV4dE91dHB1dEJveC5zZXRBdHRyaWJ1dGUoJ2RhdGEtZm9ybWF0JywgJ2hleCcpO1xuXG5cdFx0Y29uc3QgY29sb3JTdHJpbmcgPVxuXHRcdFx0YXdhaXQgY29yZS5jb252ZXJ0LmNvbG9yVG9DU1NDb2xvclN0cmluZyhjbG9uZWRDb2xvcik7XG5cblx0XHRjb2xvclRleHRPdXRwdXRCb3gudmFsdWUgPSBjb2xvclN0cmluZyB8fCAnJztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guY29sb3JWYWx1ZXMgPSBjbG9uZWRDb2xvcjtcblx0XHRjb2xvclRleHRPdXRwdXRCb3gucmVhZE9ubHkgPSBmYWxzZTtcblx0XHRjb2xvclRleHRPdXRwdXRCb3guc3R5bGUuY3Vyc29yID0gJ3RleHQnO1xuXHRcdGNvbG9yVGV4dE91dHB1dEJveC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnO1xuXG5cdFx0Y29uc3QgY29weUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXHRcdGNvcHlCdXR0b24uY2xhc3NOYW1lID0gJ2NvcHktYnV0dG9uJztcblx0XHRjb3B5QnV0dG9uLnRleHRDb250ZW50ID0gJ0NvcHknO1xuXG5cdFx0Y29uc3QgdG9vbHRpcFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG5cdFx0dG9vbHRpcFRleHQuY2xhc3NOYW1lID0gJ3Rvb2x0aXB0ZXh0Jztcblx0XHR0b29sdGlwVGV4dC50ZXh0Q29udGVudCA9ICdDb3BpZWQgdG8gY2xpcGJvYXJkISc7XG5cblx0XHRjb3B5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0YXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29sb3JUZXh0T3V0cHV0Qm94LnZhbHVlKTtcblxuXHRcdFx0XHRzaG93VG9vbHRpcChjb2xvclRleHRPdXRwdXRCb3gpO1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dChjb25zdHMudGltZW91dHMudG9vbHRpcCB8fCAxMDAwKTtcblxuXHRcdFx0XHRjb3B5QnV0dG9uLnRleHRDb250ZW50ID0gJ0NvcGllZCEnO1xuXHRcdFx0XHRzZXRUaW1lb3V0KFxuXHRcdFx0XHRcdCgpID0+IChjb3B5QnV0dG9uLnRleHRDb250ZW50ID0gJ0NvcHknKSxcblx0XHRcdFx0XHRjb25zdHMudGltZW91dHMuY29weUJ1dHRvblRleHQgfHwgMTAwMFxuXHRcdFx0XHQpO1xuXHRcdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdFx0aWYgKCFsb2dNb2RlLmVycm9yKVxuXHRcdFx0XHRcdGxvZ2dlci5lcnJvcihcblx0XHRcdFx0XHRcdGBGYWlsZWQgdG8gY29weTogJHtlcnJvcn1gLFxuXHRcdFx0XHRcdFx0J2NvbW1vbiA+IGhlbHBlcnMgPiBkb20gPiBtYWtlUGFsZXR0ZUJveCgpJ1xuXHRcdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRjb2xvclRleHRPdXRwdXRCb3guYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRcdCdpbnB1dCcsXG5cdFx0XHRjb3JlLmJhc2UuZGVib3VuY2UoKGU6IEV2ZW50KSA9PiB7XG5cdFx0XHRcdGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsO1xuXHRcdFx0XHRpZiAodGFyZ2V0KSB7XG5cdFx0XHRcdFx0Y29uc3QgY3NzQ29sb3IgPSB0YXJnZXQudmFsdWUudHJpbSgpO1xuXHRcdFx0XHRcdGNvbnN0IGJveEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHRcdFx0XHRcdGBjb2xvci1ib3gtJHtwYWxldHRlQm94Q291bnR9YFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0Y29uc3Qgc3RyaXBlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRcdFx0YGNvbG9yLXN0cmlwZS0ke3BhbGV0dGVCb3hDb3VudH1gXG5cdFx0XHRcdFx0KTtcblxuXHRcdFx0XHRcdGlmIChib3hFbGVtZW50KSBib3hFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNzc0NvbG9yO1xuXHRcdFx0XHRcdGlmIChzdHJpcGVFbGVtZW50KVxuXHRcdFx0XHRcdFx0c3RyaXBlRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjc3NDb2xvcjtcblx0XHRcdFx0fVxuXHRcdFx0fSwgY29uc3RzLmRlYm91bmNlLmlucHV0IHx8IDIwMClcblx0XHQpO1xuXG5cdFx0cGFsZXR0ZUJveFRvcEhhbGYuYXBwZW5kQ2hpbGQoY29sb3JUZXh0T3V0cHV0Qm94KTtcblx0XHRwYWxldHRlQm94VG9wSGFsZi5hcHBlbmRDaGlsZChjb3B5QnV0dG9uKTtcblxuXHRcdGNvbnN0IHBhbGV0dGVCb3hCb3R0b21IYWxmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cGFsZXR0ZUJveEJvdHRvbUhhbGYuY2xhc3NOYW1lID1cblx0XHRcdCdwYWxldHRlLWJveC1oYWxmIHBhbGV0dGUtYm94LWJvdHRvbS1oYWxmJztcblx0XHRwYWxldHRlQm94Qm90dG9tSGFsZi5pZCA9IGBwYWxldHRlLWJveC1ib3R0b20taGFsZi0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXG5cdFx0Y29uc3QgY29sb3JCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRjb2xvckJveC5jbGFzc05hbWUgPSAnY29sb3ItYm94Jztcblx0XHRjb2xvckJveC5pZCA9IGBjb2xvci1ib3gtJHtwYWxldHRlQm94Q291bnR9YDtcblx0XHRjb2xvckJveC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvclN0cmluZyB8fCAnI2ZmZmZmZic7XG5cblx0XHRwYWxldHRlQm94Qm90dG9tSGFsZi5hcHBlbmRDaGlsZChjb2xvckJveCk7XG5cdFx0cGFsZXR0ZUJveC5hcHBlbmRDaGlsZChwYWxldHRlQm94VG9wSGFsZik7XG5cdFx0cGFsZXR0ZUJveC5hcHBlbmRDaGlsZChwYWxldHRlQm94Qm90dG9tSGFsZik7XG5cblx0XHRjb25zdCBjb2xvclN0cmlwZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdGNvbG9yU3RyaXBlLmNsYXNzTmFtZSA9ICdjb2xvci1zdHJpcGUnO1xuXHRcdGNvbG9yU3RyaXBlLmlkID0gYGNvbG9yLXN0cmlwZS0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXHRcdGNvbG9yU3RyaXBlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yU3RyaW5nIHx8ICcjZmZmZmZmJztcblxuXHRcdGNvbG9yU3RyaXBlLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ3RydWUnKTtcblxuXHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKGNvbG9yU3RyaXBlKTtcblxuXHRcdGNvbG9yU3RyaXBlLmFwcGVuZENoaWxkKHBhbGV0dGVCb3gpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNvbG9yU3RyaXBlLFxuXHRcdFx0cGFsZXR0ZUJveENvdW50OiBwYWxldHRlQm94Q291bnQgKyAxXG5cdFx0fTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAoIWxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZXhlY3V0ZSBtYWtlUGFsZXR0ZUJveDogJHtlcnJvcn1gLFxuXHRcdFx0XHQnY29tbW9uID4gaGVscGVycyA+IGRvbSA+IG1ha2VQYWxldHRlQm94KCknXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNvbG9yU3RyaXBlOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcblx0XHRcdHBhbGV0dGVCb3hDb3VudFxuXHRcdH07XG5cdH1cbn1cblxuZnVuY3Rpb24gc2hvd1RvYXN0KG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuXHRjb25zdCB0b2FzdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG5cdHRvYXN0LmNsYXNzTmFtZSA9ICd0b2FzdC1tZXNzYWdlJztcblxuXHR0b2FzdC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG5cblx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0b2FzdCk7XG5cblx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRsb2dnZXIuaW5mbyhcblx0XHRcdCdUb2FzdCBtZXNzYWdlIGFkZGVkJyxcblx0XHRcdCdjb21tb24gPiBoZWxwZXJzID4gZG9tID4gc2hvd1RvYXN0KCknXG5cdFx0KTtcblxuXHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHR0b2FzdC5jbGFzc0xpc3QuYWRkKCdmYWRlLW91dCcpO1xuXG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdGxvZ2dlci5pbmZvKFxuXHRcdFx0XHQnVG9hc3QgbWVzc2FnZSBmYWRlZCBvdXQnLFxuXHRcdFx0XHQnY29tbW9uID4gaGVscGVycyA+IGRvbSA+IHNob3dUb2FzdCgpJ1xuXHRcdFx0KTtcblxuXHRcdHRvYXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lZCcsICgpID0+IHRvYXN0LnJlbW92ZSgpKTtcblx0fSwgdGltZW91dHMudG9hc3QgfHwgMzAwMCk7XG59XG5cbmZ1bmN0aW9uIHNob3dUb29sdGlwKHRvb2x0aXBFbGVtZW50OiBIVE1MRWxlbWVudCk6IHZvaWQge1xuXHR0cnkge1xuXHRcdGNvbnN0IHRvb2x0aXAgPVxuXHRcdFx0dG9vbHRpcEVsZW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MRWxlbWVudD4oJy50b29sdGlwdGV4dCcpO1xuXG5cdFx0aWYgKHRvb2x0aXApIHtcblx0XHRcdHRvb2x0aXAuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcblx0XHRcdHRvb2x0aXAuc3R5bGUub3BhY2l0eSA9ICcxJztcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHR0b29sdGlwLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcblx0XHRcdFx0dG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuXHRcdFx0fSwgY29uc3RzLnRpbWVvdXRzLnRvb2x0aXAgfHwgMTAwMCk7XG5cdFx0fVxuXG5cdFx0aWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMylcblx0XHRcdGxvZ2dlci5pbmZvKCdzaG93VG9vbHRpcCBleGVjdXRlZCcsICdzaG93VG9vbHRpcCgpJyk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBGYWlsZWQgdG8gZXhlY3V0ZSBzaG93VG9vbHRpcDogJHtlcnJvcn1gLFxuXHRcdFx0XHQnY29tbW9uID4gaGVscGVycyA+IGRvbSA+IHNob3dUb29sdGlwKCknXG5cdFx0XHQpO1xuXHR9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHZhbGlkYXRlQW5kQ29udmVydENvbG9yKFxuXHRjb2xvcjogQ29sb3IgfCBDb2xvclN0cmluZyB8IG51bGxcbik6IFByb21pc2U8Q29sb3IgfCBudWxsPiB7XG5cdGlmICghY29sb3IpIHJldHVybiBudWxsO1xuXG5cdGNvbnN0IGNvbnZlcnRlZENvbG9yID0gY29yZS5ndWFyZHMuaXNDb2xvclN0cmluZyhjb2xvcilcblx0XHQ/IGF3YWl0IGNvcmUuY29udmVydC5jb2xvclN0cmluZ1RvQ29sb3IoY29sb3IpXG5cdFx0OiBjb2xvcjtcblxuXHRpZiAoIWNvcmUudmFsaWRhdGUuY29sb3JWYWx1ZXMoY29udmVydGVkQ29sb3IpKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3IpXG5cdFx0XHRsb2dnZXIuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkIGNvbG9yOiAke0pTT04uc3RyaW5naWZ5KGNvbnZlcnRlZENvbG9yKX1gLFxuXHRcdFx0XHQnY29tbW9uID4gaGVscGVycyA+IGRvbSA+IHZhbGlkYXRlQW5kQ29udmVydENvbG9yKCknXG5cdFx0XHQpO1xuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRyZXR1cm4gY29udmVydGVkQ29sb3I7XG59XG5cbmV4cG9ydCBjb25zdCBkb206IENvbW1vbkZ1bmN0aW9uc01hc3RlckludGVyZmFjZVsnaGVscGVycyddWydkb20nXSA9IHtcblx0YXR0YWNoRHJhZ0FuZERyb3BMaXN0ZW5lcnMsXG5cdGhhbmRsZToge1xuXHRcdGRyYWdTdGFydCxcblx0XHRkcmFnT3Zlcixcblx0XHRkcmFnRW5kLFxuXHRcdGRyb3Bcblx0fSxcblx0bWFrZVBhbGV0dGVCb3gsXG5cdHNob3dUb2FzdCxcblx0c2hvd1Rvb2x0aXAsXG5cdHZhbGlkYXRlQW5kQ29udmVydENvbG9yXG59IGFzIGNvbnN0O1xuIl19