{"version":3,"file":"DataObserver.js","sources":["../../../../../src/common/services/DataObserver.ts"],"sourcesContent":["// File: common/services/DataObserver.js\n\nimport { DataObserverInterface, Listener } from '../../types/index.js';\n\ninterface DebounceOptions {\n\tdelay?: number;\n}\n\nexport class DataObserver<T extends Record<string, unknown>>\n\timplements DataObserverInterface<T>\n{\n\t#listeners: { [P in keyof T]?: Listener<T[P]>[] } = {};\n\t#debounceTimers: Partial<Record<keyof T, NodeJS.Timeout>> = {};\n\n\tconstructor(\n\t\tprivate data: T,\n\t\tprivate debounceOptions: DebounceOptions = {}\n\t) {\n\t\tthis.data = this.#deepObserve(this.data);\n\t}\n\n\tget<K extends keyof T>(prop: K): T[K] {\n\t\treturn this.data[prop];\n\t}\n\n\toff<K extends keyof T>(prop: K, callback: Listener<T[K]>): void {\n\t\tthis.#listeners[prop] =\n\t\t\tthis.#listeners[prop]?.filter(cb => cb !== callback) ?? [];\n\t}\n\n\ton<K extends keyof T>(prop: K, callback: Listener<T[K]>): void {\n\t\tif (!this.#listeners[prop]) {\n\t\t\tthis.#listeners[prop] = [];\n\t\t}\n\t\tthis.#listeners[prop]!.push(callback);\n\t}\n\n\tset<K extends keyof T>(prop: K, value: T[K]): void {\n\t\tthis.data[prop] = value;\n\t}\n\n\tsetData<U extends Record<string, unknown>>(newData: U): DataObserver<U> {\n\t\treturn new DataObserver(newData);\n\t}\n\n\t#deepObserve(obj: T): T {\n\t\tif (typeof obj !== 'object' || obj === null) {\n\t\t\treturn obj;\n\t\t}\n\n\t\t// recursively proxy nested objects\n\t\treturn new Proxy(obj as Record<string, unknown>, {\n\t\t\tget: (target, prop: string) => {\n\t\t\t\tconst value = target[prop];\n\t\t\t\treturn typeof value === 'object' && value !== null\n\t\t\t\t\t? this.#deepObserve(value as T)\n\t\t\t\t\t: value;\n\t\t\t},\n\t\t\tset: (target, prop: string, value) => {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(target, prop)) {\n\t\t\t\t\tconst oldValue = target[prop];\n\t\t\t\t\ttarget[prop] = value;\n\t\t\t\t\tthis.#triggerNotify(\n\t\t\t\t\t\tprop as keyof T,\n\t\t\t\t\t\tvalue as T[keyof T],\n\t\t\t\t\t\toldValue as T[keyof T]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\tdeleteProperty: (target, prop: string) => {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(target, prop)) {\n\t\t\t\t\tconst oldValue = target[prop];\n\t\t\t\t\tdelete target[prop];\n\t\t\t\t\tthis.#triggerNotify(\n\t\t\t\t\t\tprop as keyof T,\n\t\t\t\t\t\tundefined as T[keyof T],\n\t\t\t\t\t\toldValue as T[keyof T]\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}) as T;\n\t}\n\n\t#notify<K extends keyof T>(prop: K, newValue: T[K], oldValue: T[K]) {\n\t\tthis.#listeners[prop]?.forEach(callback =>\n\t\t\tcallback(newValue, oldValue)\n\t\t);\n\t}\n\n\t#triggerNotify<K extends keyof T>(prop: K, newValue: T[K], oldValue: T[K]) {\n\t\tconst delay = this.debounceOptions.delay ?? 0;\n\n\t\tif (delay > 0) {\n\t\t\tclearTimeout(this.#debounceTimers[prop]);\n\t\t\tthis.#debounceTimers[prop] = setTimeout(() => {\n\t\t\t\tthis.#notify(prop, newValue, oldValue);\n\t\t\t}, delay);\n\t\t} else {\n\t\t\tthis.#notify(prop, newValue, oldValue);\n\t\t}\n\t}\n}\n"],"names":[],"mappings":"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"}