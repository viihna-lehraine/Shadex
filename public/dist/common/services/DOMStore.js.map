{"version":3,"file":"DOMStore.js","sources":["../../../../../src/common/services/DOMStore.ts"],"sourcesContent":["// File: common/services/DOMStore.ts\n\nimport {\n\tDOMElements,\n\tDOMStoreInterface,\n\tHelpers,\n\tServices,\n\tUnvalidatedDOMElements\n} from '../../types/index.js';\nimport { domIndex } from '../../config/index.js';\n\nconst caller = '[DOMStore]';\nconst ids = domIndex.ids;\n\n/**\n * @description Stores validation data for DOM elements\n * @export\n * @class DOMStore\n * @implements {DOMStoreInterface}\n */\nexport class DOMStore implements DOMStoreInterface {\n\tstatic #instance: DOMStore;\n\t#elements: DOMElements | null = null;\n\t#errors: Services['errors'];\n\t#helpers: Helpers;\n\t#log: Services['log'];\n\n\tconstructor(\n\t\terrors: Services['errors'],\n\t\thelpers: Helpers,\n\t\tlog: Services['log']\n\t) {\n\t\tthis.#errors = errors;\n\t\tthis.#log = log;\n\t\tthis.#helpers = helpers;\n\t\tthis.#validateAndGetDOMElements();\n\t}\n\n\tstatic getInstance(\n\t\terrors: Services['errors'],\n\t\thelpers: Helpers,\n\t\tlog: Services['log']\n\t): DOMStore {\n\t\treturn errors.handleSync(\n\t\t\t() => {\n\t\t\t\tif (!DOMStore.#instance) {\n\t\t\t\t\tlog(\n\t\t\t\t\t\t'No DOMStore instance exists yet. Creating DOMStore instance',\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaller: `${caller}.getInstance`,\n\t\t\t\t\t\t\tlevel: 'debug'\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tDOMStore.#instance = new DOMStore(errors, helpers, log);\n\t\t\t\t}\n\n\t\t\t\tlog(\n\t\t\t\t\t'DOMStore instance already exists. Returning existing instance',\n\t\t\t\t\t{\n\t\t\t\t\t\tcaller: `${caller}.getInstance`,\n\t\t\t\t\t\tlevel: 'debug'\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\treturn DOMStore.#instance;\n\t\t\t},\n\t\t\t'Error getting DOMStore instance.',\n\t\t\t{ fallback: new DOMStore(errors, helpers, log) }\n\t\t);\n\t}\n\n\t/**\n\t * @description Get a single DOM element\n\t * @param category *\n\t * @param key *\n\t * @returns {DOMElements[K][E]}\n\t */\n\tgetElement<K extends keyof DOMElements, E extends keyof DOMElements[K]>(\n\t\tcategory: K,\n\t\tkey: E\n\t): DOMElements[K][E] {\n\t\treturn this.#errors.handleSync(\n\t\t\t() => {\n\t\t\t\tconst element = this.#elements?.[category]?.[key];\n\n\t\t\t\tif (!element) {\n\t\t\t\t\tthis.#log(\n\t\t\t\t\t\t`Element ${category}.${String(key)} is not validated or missing.`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaller: `${caller}.getElement`,\n\t\t\t\t\t\t\tlevel: 'error'\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Element ${category}.${String(key)} not found`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn element;\n\t\t\t},\n\t\t\t'Error getting DOM element.',\n\t\t\t{ fallback: null as unknown as DOMElements[K][E] }\n\t\t);\n\t}\n\n\t/**\n\t * @description Get all DOM elements\n\t * @param category *\n\t * @param key *\n\t * @returns {DOMElements[K][E]}\n\t */\n\tgetElements(): DOMElements {\n\t\treturn this.#errors.handleSync(\n\t\t\t() => {\n\t\t\t\tif (!this.#elements) {\n\t\t\t\t\tthis.#log('DOM elements are not validated yet.', {\n\t\t\t\t\t\tcaller: `${caller}.getElements`,\n\t\t\t\t\t\tlevel: 'warn'\n\t\t\t\t\t});\n\t\t\t\t\tthrow new Error('DOM elements not validated');\n\t\t\t\t}\n\n\t\t\t\treturn this.#elements;\n\t\t\t},\n\t\t\t'Error getting DOM elements.',\n\t\t\t{ fallback: {} as DOMElements }\n\t\t);\n\t}\n\n\t/**\n\t * @description Sets class instance's DOM elements value\n\t * @param elements DOMElements\n\t */\n\tsetElements(elements: DOMElements): void {\n\t\treturn this.#errors.handleSync(() => {\n\t\t\tthis.#elements = elements;\n\n\t\t\tthis.#log('DOM elements set successfully', {\n\t\t\t\tcaller: `${caller}.setElements`,\n\t\t\t\tlevel: 'debug'\n\t\t\t});\n\t\t}, 'Unable to set DOM elements');\n\t}\n\n\t/**\n\t * @description Validates and retrieves DOM elements\n\t * @private\n\t * @memberof DOMStore\n\t * @returns {void}\n\t */\n\t#validateAndGetDOMElements(): void {\n\t\tconst missingElements: string[] = [];\n\n\t\tthis.#errors.handleSync(\n\t\t\t() => {\n\t\t\t\tconst elementTypeMap: Record<\n\t\t\t\t\tkeyof UnvalidatedDOMElements,\n\t\t\t\t\tkeyof HTMLElementTagNameMap\n\t\t\t\t> = {\n\t\t\t\t\tbtns: 'button',\n\t\t\t\t\tdivs: 'div',\n\t\t\t\t\tinputs: 'input'\n\t\t\t\t};\n\n\t\t\t\tconst elements: Partial<DOMElements> = {\n\t\t\t\t\tbtns: {} as DOMElements['btns'],\n\t\t\t\t\tdivs: {} as DOMElements['divs'],\n\t\t\t\t\tinputs: {} as DOMElements['inputs']\n\t\t\t\t};\n\n\t\t\t\tfor (const [category, elementsGroup] of Object.entries(ids)) {\n\t\t\t\t\tconst tagName =\n\t\t\t\t\t\telementTypeMap[\n\t\t\t\t\t\t\tcategory as keyof UnvalidatedDOMElements\n\t\t\t\t\t\t];\n\t\t\t\t\tif (!tagName) {\n\t\t\t\t\t\tthis.#log(\n\t\t\t\t\t\t\t`No element type mapping for category \"${category}\". Skipping...`,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcaller: `${caller}.#validateAndGetDOMElements`,\n\t\t\t\t\t\t\t\tlevel: 'warn'\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const [key, id] of Object.entries(elementsGroup)) {\n\t\t\t\t\t\tconst element =\n\t\t\t\t\t\t\tthis.#helpers.dom.getElement<\n\t\t\t\t\t\t\t\tHTMLElementTagNameMap[typeof tagName]\n\t\t\t\t\t\t\t>(id);\n\t\t\t\t\t\tif (!element) {\n\t\t\t\t\t\t\tthis.#log(`Element with ID \"${id}\" not found.`, {\n\t\t\t\t\t\t\t\tcaller: `${caller}.#validateAndGetDOMElements`,\n\t\t\t\t\t\t\t\tlevel: 'warn'\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tmissingElements.push(id);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\telements[\n\t\t\t\t\t\t\t\t\tcategory as keyof DOMElements\n\t\t\t\t\t\t\t\t] as Record<string, HTMLElement>\n\t\t\t\t\t\t\t)[key] = element;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (missingElements.length > 0) {\n\t\t\t\t\tthis.#log(\n\t\t\t\t\t\t`Missing elements: ${missingElements.join(', ')}`,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcaller: `${caller}.#validateAndGetDOMElements`,\n\t\t\t\t\t\t\tlevel: 'error'\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t'Some DOM elements are missing. Validation failed.'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tthis.#elements = elements as DOMElements;\n\t\t\t},\n\t\t\t'Unable to validate DOM elements',\n\t\t\t{ context: { missingElements } }\n\t\t);\n\t\tthis.#log('All static elements are present! üè≥Ô∏è‚Äç‚ößÔ∏è ü©∑ üè≥Ô∏è‚Äç‚ößÔ∏è', {\n\t\t\tcaller: `${caller}.#validateAndGetDOMElements`,\n\t\t\tlevel: 'info'\n\t\t});\n\t}\n}\n"],"names":[],"mappings":"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"}