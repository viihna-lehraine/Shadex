import { convert } from '../../color-conversion/conversion-index.js';
import { config } from '../../config/constants.js';
import { paletteHelpers } from '../../helpers/palette.js';
import { core } from '../../utils/core.js';
function isCMYKTooBright(cmyk) {
    if (!paletteHelpers.validateColorValues(cmyk)) {
        console.error(`Invalid CMYK value ${JSON.stringify(cmyk)}`);
        return false;
    }
    return (core.clone(cmyk).value.cyan < config.cmykBrightnessThreshold &&
        core.clone(cmyk).value.magenta < config.cmykBrightnessThreshold &&
        core.clone(cmyk).value.yellow < config.cmykBrightnessThreshold);
}
export function isCMYKTooDark(cmyk) {
    if (!paletteHelpers.validateColorValues(cmyk)) {
        console.error(`Invalid CMYK value ${JSON.stringify(cmyk)}`);
        return false;
    }
    return core.clone(cmyk).value.key > config.cmykDarknessThreshold;
}
function isCMYKTooGray(cmyk) {
    if (!paletteHelpers.validateColorValues(cmyk)) {
        console.error(`Invalid CMYK value ${JSON.stringify(cmyk)}`);
        return false;
    }
    return (Math.abs(core.clone(cmyk).value.cyan - core.clone(cmyk).value.magenta) <
        config.cmykGrayThreshold &&
        Math.abs(core.clone(cmyk).value.magenta - core.clone(cmyk).value.yellow) < config.cmykGrayThreshold);
}
function isHexTooBright(hex) {
    if (!paletteHelpers.validateColorValues(hex)) {
        console.error(`Invalid Hex value ${JSON.stringify(hex)}`);
        return false;
    }
    return isRGBTooBright(convert.hexToRGB(core.clone(hex)));
}
function isHexTooDark(hex) {
    if (!paletteHelpers.validateColorValues(hex)) {
        console.error(`Invalid Hex value ${JSON.stringify(hex)}`);
        return false;
    }
    return isRGBTooBright(convert.hexToRGB(core.clone(hex)));
}
function isHexTooGray(hex) {
    if (!paletteHelpers.validateColorValues(hex)) {
        console.error(`Invalid Hex value ${JSON.stringify(hex)}`);
        return false;
    }
    return isRGBTooGray(convert.hexToRGB(core.clone(hex)));
}
function isHSLTooBright(hsl) {
    if (!paletteHelpers.validateColorValues(hsl)) {
        console.error(`Invalid HSL value ${JSON.stringify(hsl)}`);
        return false;
    }
    return core.clone(hsl).value.lightness > config.hslBrightnessThreshold;
}
function isHSLTooDark(hsl) {
    if (!paletteHelpers.validateColorValues(hsl)) {
        console.error(`Invalid HSL value ${JSON.stringify(hsl)}`);
        return false;
    }
    return core.clone(hsl).value.lightness < config.hslDarknessThreshold;
}
function isHSLTooGray(hsl) {
    if (!paletteHelpers.validateColorValues(hsl)) {
        console.error(`Invalid HSL value ${JSON.stringify(hsl)}`);
        return false;
    }
    return core.clone(hsl).value.saturation < config.hslGrayThreshold;
}
function isHSVTooBright(hsv) {
    if (!paletteHelpers.validateColorValues(hsv)) {
        console.error(`Invalid HSV value ${JSON.stringify(hsv)}`);
        return false;
    }
    return (core.clone(hsv).value.value > config.hsvBrightnessValueThreshold &&
        core.clone(hsv).value.saturation <
            config.hsvBrightnessSaturationThreshold);
}
function isHSVTooDark(hsv) {
    if (!paletteHelpers.validateColorValues(hsv)) {
        console.error(`Invalid HSV value ${JSON.stringify(hsv)}`);
        return false;
    }
    return core.clone(hsv).value.value < config.hsvDarknessThreshold;
}
function isHSVTooGray(hsv) {
    if (!paletteHelpers.validateColorValues(hsv)) {
        console.error(`Invalid HSV value ${JSON.stringify(hsv)}`);
        return false;
    }
    return core.clone(hsv).value.saturation < config.hsvGrayThreshold;
}
function isLABTooBright(lab) {
    if (!paletteHelpers.validateColorValues(lab)) {
        console.error(`Invalid LAB value ${JSON.stringify(lab)}`);
        return false;
    }
    return core.clone(lab).value.l > config.labBrightnessThreshold;
}
function isLABTooDark(lab) {
    if (!paletteHelpers.validateColorValues(lab)) {
        console.error(`Invalid LAB value ${JSON.stringify(lab)}`);
        return false;
    }
    return core.clone(lab).value.l < config.labDarknessThreshold;
}
function isLABTooGray(lab) {
    if (!paletteHelpers.validateColorValues(lab)) {
        console.error(`Invalid LAB value ${JSON.stringify(lab)}`);
        return false;
    }
    return (Math.abs(core.clone(lab).value.a) < config.labGrayThreshold &&
        Math.abs(core.clone(lab).value.b) < config.labGrayThreshold);
}
function isRGBTooBright(rgb) {
    if (!paletteHelpers.validateColorValues(rgb)) {
        console.error(`Invalid RGB value ${JSON.stringify(rgb)}`);
        return false;
    }
    return ((core.clone(rgb).value.red +
        core.clone(rgb).value.green +
        core.clone(rgb).value.blue) /
        3 >
        config.rgbMaxBrightness);
}
function isRGBTooDark(rgb) {
    if (!paletteHelpers.validateColorValues(rgb)) {
        console.error(`Invalid RGB value ${JSON.stringify(rgb)}`);
        return false;
    }
    return ((core.clone(rgb).value.red +
        core.clone(rgb).value.green +
        core.clone(rgb).value.blue) /
        3 <
        config.rgbMinBrightness);
}
function isRGBTooGray(rgb) {
    if (!paletteHelpers.validateColorValues(rgb)) {
        console.error(`Invalid RGB value ${JSON.stringify(rgb)}`);
        return false;
    }
    return (Math.abs(core.clone(rgb).value.red - core.clone(rgb).value.green) <
        config.rgbGrayThreshold &&
        Math.abs(core.clone(rgb).value.green - core.clone(rgb).value.blue) <
            config.rgbGrayThreshold &&
        Math.abs(core.clone(rgb).value.red - core.clone(rgb).value.blue) <
            config.rgbGrayThreshold);
}
function getLimitChecker(limit) {
    return colorLimits[limit];
}
function isColorInBounds(colors) {
    try {
        const areAllColorsValid = Object.entries(colors).every(([key, color]) => {
            if (!paletteHelpers.validateColorValues(color)) {
                console.error(`Invalid color (${key}): ${JSON.stringify(color)}`);
                return false;
            }
            return true;
        });
        if (!areAllColorsValid)
            return false;
        return Object.entries(colors).some(([key, color]) => {
            if (!color)
                return false;
            const format = key.toUpperCase();
            const isTooGray = getLimitChecker(`is${format}TooGray`);
            const isTooDark = getLimitChecker(`is${format}TooDark`);
            const isTooBright = getLimitChecker(`is${format}TooBright`);
            return isTooGray(color) || isTooDark(color) || isTooBright(color);
        });
    }
    catch (error) {
        console.error(`Error validating color bounds: ${error}`);
        return false;
    }
}
export const colorLimits = {
    getLimitChecker,
    isCMYKTooBright,
    isCMYKTooDark,
    isCMYKTooGray,
    isColorInBounds,
    isHexTooBright,
    isHexTooDark,
    isHexTooGray,
    isHSLTooBright,
    isHSLTooDark,
    isHSLTooGray,
    isHSVTooBright,
    isHSVTooDark,
    isHSVTooGray,
    isLABTooBright,
    isLABTooDark,
    isLABTooGray,
    isRGBTooBright,
    isRGBTooDark,
    isRGBTooGray
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGltaXRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2RvbS91c2VyLXBhcmFtcy9saW1pdHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHlDQUF5QyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFJdkQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRXhDLFNBQVMsZUFBZSxDQUFDLElBQWdCO0lBQ3hDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMvQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1RCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLENBQ04sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyx1QkFBdUI7UUFDNUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyx1QkFBdUI7UUFDL0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyx1QkFBdUIsQ0FDOUQsQ0FBQztBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsYUFBYSxDQUFDLElBQWdCO0lBQzdDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMvQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1RCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMscUJBQXFCLENBQUM7QUFDbEUsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLElBQWdCO0lBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMvQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1RCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLENBQ04sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3JFLE1BQU0sQ0FBQyxpQkFBaUI7UUFDekIsSUFBSSxDQUFDLEdBQUcsQ0FDUCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUM5RCxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FDNUIsQ0FBQztBQUNILENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxHQUFjO0lBQ3JDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFELENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxHQUFjO0lBQ25DLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFELENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxHQUFjO0lBQ25DLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxHQUFjO0lBQ3JDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxD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Q1osWUFBWTtJQUNaLGNBQWM7SUFDZCxZQUFZO0lBQ1osWUFBWTtJQUNaLGNBQWM7SUFDZCxZQUFZO0lBQ1osWUFBWTtDQUNaLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb252ZXJ0IH0gZnJvbSAnLi4vLi4vY29sb3ItY29udmVyc2lvbi9jb252ZXJzaW9uLWluZGV4JztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZy9jb25zdGFudHMnO1xuaW1wb3J0IHsgcGFsZXR0ZUhlbHBlcnMgfSBmcm9tICcuLi8uLi9oZWxwZXJzL3BhbGV0dGUnO1xuaW1wb3J0ICogYXMgZm5PYmplY3RzIGZyb20gJy4uLy4uL2luZGV4L2ZuLW9iamVjdHMnO1xuaW1wb3J0ICogYXMgaW50ZXJmYWNlcyBmcm9tICcuLi8uLi9pbmRleC9pbnRlcmZhY2VzJztcbmltcG9ydCAqIGFzIHR5cGVzIGZyb20gJy4uLy4uL2luZGV4L3R5cGVzJztcbmltcG9ydCB7IGNvcmUgfSBmcm9tICcuLi8uLi91dGlscy9jb3JlJztcblxuZnVuY3Rpb24gaXNDTVlLVG9vQnJpZ2h0KGNteWs6IHR5cGVzLkNNWUspOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGNteWspKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBDTVlLIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoY215ayl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdGNvcmUuY2xvbmUoY215aykudmFsdWUuY3lhbiA8IGNvbmZpZy5jbXlrQnJpZ2h0bmVzc1RocmVzaG9sZCAmJlxuXHRcdGNvcmUuY2xvbmUoY215aykudmFsdWUubWFnZW50YSA8IGNvbmZpZy5jbXlrQnJpZ2h0bmVzc1RocmVzaG9sZCAmJlxuXHRcdGNvcmUuY2xvbmUoY215aykudmFsdWUueWVsbG93IDwgY29uZmlnLmNteWtCcmlnaHRuZXNzVGhyZXNob2xkXG5cdCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0NNWUtUb29EYXJrKGNteWs6IHR5cGVzLkNNWUspOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGNteWspKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBDTVlLIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoY215ayl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShjbXlrKS52YWx1ZS5rZXkgPiBjb25maWcuY215a0RhcmtuZXNzVGhyZXNob2xkO1xufVxuXG5mdW5jdGlvbiBpc0NNWUtUb29HcmF5KGNteWs6IHR5cGVzLkNNWUspOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGNteWspKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBDTVlLIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoY215ayl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdE1hdGguYWJzKGNvcmUuY2xvbmUoY215aykudmFsdWUuY3lhbiAtIGNvcmUuY2xvbmUoY215aykudmFsdWUubWFnZW50YSkgPFxuXHRcdFx0Y29uZmlnLmNteWtHcmF5VGhyZXNob2xkICYmXG5cdFx0TWF0aC5hYnMoXG5cdFx0XHRjb3JlLmNsb25lKGNteWspLnZhbHVlLm1hZ2VudGEgLSBjb3JlLmNsb25lKGNteWspLnZhbHVlLnllbGxvd1xuXHRcdCkgPCBjb25maWcuY215a0dyYXlUaHJlc2hvbGRcblx0KTtcbn1cblxuZnVuY3Rpb24gaXNIZXhUb29CcmlnaHQoaGV4OiB0eXBlcy5IZXgpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhleCkpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIEhleCB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhleCl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gaXNSR0JUb29CcmlnaHQoY29udmVydC5oZXhUb1JHQihjb3JlLmNsb25lKGhleCkpKTtcbn1cblxuZnVuY3Rpb24gaXNIZXhUb29EYXJrKGhleDogdHlwZXMuSGV4KTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhoZXgpKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBIZXggdmFsdWUgJHtKU09OLnN0cmluZ2lmeShoZXgpfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIGlzUkdCVG9vQnJpZ2h0KGNvbnZlcnQuaGV4VG9SR0IoY29yZS5jbG9uZShoZXgpKSk7XG59XG5cbmZ1bmN0aW9uIGlzSGV4VG9vR3JheShoZXg6IHR5cGVzLkhleCk6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaGV4KSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgSGV4IHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaGV4KX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBpc1JHQlRvb0dyYXkoY29udmVydC5oZXhUb1JHQihjb3JlLmNsb25lKGhleCkpKTtcbn1cblxuZnVuY3Rpb24gaXNIU0xUb29CcmlnaHQoaHNsOiB0eXBlcy5IU0wpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhzbCkpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIEhTTCB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzbCl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShoc2wpLnZhbHVlLmxpZ2h0bmVzcyA+IGNvbmZpZy5oc2xCcmlnaHRuZXNzVGhyZXNob2xkO1xufVxuXG5mdW5jdGlvbiBpc0hTTFRvb0RhcmsoaHNsOiB0eXBlcy5IU0wpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhzbCkpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIEhTTCB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzbCl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShoc2wpLnZhbHVlLmxpZ2h0bmVzcyA8IGNvbmZpZy5oc2xEYXJrbmVzc1RocmVzaG9sZDtcbn1cblxuZnVuY3Rpb24gaXNIU0xUb29HcmF5KGhzbDogdHlwZXMuSFNMKTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhoc2wpKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBIU0wgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShoc2wpfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIGNvcmUuY2xvbmUoaHNsKS52YWx1ZS5zYXR1cmF0aW9uIDwgY29uZmlnLmhzbEdyYXlUaHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIGlzSFNWVG9vQnJpZ2h0KGhzdjogdHlwZXMuSFNWKTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhoc3YpKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBIU1YgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShoc3YpfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIChcblx0XHRjb3JlLmNsb25lKGhzdikudmFsdWUudmFsdWUgPiBjb25maWcuaHN2QnJpZ2h0bmVzc1ZhbHVlVGhyZXNob2xkICYmXG5cdFx0Y29yZS5jbG9uZShoc3YpLnZhbHVlLnNhdHVyYXRpb24gPFxuXHRcdFx0Y29uZmlnLmhzdkJyaWdodG5lc3NTYXR1cmF0aW9uVGhyZXNob2xkXG5cdCk7XG59XG5cbmZ1bmN0aW9uIGlzSFNWVG9vRGFyayhoc3Y6IHR5cGVzLkhTVik6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHN2KSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgSFNWIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaHN2KX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBjb3JlLmNsb25lKGhzdikudmFsdWUudmFsdWUgPCBjb25maWcuaHN2RGFya25lc3NUaHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIGlzSFNWVG9vR3JheShoc3Y6IHR5cGVzLkhTVik6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHN2KSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgSFNWIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaHN2KX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBjb3JlLmNsb25lKGhzdikudmFsdWUuc2F0dXJhdGlvbiA8IGNvbmZpZy5oc3ZHcmF5VGhyZXNob2xkO1xufVxuXG5mdW5jdGlvbiBpc0xBQlRvb0JyaWdodChsYWI6IHR5cGVzLkxBQik6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMobGFiKSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgTEFCIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkobGFiKX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBjb3JlLmNsb25lKGxhYikudmFsdWUubCA+IGNvbmZpZy5sYWJCcmlnaHRuZXNzVGhyZXNob2xkO1xufVxuXG5mdW5jdGlvbiBpc0xBQlRvb0RhcmsobGFiOiB0eXBlcy5MQUIpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGxhYikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIExBQiB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGxhYil9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShsYWIpLnZhbHVlLmwgPCBjb25maWcubGFiRGFya25lc3NUaHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIGlzTEFCVG9vR3JheShsYWI6IHR5cGVzLkxBQik6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMobGFiKSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgTEFCIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkobGFiKX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiAoXG5cdFx0TWF0aC5hYnMoY29yZS5jbG9uZShsYWIpLnZhbHVlLmEpIDwgY29uZmlnLmxhYkdyYXlUaHJlc2hvbGQgJiZcblx0XHRNYXRoLmFicyhjb3JlLmNsb25lKGxhYikudmFsdWUuYikgPCBjb25maWcubGFiR3JheVRocmVzaG9sZFxuXHQpO1xufVxuXG5mdW5jdGlvbiBpc1JHQlRvb0JyaWdodChyZ2I6IHR5cGVzLlJHQik6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMocmdiKSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgUkdCIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkocmdiKX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiAoXG5cdFx0KGNvcmUuY2xvbmUocmdiKS52YWx1ZS5yZWQgK1xuXHRcdFx0Y29yZS5jbG9uZShyZ2IpLnZhbHVlLmdyZWVuICtcblx0XHRcdGNvcmUuY2xvbmUocmdiKS52YWx1ZS5ibHVlKSAvXG5cdFx0XHQzID5cblx0XHRjb25maWcucmdiTWF4QnJpZ2h0bmVzc1xuXHQpO1xufVxuXG5mdW5jdGlvbiBpc1JHQlRvb0RhcmsocmdiOiB0eXBlcy5SR0IpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKHJnYikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIFJHQiB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHJnYil9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdChjb3JlLmNsb25lKHJnYikudmFsdWUucmVkICtcblx0XHRcdGNvcmUuY2xvbmUocmdiKS52YWx1ZS5ncmVlbiArXG5cdFx0XHRjb3JlLmNsb25lKHJnYikudmFsdWUuYmx1ZSkgL1xuXHRcdFx0MyA8XG5cdFx0Y29uZmlnLnJnYk1pbkJyaWdodG5lc3Ncblx0KTtcbn1cblxuZnVuY3Rpb24gaXNSR0JUb29HcmF5KHJnYjogdHlwZXMuUkdCKTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhyZ2IpKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBSR0IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShyZ2IpfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIChcblx0XHRNYXRoLmFicyhjb3JlLmNsb25lKHJnYikudmFsdWUucmVkIC0gY29yZS5jbG9uZShyZ2IpLnZhbHVlLmdyZWVuKSA8XG5cdFx0XHRjb25maWcucmdiR3JheVRocmVzaG9sZCAmJlxuXHRcdE1hdGguYWJzKGNvcmUuY2xvbmUocmdiKS52YWx1ZS5ncmVlbiAtIGNvcmUuY2xvbmUocmdiKS52YWx1ZS5ibHVlKSA8XG5cdFx0XHRjb25maWcucmdiR3JheVRocmVzaG9sZCAmJlxuXHRcdE1hdGguYWJzKGNvcmUuY2xvbmUocmdiKS52YWx1ZS5yZWQgLSBjb3JlLmNsb25lKHJnYikudmFsdWUuYmx1ZSkgPFxuXHRcdFx0Y29uZmlnLnJnYkdyYXlUaHJlc2hvbGRcblx0KTtcbn1cblxuZnVuY3Rpb24gZ2V0TGltaXRDaGVja2VyPEsgZXh0ZW5kcyBrZXlvZiBmbk9iamVjdHMuQ29sb3JMaW1pdHM+KFxuXHRsaW1pdDogS1xuKTogZm5PYmplY3RzLkNvbG9yTGltaXRzW0tdIHtcblx0cmV0dXJuIGNvbG9yTGltaXRzW2xpbWl0XTtcbn1cblxuZnVuY3Rpb24gaXNDb2xvckluQm91bmRzKGNvbG9yczogaW50ZXJmYWNlcy5Db252ZXJzaW9uRGF0YSk6IGJvb2xlYW4ge1xuXHR0cnkge1xuXHRcdGNvbnN0IGFyZUFsbENvbG9yc1ZhbGlkID0gT2JqZWN0LmVudHJpZXMoY29sb3JzKS5ldmVyeShcblx0XHRcdChba2V5LCBjb2xvcl0pID0+IHtcblx0XHRcdFx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGNvbG9yKSkge1xuXHRcdFx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdFx0XHRgSW52YWxpZCBjb2xvciAoJHtrZXl9KTogJHtKU09OLnN0cmluZ2lmeShjb2xvcil9YFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXHRcdCk7XG5cblx0XHRpZiAoIWFyZUFsbENvbG9yc1ZhbGlkKSByZXR1cm4gZmFsc2U7XG5cblx0XHRyZXR1cm4gT2JqZWN0LmVudHJpZXMoY29sb3JzKS5zb21lKChba2V5LCBjb2xvcl0pID0+IHtcblx0XHRcdGlmICghY29sb3IpIHJldHVybiBmYWxzZTtcblxuXHRcdFx0Y29uc3QgZm9ybWF0ID0ga2V5LnRvVXBwZXJDYXNlKCk7XG5cblx0XHRcdGNvbnN0IGlzVG9vR3JheSA9IGdldExpbWl0Q2hlY2tlcihcblx0XHRcdFx0YGlzJHtmb3JtYXR9VG9vR3JheWAgYXMga2V5b2YgZm5PYmplY3RzLkNvbG9yTGltaXRzXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3QgaXNUb29EYXJrID0gZ2V0TGltaXRDaGVja2VyKFxuXHRcdFx0XHRgaXMke2Zvcm1hdH1Ub29EYXJrYCBhcyBrZXlvZiBmbk9iamVjdHMuQ29sb3JMaW1pdHNcblx0XHRcdCk7XG5cdFx0XHRjb25zdCBpc1Rvb0JyaWdodCA9IGdldExpbWl0Q2hlY2tlcihcblx0XHRcdFx0YGlzJHtmb3JtYXR9VG9vQnJpZ2h0YCBhcyBrZXlvZiBmbk9iamVjdHMuQ29sb3JMaW1pdHNcblx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBpc1Rvb0dyYXkoY29sb3IpIHx8IGlzVG9vRGFyayhjb2xvcikgfHwgaXNUb29CcmlnaHQoY29sb3IpO1xuXHRcdH0pO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIHZhbGlkYXRpbmcgY29sb3IgYm91bmRzOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCBjb2xvckxpbWl0czogZm5PYmplY3RzLkNvbG9yTGltaXRzID0ge1xuXHRnZXRMaW1pdENoZWNrZXIsXG5cdGlzQ01ZS1Rvb0JyaWdodCxcblx0aXNDTVlLVG9vRGFyayxcblx0aXNDTVlLVG9vR3JheSxcblx0aXNDb2xvckluQm91bmRzLFxuXHRpc0hleFRvb0JyaWdodCxcblx0aXNIZXhUb29EYXJrLFxuXHRpc0hleFRvb0dyYXksXG5cdGlzSFNMVG9vQnJpZ2h0LFxuXHRpc0hTTFRvb0RhcmssXG5cdGlzSFNMVG9vR3JheSxcblx0aXNIU1ZUb29CcmlnaHQsXG5cdGlzSFNWVG9vRGFyayxcblx0aXNIU1ZUb29HcmF5LFxuXHRpc0xBQlRvb0JyaWdodCxcblx0aXNMQUJUb29EYXJrLFxuXHRpc0xBQlRvb0dyYXksXG5cdGlzUkdCVG9vQnJpZ2h0LFxuXHRpc1JHQlRvb0RhcmssXG5cdGlzUkdCVG9vR3JheVxufTtcbiJdfQ==