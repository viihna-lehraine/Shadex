import { convert } from '../../color-spaces/color-space-index.js';
import { config } from '../../config/constants.js';
import { paletteHelpers } from '../../helpers/palette.js';
import { core } from '../../utils/core.js';
function isCMYKTooBright(cmyk) {
    if (!paletteHelpers.validateColorValues(cmyk)) {
        console.error(`Invalid CMYK value ${JSON.stringify(cmyk)}`);
        return false;
    }
    return (core.clone(cmyk).value.cyan < config.cmykBrightnessThreshold &&
        core.clone(cmyk).value.magenta < config.cmykBrightnessThreshold &&
        core.clone(cmyk).value.yellow < config.cmykBrightnessThreshold);
}
export function isCMYKTooDark(cmyk) {
    if (!paletteHelpers.validateColorValues(cmyk)) {
        console.error(`Invalid CMYK value ${JSON.stringify(cmyk)}`);
        return false;
    }
    return core.clone(cmyk).value.key > config.cmykDarknessThreshold;
}
function isCMYKTooGray(cmyk) {
    if (!paletteHelpers.validateColorValues(cmyk)) {
        console.error(`Invalid CMYK value ${JSON.stringify(cmyk)}`);
        return false;
    }
    return (Math.abs(core.clone(cmyk).value.cyan - core.clone(cmyk).value.magenta) <
        config.cmykGrayThreshold &&
        Math.abs(core.clone(cmyk).value.magenta - core.clone(cmyk).value.yellow) < config.cmykGrayThreshold);
}
function isHexTooBright(hex) {
    if (!paletteHelpers.validateColorValues(hex)) {
        console.error(`Invalid Hex value ${JSON.stringify(hex)}`);
        return false;
    }
    return isRGBTooBright(convert.hexToRGB(core.clone(hex)));
}
function isHexTooDark(hex) {
    if (!paletteHelpers.validateColorValues(hex)) {
        console.error(`Invalid Hex value ${JSON.stringify(hex)}`);
        return false;
    }
    return isRGBTooBright(convert.hexToRGB(core.clone(hex)));
}
function isHexTooGray(hex) {
    if (!paletteHelpers.validateColorValues(hex)) {
        console.error(`Invalid Hex value ${JSON.stringify(hex)}`);
        return false;
    }
    return isRGBTooGray(convert.hexToRGB(core.clone(hex)));
}
function isHSLTooBright(hsl) {
    if (!paletteHelpers.validateColorValues(hsl)) {
        console.error(`Invalid HSL value ${JSON.stringify(hsl)}`);
        return false;
    }
    return core.clone(hsl).value.lightness > config.hslBrightnessThreshold;
}
function isHSLTooDark(hsl) {
    if (!paletteHelpers.validateColorValues(hsl)) {
        console.error(`Invalid HSL value ${JSON.stringify(hsl)}`);
        return false;
    }
    return core.clone(hsl).value.lightness < config.hslDarknessThreshold;
}
function isHSLTooGray(hsl) {
    if (!paletteHelpers.validateColorValues(hsl)) {
        console.error(`Invalid HSL value ${JSON.stringify(hsl)}`);
        return false;
    }
    return core.clone(hsl).value.saturation < config.hslGrayThreshold;
}
function isHSVTooBright(hsv) {
    if (!paletteHelpers.validateColorValues(hsv)) {
        console.error(`Invalid HSV value ${JSON.stringify(hsv)}`);
        return false;
    }
    return (core.clone(hsv).value.value > config.hsvBrightnessValueThreshold &&
        core.clone(hsv).value.saturation <
            config.hsvBrightnessSaturationThreshold);
}
function isHSVTooDark(hsv) {
    if (!paletteHelpers.validateColorValues(hsv)) {
        console.error(`Invalid HSV value ${JSON.stringify(hsv)}`);
        return false;
    }
    return core.clone(hsv).value.value < config.hsvDarknessThreshold;
}
function isHSVTooGray(hsv) {
    if (!paletteHelpers.validateColorValues(hsv)) {
        console.error(`Invalid HSV value ${JSON.stringify(hsv)}`);
        return false;
    }
    return core.clone(hsv).value.saturation < config.hsvGrayThreshold;
}
function isLABTooBright(lab) {
    if (!paletteHelpers.validateColorValues(lab)) {
        console.error(`Invalid LAB value ${JSON.stringify(lab)}`);
        return false;
    }
    return core.clone(lab).value.l > config.labBrightnessThreshold;
}
function isLABTooDark(lab) {
    if (!paletteHelpers.validateColorValues(lab)) {
        console.error(`Invalid LAB value ${JSON.stringify(lab)}`);
        return false;
    }
    return core.clone(lab).value.l < config.labDarknessThreshold;
}
function isLABTooGray(lab) {
    if (!paletteHelpers.validateColorValues(lab)) {
        console.error(`Invalid LAB value ${JSON.stringify(lab)}`);
        return false;
    }
    return (Math.abs(core.clone(lab).value.a) < config.labGrayThreshold &&
        Math.abs(core.clone(lab).value.b) < config.labGrayThreshold);
}
function isRGBTooBright(rgb) {
    if (!paletteHelpers.validateColorValues(rgb)) {
        console.error(`Invalid RGB value ${JSON.stringify(rgb)}`);
        return false;
    }
    return ((core.clone(rgb).value.red +
        core.clone(rgb).value.green +
        core.clone(rgb).value.blue) /
        3 >
        config.rgbMaxBrightness);
}
function isRGBTooDark(rgb) {
    if (!paletteHelpers.validateColorValues(rgb)) {
        console.error(`Invalid RGB value ${JSON.stringify(rgb)}`);
        return false;
    }
    return ((core.clone(rgb).value.red +
        core.clone(rgb).value.green +
        core.clone(rgb).value.blue) /
        3 <
        config.rgbMinBrightness);
}
function isRGBTooGray(rgb) {
    if (!paletteHelpers.validateColorValues(rgb)) {
        console.error(`Invalid RGB value ${JSON.stringify(rgb)}`);
        return false;
    }
    return (Math.abs(core.clone(rgb).value.red - core.clone(rgb).value.green) <
        config.rgbGrayThreshold &&
        Math.abs(core.clone(rgb).value.green - core.clone(rgb).value.blue) <
            config.rgbGrayThreshold &&
        Math.abs(core.clone(rgb).value.red - core.clone(rgb).value.blue) <
            config.rgbGrayThreshold);
}
function getLimitChecker(limit) {
    return colorLimits[limit];
}
function isColorInBounds(colors) {
    try {
        const areAllColorsValid = Object.entries(colors).every(([key, color]) => {
            if (!paletteHelpers.validateColorValues(color)) {
                console.error(`Invalid color (${key}): ${JSON.stringify(color)}`);
                return false;
            }
            return true;
        });
        if (!areAllColorsValid)
            return false;
        return Object.entries(colors).some(([key, color]) => {
            if (!color)
                return false;
            const format = key.toUpperCase();
            const isTooGray = getLimitChecker(`is${format}TooGray`);
            const isTooDark = getLimitChecker(`is${format}TooDark`);
            const isTooBright = getLimitChecker(`is${format}TooBright`);
            return isTooGray(color) || isTooDark(color) || isTooBright(color);
        });
    }
    catch (error) {
        console.error(`Error validating color bounds: ${error}`);
        return false;
    }
}
export const colorLimits = {
    getLimitChecker,
    isCMYKTooBright,
    isCMYKTooDark,
    isCMYKTooGray,
    isColorInBounds,
    isHexTooBright,
    isHexTooDark,
    isHexTooGray,
    isHSLTooBright,
    isHSLTooDark,
    isHSLTooGray,
    isHSVTooBright,
    isHSVTooDark,
    isHSVTooGray,
    isLABTooBright,
    isLABTooDark,
    isLABTooGray,
    isRGBTooBright,
    isRGBTooDark,
    isRGBTooGray
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGltaXRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2RvbS91c2VyLXBhcmFtcy9saW1pdHMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNoRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sdUJBQXVCLENBQUM7QUFHdkQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRXhDLFNBQVMsZUFBZSxDQUFDLElBQWlCO0lBQ3pDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMvQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1RCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLENBQ04sSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLE1BQU0sQ0FBQyx1QkFBdUI7UUFDNUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLE1BQU0sQ0FBQyx1QkFBdUI7UUFDL0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyx1QkFBdUIsQ0FDOUQsQ0FBQztBQUNILENBQUM7QUFFRCxNQUFNLFVBQVUsYUFBYSxDQUFDLElBQWlCO0lBQzlDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMvQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1RCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMscUJBQXFCLENBQUM7QUFDbEUsQ0FBQztBQUVELFNBQVMsYUFBYSxDQUFDLElBQWlCO0lBQ3ZDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUMvQyxPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUU1RCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLENBQ04sSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQ3JFLE1BQU0sQ0FBQyxpQkFBaUI7UUFDekIsSUFBSSxDQUFDLEdBQUcsQ0FDUCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUM5RCxHQUFHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FDNUIsQ0FBQztBQUNILENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxHQUFlO0lBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFELENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxHQUFlO0lBQ3BDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLGNBQWMsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFELENBQUM7QUFFRCxTQUFTLFlBQVksQ0FBQyxHQUFlO0lBQ3BDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLFlBQVksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3hELENBQUM7QUFFRCxTQUFTLGNBQWMsQ0FBQyxHQUFlO0lBQ3RDLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLHFCQUFxQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUUxRCxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxD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Q1osWUFBWTtJQUNaLGNBQWM7SUFDZCxZQUFZO0lBQ1osWUFBWTtJQUNaLGNBQWM7SUFDZCxZQUFZO0lBQ1osWUFBWTtDQUNaLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjb252ZXJ0IH0gZnJvbSAnLi4vLi4vY29sb3Itc3BhY2VzL2NvbG9yLXNwYWNlLWluZGV4JztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZy9jb25zdGFudHMnO1xuaW1wb3J0IHsgcGFsZXR0ZUhlbHBlcnMgfSBmcm9tICcuLi8uLi9oZWxwZXJzL3BhbGV0dGUnO1xuaW1wb3J0ICogYXMgZm5PYmplY3RzIGZyb20gJy4uLy4uL2luZGV4L2ZuLW9iamVjdHMnO1xuaW1wb3J0ICogYXMgY29sb3JzIGZyb20gJy4uLy4uL2luZGV4L2NvbG9ycyc7XG5pbXBvcnQgeyBjb3JlIH0gZnJvbSAnLi4vLi4vdXRpbHMvY29yZSc7XG5cbmZ1bmN0aW9uIGlzQ01ZS1Rvb0JyaWdodChjbXlrOiBjb2xvcnMuQ01ZSyk6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoY215aykpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIENNWUsgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShjbXlrKX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiAoXG5cdFx0Y29yZS5jbG9uZShjbXlrKS52YWx1ZS5jeWFuIDwgY29uZmlnLmNteWtCcmlnaHRuZXNzVGhyZXNob2xkICYmXG5cdFx0Y29yZS5jbG9uZShjbXlrKS52YWx1ZS5tYWdlbnRhIDwgY29uZmlnLmNteWtCcmlnaHRuZXNzVGhyZXNob2xkICYmXG5cdFx0Y29yZS5jbG9uZShjbXlrKS52YWx1ZS55ZWxsb3cgPCBjb25maWcuY215a0JyaWdodG5lc3NUaHJlc2hvbGRcblx0KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQ01ZS1Rvb0RhcmsoY215azogY29sb3JzLkNNWUspOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGNteWspKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBDTVlLIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoY215ayl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShjbXlrKS52YWx1ZS5rZXkgPiBjb25maWcuY215a0RhcmtuZXNzVGhyZXNob2xkO1xufVxuXG5mdW5jdGlvbiBpc0NNWUtUb29HcmF5KGNteWs6IGNvbG9ycy5DTVlLKTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhjbXlrKSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgQ01ZSyB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGNteWspfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIChcblx0XHRNYXRoLmFicyhjb3JlLmNsb25lKGNteWspLnZhbHVlLmN5YW4gLSBjb3JlLmNsb25lKGNteWspLnZhbHVlLm1hZ2VudGEpIDxcblx0XHRcdGNvbmZpZy5jbXlrR3JheVRocmVzaG9sZCAmJlxuXHRcdE1hdGguYWJzKFxuXHRcdFx0Y29yZS5jbG9uZShjbXlrKS52YWx1ZS5tYWdlbnRhIC0gY29yZS5jbG9uZShjbXlrKS52YWx1ZS55ZWxsb3dcblx0XHQpIDwgY29uZmlnLmNteWtHcmF5VGhyZXNob2xkXG5cdCk7XG59XG5cbmZ1bmN0aW9uIGlzSGV4VG9vQnJpZ2h0KGhleDogY29sb3JzLkhleCk6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaGV4KSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgSGV4IHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaGV4KX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBpc1JHQlRvb0JyaWdodChjb252ZXJ0LmhleFRvUkdCKGNvcmUuY2xvbmUoaGV4KSkpO1xufVxuXG5mdW5jdGlvbiBpc0hleFRvb0RhcmsoaGV4OiBjb2xvcnMuSGV4KTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhoZXgpKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBIZXggdmFsdWUgJHtKU09OLnN0cmluZ2lmeShoZXgpfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIGlzUkdCVG9vQnJpZ2h0KGNvbnZlcnQuaGV4VG9SR0IoY29yZS5jbG9uZShoZXgpKSk7XG59XG5cbmZ1bmN0aW9uIGlzSGV4VG9vR3JheShoZXg6IGNvbG9ycy5IZXgpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhleCkpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIEhleCB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhleCl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gaXNSR0JUb29HcmF5KGNvbnZlcnQuaGV4VG9SR0IoY29yZS5jbG9uZShoZXgpKSk7XG59XG5cbmZ1bmN0aW9uIGlzSFNMVG9vQnJpZ2h0KGhzbDogY29sb3JzLkhTTCk6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHNsKSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgSFNMIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaHNsKX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBjb3JlLmNsb25lKGhzbCkudmFsdWUubGlnaHRuZXNzID4gY29uZmlnLmhzbEJyaWdodG5lc3NUaHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIGlzSFNMVG9vRGFyayhoc2w6IGNvbG9ycy5IU0wpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhzbCkpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIEhTTCB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzbCl9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShoc2wpLnZhbHVlLmxpZ2h0bmVzcyA8IGNvbmZpZy5oc2xEYXJrbmVzc1RocmVzaG9sZDtcbn1cblxuZnVuY3Rpb24gaXNIU0xUb29HcmF5KGhzbDogY29sb3JzLkhTTCk6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHNsKSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgSFNMIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaHNsKX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBjb3JlLmNsb25lKGhzbCkudmFsdWUuc2F0dXJhdGlvbiA8IGNvbmZpZy5oc2xHcmF5VGhyZXNob2xkO1xufVxuXG5mdW5jdGlvbiBpc0hTVlRvb0JyaWdodChoc3Y6IGNvbG9ycy5IU1YpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhzdikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIEhTViB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzdil9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdGNvcmUuY2xvbmUoaHN2KS52YWx1ZS52YWx1ZSA+IGNvbmZpZy5oc3ZCcmlnaHRuZXNzVmFsdWVUaHJlc2hvbGQgJiZcblx0XHRjb3JlLmNsb25lKGhzdikudmFsdWUuc2F0dXJhdGlvbiA8XG5cdFx0XHRjb25maWcuaHN2QnJpZ2h0bmVzc1NhdHVyYXRpb25UaHJlc2hvbGRcblx0KTtcbn1cblxuZnVuY3Rpb24gaXNIU1ZUb29EYXJrKGhzdjogY29sb3JzLkhTVik6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHN2KSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgSFNWIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaHN2KX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiBjb3JlLmNsb25lKGhzdikudmFsdWUudmFsdWUgPCBjb25maWcuaHN2RGFya25lc3NUaHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIGlzSFNWVG9vR3JheShoc3Y6IGNvbG9ycy5IU1YpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhzdikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIEhTViB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzdil9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShoc3YpLnZhbHVlLnNhdHVyYXRpb24gPCBjb25maWcuaHN2R3JheVRocmVzaG9sZDtcbn1cblxuZnVuY3Rpb24gaXNMQUJUb29CcmlnaHQobGFiOiBjb2xvcnMuTEFCKTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhsYWIpKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBMQUIgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShsYWIpfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIGNvcmUuY2xvbmUobGFiKS52YWx1ZS5sID4gY29uZmlnLmxhYkJyaWdodG5lc3NUaHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIGlzTEFCVG9vRGFyayhsYWI6IGNvbG9ycy5MQUIpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGxhYikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIExBQiB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGxhYil9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gY29yZS5jbG9uZShsYWIpLnZhbHVlLmwgPCBjb25maWcubGFiRGFya25lc3NUaHJlc2hvbGQ7XG59XG5cbmZ1bmN0aW9uIGlzTEFCVG9vR3JheShsYWI6IGNvbG9ycy5MQUIpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGxhYikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIExBQiB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGxhYil9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdE1hdGguYWJzKGNvcmUuY2xvbmUobGFiKS52YWx1ZS5hKSA8IGNvbmZpZy5sYWJHcmF5VGhyZXNob2xkICYmXG5cdFx0TWF0aC5hYnMoY29yZS5jbG9uZShsYWIpLnZhbHVlLmIpIDwgY29uZmlnLmxhYkdyYXlUaHJlc2hvbGRcblx0KTtcbn1cblxuZnVuY3Rpb24gaXNSR0JUb29CcmlnaHQocmdiOiBjb2xvcnMuUkdCKTogYm9vbGVhbiB7XG5cdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhyZ2IpKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgSW52YWxpZCBSR0IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShyZ2IpfWApO1xuXG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9XG5cblx0cmV0dXJuIChcblx0XHQoY29yZS5jbG9uZShyZ2IpLnZhbHVlLnJlZCArXG5cdFx0XHRjb3JlLmNsb25lKHJnYikudmFsdWUuZ3JlZW4gK1xuXHRcdFx0Y29yZS5jbG9uZShyZ2IpLnZhbHVlLmJsdWUpIC9cblx0XHRcdDMgPlxuXHRcdGNvbmZpZy5yZ2JNYXhCcmlnaHRuZXNzXG5cdCk7XG59XG5cbmZ1bmN0aW9uIGlzUkdCVG9vRGFyayhyZ2I6IGNvbG9ycy5SR0IpOiBib29sZWFuIHtcblx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKHJnYikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIFJHQiB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHJnYil9YCk7XG5cblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdChjb3JlLmNsb25lKHJnYikudmFsdWUucmVkICtcblx0XHRcdGNvcmUuY2xvbmUocmdiKS52YWx1ZS5ncmVlbiArXG5cdFx0XHRjb3JlLmNsb25lKHJnYikudmFsdWUuYmx1ZSkgL1xuXHRcdFx0MyA8XG5cdFx0Y29uZmlnLnJnYk1pbkJyaWdodG5lc3Ncblx0KTtcbn1cblxuZnVuY3Rpb24gaXNSR0JUb29HcmF5KHJnYjogY29sb3JzLlJHQik6IGJvb2xlYW4ge1xuXHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMocmdiKSkge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEludmFsaWQgUkdCIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkocmdiKX1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxuXG5cdHJldHVybiAoXG5cdFx0TWF0aC5hYnMoY29yZS5jbG9uZShyZ2IpLnZhbHVlLnJlZCAtIGNvcmUuY2xvbmUocmdiKS52YWx1ZS5ncmVlbikgPFxuXHRcdFx0Y29uZmlnLnJnYkdyYXlUaHJlc2hvbGQgJiZcblx0XHRNYXRoLmFicyhjb3JlLmNsb25lKHJnYikudmFsdWUuZ3JlZW4gLSBjb3JlLmNsb25lKHJnYikudmFsdWUuYmx1ZSkgPFxuXHRcdFx0Y29uZmlnLnJnYkdyYXlUaHJlc2hvbGQgJiZcblx0XHRNYXRoLmFicyhjb3JlLmNsb25lKHJnYikudmFsdWUucmVkIC0gY29yZS5jbG9uZShyZ2IpLnZhbHVlLmJsdWUpIDxcblx0XHRcdGNvbmZpZy5yZ2JHcmF5VGhyZXNob2xkXG5cdCk7XG59XG5cbmZ1bmN0aW9uIGdldExpbWl0Q2hlY2tlcjxLIGV4dGVuZHMga2V5b2YgZm5PYmplY3RzLkNvbG9yTGltaXRzPihcblx0bGltaXQ6IEtcbik6IGZuT2JqZWN0cy5Db2xvckxpbWl0c1tLXSB7XG5cdHJldHVybiBjb2xvckxpbWl0c1tsaW1pdF07XG59XG5cbmZ1bmN0aW9uIGlzQ29sb3JJbkJvdW5kcyhjb2xvcnM6IGNvbG9ycy5Db2xvckRhdGFBc3NlcnRpb24pOiBib29sZWFuIHtcblx0dHJ5IHtcblx0XHRjb25zdCBhcmVBbGxDb2xvcnNWYWxpZCA9IE9iamVjdC5lbnRyaWVzKGNvbG9ycykuZXZlcnkoXG5cdFx0XHQoW2tleSwgY29sb3JdKSA9PiB7XG5cdFx0XHRcdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhjb2xvcikpIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XHRcdFx0YEludmFsaWQgY29sb3IgKCR7a2V5fSk6ICR7SlNPTi5zdHJpbmdpZnkoY29sb3IpfWBcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblx0XHQpO1xuXG5cdFx0aWYgKCFhcmVBbGxDb2xvcnNWYWxpZCkgcmV0dXJuIGZhbHNlO1xuXG5cdFx0cmV0dXJuIE9iamVjdC5lbnRyaWVzKGNvbG9ycykuc29tZSgoW2tleSwgY29sb3JdKSA9PiB7XG5cdFx0XHRpZiAoIWNvbG9yKSByZXR1cm4gZmFsc2U7XG5cblx0XHRcdGNvbnN0IGZvcm1hdCA9IGtleS50b1VwcGVyQ2FzZSgpO1xuXG5cdFx0XHRjb25zdCBpc1Rvb0dyYXkgPSBnZXRMaW1pdENoZWNrZXIoXG5cdFx0XHRcdGBpcyR7Zm9ybWF0fVRvb0dyYXlgIGFzIGtleW9mIGZuT2JqZWN0cy5Db2xvckxpbWl0c1xuXHRcdFx0KTtcblx0XHRcdGNvbnN0IGlzVG9vRGFyayA9IGdldExpbWl0Q2hlY2tlcihcblx0XHRcdFx0YGlzJHtmb3JtYXR9VG9vRGFya2AgYXMga2V5b2YgZm5PYmplY3RzLkNvbG9yTGltaXRzXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3QgaXNUb29CcmlnaHQgPSBnZXRMaW1pdENoZWNrZXIoXG5cdFx0XHRcdGBpcyR7Zm9ybWF0fVRvb0JyaWdodGAgYXMga2V5b2YgZm5PYmplY3RzLkNvbG9yTGltaXRzXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gaXNUb29HcmF5KGNvbG9yKSB8fCBpc1Rvb0RhcmsoY29sb3IpIHx8IGlzVG9vQnJpZ2h0KGNvbG9yKTtcblx0XHR9KTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBFcnJvciB2YWxpZGF0aW5nIGNvbG9yIGJvdW5kczogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5leHBvcnQgY29uc3QgY29sb3JMaW1pdHM6IGZuT2JqZWN0cy5Db2xvckxpbWl0cyA9IHtcblx0Z2V0TGltaXRDaGVja2VyLFxuXHRpc0NNWUtUb29CcmlnaHQsXG5cdGlzQ01ZS1Rvb0RhcmssXG5cdGlzQ01ZS1Rvb0dyYXksXG5cdGlzQ29sb3JJbkJvdW5kcyxcblx0aXNIZXhUb29CcmlnaHQsXG5cdGlzSGV4VG9vRGFyayxcblx0aXNIZXhUb29HcmF5LFxuXHRpc0hTTFRvb0JyaWdodCxcblx0aXNIU0xUb29EYXJrLFxuXHRpc0hTTFRvb0dyYXksXG5cdGlzSFNWVG9vQnJpZ2h0LFxuXHRpc0hTVlRvb0RhcmssXG5cdGlzSFNWVG9vR3JheSxcblx0aXNMQUJUb29CcmlnaHQsXG5cdGlzTEFCVG9vRGFyayxcblx0aXNMQUJUb29HcmF5LFxuXHRpc1JHQlRvb0JyaWdodCxcblx0aXNSR0JUb29EYXJrLFxuXHRpc1JHQlRvb0dyYXlcbn07XG4iXX0=