// File: src/dom/exportPalette.ts
function asCSS(palette, colorSpace = 'hsl') {
    const css = palette.items
        .map(item => {
        const colorValue = (() => {
            switch (colorSpace) {
                case 'cmyk':
                    return item.cssStrings.cmykCSSString;
                case 'hex':
                    return item.cssStrings.hexCSSString;
                case 'hsl':
                    return item.cssStrings.hslCSSString;
                case 'hsv':
                    return item.cssStrings.hsvCSSString;
                case 'lab':
                    return item.cssStrings.labCSSString;
                case 'rgb':
                    return item.cssStrings.rgbCSSString;
                case 'xyz':
                    return item.cssStrings.xyzCSSString;
                default:
                    return item.cssStrings.hslCSSString;
            }
        })();
        return `
            /* Palette Item: ${item.id} */
            .color-${item.id} {
                cmyk-color: ${item.cssStrings.cmykCSSString};
                hex-color: ${item.cssStrings.hexCSSString};
                hsl-color: ${item.cssStrings.hslCSSString};
                hsv-color: ${item.cssStrings.hsvCSSString};
                lab-color: ${item.cssStrings.labCSSString};
                rgb-color: ${item.cssStrings.rgbCSSString};
                xyz-color: ${item.cssStrings.xyzCSSString};
                background-color: ${colorValue}; /* Use selected color space */
            }
        `;
    })
        .join('\n');
    const blob = new Blob([css], { type: 'text/css' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `palette_${palette.id}.css`;
    a.click();
    URL.revokeObjectURL(url);
}
function asJSON(palette) {
    const json = JSON.stringify(palette, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `palette_${palette.id}.json`;
    a.click();
    URL.revokeObjectURL(url);
}
function asPNG(palette, colorSpace = 'hsl', paletteName) {
    const canvas = document.createElement('canvas');
    const context = canvas.getContext('2d');
    const swatchSize = 100;
    const padding = 20;
    const labelHeight = 40;
    const titleHeight = paletteName ? 60 : 0;
    canvas.width = (swatchSize + padding) * palette.items.length + padding;
    canvas.height = swatchSize + labelHeight + titleHeight + 2 * padding;
    if (!context)
        throw new Error('Could not get 2d context');
    context.fillStyle = '#f0f0f0ff';
    context.fillRect(0, 0, canvas.width, canvas.height);
    if (paletteName) {
        context.font = '22px Arial';
        context.fillStyle = '#1e1e1eff';
        context.textAlign = 'center';
        context.fillText(paletteName, canvas.width / 2, padding + titleHeight / 2);
    }
    palette.items.forEach((item, index) => {
        const x = padding + index * (swatchSize + padding);
        const y = padding + titleHeight;
        const fillColor = (() => {
            switch (colorSpace) {
                case 'cmyk':
                    return item.cssStrings.cmykCSSString;
                case 'hex':
                    return item.cssStrings.hexCSSString;
                case 'hsl':
                    return item.cssStrings.hslCSSString;
                case 'hsv':
                    return item.cssStrings.hsvCSSString;
                case 'lab':
                    return item.cssStrings.labCSSString;
                case 'rgb':
                    return item.cssStrings.rgbCSSString;
                default:
                    return item.cssStrings.hslCSSString;
            }
        })();
        const colorLabel = fillColor;
        context.fillStyle = fillColor;
        context.fillRect(x, y, swatchSize, swatchSize);
        context.font = '12px Arial';
        context.fillStyle = '#0a0a0aff';
        context.textAlign = 'center';
        context.fillText(colorLabel, x + swatchSize / 2, y + swatchSize + labelHeight - 5);
    });
    canvas.toBlob(blob => {
        if (blob) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `palette_${palette.id}.png`;
            a.click();
            URL.revokeObjectURL(url);
        }
        else {
            console.error('Failed to create PNG blob.');
        }
    }, 'image/png');
}
function asXML(palette) {
    const xmlItems = palette.items
        .map(item => `
		<PaletteItem "${item.id}>
			<Colors>
				<CMYK>${item.colors.cmyk}</CMYK>
				<Hex>${item.colors.hex}</Hex>
				<HSL>${item.colors.hsl}</HSL>
				<HSV>${item.colors.hsv}</HSV>
				<LAB>${item.colors.lab}</LAB>
				<RGB>${item.colors.rgb}</RGB>
			</Colors>
		</PaletteItem>
	`)
        .join('');
    const xml = `
		<Palette ${palette.id}>
			<Flags>
				<EnableAlpha>${palette.flags.enableAlpha}</EnableAlpha>
				<LimitDarkness>${palette.flags.limitDarkness}</LimitDarkness>
				<LimitGrayness>${palette.flags.limitGrayness}</LimitGrayness>
				<LimitLightness>${palette.flags.limitLightness}</LimitLightness>
			</Flags>
			<Metadata>
				<CustomColor>
					<HSLColor>${palette.metadata.customColor ? palette.metadata.customColor.hslColor : null}</HSLColor>
					<ConvertedColors>${palette.metadata.customColor ? palette.metadata.customColor.convertedColors : null}</ConvertedColors>
				</CustomColor>
				<NumBoxes>${palette.metadata.numBoxes}</NumBoxes>
				<PaletteType>${palette.metadata.paletteType}</PaletteType>
			</Metadata>
			${xmlItems}
		</Palette>
	`;
    const blob = new Blob([xml], { type: 'application/xml' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `palette_${palette.id}.xml`;
    a.click();
    URL.revokeObjectURL(url);
}
export const exportPalette = {
    asCSS,
    asJSON,
    asPNG,
    asXML
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0UGFsZXR0ZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kb20vZXhwb3J0UGFsZXR0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxpQ0FBaUM7QUFRakMsU0FBUyxLQUFLLENBQUMsT0FBZ0IsRUFBRSxhQUF5QixLQUFLO0lBQzlELE1BQU0sR0FBRyxHQUFHLE9BQU8sQ0FBQyxLQUFLO1NBQ3ZCLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtRQUNYLE1BQU0sVUFBVSxHQUFHLENBQUMsR0FBRyxFQUFFO1lBQ3hCLFFBQVEsVUFBVSxFQUFFLENBQUM7Z0JBQ3BCLEtBQUssTUFBTTtvQkFDVixPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO2dCQUN0QyxLQUFLLEtBQUs7b0JBQ1QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQztnQkFDckMsS0FBSyxLQUFLO29CQUNULE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUM7Z0JBQ3JDLEtBQUssS0FBSztvQkFDVCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDO2dCQUNyQyxLQUFLLEtBQUs7b0JBQ1QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQztnQkFDckMsS0FBSyxLQUFLO29CQUNULE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUM7Z0JBQ3JDLEtBQUssS0FBSztvQkFDVCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDO2dCQUNyQztvQkFDQyxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDO1lBQ3RDLENBQUM7UUFDRixDQUFDLENBQUMsRUFBRSxDQUFDO1FBRUwsT0FBTzsrQkFDcUIsSUFBSSxDQUFDLEVBQUU7cUJBQ2pCLElBQUksQ0FBQyxFQUFFOzhCQUNFLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYTs2QkFDOUIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZOzZCQUM1QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVk7NkJBQzVCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWTs2QkFDNUIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZOzZCQUM1QixJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVk7NkJBQzVCLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWTtvQ0FDckIsVUFBVTs7U0FFckMsQ0FBQztJQUNSLENBQUMsQ0FBQztTQUNELElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUViLE1BQU0sSUFBSSxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLENBQUMsQ0FBQztJQUNuRCxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7SUFDYixDQUFDLENBQUMsUUFBUSxHQUFHLFdBQVcsT0FBTyxDQUFDLEVBQUUsTUFBTSxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUVWLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQUVELFNBQVMsTUFBTSxDQUFDLE9BQWdCO0lBQy9CLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUM5QyxNQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztJQUM1RCxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7SUFDYixDQUFDLENBQUMsUUFBUSxHQUFHLFdBQVcsT0FBTyxDQUFDLEVBQUUsT0FBTyxDQUFDO0lBQzFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUVWLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQUVELFNBQVMsS0FBSyxDQUNiLE9BQWdCLEVBQ2hCLGFBQXlCLEtBQUssRUFDOUIsV0FBb0I7SUFFcEIsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNoRCxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXhDLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQztJQUN2QixNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUM7SUFDbkIsTUFBTSxXQUFXLEdBQUcsRUFBRSxDQUFDO0lBQ3ZCLE1BQU0sV0FBVyxHQUFHLFdBQVcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFekMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxPQUFPLENBQUM7SUFDdkUsTUFBTSxDQUFDLE1BQU0sR0FBRyxVQUFVLEdBQUcsV0FBVyxHQUFHLFdBQVcsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDO0lBRXJFLElBQUksQ0FBQyxPQUFPO1FBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBRTFELE9BQU8sQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDO0lBQ2hDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUVwRCxJQUFJLFdBQVcsRUFBRSxDQUFDO1FBQ2pCLE9BQU8sQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDO1FBQzVCLE9BQU8sQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDO1FBQ2hDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxRQUFRLENBQ2YsV0FBVyxFQUNYLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUNoQixPQUFPLEdBQUcsV0FBVyxHQUFHLENBQUMsQ0FDekIsQ0FBQztJQUNILENBQUM7SUFFRCxPQUFPLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRTtRQUNyQyxNQUFNLENBQUMsR0FBRyxPQUFPLEdBQUcsS0FBSyxHQUFHLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxDQUFDO1FBQ25ELE1BQU0sQ0FBQyxHQUFHLE9BQU8sR0FBRyxXQUFXLENBQUM7UUFFaEMsTUFBTSxTQUFTLEdBQUcsQ0FBQyxHQUFHLEVBQUU7WUFDdkIsUUFBUSxVQUFVLEVBQUUsQ0FBQztnQkFDcEIsS0FBSyxNQUFNO29CQUNWLE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUM7Z0JBQ3RDLEtBQUssS0FBSztvQkFDVCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDO2dCQUNyQyxLQUFLLEtBQUs7b0JBQ1QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQztnQkFDckMsS0FBSyxLQUFLO29CQUNULE9BQU8sSUFBSSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUM7Z0JBQ3JDLEtBQUssS0FBSztvQkFDVCxPQUFPLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDO2dCQUNyQyxLQUFLLEtBQUs7b0JBQ1QsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQztnQkFDckM7b0JBQ0MsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQztZQUN0QyxDQUFDO1FBQ0YsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUVMLE1BQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQztRQUU3QixPQUFPLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztRQUM5QixPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRS9DLE9BQU8sQ0FBQyxJQUFJLEdBQUcsWUFBWSxDQUFDO1FBQzVCLE9BQU8sQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDO1FBQ2hDLE9BQU8sQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxRQUFRLENBQ2YsVUFBVSxFQUNWLENBQUMsR0FBRyxVQUFVLEdBQUcsQ0FBQyxFQUNsQixDQUFDLEdBQUcsVUFBVSxHQUFHLFdBQVcsR0FBRyxDQUFDLENBQ2hDLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDcEIsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUNWLE1BQU0sR0FBRyxHQUFHLEdBQUcsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdEMsTUFBTSxDQUFDLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUV0QyxDQUFDLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQztZQUNiLENBQUMsQ0FBQyxRQUFRLEdBQUcsV0FBVyxPQUFPLENBQUMsRUFBRSxNQUFNLENBQUM7WUFDekMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRVYsR0FBRyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxQixDQUFDO2FBQU0sQ0FBQztZQUNQLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLENBQUMsQ0FBQztRQUM3QyxDQUFDO0lBQ0YsQ0FBQyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0FBQ2pCLENBQUM7QUFFRCxTQUFTLEtBQUssQ0FBQyxPQUFnQjtJQUM5QixNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsS0FBSztTQUM1QixHQUFHLENBQ0gsSUFBSSxDQUFDLEVBQUUsQ0FBQztrQkFDTyxJQUFJLENBQUMsRUFBRTs7WUFFYixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUk7V0FDakIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHO1dBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHO1dBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHO1dBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHO1dBQ2YsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHOzs7RUFHeEIsQ0FDQztTQUNBLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNYLE1BQU0sR0FBRyxHQUFHO2FBQ0EsT0FBTyxDQUFDLEVBQUU7O21CQUVKLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVztxQkFDdkIsT0FBTyxDQUFDLEtBQUssQ0FBQyxhQUFhO3FCQUMzQixPQUFPLENBQUMsS0FBSyxDQUFDLGFBQWE7c0JBQzFCLE9BQU8sQ0FBQyxLQUFLLENBQUMsY0FBYzs7OztpQkFJakMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSTt3QkFDcEUsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsSUFBSTs7Z0JBRTFGLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUTttQkFDdEIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxXQUFXOztLQUUxQyxRQUFROztFQUVYLENBQUM7SUFFRixNQUFNLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLENBQUMsQ0FBQztJQUMxRCxNQUFNLEdBQUcsR0FBRyxHQUFHLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3RDLE1BQU0sQ0FBQyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7SUFFdEMsQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7SUFDYixDQUFDLENBQUMsUUFBUSxHQUFHLFdBQVcsT0FBTyxDQUFDLEVBQUUsTUFBTSxDQUFDO0lBQ3pDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUVWLEdBQUcsQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQUVELE1BQU0sQ0FBQyxNQUFNLGFBQWEsR0FBZ0M7SUFDekQsS0FBSztJQUNMLE1BQU07SUFDTixLQUFLO0lBQ0wsS0FBSztDQUNMLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBzcmMvZG9tL2V4cG9ydFBhbGV0dGUudHNcblxuaW1wb3J0IHtcblx0Q29sb3JTcGFjZSxcblx0RE9NRXhwb3J0UGFsZXR0ZUZuSW50ZXJmYWNlLFxuXHRQYWxldHRlXG59IGZyb20gJy4uL2luZGV4L2luZGV4LmpzJztcblxuZnVuY3Rpb24gYXNDU1MocGFsZXR0ZTogUGFsZXR0ZSwgY29sb3JTcGFjZTogQ29sb3JTcGFjZSA9ICdoc2wnKTogdm9pZCB7XG5cdGNvbnN0IGNzcyA9IHBhbGV0dGUuaXRlbXNcblx0XHQubWFwKGl0ZW0gPT4ge1xuXHRcdFx0Y29uc3QgY29sb3JWYWx1ZSA9ICgoKSA9PiB7XG5cdFx0XHRcdHN3aXRjaCAoY29sb3JTcGFjZSkge1xuXHRcdFx0XHRcdGNhc2UgJ2NteWsnOlxuXHRcdFx0XHRcdFx0cmV0dXJuIGl0ZW0uY3NzU3RyaW5ncy5jbXlrQ1NTU3RyaW5nO1xuXHRcdFx0XHRcdGNhc2UgJ2hleCc6XG5cdFx0XHRcdFx0XHRyZXR1cm4gaXRlbS5jc3NTdHJpbmdzLmhleENTU1N0cmluZztcblx0XHRcdFx0XHRjYXNlICdoc2wnOlxuXHRcdFx0XHRcdFx0cmV0dXJuIGl0ZW0uY3NzU3RyaW5ncy5oc2xDU1NTdHJpbmc7XG5cdFx0XHRcdFx0Y2FzZSAnaHN2Jzpcblx0XHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MuaHN2Q1NTU3RyaW5nO1xuXHRcdFx0XHRcdGNhc2UgJ2xhYic6XG5cdFx0XHRcdFx0XHRyZXR1cm4gaXRlbS5jc3NTdHJpbmdzLmxhYkNTU1N0cmluZztcblx0XHRcdFx0XHRjYXNlICdyZ2InOlxuXHRcdFx0XHRcdFx0cmV0dXJuIGl0ZW0uY3NzU3RyaW5ncy5yZ2JDU1NTdHJpbmc7XG5cdFx0XHRcdFx0Y2FzZSAneHl6Jzpcblx0XHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MueHl6Q1NTU3RyaW5nO1xuXHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRyZXR1cm4gaXRlbS5jc3NTdHJpbmdzLmhzbENTU1N0cmluZztcblx0XHRcdFx0fVxuXHRcdFx0fSkoKTtcblxuXHRcdFx0cmV0dXJuIGBcbiAgICAgICAgICAgIC8qIFBhbGV0dGUgSXRlbTogJHtpdGVtLmlkfSAqL1xuICAgICAgICAgICAgLmNvbG9yLSR7aXRlbS5pZH0ge1xuICAgICAgICAgICAgICAgIGNteWstY29sb3I6ICR7aXRlbS5jc3NTdHJpbmdzLmNteWtDU1NTdHJpbmd9O1xuICAgICAgICAgICAgICAgIGhleC1jb2xvcjogJHtpdGVtLmNzc1N0cmluZ3MuaGV4Q1NTU3RyaW5nfTtcbiAgICAgICAgICAgICAgICBoc2wtY29sb3I6ICR7aXRlbS5jc3NTdHJpbmdzLmhzbENTU1N0cmluZ307XG4gICAgICAgICAgICAgICAgaHN2LWNvbG9yOiAke2l0ZW0uY3NzU3RyaW5ncy5oc3ZDU1NTdHJpbmd9O1xuICAgICAgICAgICAgICAgIGxhYi1jb2xvcjogJHtpdGVtLmNzc1N0cmluZ3MubGFiQ1NTU3RyaW5nfTtcbiAgICAgICAgICAgICAgICByZ2ItY29sb3I6ICR7aXRlbS5jc3NTdHJpbmdzLnJnYkNTU1N0cmluZ307XG4gICAgICAgICAgICAgICAgeHl6LWNvbG9yOiAke2l0ZW0uY3NzU3RyaW5ncy54eXpDU1NTdHJpbmd9O1xuICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICR7Y29sb3JWYWx1ZX07IC8qIFVzZSBzZWxlY3RlZCBjb2xvciBzcGFjZSAqL1xuICAgICAgICAgICAgfVxuICAgICAgICBgO1xuXHRcdH0pXG5cdFx0LmpvaW4oJ1xcbicpO1xuXG5cdGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY3NzXSwgeyB0eXBlOiAndGV4dC9jc3MnIH0pO1xuXHRjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuXHRjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuXG5cdGEuaHJlZiA9IHVybDtcblx0YS5kb3dubG9hZCA9IGBwYWxldHRlXyR7cGFsZXR0ZS5pZH0uY3NzYDtcblx0YS5jbGljaygpO1xuXG5cdFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTtcbn1cblxuZnVuY3Rpb24gYXNKU09OKHBhbGV0dGU6IFBhbGV0dGUpOiB2b2lkIHtcblx0Y29uc3QganNvbiA9IEpTT04uc3RyaW5naWZ5KHBhbGV0dGUsIG51bGwsIDIpO1xuXHRjb25zdCBibG9iID0gbmV3IEJsb2IoW2pzb25dLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTtcblx0Y29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcblx0Y29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcblxuXHRhLmhyZWYgPSB1cmw7XG5cdGEuZG93bmxvYWQgPSBgcGFsZXR0ZV8ke3BhbGV0dGUuaWR9Lmpzb25gO1xuXHRhLmNsaWNrKCk7XG5cblx0VVJMLnJldm9rZU9iamVjdFVSTCh1cmwpO1xufVxuXG5mdW5jdGlvbiBhc1BORyhcblx0cGFsZXR0ZTogUGFsZXR0ZSxcblx0Y29sb3JTcGFjZTogQ29sb3JTcGFjZSA9ICdoc2wnLFxuXHRwYWxldHRlTmFtZT86IHN0cmluZ1xuKTogdm9pZCB7XG5cdGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuXHRjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cblx0Y29uc3Qgc3dhdGNoU2l6ZSA9IDEwMDtcblx0Y29uc3QgcGFkZGluZyA9IDIwO1xuXHRjb25zdCBsYWJlbEhlaWdodCA9IDQwO1xuXHRjb25zdCB0aXRsZUhlaWdodCA9IHBhbGV0dGVOYW1lID8gNjAgOiAwO1xuXG5cdGNhbnZhcy53aWR0aCA9IChzd2F0Y2hTaXplICsgcGFkZGluZykgKiBwYWxldHRlLml0ZW1zLmxlbmd0aCArIHBhZGRpbmc7XG5cdGNhbnZhcy5oZWlnaHQgPSBzd2F0Y2hTaXplICsgbGFiZWxIZWlnaHQgKyB0aXRsZUhlaWdodCArIDIgKiBwYWRkaW5nO1xuXG5cdGlmICghY29udGV4dCkgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZ2V0IDJkIGNvbnRleHQnKTtcblxuXHRjb250ZXh0LmZpbGxTdHlsZSA9ICcjZjBmMGYwZmYnO1xuXHRjb250ZXh0LmZpbGxSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cblx0aWYgKHBhbGV0dGVOYW1lKSB7XG5cdFx0Y29udGV4dC5mb250ID0gJzIycHggQXJpYWwnO1xuXHRcdGNvbnRleHQuZmlsbFN0eWxlID0gJyMxZTFlMWVmZic7XG5cdFx0Y29udGV4dC50ZXh0QWxpZ24gPSAnY2VudGVyJztcblx0XHRjb250ZXh0LmZpbGxUZXh0KFxuXHRcdFx0cGFsZXR0ZU5hbWUsXG5cdFx0XHRjYW52YXMud2lkdGggLyAyLFxuXHRcdFx0cGFkZGluZyArIHRpdGxlSGVpZ2h0IC8gMlxuXHRcdCk7XG5cdH1cblxuXHRwYWxldHRlLml0ZW1zLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG5cdFx0Y29uc3QgeCA9IHBhZGRpbmcgKyBpbmRleCAqIChzd2F0Y2hTaXplICsgcGFkZGluZyk7XG5cdFx0Y29uc3QgeSA9IHBhZGRpbmcgKyB0aXRsZUhlaWdodDtcblxuXHRcdGNvbnN0IGZpbGxDb2xvciA9ICgoKSA9PiB7XG5cdFx0XHRzd2l0Y2ggKGNvbG9yU3BhY2UpIHtcblx0XHRcdFx0Y2FzZSAnY215ayc6XG5cdFx0XHRcdFx0cmV0dXJuIGl0ZW0uY3NzU3RyaW5ncy5jbXlrQ1NTU3RyaW5nO1xuXHRcdFx0XHRjYXNlICdoZXgnOlxuXHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MuaGV4Q1NTU3RyaW5nO1xuXHRcdFx0XHRjYXNlICdoc2wnOlxuXHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MuaHNsQ1NTU3RyaW5nO1xuXHRcdFx0XHRjYXNlICdoc3YnOlxuXHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MuaHN2Q1NTU3RyaW5nO1xuXHRcdFx0XHRjYXNlICdsYWInOlxuXHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MubGFiQ1NTU3RyaW5nO1xuXHRcdFx0XHRjYXNlICdyZ2InOlxuXHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MucmdiQ1NTU3RyaW5nO1xuXHRcdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRcdHJldHVybiBpdGVtLmNzc1N0cmluZ3MuaHNsQ1NTU3RyaW5nO1xuXHRcdFx0fVxuXHRcdH0pKCk7XG5cblx0XHRjb25zdCBjb2xvckxhYmVsID0gZmlsbENvbG9yO1xuXG5cdFx0Y29udGV4dC5maWxsU3R5bGUgPSBmaWxsQ29sb3I7XG5cdFx0Y29udGV4dC5maWxsUmVjdCh4LCB5LCBzd2F0Y2hTaXplLCBzd2F0Y2hTaXplKTtcblxuXHRcdGNvbnRleHQuZm9udCA9ICcxMnB4IEFyaWFsJztcblx0XHRjb250ZXh0LmZpbGxTdHlsZSA9ICcjMGEwYTBhZmYnO1xuXHRcdGNvbnRleHQudGV4dEFsaWduID0gJ2NlbnRlcic7XG5cdFx0Y29udGV4dC5maWxsVGV4dChcblx0XHRcdGNvbG9yTGFiZWwsXG5cdFx0XHR4ICsgc3dhdGNoU2l6ZSAvIDIsXG5cdFx0XHR5ICsgc3dhdGNoU2l6ZSArIGxhYmVsSGVpZ2h0IC0gNVxuXHRcdCk7XG5cdH0pO1xuXG5cdGNhbnZhcy50b0Jsb2IoYmxvYiA9PiB7XG5cdFx0aWYgKGJsb2IpIHtcblx0XHRcdGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG5cdFx0XHRjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuXG5cdFx0XHRhLmhyZWYgPSB1cmw7XG5cdFx0XHRhLmRvd25sb2FkID0gYHBhbGV0dGVfJHtwYWxldHRlLmlkfS5wbmdgO1xuXHRcdFx0YS5jbGljaygpO1xuXG5cdFx0XHRVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjcmVhdGUgUE5HIGJsb2IuJyk7XG5cdFx0fVxuXHR9LCAnaW1hZ2UvcG5nJyk7XG59XG5cbmZ1bmN0aW9uIGFzWE1MKHBhbGV0dGU6IFBhbGV0dGUpOiB2b2lkIHtcblx0Y29uc3QgeG1sSXRlbXMgPSBwYWxldHRlLml0ZW1zXG5cdFx0Lm1hcChcblx0XHRcdGl0ZW0gPT4gYFxuXHRcdDxQYWxldHRlSXRlbSBcIiR7aXRlbS5pZH0+XG5cdFx0XHQ8Q29sb3JzPlxuXHRcdFx0XHQ8Q01ZSz4ke2l0ZW0uY29sb3JzLmNteWt9PC9DTVlLPlxuXHRcdFx0XHQ8SGV4PiR7aXRlbS5jb2xvcnMuaGV4fTwvSGV4PlxuXHRcdFx0XHQ8SFNMPiR7aXRlbS5jb2xvcnMuaHNsfTwvSFNMPlxuXHRcdFx0XHQ8SFNWPiR7aXRlbS5jb2xvcnMuaHN2fTwvSFNWPlxuXHRcdFx0XHQ8TEFCPiR7aXRlbS5jb2xvcnMubGFifTwvTEFCPlxuXHRcdFx0XHQ8UkdCPiR7aXRlbS5jb2xvcnMucmdifTwvUkdCPlxuXHRcdFx0PC9Db2xvcnM+XG5cdFx0PC9QYWxldHRlSXRlbT5cblx0YFxuXHRcdClcblx0XHQuam9pbignJyk7XG5cdGNvbnN0IHhtbCA9IGBcblx0XHQ8UGFsZXR0ZSAke3BhbGV0dGUuaWR9PlxuXHRcdFx0PEZsYWdzPlxuXHRcdFx0XHQ8RW5hYmxlQWxwaGE+JHtwYWxldHRlLmZsYWdzLmVuYWJsZUFscGhhfTwvRW5hYmxlQWxwaGE+XG5cdFx0XHRcdDxMaW1pdERhcmtuZXNzPiR7cGFsZXR0ZS5mbGFncy5saW1pdERhcmtuZXNzfTwvTGltaXREYXJrbmVzcz5cblx0XHRcdFx0PExpbWl0R3JheW5lc3M+JHtwYWxldHRlLmZsYWdzLmxpbWl0R3JheW5lc3N9PC9MaW1pdEdyYXluZXNzPlxuXHRcdFx0XHQ8TGltaXRMaWdodG5lc3M+JHtwYWxldHRlLmZsYWdzLmxpbWl0TGlnaHRuZXNzfTwvTGltaXRMaWdodG5lc3M+XG5cdFx0XHQ8L0ZsYWdzPlxuXHRcdFx0PE1ldGFkYXRhPlxuXHRcdFx0XHQ8Q3VzdG9tQ29sb3I+XG5cdFx0XHRcdFx0PEhTTENvbG9yPiR7cGFsZXR0ZS5tZXRhZGF0YS5jdXN0b21Db2xvciA/IHBhbGV0dGUubWV0YWRhdGEuY3VzdG9tQ29sb3IuaHNsQ29sb3IgOiBudWxsfTwvSFNMQ29sb3I+XG5cdFx0XHRcdFx0PENvbnZlcnRlZENvbG9ycz4ke3BhbGV0dGUubWV0YWRhdGEuY3VzdG9tQ29sb3IgPyBwYWxldHRlLm1ldGFkYXRhLmN1c3RvbUNvbG9yLmNvbnZlcnRlZENvbG9ycyA6IG51bGx9PC9Db252ZXJ0ZWRDb2xvcnM+XG5cdFx0XHRcdDwvQ3VzdG9tQ29sb3I+XG5cdFx0XHRcdDxOdW1Cb3hlcz4ke3BhbGV0dGUubWV0YWRhdGEubnVtQm94ZXN9PC9OdW1Cb3hlcz5cblx0XHRcdFx0PFBhbGV0dGVUeXBlPiR7cGFsZXR0ZS5tZXRhZGF0YS5wYWxldHRlVHlwZX08L1BhbGV0dGVUeXBlPlxuXHRcdFx0PC9NZXRhZGF0YT5cblx0XHRcdCR7eG1sSXRlbXN9XG5cdFx0PC9QYWxldHRlPlxuXHRgO1xuXG5cdGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbeG1sXSwgeyB0eXBlOiAnYXBwbGljYXRpb24veG1sJyB9KTtcblx0Y29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcblx0Y29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcblxuXHRhLmhyZWYgPSB1cmw7XG5cdGEuZG93bmxvYWQgPSBgcGFsZXR0ZV8ke3BhbGV0dGUuaWR9LnhtbGA7XG5cdGEuY2xpY2soKTtcblxuXHRVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG59XG5cbmV4cG9ydCBjb25zdCBleHBvcnRQYWxldHRlOiBET01FeHBvcnRQYWxldHRlRm5JbnRlcmZhY2UgPSB7XG5cdGFzQ1NTLFxuXHRhc0pTT04sXG5cdGFzUE5HLFxuXHRhc1hNTFxufTtcbiJdfQ==