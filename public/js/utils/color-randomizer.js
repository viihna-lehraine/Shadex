import { defaults } from '../config/defaults.js';
import { paletteHelpers } from '../helpers/palette.js';
import { core } from './core.js';
function randomCMYK() {
    try {
        const cmyk = {
            value: {
                cyan: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                magenta: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                yellow: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                key: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101))
            },
            format: 'cmyk'
        };
        if (!paletteHelpers.validateColorValues(cmyk)) {
            console.error(`Invalid random CMYK color value ${JSON.stringify(cmyk)}`);
            return core.clone(defaults.defaultCMYK);
        }
        console.log(`Generated randomCMYK: ${JSON.stringify(cmyk)}`);
        return cmyk;
    }
    catch (error) {
        console.error(`Error generating random CMYK color: ${error}`);
        return core.clone(defaults.defaultCMYK);
    }
}
function randomHex() {
    try {
        const hexDigits = '0123456789ABCDEF';
        const hexCodeArray = Array.from({ length: 6 }, () => hexDigits[Math.floor(Math.random() * hexDigits.length)]);
        const hex = {
            value: { hex: `#${hexCodeArray.join('')}` },
            format: 'hex'
        };
        if (!paletteHelpers.validateColorValues(hex)) {
            console.error(`Invalid random hex color value ${JSON.stringify(hex)}`);
            return core.clone(defaults.defaultHex);
        }
        console.log(`Generated randomHex: ${JSON.stringify(hex)}`);
        return hex;
    }
    catch (error) {
        console.error(`Error generating random hex color: ${error}`);
        return core.clone(defaults.defaultHex);
    }
}
function randomHSL() {
    try {
        const hsl = {
            value: {
                hue: paletteHelpers.sanitizeRadial(Math.floor(Math.random() * 360)),
                saturation: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                lightness: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101))
            },
            format: 'hsl'
        };
        if (!paletteHelpers.validateColorValues(hsl)) {
            console.error(`Invalid random HSL color value ${JSON.stringify(hsl)}`);
            return core.clone(defaults.defaultHSL);
        }
        console.log(`Generated randomHSL: ${JSON.stringify(hsl)}`);
        return hsl;
    }
    catch (error) {
        console.error(`Error generating random HSL color: ${error}`);
        return core.clone(defaults.defaultHSL);
    }
}
function randomHSV() {
    try {
        const hsv = {
            value: {
                hue: paletteHelpers.sanitizeRadial(Math.floor(Math.random() * 360)),
                saturation: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                value: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101))
            },
            format: 'hsv'
        };
        if (!paletteHelpers.validateColorValues(hsv)) {
            console.error(`Invalid random HSV color value ${JSON.stringify(hsv)}`);
            return core.clone(defaults.defaultHSV);
        }
        console.log(`Generated randomHSV: ${JSON.stringify(hsv)}`);
        return hsv;
    }
    catch (error) {
        console.error(`Error generating random HSV color: ${error}`);
        return core.clone(defaults.defaultHSV);
    }
}
function randomLAB() {
    try {
        const lab = {
            value: {
                l: paletteHelpers.sanitizePercentage(Math.random() * 100),
                a: paletteHelpers.sanitizeLAB(Math.random() * 251 - 125),
                b: paletteHelpers.sanitizeLAB(Math.random() * 251 - 125)
            },
            format: 'lab'
        };
        if (!paletteHelpers.validateColorValues(lab)) {
            console.error(`Invalid random LAB color value ${JSON.stringify(lab)}`);
            return core.clone(defaults.defaultLAB);
        }
        console.log(`Generated randomLAB: ${JSON.stringify(lab)}`);
        return lab;
    }
    catch (error) {
        console.error(`Error generating random LAB color: ${error}`);
        return core.clone(defaults.defaultLAB);
    }
}
function randomRGB() {
    try {
        const rgb = {
            value: {
                red: paletteHelpers.sanitizeRGB(Math.floor(Math.random() * 256)),
                green: paletteHelpers.sanitizeRGB(Math.floor(Math.random() * 256)),
                blue: paletteHelpers.sanitizeRGB(Math.floor(Math.random() * 256))
            },
            format: 'rgb'
        };
        if (!paletteHelpers.validateColorValues(rgb)) {
            console.error(`Invalid random RGB color value ${JSON.stringify(rgb)}`);
            return core.clone(defaults.defaultRGB);
        }
        console.log(`Generated randomRGB: ${JSON.stringify(rgb)}`);
        return rgb;
    }
    catch (error) {
        console.error(`Error generating random RGB color: ${error}`);
        return core.clone(defaults.defaultRGB);
    }
}
function randomSL() {
    try {
        const sl = {
            value: {
                saturation: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100))),
                lightness: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100)))
            },
            format: 'sl'
        };
        if (!paletteHelpers.validateColorValues(sl)) {
            console.error(`Invalid random SV color value ${JSON.stringify(sl)}`);
            return core.clone(defaults.defaultSL);
        }
        console.log(`Generated randomSL: ${JSON.stringify(sl)}`);
        return sl;
    }
    catch (error) {
        console.error(`Error generating random SL color: ${error}`);
        return core.clone(defaults.defaultSL);
    }
}
function randomSV() {
    try {
        const sv = {
            value: {
                saturation: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100))),
                value: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100)))
            },
            format: 'sv'
        };
        if (!paletteHelpers.validateColorValues(sv)) {
            console.error(`Invalid random SV color value ${JSON.stringify(sv)}`);
            return core.clone(defaults.defaultSV);
        }
        console.log(`Generated randomSV: ${JSON.stringify(sv)}`);
        return sv;
    }
    catch (error) {
        console.error(`Error generating random SV color: ${error}`);
        return core.clone(defaults.defaultSV);
    }
}
export function genRandomColor(colorSpace) {
    try {
        switch (colorSpace) {
            case 'cmyk':
                return randomCMYK();
            case 'hex':
                return randomHex();
            case 'hsl':
                return randomHSL();
            case 'hsv':
                return randomHSV();
            case 'lab':
                return randomLAB();
            case 'rgb':
                return randomRGB();
            case 'sl':
                return randomSL();
            case 'sv':
                return randomSV();
            default:
                return randomHex();
        }
    }
    catch (error) {
        console.error(`Error generating random color: ${error}`);
        return randomHex();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItcmFuZG9taXplci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9jb2xvci1yYW5kb21pemVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFFcEQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUU5QixTQUFTLFVBQVU7SUFDbEIsSUFBSSxDQUFDO1FBQ0osTUFBTSxJQUFJLEdBQWdCO1lBQ3pCLEtBQUssRUFBRTtnQkFDTixJQUFJLEVBQUUsY0FBYyxDQUFDLGtCQUFrQixDQUN0QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FDL0I7Z0JBQ0QsT0FBTyxFQUFFLGNBQWMsQ0FBQyxrQkFBa0IsQ0FDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQy9CO2dCQUNELE1BQU0sRUFBRSxjQUFjLENBQUMsa0JBQWtCLENBQ3hDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUMvQjtnQkFDRCxHQUFHLEVBQUUsY0FBYyxDQUFDLGtCQUFrQixDQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FDL0I7YUFDRDtZQUNELE1BQU0sRUFBRSxNQUFNO1NBQ2QsQ0FBQztRQUVGLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMvQyxPQUFPLENBQUMsS0FBSyxDQUNaLG1DQUFtQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQ3pELENBQUM7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QXFDO0lBRXJDLElBQUksQ0FBQztRQUNKLFFBQVEsVUFBVSxFQUFFLENBQUM7WUFDcEIsS0FBSyxNQUFNO2dCQUNWLE9BQU8sVUFBVSxFQUFFLENBQUM7WUFDckIsS0FBSyxLQUFLO2dCQUNULE9BQU8sU0FBUyxFQUFFLENBQUM7WUFDcEIsS0FBSyxLQUFLO2dCQUNULE9BQU8sU0FBUyxFQUFFLENBQUM7WUFDcEIsS0FBSyxLQUFLO2dCQUNULE9BQU8sU0FBUyxFQUFFLENBQUM7WUFDcEIsS0FBSyxLQUFLO2dCQUNULE9BQU8sU0FBUyxFQUFFLENBQUM7WUFDcEIsS0FBSyxLQUFLO2dCQUNULE9BQU8sU0FBUyxFQUFFLENBQUM7WUFDcEIsS0FBSyxJQUFJO2dCQUNSLE9BQU8sUUFBUSxFQUFFLENBQUM7WUFDbkIsS0FBSyxJQUFJO2dCQUNSLE9BQU8sUUFBUSxFQUFFLENBQUM7WUFDbkI7Z0JBQ0MsT0FBTyxTQUFTLEVBQUUsQ0FBQztRQUNyQixDQUFDO0lBQ0YsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDaEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUV6RCxPQUFPLFNBQVMsRUFBRSxDQUFDO0lBQ3BCLENBQUM7QUFDRixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVmYXVsdHMgfSBmcm9tICcuLi9jb25maWcvZGVmYXVsdHMnO1xuaW1wb3J0IHsgcGFsZXR0ZUhlbHBlcnMgfSBmcm9tICcuLi9oZWxwZXJzL3BhbGV0dGUnO1xuaW1wb3J0ICogYXMgY29sb3JzIGZyb20gJy4uL2luZGV4L2NvbG9ycyc7XG5pbXBvcnQgeyBjb3JlIH0gZnJvbSAnLi9jb3JlJztcblxuZnVuY3Rpb24gcmFuZG9tQ01ZSygpOiBjb2xvcnMuQ01ZSyB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgY215azogY29sb3JzLkNNWUsgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRjeWFuOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHQpLFxuXHRcdFx0XHRtYWdlbnRhOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHQpLFxuXHRcdFx0XHR5ZWxsb3c6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUGVyY2VudGFnZShcblx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDEpXG5cdFx0XHRcdCksXG5cdFx0XHRcdGtleTogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMSlcblx0XHRcdFx0KVxuXHRcdFx0fSxcblx0XHRcdGZvcm1hdDogJ2NteWsnXG5cdFx0fTtcblxuXHRcdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhjbXlrKSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0YEludmFsaWQgcmFuZG9tIENNWUsgY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShjbXlrKX1gXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gY29yZS5jbG9uZShkZWZhdWx0cy5kZWZhdWx0Q01ZSyk7XG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coYEdlbmVyYXRlZCByYW5kb21DTVlLOiAke0pTT04uc3RyaW5naWZ5KGNteWspfWApO1xuXG5cdFx0cmV0dXJuIGNteWs7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyByYW5kb20gQ01ZSyBjb2xvcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRDTVlLKTtcblx0fVxufVxuXG5mdW5jdGlvbiByYW5kb21IZXgoKTogY29sb3JzLkhleCB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgaGV4RGlnaXRzID0gJzAxMjM0NTY3ODlBQkNERUYnO1xuXHRcdGNvbnN0IGhleENvZGVBcnJheSA9IEFycmF5LmZyb20oXG5cdFx0XHR7IGxlbmd0aDogNiB9LFxuXHRcdFx0KCkgPT4gaGV4RGlnaXRzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGhleERpZ2l0cy5sZW5ndGgpXVxuXHRcdCk7XG5cdFx0Y29uc3QgaGV4OiBjb2xvcnMuSGV4ID0ge1xuXHRcdFx0dmFsdWU6IHsgaGV4OiBgIyR7aGV4Q29kZUFycmF5LmpvaW4oJycpfWAgfSxcblx0XHRcdGZvcm1hdDogJ2hleCdcblx0XHR9O1xuXG5cdFx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhleCkpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkIHJhbmRvbSBoZXggY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShoZXgpfWBcblx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRIZXgpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tSGV4OiAke0pTT04uc3RyaW5naWZ5KGhleCl9YCk7XG5cblx0XHRyZXR1cm4gaGV4O1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIGhleCBjb2xvcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRIZXgpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUhTTCgpOiBjb2xvcnMuSFNMIHtcblx0dHJ5IHtcblx0XHRjb25zdCBoc2w6IGNvbG9ycy5IU0wgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRodWU6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUmFkaWFsKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDM2MClcblx0XHRcdFx0KSxcblx0XHRcdFx0c2F0dXJhdGlvbjogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMSlcblx0XHRcdFx0KSxcblx0XHRcdFx0bGlnaHRuZXNzOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAnaHNsJ1xuXHRcdH07XG5cblx0XHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHNsKSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0YEludmFsaWQgcmFuZG9tIEhTTCBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzbCl9YFxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdEhTTCk7XG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coYEdlbmVyYXRlZCByYW5kb21IU0w6ICR7SlNPTi5zdHJpbmdpZnkoaHNsKX1gKTtcblxuXHRcdHJldHVybiBoc2w7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyByYW5kb20gSFNMIGNvbG9yOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdEhTTCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tSFNWKCk6IGNvbG9ycy5IU1Yge1xuXHR0cnkge1xuXHRcdGNvbnN0IGhzdjogY29sb3JzLkhTViA9IHtcblx0XHRcdHZhbHVlOiB7XG5cdFx0XHRcdGh1ZTogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVSYWRpYWwoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMzYwKVxuXHRcdFx0XHQpLFxuXHRcdFx0XHRzYXR1cmF0aW9uOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHQpLFxuXHRcdFx0XHR2YWx1ZTogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMSlcblx0XHRcdFx0KVxuXHRcdFx0fSxcblx0XHRcdGZvcm1hdDogJ2hzdidcblx0XHR9O1xuXG5cdFx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGhzdikpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkIHJhbmRvbSBIU1YgY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShoc3YpfWBcblx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRIU1YpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tSFNWOiAke0pTT04uc3RyaW5naWZ5KGhzdil9YCk7XG5cblx0XHRyZXR1cm4gaHN2O1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIEhTViBjb2xvcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRIU1YpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUxBQigpOiBjb2xvcnMuTEFCIHtcblx0dHJ5IHtcblx0XHRjb25zdCBsYWI6IGNvbG9ycy5MQUIgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRsOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoTWF0aC5yYW5kb20oKSAqIDEwMCksXG5cdFx0XHRcdGE6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplTEFCKE1hdGgucmFuZG9tKCkgKiAyNTEgLSAxMjUpLFxuXHRcdFx0XHRiOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZUxBQihNYXRoLnJhbmRvbSgpICogMjUxIC0gMTI1KVxuXHRcdFx0fSxcblx0XHRcdGZvcm1hdDogJ2xhYidcblx0XHR9O1xuXG5cdFx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGxhYikpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkIHJhbmRvbSBMQUIgY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShsYWIpfWBcblx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRMQUIpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tTEFCOiAke0pTT04uc3RyaW5naWZ5KGxhYil9YCk7XG5cblx0XHRyZXR1cm4gbGFiO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIExBQiBjb2xvcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRMQUIpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbVJHQigpOiBjb2xvcnMuUkdCIHtcblx0dHJ5IHtcblx0XHRjb25zdCByZ2I6IGNvbG9ycy5SR0IgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRyZWQ6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUkdCKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1Nilcblx0XHRcdFx0KSxcblx0XHRcdFx0Z3JlZW46IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUkdCKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1Nilcblx0XHRcdFx0KSxcblx0XHRcdFx0Ymx1ZTogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVSR0IoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAncmdiJ1xuXHRcdH07XG5cblx0XHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMocmdiKSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0YEludmFsaWQgcmFuZG9tIFJHQiBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHJnYil9YFxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdFJHQik7XG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coYEdlbmVyYXRlZCByYW5kb21SR0I6ICR7SlNPTi5zdHJpbmdpZnkocmdiKX1gKTtcblxuXHRcdHJldHVybiByZ2I7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyByYW5kb20gUkdCIGNvbG9yOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdFJHQik7XG5cdH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tU0woKTogY29sb3JzLlNMIHtcblx0dHJ5IHtcblx0XHRjb25zdCBzbDogY29sb3JzLlNMID0ge1xuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0c2F0dXJhdGlvbjogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKFxuXHRcdFx0XHRcdE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgTWF0aC5yYW5kb20oKSAqIDEwMCkpXG5cdFx0XHRcdCksXG5cdFx0XHRcdGxpZ2h0bmVzczogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKFxuXHRcdFx0XHRcdE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgTWF0aC5yYW5kb20oKSAqIDEwMCkpXG5cdFx0XHRcdClcblx0XHRcdH0sXG5cdFx0XHRmb3JtYXQ6ICdzbCdcblx0XHR9O1xuXG5cdFx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKHNsIGFzIGNvbG9ycy5TTCkpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkIHJhbmRvbSBTViBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHNsKX1gXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gY29yZS5jbG9uZShkZWZhdWx0cy5kZWZhdWx0U0wpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tU0w6ICR7SlNPTi5zdHJpbmdpZnkoc2wpfWApO1xuXG5cdFx0cmV0dXJuIHNsO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIFNMIGNvbG9yOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdFNMKTtcblx0fVxufVxuXG5mdW5jdGlvbiByYW5kb21TVigpOiBjb2xvcnMuU1Yge1xuXHR0cnkge1xuXHRcdGNvbnN0IHN2OiBjb2xvcnMuU1YgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRzYXR1cmF0aW9uOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBNYXRoLnJhbmRvbSgpICogMTAwKSlcblx0XHRcdFx0KSxcblx0XHRcdFx0dmFsdWU6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUGVyY2VudGFnZShcblx0XHRcdFx0XHRNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIE1hdGgucmFuZG9tKCkgKiAxMDApKVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAnc3YnXG5cdFx0fTtcblxuXHRcdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhzdikpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkIHJhbmRvbSBTViBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHN2KX1gXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gY29yZS5jbG9uZShkZWZhdWx0cy5kZWZhdWx0U1YpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tU1Y6ICR7SlNPTi5zdHJpbmdpZnkoc3YpfWApO1xuXG5cdFx0cmV0dXJuIHN2O1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIFNWIGNvbG9yOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdFNWKTtcblx0fVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2VuUmFuZG9tQ29sb3IoXG5cdGNvbG9yU3BhY2U6IGNvbG9ycy5Db2xvclNwYWNlRXh0ZW5kZWRcbik6IGNvbG9ycy5Db2xvciB7XG5cdHRyeSB7XG5cdFx0c3dpdGNoIChjb2xvclNwYWNlKSB7XG5cdFx0XHRjYXNlICdjbXlrJzpcblx0XHRcdFx0cmV0dXJuIHJhbmRvbUNNWUsoKTtcblx0XHRcdGNhc2UgJ2hleCc6XG5cdFx0XHRcdHJldHVybiByYW5kb21IZXgoKTtcblx0XHRcdGNhc2UgJ2hzbCc6XG5cdFx0XHRcdHJldHVybiByYW5kb21IU0woKTtcblx0XHRcdGNhc2UgJ2hzdic6XG5cdFx0XHRcdHJldHVybiByYW5kb21IU1YoKTtcblx0XHRcdGNhc2UgJ2xhYic6XG5cdFx0XHRcdHJldHVybiByYW5kb21MQUIoKTtcblx0XHRcdGNhc2UgJ3JnYic6XG5cdFx0XHRcdHJldHVybiByYW5kb21SR0IoKTtcblx0XHRcdGNhc2UgJ3NsJzpcblx0XHRcdFx0cmV0dXJuIHJhbmRvbVNMKCk7XG5cdFx0XHRjYXNlICdzdic6XG5cdFx0XHRcdHJldHVybiByYW5kb21TVigpO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0cmV0dXJuIHJhbmRvbUhleCgpO1xuXHRcdH1cblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIHJhbmRvbSBjb2xvcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiByYW5kb21IZXgoKTtcblx0fVxufVxuIl19