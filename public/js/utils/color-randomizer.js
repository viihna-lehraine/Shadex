import { defaults } from './defaults.js';
import { paletteHelpers } from '../helpers/palette.js';
import { core } from './core.js';
function randomCMYK() {
    try {
        const cmyk = {
            value: {
                cyan: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                magenta: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                yellow: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                key: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101))
            },
            format: 'cmyk'
        };
        if (!paletteHelpers.validateColorValues(cmyk)) {
            console.error(`Invalid random CMYK color value ${JSON.stringify(cmyk)}`);
            return core.clone(defaults.defaultCMYK());
        }
        console.log(`Generated randomCMYK: ${JSON.stringify(cmyk)}`);
        return cmyk;
    }
    catch (error) {
        console.error(`Error generating random CMYK color: ${error}`);
        return defaults.defaultCMYK();
    }
}
function randomHex() {
    try {
        const hexDigits = '0123456789ABCDEF';
        const hexCodeArray = Array.from({ length: 6 }, () => hexDigits[Math.floor(Math.random() * hexDigits.length)]);
        const hex = {
            value: { hex: `#${hexCodeArray.join('')}` },
            format: 'hex'
        };
        if (!paletteHelpers.validateColorValues(hex)) {
            console.error(`Invalid random hex color value ${JSON.stringify(hex)}`);
            return core.clone(defaults.defaultHex());
        }
        console.log(`Generated randomHex: ${JSON.stringify(hex)}`);
        return hex;
    }
    catch (error) {
        console.error(`Error generating random hex color: ${error}`);
        return defaults.defaultHex();
    }
}
function randomHSL() {
    try {
        const hsl = {
            value: {
                hue: paletteHelpers.sanitizeRadial(Math.floor(Math.random() * 360)),
                saturation: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                lightness: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101))
            },
            format: 'hsl'
        };
        if (!paletteHelpers.validateColorValues(hsl)) {
            console.error(`Invalid random HSL color value ${JSON.stringify(hsl)}`);
            return core.clone(defaults.defaultHSL());
        }
        console.log(`Generated randomHSL: ${JSON.stringify(hsl)}`);
        return hsl;
    }
    catch (error) {
        console.error(`Error generating random HSL color: ${error}`);
        return defaults.defaultHSL();
    }
}
function randomHSV() {
    try {
        const hsv = {
            value: {
                hue: paletteHelpers.sanitizeRadial(Math.floor(Math.random() * 360)),
                saturation: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101)),
                value: paletteHelpers.sanitizePercentage(Math.floor(Math.random() * 101))
            },
            format: 'hsv'
        };
        if (!paletteHelpers.validateColorValues(hsv)) {
            console.error(`Invalid random HSV color value ${JSON.stringify(hsv)}`);
            return core.clone(defaults.defaultHSV());
        }
        console.log(`Generated randomHSV: ${JSON.stringify(hsv)}`);
        return hsv;
    }
    catch (error) {
        console.error(`Error generating random HSV color: ${error}`);
        return defaults.defaultHSV();
    }
}
function randomLAB() {
    try {
        const lab = {
            value: {
                l: paletteHelpers.sanitizePercentage(Math.random() * 100),
                a: paletteHelpers.sanitizeLAB(Math.random() * 251 - 125),
                b: paletteHelpers.sanitizeLAB(Math.random() * 251 - 125)
            },
            format: 'lab'
        };
        if (!paletteHelpers.validateColorValues(lab)) {
            console.error(`Invalid random LAB color value ${JSON.stringify(lab)}`);
            return core.clone(defaults.defaultLAB());
        }
        console.log(`Generated randomLAB: ${JSON.stringify(lab)}`);
        return lab;
    }
    catch (error) {
        console.error(`Error generating random LAB color: ${error}`);
        return defaults.defaultLAB();
    }
}
function randomRGB() {
    try {
        const rgb = {
            value: {
                red: paletteHelpers.sanitizeRGB(Math.floor(Math.random() * 256)),
                green: paletteHelpers.sanitizeRGB(Math.floor(Math.random() * 256)),
                blue: paletteHelpers.sanitizeRGB(Math.floor(Math.random() * 256))
            },
            format: 'rgb'
        };
        if (!paletteHelpers.validateColorValues(rgb)) {
            console.error(`Invalid random RGB color value ${JSON.stringify(rgb)}`);
            return core.clone(defaults.defaultRGB());
        }
        console.log(`Generated randomRGB: ${JSON.stringify(rgb)}`);
        return rgb;
    }
    catch (error) {
        console.error(`Error generating random RGB color: ${error}`);
        return defaults.defaultRGB();
    }
}
function randomSL() {
    try {
        const sl = {
            value: {
                saturation: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100))),
                lightness: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100)))
            },
            format: 'sl'
        };
        if (!paletteHelpers.validateColorValues(sl)) {
            console.error(`Invalid random SV color value ${JSON.stringify(sl)}`);
            return core.clone(defaults.defaultSL());
        }
        console.log(`Generated randomSL: ${JSON.stringify(sl)}`);
        return sl;
    }
    catch (error) {
        console.error(`Error generating random SL color: ${error}`);
        return defaults.defaultSL();
    }
}
function randomSV() {
    try {
        const sv = {
            value: {
                saturation: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100))),
                value: paletteHelpers.sanitizePercentage(Math.max(0, Math.min(100, Math.random() * 100)))
            },
            format: 'sv'
        };
        if (!paletteHelpers.validateColorValues(sv)) {
            console.error(`Invalid random SV color value ${JSON.stringify(sv)}`);
            return core.clone(defaults.defaultSV());
        }
        console.log(`Generated randomSV: ${JSON.stringify(sv)}`);
        return sv;
    }
    catch (error) {
        console.error(`Error generating random SV color: ${error}`);
        return defaults.defaultSV();
    }
}
function randomColor(colorSpace) {
    try {
        switch (colorSpace) {
            case 'cmyk':
                return random.randomCMYK();
            case 'hex':
                return random.randomHex();
            case 'hsl':
                return random.randomHSL();
            case 'hsv':
                return random.randomHSV();
            case 'lab':
                return random.randomLAB();
            case 'rgb':
                return random.randomRGB();
            default:
                return random.randomHex();
        }
    }
    catch (error) {
        console.error(`Error generating random color: ${error}`);
        return random.randomHex();
    }
}
export const random = {
    randomCMYK,
    randomHex,
    randomHSL,
    randomHSV,
    randomLAB,
    randomRGB,
    randomSL,
    randomSV,
    randomColor
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29sb3ItcmFuZG9taXplci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy91dGlscy9jb2xvci1yYW5kb21pemVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdEMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBR3BELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFFOUIsU0FBUyxVQUFVO0lBQ2xCLElBQUksQ0FBQztRQUNKLE1BQU0sSUFBSSxHQUFlO1lBQ3hCLEtBQUssRUFBRTtnQkFDTixJQUFJLEVBQUUsY0FBYyxDQUFDLGtCQUFrQixDQUN0QyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FDL0I7Z0JBQ0QsT0FBTyxFQUFFLGNBQWMsQ0FBQyxrQkFBa0IsQ0FDekMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLENBQy9CO2dCQUNELE1BQU0sRUFBRSxjQUFjLENBQUMsa0JBQWtCLENBQ3hDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUMvQjtnQkFDRCxHQUFHLEVBQUUsY0FBYyxDQUFDLGtCQUFrQixDQUNyQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FDL0I7YUFDRDtZQUNELE1BQU0sRUFBRSxNQUFNO1NBQ2QsQ0FBQztRQUVGLElBQUksQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMvQyxPQUFPLENBQUMsS0FBSyxDQUNaLG1DQUFtQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQ3pELENBQUM7WUFF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Q0FBQyxTQUFTLEVBQUUsQ0FBQztZQUMzQixLQUFLLEtBQUs7Z0JBQ1QsT0FBTyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDM0IsS0FBSyxLQUFLO2dCQUNULE9BQU8sTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQzNCLEtBQUssS0FBSztnQkFDVCxPQUFPLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUMzQixLQUFLLEtBQUs7Z0JBQ1QsT0FBTyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDM0I7Z0JBQ0MsT0FBTyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDNUIsQ0FBQztJQUNGLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsa0NBQWtDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFekQsT0FBTyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDM0IsQ0FBQztBQUNGLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQXFCO0lBQ3ZDLFVBQVU7SUFDVixTQUFTO0lBQ1QsU0FBUztJQUNULFNBQVM7SUFDVCxTQUFTO0lBQ1QsU0FBUztJQUNULFFBQVE7SUFDUixRQUFRO0lBQ1IsV0FBVztDQUNYLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZWZhdWx0cyB9IGZyb20gJy4vZGVmYXVsdHMnO1xuaW1wb3J0IHsgcGFsZXR0ZUhlbHBlcnMgfSBmcm9tICcuLi9oZWxwZXJzL3BhbGV0dGUnO1xuaW1wb3J0ICogYXMgZm5PYmplY3RzIGZyb20gJy4uL2luZGV4L2ZuLW9iamVjdHMnO1xuaW1wb3J0ICogYXMgdHlwZXMgZnJvbSAnLi4vaW5kZXgvdHlwZXMnO1xuaW1wb3J0IHsgY29yZSB9IGZyb20gJy4vY29yZSc7XG5cbmZ1bmN0aW9uIHJhbmRvbUNNWUsoKTogdHlwZXMuQ01ZSyB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgY215azogdHlwZXMuQ01ZSyA9IHtcblx0XHRcdHZhbHVlOiB7XG5cdFx0XHRcdGN5YW46IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUGVyY2VudGFnZShcblx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDEpXG5cdFx0XHRcdCksXG5cdFx0XHRcdG1hZ2VudGE6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUGVyY2VudGFnZShcblx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDEpXG5cdFx0XHRcdCksXG5cdFx0XHRcdHllbGxvdzogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMSlcblx0XHRcdFx0KSxcblx0XHRcdFx0a2V5OiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAnY215aydcblx0XHR9O1xuXG5cdFx0aWYgKCFwYWxldHRlSGVscGVycy52YWxpZGF0ZUNvbG9yVmFsdWVzKGNteWspKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XHRgSW52YWxpZCByYW5kb20gQ01ZSyBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGNteWspfWBcblx0XHRcdCk7XG5cblx0XHRcdHJldHVybiBjb3JlLmNsb25lKGRlZmF1bHRzLmRlZmF1bHRDTVlLKCkpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tQ01ZSzogJHtKU09OLnN0cmluZ2lmeShjbXlrKX1gKTtcblxuXHRcdHJldHVybiBjbXlrO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIENNWUsgY29sb3I6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gZGVmYXVsdHMuZGVmYXVsdENNWUsoKTtcblx0fVxufVxuXG5mdW5jdGlvbiByYW5kb21IZXgoKTogdHlwZXMuSGV4IHtcblx0dHJ5IHtcblx0XHRjb25zdCBoZXhEaWdpdHMgPSAnMDEyMzQ1Njc4OUFCQ0RFRic7XG5cdFx0Y29uc3QgaGV4Q29kZUFycmF5ID0gQXJyYXkuZnJvbShcblx0XHRcdHsgbGVuZ3RoOiA2IH0sXG5cdFx0XHQoKSA9PiBoZXhEaWdpdHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaGV4RGlnaXRzLmxlbmd0aCldXG5cdFx0KTtcblx0XHRjb25zdCBoZXg6IHR5cGVzLkhleCA9IHtcblx0XHRcdHZhbHVlOiB7IGhleDogYCMke2hleENvZGVBcnJheS5qb2luKCcnKX1gIH0sXG5cdFx0XHRmb3JtYXQ6ICdoZXgnXG5cdFx0fTtcblxuXHRcdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhoZXgpKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XHRgSW52YWxpZCByYW5kb20gaGV4IGNvbG9yIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkoaGV4KX1gXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gY29yZS5jbG9uZShkZWZhdWx0cy5kZWZhdWx0SGV4KCkpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tSGV4OiAke0pTT04uc3RyaW5naWZ5KGhleCl9YCk7XG5cblx0XHRyZXR1cm4gaGV4O1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIGhleCBjb2xvcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBkZWZhdWx0cy5kZWZhdWx0SGV4KCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tSFNMKCk6IHR5cGVzLkhTTCB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgaHNsOiB0eXBlcy5IU0wgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRodWU6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUmFkaWFsKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDM2MClcblx0XHRcdFx0KSxcblx0XHRcdFx0c2F0dXJhdGlvbjogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMSlcblx0XHRcdFx0KSxcblx0XHRcdFx0bGlnaHRuZXNzOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAnaHNsJ1xuXHRcdH07XG5cblx0XHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHNsKSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0YEludmFsaWQgcmFuZG9tIEhTTCBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzbCl9YFxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdEhTTCgpKTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhgR2VuZXJhdGVkIHJhbmRvbUhTTDogJHtKU09OLnN0cmluZ2lmeShoc2wpfWApO1xuXG5cdFx0cmV0dXJuIGhzbDtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIHJhbmRvbSBIU0wgY29sb3I6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gZGVmYXVsdHMuZGVmYXVsdEhTTCgpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUhTVigpOiB0eXBlcy5IU1Yge1xuXHR0cnkge1xuXHRcdGNvbnN0IGhzdjogdHlwZXMuSFNWID0ge1xuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0aHVlOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVJhZGlhbChcblx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAzNjApXG5cdFx0XHRcdCksXG5cdFx0XHRcdHNhdHVyYXRpb246IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUGVyY2VudGFnZShcblx0XHRcdFx0XHRNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDEpXG5cdFx0XHRcdCksXG5cdFx0XHRcdHZhbHVlOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAxKVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAnaHN2J1xuXHRcdH07XG5cblx0XHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoaHN2KSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0YEludmFsaWQgcmFuZG9tIEhTViBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGhzdil9YFxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdEhTVigpKTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhgR2VuZXJhdGVkIHJhbmRvbUhTVjogJHtKU09OLnN0cmluZ2lmeShoc3YpfWApO1xuXG5cdFx0cmV0dXJuIGhzdjtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIHJhbmRvbSBIU1YgY29sb3I6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gZGVmYXVsdHMuZGVmYXVsdEhTVigpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUxBQigpOiB0eXBlcy5MQUIge1xuXHR0cnkge1xuXHRcdGNvbnN0IGxhYjogdHlwZXMuTEFCID0ge1xuXHRcdFx0dmFsdWU6IHtcblx0XHRcdFx0bDogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVQZXJjZW50YWdlKE1hdGgucmFuZG9tKCkgKiAxMDApLFxuXHRcdFx0XHRhOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZUxBQihNYXRoLnJhbmRvbSgpICogMjUxIC0gMTI1KSxcblx0XHRcdFx0YjogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVMQUIoTWF0aC5yYW5kb20oKSAqIDI1MSAtIDEyNSlcblx0XHRcdH0sXG5cdFx0XHRmb3JtYXQ6ICdsYWInXG5cdFx0fTtcblxuXHRcdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhsYWIpKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XHRgSW52YWxpZCByYW5kb20gTEFCIGNvbG9yIHZhbHVlICR7SlNPTi5zdHJpbmdpZnkobGFiKX1gXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gY29yZS5jbG9uZShkZWZhdWx0cy5kZWZhdWx0TEFCKCkpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tTEFCOiAke0pTT04uc3RyaW5naWZ5KGxhYil9YCk7XG5cblx0XHRyZXR1cm4gbGFiO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIExBQiBjb2xvcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBkZWZhdWx0cy5kZWZhdWx0TEFCKCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tUkdCKCk6IHR5cGVzLlJHQiB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgcmdiOiB0eXBlcy5SR0IgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRyZWQ6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUkdCKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1Nilcblx0XHRcdFx0KSxcblx0XHRcdFx0Z3JlZW46IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUkdCKFxuXHRcdFx0XHRcdE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDI1Nilcblx0XHRcdFx0KSxcblx0XHRcdFx0Ymx1ZTogcGFsZXR0ZUhlbHBlcnMuc2FuaXRpemVSR0IoXG5cdFx0XHRcdFx0TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU2KVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAncmdiJ1xuXHRcdH07XG5cblx0XHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMocmdiKSkge1xuXHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0YEludmFsaWQgcmFuZG9tIFJHQiBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHJnYil9YFxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdFJHQigpKTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZyhgR2VuZXJhdGVkIHJhbmRvbVJHQjogJHtKU09OLnN0cmluZ2lmeShyZ2IpfWApO1xuXG5cdFx0cmV0dXJuIHJnYjtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIHJhbmRvbSBSR0IgY29sb3I6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gZGVmYXVsdHMuZGVmYXVsdFJHQigpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbVNMKCk6IHR5cGVzLlNMIHtcblx0dHJ5IHtcblx0XHRjb25zdCBzbDogdHlwZXMuU0wgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRzYXR1cmF0aW9uOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBNYXRoLnJhbmRvbSgpICogMTAwKSlcblx0XHRcdFx0KSxcblx0XHRcdFx0bGlnaHRuZXNzOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBNYXRoLnJhbmRvbSgpICogMTAwKSlcblx0XHRcdFx0KVxuXHRcdFx0fSxcblx0XHRcdGZvcm1hdDogJ3NsJ1xuXHRcdH07XG5cblx0XHRpZiAoIXBhbGV0dGVIZWxwZXJzLnZhbGlkYXRlQ29sb3JWYWx1ZXMoc2wgYXMgdHlwZXMuU0wpKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XHRgSW52YWxpZCByYW5kb20gU1YgY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShzbCl9YFxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIGNvcmUuY2xvbmUoZGVmYXVsdHMuZGVmYXVsdFNMKCkpO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKGBHZW5lcmF0ZWQgcmFuZG9tU0w6ICR7SlNPTi5zdHJpbmdpZnkoc2wpfWApO1xuXG5cdFx0cmV0dXJuIHNsO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgcmFuZG9tIFNMIGNvbG9yOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIGRlZmF1bHRzLmRlZmF1bHRTTCgpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHJhbmRvbVNWKCk6IHR5cGVzLlNWIHtcblx0dHJ5IHtcblx0XHRjb25zdCBzdjogdHlwZXMuU1YgPSB7XG5cdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRzYXR1cmF0aW9uOiBwYWxldHRlSGVscGVycy5zYW5pdGl6ZVBlcmNlbnRhZ2UoXG5cdFx0XHRcdFx0TWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBNYXRoLnJhbmRvbSgpICogMTAwKSlcblx0XHRcdFx0KSxcblx0XHRcdFx0dmFsdWU6IHBhbGV0dGVIZWxwZXJzLnNhbml0aXplUGVyY2VudGFnZShcblx0XHRcdFx0XHRNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIE1hdGgucmFuZG9tKCkgKiAxMDApKVxuXHRcdFx0XHQpXG5cdFx0XHR9LFxuXHRcdFx0Zm9ybWF0OiAnc3YnXG5cdFx0fTtcblxuXHRcdGlmICghcGFsZXR0ZUhlbHBlcnMudmFsaWRhdGVDb2xvclZhbHVlcyhzdikpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkIHJhbmRvbSBTViBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KHN2KX1gXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4gY29yZS5jbG9uZShkZWZhdWx0cy5kZWZhdWx0U1YoKSk7XG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coYEdlbmVyYXRlZCByYW5kb21TVjogJHtKU09OLnN0cmluZ2lmeShzdil9YCk7XG5cblx0XHRyZXR1cm4gc3Y7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyByYW5kb20gU1YgY29sb3I6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gZGVmYXVsdHMuZGVmYXVsdFNWKCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gcmFuZG9tQ29sb3IoY29sb3JTcGFjZTogdHlwZXMuQ29sb3JTcGFjZSk6IHR5cGVzLkNvbG9yIHtcblx0dHJ5IHtcblx0XHRzd2l0Y2ggKGNvbG9yU3BhY2UpIHtcblx0XHRcdGNhc2UgJ2NteWsnOlxuXHRcdFx0XHRyZXR1cm4gcmFuZG9tLnJhbmRvbUNNWUsoKTtcblx0XHRcdGNhc2UgJ2hleCc6XG5cdFx0XHRcdHJldHVybiByYW5kb20ucmFuZG9tSGV4KCk7XG5cdFx0XHRjYXNlICdoc2wnOlxuXHRcdFx0XHRyZXR1cm4gcmFuZG9tLnJhbmRvbUhTTCgpO1xuXHRcdFx0Y2FzZSAnaHN2Jzpcblx0XHRcdFx0cmV0dXJuIHJhbmRvbS5yYW5kb21IU1YoKTtcblx0XHRcdGNhc2UgJ2xhYic6XG5cdFx0XHRcdHJldHVybiByYW5kb20ucmFuZG9tTEFCKCk7XG5cdFx0XHRjYXNlICdyZ2InOlxuXHRcdFx0XHRyZXR1cm4gcmFuZG9tLnJhbmRvbVJHQigpO1xuXHRcdFx0ZGVmYXVsdDpcblx0XHRcdFx0cmV0dXJuIHJhbmRvbS5yYW5kb21IZXgoKTtcblx0XHR9XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyByYW5kb20gY29sb3I6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gcmFuZG9tLnJhbmRvbUhleCgpO1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCByYW5kb206IGZuT2JqZWN0cy5SYW5kb20gPSB7XG5cdHJhbmRvbUNNWUssXG5cdHJhbmRvbUhleCxcblx0cmFuZG9tSFNMLFxuXHRyYW5kb21IU1YsXG5cdHJhbmRvbUxBQixcblx0cmFuZG9tUkdCLFxuXHRyYW5kb21TTCxcblx0cmFuZG9tU1YsXG5cdHJhbmRvbUNvbG9yXG59O1xuIl19