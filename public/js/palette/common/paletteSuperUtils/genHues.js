// File: src/palette/common/paletteSuperUtils/genHues.js
import { core, utils } from '../../../common/index.js';
import { data } from '../../../data/index.js';
import { log } from '../../../classes/logger/index.js';
import { paletteUtils } from '../paletteUtils/index.js';
const logMode = data.mode.logging;
const mode = data.mode;
const genAllColorValues = utils.conversion.genAllColorValues;
const getWeightedRandomInterval = paletteUtils.probability.getWeightedRandomInterval;
const validateColorValues = core.validate.colorValues;
function analogous(color, numBoxes) {
    try {
        if (!validateColorValues(color)) {
            if (logMode.errors)
                log.error(`Invalid color value ${JSON.stringify(color)}`);
            return [];
        }
        const clonedColor = core.base.clone(color);
        const analogousHues = [];
        const baseHue = clonedColor.value.hue;
        const maxTotalDistance = 60;
        const minTotalDistance = Math.max(20, 10 + (numBoxes - 2) * 12);
        const totalIncrement = Math.floor(Math.random() * (maxTotalDistance - minTotalDistance + 1)) + minTotalDistance;
        const increment = Math.floor(totalIncrement / (numBoxes - 1));
        for (let i = 1; i < numBoxes; i++) {
            analogousHues.push((baseHue + increment * i) % 360);
        }
        return analogousHues;
    }
    catch (error) {
        if (logMode.errors)
            log.error(`Error generating analogous hues: ${error}`);
        return [];
    }
}
function diadic(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        const diadicHues = [];
        const randomDistance = getWeightedRandomInterval();
        const hue1 = clonedBaseHue;
        const hue2 = (hue1 + randomDistance) % 360;
        diadicHues.push(hue1, hue2);
        return diadicHues;
    }
    catch (error) {
        if (logMode.errors)
            log.error(`Error generating diadic hues: ${error}`);
        return [];
    }
}
function hexadic(color) {
    try {
        const clonedColor = core.base.clone(color);
        if (!validateColorValues(clonedColor)) {
            if (logMode.errors)
                log.error(`Invalid color value ${JSON.stringify(clonedColor)}`);
            return [];
        }
        const clonedBaseHSL = genAllColorValues(clonedColor).hsl;
        if (!clonedBaseHSL) {
            if (!mode.gracefulErrors)
                throw new Error('Unable to generate hexadic hues - missing HSL values');
            else if (logMode.errors)
                log.error('Unable to generate hexadic hues - missing HSL values');
            else if (!mode.quiet && logMode.verbosity > 0)
                log.error('Error generating hexadic hues');
            return [];
        }
        const hexadicHues = [];
        const baseHue = clonedBaseHSL.value.hue;
        const hue1 = baseHue;
        const hue2 = (hue1 + 180) % 360;
        const randomDistance = Math.floor(Math.random() * 61 + 30);
        const hue3 = (hue1 + randomDistance) % 360;
        const hue4 = (hue3 + 180) % 360;
        const hue5 = (hue1 + 360 - randomDistance) % 360;
        const hue6 = (hue5 + 180) % 360;
        hexadicHues.push(hue1, hue2, hue3, hue4, hue5, hue6);
        return hexadicHues;
    }
    catch (error) {
        if (logMode.errors)
            log.error(`Error generating hexadic hues: ${error}`);
        return [];
    }
}
function splitComplementary(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        const modifier = Math.floor(Math.random() * 11) + 20;
        return [
            (clonedBaseHue + 180 + modifier) % 360,
            (clonedBaseHue + 180 - modifier + 360) % 360
        ];
    }
    catch (error) {
        if (logMode.errors)
            log.error(`Error generating split complementary hues: ${error}`);
        return [];
    }
}
function tetradic(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        const randomOffset = Math.floor(Math.random() * 46) + 20;
        const distance = 90 + (Math.random() < 0.5 ? -randomOffset : randomOffset);
        return [
            clonedBaseHue,
            (clonedBaseHue + 180) % 360,
            (clonedBaseHue + distance) % 360,
            (clonedBaseHue + distance + 180) % 360
        ];
    }
    catch (error) {
        if (logMode.errors)
            log.error(`Error generating tetradic hues: ${error}`);
        return [];
    }
}
function triadic(baseHue) {
    try {
        const clonedBaseHue = core.base.clone(baseHue);
        return [120, 240].map(increment => (clonedBaseHue + increment) % 360);
    }
    catch (error) {
        if (logMode.errors)
            log.error(`Error generating triadic hues: ${error}`);
        return [];
    }
}
export const genHues = {
    analogous,
    diadic,
    hexadic,
    splitComplementary,
    tetradic,
    triadic
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2VuSHVlcy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3NyYy9wYWxldHRlL2NvbW1vbi9wYWxldHRlU3VwZXJVdGlscy9nZW5IdWVzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHdEQUF3RDtBQUd4RCxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM5QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDdkQsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBRXhELE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBQ2xDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7QUFFdkIsTUFBTSxpQkFBaUIsR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLGlCQUFpQixDQUFDO0FBQzdELE1BQU0seUJBQXlCLEdBQzlCLFlBQVksQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUM7QUFDcEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztBQUV0RCxTQUFTLFNBQVMsQ0FBQyxLQUFVLEVBQUUsUUFBZ0I7SUFDOUMsSUFBSSxDQUFDO1FBQ0osSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDakMsSUFBSSxPQUFPLENBQUMsTUFBTTtnQkFDakIsR0FBRyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFM0QsT0FBTyxFQUFFLENBQUM7UUFDWCxDQUFDO1FBRUQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFRLENBQUM7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YUFBYSxHQUFHLFFBQVEsQ0FBQyxHQUFHLEdBQUc7WUFDaEMsQ0FBQyxhQUFhLEdBQUcsUUFBUSxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUc7U0FDdEMsQ0FBQztJQUNILENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLElBQUksT0FBTyxDQUFDLE1BQU07WUFDakIsR0FBRyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUV2RCxPQUFPLEVBQUUsQ0FBQztJQUNYLENBQUM7QUFDRixDQUFDO0FBRUQsU0FBUyxPQUFPLENBQUMsT0FBZTtJQUMvQixJQUFJLENBQUM7UUFDSixNQUFNLGFBQWEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUUvQyxPQUFPLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDLENBQUMsYUFBYSxHQUFHLFNBQVMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLElBQUksT0FBTyxDQUFDLE1BQU07WUFDakIsR0FBRyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUV0RCxPQUFPLEVBQUUsQ0FBQztJQUNYLENBQUM7QUFDRixDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0sT0FBTyxHQUFxQztJQUN4RCxTQUFTO0lBQ1QsTUFBTTtJQUNOLE9BQU87SUFDUCxrQkFBa0I7SUFDbEIsUUFBUTtJQUNSLE9BQU87Q0FDRSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gRmlsZTogc3JjL3BhbGV0dGUvY29tbW9uL3BhbGV0dGVTdXBlclV0aWxzL2dlbkh1ZXMuanNcblxuaW1wb3J0IHsgSFNMLCBQYWxldHRlQ29tbW9uX1N1cGVyVXRpbHNfR2VuSHVlcyB9IGZyb20gJy4uLy4uLy4uL2luZGV4L2luZGV4LmpzJztcbmltcG9ydCB7IGNvcmUsIHV0aWxzIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2luZGV4LmpzJztcbmltcG9ydCB7IGRhdGEgfSBmcm9tICcuLi8uLi8uLi9kYXRhL2luZGV4LmpzJztcbmltcG9ydCB7IGxvZyB9IGZyb20gJy4uLy4uLy4uL2NsYXNzZXMvbG9nZ2VyL2luZGV4LmpzJztcbmltcG9ydCB7IHBhbGV0dGVVdGlscyB9IGZyb20gJy4uL3BhbGV0dGVVdGlscy9pbmRleC5qcyc7XG5cbmNvbnN0IGxvZ01vZGUgPSBkYXRhLm1vZGUubG9nZ2luZztcbmNvbnN0IG1vZGUgPSBkYXRhLm1vZGU7XG5cbmNvbnN0IGdlbkFsbENvbG9yVmFsdWVzID0gdXRpbHMuY29udmVyc2lvbi5nZW5BbGxDb2xvclZhbHVlcztcbmNvbnN0IGdldFdlaWdodGVkUmFuZG9tSW50ZXJ2YWwgPVxuXHRwYWxldHRlVXRpbHMucHJvYmFiaWxpdHkuZ2V0V2VpZ2h0ZWRSYW5kb21JbnRlcnZhbDtcbmNvbnN0IHZhbGlkYXRlQ29sb3JWYWx1ZXMgPSBjb3JlLnZhbGlkYXRlLmNvbG9yVmFsdWVzO1xuXG5mdW5jdGlvbiBhbmFsb2dvdXMoY29sb3I6IEhTTCwgbnVtQm94ZXM6IG51bWJlcik6IG51bWJlcltdIHtcblx0dHJ5IHtcblx0XHRpZiAoIXZhbGlkYXRlQ29sb3JWYWx1ZXMoY29sb3IpKSB7XG5cdFx0XHRpZiAobG9nTW9kZS5lcnJvcnMpXG5cdFx0XHRcdGxvZy5lcnJvcihgSW52YWxpZCBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGNvbG9yKX1gKTtcblxuXHRcdFx0cmV0dXJuIFtdO1xuXHRcdH1cblxuXHRcdGNvbnN0IGNsb25lZENvbG9yID0gY29yZS5iYXNlLmNsb25lKGNvbG9yKSBhcyBIU0w7XG5cblx0XHRjb25zdCBhbmFsb2dvdXNIdWVzOiBudW1iZXJbXSA9IFtdO1xuXHRcdGNvbnN0IGJhc2VIdWUgPSBjbG9uZWRDb2xvci52YWx1ZS5odWU7XG5cdFx0Y29uc3QgbWF4VG90YWxEaXN0YW5jZSA9IDYwO1xuXHRcdGNvbnN0IG1pblRvdGFsRGlzdGFuY2UgPSBNYXRoLm1heCgyMCwgMTAgKyAobnVtQm94ZXMgLSAyKSAqIDEyKTtcblx0XHRjb25zdCB0b3RhbEluY3JlbWVudCA9XG5cdFx0XHRNYXRoLmZsb29yKFxuXHRcdFx0XHRNYXRoLnJhbmRvbSgpICogKG1heFRvdGFsRGlzdGFuY2UgLSBtaW5Ub3RhbERpc3RhbmNlICsgMSlcblx0XHRcdCkgKyBtaW5Ub3RhbERpc3RhbmNlO1xuXHRcdGNvbnN0IGluY3JlbWVudCA9IE1hdGguZmxvb3IodG90YWxJbmNyZW1lbnQgLyAobnVtQm94ZXMgLSAxKSk7XG5cblx0XHRmb3IgKGxldCBpID0gMTsgaSA8IG51bUJveGVzOyBpKyspIHtcblx0XHRcdGFuYWxvZ291c0h1ZXMucHVzaCgoYmFzZUh1ZSArIGluY3JlbWVudCAqIGkpICUgMzYwKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gYW5hbG9nb3VzSHVlcztcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcnMpXG5cdFx0XHRsb2cuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgYW5hbG9nb3VzIGh1ZXM6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gW107XG5cdH1cbn1cblxuZnVuY3Rpb24gZGlhZGljKGJhc2VIdWU6IG51bWJlcik6IG51bWJlcltdIHtcblx0dHJ5IHtcblx0XHRjb25zdCBjbG9uZWRCYXNlSHVlID0gY29yZS5iYXNlLmNsb25lKGJhc2VIdWUpO1xuXHRcdGNvbnN0IGRpYWRpY0h1ZXMgPSBbXTtcblx0XHRjb25zdCByYW5kb21EaXN0YW5jZSA9IGdldFdlaWdodGVkUmFuZG9tSW50ZXJ2YWwoKTtcblx0XHRjb25zdCBodWUxID0gY2xvbmVkQmFzZUh1ZTtcblx0XHRjb25zdCBodWUyID0gKGh1ZTEgKyByYW5kb21EaXN0YW5jZSkgJSAzNjA7XG5cblx0XHRkaWFkaWNIdWVzLnB1c2goaHVlMSwgaHVlMik7XG5cblx0XHRyZXR1cm4gZGlhZGljSHVlcztcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcnMpIGxvZy5lcnJvcihgRXJyb3IgZ2VuZXJhdGluZyBkaWFkaWMgaHVlczogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBbXTtcblx0fVxufVxuXG5mdW5jdGlvbiBoZXhhZGljKGNvbG9yOiBIU0wpOiBudW1iZXJbXSB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgY2xvbmVkQ29sb3IgPSBjb3JlLmJhc2UuY2xvbmUoY29sb3IpO1xuXG5cdFx0aWYgKCF2YWxpZGF0ZUNvbG9yVmFsdWVzKGNsb25lZENvbG9yKSkge1xuXHRcdFx0aWYgKGxvZ01vZGUuZXJyb3JzKVxuXHRcdFx0XHRsb2cuZXJyb3IoYEludmFsaWQgY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShjbG9uZWRDb2xvcil9YCk7XG5cblx0XHRcdHJldHVybiBbXTtcblx0XHR9XG5cblx0XHRjb25zdCBjbG9uZWRCYXNlSFNMID0gZ2VuQWxsQ29sb3JWYWx1ZXMoY2xvbmVkQ29sb3IpLmhzbCBhcyBIU0w7XG5cblx0XHRpZiAoIWNsb25lZEJhc2VIU0wpIHtcblx0XHRcdGlmICghbW9kZS5ncmFjZWZ1bEVycm9ycylcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRcdCdVbmFibGUgdG8gZ2VuZXJhdGUgaGV4YWRpYyBodWVzIC0gbWlzc2luZyBIU0wgdmFsdWVzJ1xuXHRcdFx0XHQpO1xuXHRcdFx0ZWxzZSBpZiAobG9nTW9kZS5lcnJvcnMpXG5cdFx0XHRcdGxvZy5lcnJvcihcblx0XHRcdFx0XHQnVW5hYmxlIHRvIGdlbmVyYXRlIGhleGFkaWMgaHVlcyAtIG1pc3NpbmcgSFNMIHZhbHVlcydcblx0XHRcdFx0KTtcblx0XHRcdGVsc2UgaWYgKCFtb2RlLnF1aWV0ICYmIGxvZ01vZGUudmVyYm9zaXR5ID4gMClcblx0XHRcdFx0bG9nLmVycm9yKCdFcnJvciBnZW5lcmF0aW5nIGhleGFkaWMgaHVlcycpO1xuXG5cdFx0XHRyZXR1cm4gW107XG5cdFx0fVxuXG5cdFx0Y29uc3QgaGV4YWRpY0h1ZXM6IG51bWJlcltdID0gW107XG5cdFx0Y29uc3QgYmFzZUh1ZSA9IGNsb25lZEJhc2VIU0wudmFsdWUuaHVlO1xuXHRcdGNvbnN0IGh1ZTEgPSBiYXNlSHVlO1xuXHRcdGNvbnN0IGh1ZTIgPSAoaHVlMSArIDE4MCkgJSAzNjA7XG5cdFx0Y29uc3QgcmFuZG9tRGlzdGFuY2UgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2MSArIDMwKTtcblx0XHRjb25zdCBodWUzID0gKGh1ZTEgKyByYW5kb21EaXN0YW5jZSkgJSAzNjA7XG5cdFx0Y29uc3QgaHVlNCA9IChodWUzICsgMTgwKSAlIDM2MDtcblx0XHRjb25zdCBodWU1ID0gKGh1ZTEgKyAzNjAgLSByYW5kb21EaXN0YW5jZSkgJSAzNjA7XG5cdFx0Y29uc3QgaHVlNiA9IChodWU1ICsgMTgwKSAlIDM2MDtcblxuXHRcdGhleGFkaWNIdWVzLnB1c2goaHVlMSwgaHVlMiwgaHVlMywgaHVlNCwgaHVlNSwgaHVlNik7XG5cblx0XHRyZXR1cm4gaGV4YWRpY0h1ZXM7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3JzKVxuXHRcdFx0bG9nLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIGhleGFkaWMgaHVlczogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBbXTtcblx0fVxufVxuXG5mdW5jdGlvbiBzcGxpdENvbXBsZW1lbnRhcnkoYmFzZUh1ZTogbnVtYmVyKTogbnVtYmVyW10ge1xuXHR0cnkge1xuXHRcdGNvbnN0IGNsb25lZEJhc2VIdWUgPSBjb3JlLmJhc2UuY2xvbmUoYmFzZUh1ZSk7XG5cdFx0Y29uc3QgbW9kaWZpZXIgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMSkgKyAyMDtcblxuXHRcdHJldHVybiBbXG5cdFx0XHQoY2xvbmVkQmFzZUh1ZSArIDE4MCArIG1vZGlmaWVyKSAlIDM2MCxcblx0XHRcdChjbG9uZWRCYXNlSHVlICsgMTgwIC0gbW9kaWZpZXIgKyAzNjApICUgMzYwXG5cdFx0XTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcnMpXG5cdFx0XHRsb2cuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgc3BsaXQgY29tcGxlbWVudGFyeSBodWVzOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIFtdO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHRldHJhZGljKGJhc2VIdWU6IG51bWJlcik6IG51bWJlcltdIHtcblx0dHJ5IHtcblx0XHRjb25zdCBjbG9uZWRCYXNlSHVlID0gY29yZS5iYXNlLmNsb25lKGJhc2VIdWUpO1xuXHRcdGNvbnN0IHJhbmRvbU9mZnNldCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDQ2KSArIDIwO1xuXHRcdGNvbnN0IGRpc3RhbmNlID1cblx0XHRcdDkwICsgKE1hdGgucmFuZG9tKCkgPCAwLjUgPyAtcmFuZG9tT2Zmc2V0IDogcmFuZG9tT2Zmc2V0KTtcblxuXHRcdHJldHVybiBbXG5cdFx0XHRjbG9uZWRCYXNlSHVlLFxuXHRcdFx0KGNsb25lZEJhc2VIdWUgKyAxODApICUgMzYwLFxuXHRcdFx0KGNsb25lZEJhc2VIdWUgKyBkaXN0YW5jZSkgJSAzNjAsXG5cdFx0XHQoY2xvbmVkQmFzZUh1ZSArIGRpc3RhbmNlICsgMTgwKSAlIDM2MFxuXHRcdF07XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ01vZGUuZXJyb3JzKVxuXHRcdFx0bG9nLmVycm9yKGBFcnJvciBnZW5lcmF0aW5nIHRldHJhZGljIGh1ZXM6ICR7ZXJyb3J9YCk7XG5cblx0XHRyZXR1cm4gW107XG5cdH1cbn1cblxuZnVuY3Rpb24gdHJpYWRpYyhiYXNlSHVlOiBudW1iZXIpOiBudW1iZXJbXSB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgY2xvbmVkQmFzZUh1ZSA9IGNvcmUuYmFzZS5jbG9uZShiYXNlSHVlKTtcblxuXHRcdHJldHVybiBbMTIwLCAyNDBdLm1hcChpbmNyZW1lbnQgPT4gKGNsb25lZEJhc2VIdWUgKyBpbmNyZW1lbnQpICUgMzYwKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nTW9kZS5lcnJvcnMpXG5cdFx0XHRsb2cuZXJyb3IoYEVycm9yIGdlbmVyYXRpbmcgdHJpYWRpYyBodWVzOiAke2Vycm9yfWApO1xuXG5cdFx0cmV0dXJuIFtdO1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCBnZW5IdWVzOiBQYWxldHRlQ29tbW9uX1N1cGVyVXRpbHNfR2VuSHVlcyA9IHtcblx0YW5hbG9nb3VzLFxuXHRkaWFkaWMsXG5cdGhleGFkaWMsXG5cdHNwbGl0Q29tcGxlbWVudGFyeSxcblx0dGV0cmFkaWMsXG5cdHRyaWFkaWNcbn0gYXMgY29uc3Q7XG4iXX0=