// File: src/palette/common/paletteSuperUtils/create.js
import { convert, core, utils } from '../../../common/index.js';
import { idbInstance } from '../../../idb/index.js';
import { paletteHelpers } from '../paletteHelpers/index.js';
const limits = paletteHelpers.limits;
const update = paletteHelpers.update;
const hslTo = convert.hslTo;
function baseColor(customColor, enableAlpha) {
    const color = core.base.clone(customColor ?? utils.random.hsl(enableAlpha));
    return color;
}
async function paletteItem(color, enableAlpha) {
    const clonedColor = core.base.clone(color);
    const nextPaletteID = await idbInstance.getNextPaletteID();
    clonedColor.value.alpha = enableAlpha
        ? core.brand.asAlphaRange(Math.random())
        : core.brand.asAlphaRange(1);
    return {
        id: `${color.format}_${nextPaletteID}`,
        colors: {
            cmyk: hslTo(clonedColor, 'cmyk').value,
            hex: hslTo(clonedColor, 'hex').value,
            hsl: clonedColor.value,
            hsv: hslTo(clonedColor, 'hsv').value,
            lab: hslTo(clonedColor, 'lab').value,
            rgb: hslTo(clonedColor, 'rgb').value,
            xyz: hslTo(clonedColor, 'xyz').value
        },
        colorStrings: {
            cmykString: utils.color.colorToColorString(hslTo(clonedColor, 'cmyk')).value,
            hexString: utils.color.colorToColorString(hslTo(clonedColor, 'hex')).value,
            hslString: utils.color.colorToColorString(clonedColor).value,
            hsvString: utils.color.colorToColorString(hslTo(clonedColor, 'hsv')).value,
            labString: utils.color.colorToColorString(hslTo(clonedColor, 'lab')).value,
            rgbString: utils.color.colorToColorString(hslTo(clonedColor, 'rgb')).value,
            xyzString: utils.color.colorToColorString(hslTo(clonedColor, 'xyz')).value
        },
        cssStrings: {
            cmykCSSString: core.convert.toCSSColorString(hslTo(clonedColor, 'cmyk')),
            hexCSSString: core.convert.toCSSColorString(hslTo(clonedColor, 'hex')),
            hslCSSString: core.convert.toCSSColorString(clonedColor),
            hsvCSSString: core.convert.toCSSColorString(hslTo(clonedColor, 'hsv')),
            labCSSString: core.convert.toCSSColorString(hslTo(clonedColor, 'lab')),
            rgbCSSString: core.convert.toCSSColorString(hslTo(clonedColor, 'rgb')),
            xyzCSSString: core.convert.toCSSColorString(hslTo(clonedColor, 'xyz'))
        }
    };
}
async function paletteItemArray(baseColor, hues, enableAlpha, limitDark, limitGray, limitLight) {
    const paletteItems = [
        await paletteItem(baseColor, enableAlpha)
    ];
    for (const [i, hue] of hues.entries()) {
        let newColor = null;
        do {
            const sl = utils.random.sl(enableAlpha);
            newColor = utils.conversion.genAllColorValues({
                value: {
                    hue: core.brand.asRadial(hue),
                    ...sl.value
                },
                format: 'hsl'
            }).hsl;
        } while (newColor &&
            ((limitGray && limits.isTooGray(newColor)) ||
                (limitDark && limits.isTooDark(newColor)) ||
                (limitLight && limits.isTooLight(newColor))));
        if (newColor) {
            const newPaletteItem = await paletteItem(newColor, enableAlpha);
            paletteItems.push(newPaletteItem);
            update.colorBox(newColor, i + 1);
        }
    }
    return paletteItems;
}
export const create = {
    baseColor,
    paletteItem,
    paletteItemArray
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL3BhbGV0dGUvY29tbW9uL3BhbGV0dGVTdXBlclV0aWxzL2NyZWF0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx1REFBdUQ7QUFxQnZELE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFFNUQsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLE1BQU0sQ0FBQztBQUNyQyxNQUFNLE1BQU0sR0FBRyxjQUFjLENBQUMsTUFBTSxDQUFDO0FBRXJDLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7QUFFNUIsU0FBUyxTQUFTLENBQUMsV0FBdUIsRUFBRSxXQUFvQjtJQUMvRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUU1RSxPQUFPLEtBQVksQ0FBQztBQUNyQixDQUFDO0FBRUQsS0FBSyxVQUFVLFdBQVcsQ0FDekIsS0FBVSxFQUNWLFdBQW9CO0lBRXBCLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBUSxDQUFDO0lBQ2xELE1BQU0sYUFBYSxHQUFHLE1BQU0sV0FBVyxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFFM0QsV0FBVyxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsV0FBVztRQUNwQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3hDLENBQUMsQ0FB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QUFDO0lBQ0YsQ0FBQztJQUVELE9BQU8sWUFBWSxDQUFDO0FBQ3JCLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQW9DO0lBQ3RELFNBQVM7SUFDVCxXQUFXO0lBQ1gsZ0JBQWdCO0NBQ1AsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEZpbGU6IHNyYy9wYWxldHRlL2NvbW1vbi9wYWxldHRlU3VwZXJVdGlscy9jcmVhdGUuanNcblxuaW1wb3J0IHtcblx0Q01ZSyxcblx0Q01ZS1N0cmluZyxcblx0SGV4LFxuXHRIZXhTdHJpbmcsXG5cdEhTTCxcblx0SFNMU3RyaW5nLFxuXHRIU1YsXG5cdEhTVlN0cmluZyxcblx0TEFCLFxuXHRMQUJTdHJpbmcsXG5cdFBhbGV0dGVDb21tb25fU3VwZXJVdGlsc19DcmVhdGUsXG5cdFBhbGV0dGVJdGVtLFxuXHRSR0IsXG5cdFJHQlN0cmluZyxcblx0U0wsXG5cdFhZWixcblx0WFlaU3RyaW5nXG59IGZyb20gJy4uLy4uLy4uL2luZGV4L2luZGV4LmpzJztcbmltcG9ydCB7IGNvbnZlcnQsIGNvcmUsIHV0aWxzIH0gZnJvbSAnLi4vLi4vLi4vY29tbW9uL2luZGV4LmpzJztcbmltcG9ydCB7IGlkYkluc3RhbmNlIH0gZnJvbSAnLi4vLi4vLi4vaWRiL2luZGV4LmpzJztcbmltcG9ydCB7IHBhbGV0dGVIZWxwZXJzIH0gZnJvbSAnLi4vcGFsZXR0ZUhlbHBlcnMvaW5kZXguanMnO1xuXG5jb25zdCBsaW1pdHMgPSBwYWxldHRlSGVscGVycy5saW1pdHM7XG5jb25zdCB1cGRhdGUgPSBwYWxldHRlSGVscGVycy51cGRhdGU7XG5cbmNvbnN0IGhzbFRvID0gY29udmVydC5oc2xUbztcblxuZnVuY3Rpb24gYmFzZUNvbG9yKGN1c3RvbUNvbG9yOiBIU0wgfCBudWxsLCBlbmFibGVBbHBoYTogYm9vbGVhbik6IEhTTCB7XG5cdGNvbnN0IGNvbG9yID0gY29yZS5iYXNlLmNsb25lKGN1c3RvbUNvbG9yID8/IHV0aWxzLnJhbmRvbS5oc2woZW5hYmxlQWxwaGEpKTtcblxuXHRyZXR1cm4gY29sb3IgYXMgSFNMO1xufVxuXG5hc3luYyBmdW5jdGlvbiBwYWxldHRlSXRlbShcblx0Y29sb3I6IEhTTCxcblx0ZW5hYmxlQWxwaGE6IGJvb2xlYW5cbik6IFByb21pc2U8UGFsZXR0ZUl0ZW0+IHtcblx0Y29uc3QgY2xvbmVkQ29sb3IgPSBjb3JlLmJhc2UuY2xvbmUoY29sb3IpIGFzIEhTTDtcblx0Y29uc3QgbmV4dFBhbGV0dGVJRCA9IGF3YWl0IGlkYkluc3RhbmNlLmdldE5leHRQYWxldHRlSUQoKTtcblxuXHRjbG9uZWRDb2xvci52YWx1ZS5hbHBoYSA9IGVuYWJsZUFscGhhXG5cdFx0PyBjb3JlLmJyYW5kLmFzQWxwaGFSYW5nZShNYXRoLnJhbmRvbSgpKVxuXHRcdDogY29yZS5icmFuZC5hc0FscGhhUmFuZ2UoMSk7XG5cblx0cmV0dXJuIHtcblx0XHRpZDogYCR7Y29sb3IuZm9ybWF0fV8ke25leHRQYWxldHRlSUR9YCxcblx0XHRjb2xvcnM6IHtcblx0XHRcdGNteWs6IChoc2xUbyhjbG9uZWRDb2xvciwgJ2NteWsnKSBhcyBDTVlLKS52YWx1ZSxcblx0XHRcdGhleDogKGhzbFRvKGNsb25lZENvbG9yLCAnaGV4JykgYXMgSGV4KS52YWx1ZSxcblx0XHRcdGhzbDogY2xvbmVkQ29sb3IudmFsdWUsXG5cdFx0XHRoc3Y6IChoc2xUbyhjbG9uZWRDb2xvciwgJ2hzdicpIGFzIEhTVikudmFsdWUsXG5cdFx0XHRsYWI6IChoc2xUbyhjbG9uZWRDb2xvciwgJ2xhYicpIGFzIExBQikudmFsdWUsXG5cdFx0XHRyZ2I6IChoc2xUbyhjbG9uZWRDb2xvciwgJ3JnYicpIGFzIFJHQikudmFsdWUsXG5cdFx0XHR4eXo6IChoc2xUbyhjbG9uZWRDb2xvciwgJ3h5eicpIGFzIFhZWikudmFsdWVcblx0XHR9LFxuXHRcdGNvbG9yU3RyaW5nczoge1xuXHRcdFx0Y215a1N0cmluZzogKFxuXHRcdFx0XHR1dGlscy5jb2xvci5jb2xvclRvQ29sb3JTdHJpbmcoXG5cdFx0XHRcdFx0aHNsVG8oY2xvbmVkQ29sb3IsICdjbXlrJylcblx0XHRcdFx0KSBhcyBDTVlLU3RyaW5nXG5cdFx0XHQpLnZhbHVlLFxuXHRcdFx0aGV4U3RyaW5nOiAoXG5cdFx0XHRcdHV0aWxzLmNvbG9yLmNvbG9yVG9Db2xvclN0cmluZyhcblx0XHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ2hleCcpXG5cdFx0XHRcdCkgYXMgSGV4U3RyaW5nXG5cdFx0XHQpLnZhbHVlLFxuXHRcdFx0aHNsU3RyaW5nOiAoXG5cdFx0XHRcdHV0aWxzLmNvbG9yLmNvbG9yVG9Db2xvclN0cmluZyhjbG9uZWRDb2xvcikgYXMgSFNMU3RyaW5nXG5cdFx0XHQpLnZhbHVlLFxuXHRcdFx0aHN2U3RyaW5nOiAoXG5cdFx0XHRcdHV0aWxzLmNvbG9yLmNvbG9yVG9Db2xvclN0cmluZyhcblx0XHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ2hzdicpXG5cdFx0XHRcdCkgYXMgSFNWU3RyaW5nXG5cdFx0XHQpLnZhbHVlLFxuXHRcdFx0bGFiU3RyaW5nOiAoXG5cdFx0XHRcdHV0aWxzLmNvbG9yLmNvbG9yVG9Db2xvclN0cmluZyhcblx0XHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ2xhYicpXG5cdFx0XHRcdCkgYXMgTEFCU3RyaW5nXG5cdFx0XHQpLnZhbHVlLFxuXHRcdFx0cmdiU3RyaW5nOiAoXG5cdFx0XHRcdHV0aWxzLmNvbG9yLmNvbG9yVG9Db2xvclN0cmluZyhcblx0XHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ3JnYicpXG5cdFx0XHRcdCkgYXMgUkdCU3RyaW5nXG5cdFx0XHQpLnZhbHVlLFxuXHRcdFx0eHl6U3RyaW5nOiAoXG5cdFx0XHRcdHV0aWxzLmNvbG9yLmNvbG9yVG9Db2xvclN0cmluZyhcblx0XHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ3h5eicpXG5cdFx0XHRcdCkgYXMgWFlaU3RyaW5nXG5cdFx0XHQpLnZhbHVlXG5cdFx0fSxcblx0XHRjc3NTdHJpbmdzOiB7XG5cdFx0XHRjbXlrQ1NTU3RyaW5nOiBjb3JlLmNvbnZlcnQudG9DU1NDb2xvclN0cmluZyhcblx0XHRcdFx0aHNsVG8oY2xvbmVkQ29sb3IsICdjbXlrJylcblx0XHRcdCksXG5cdFx0XHRoZXhDU1NTdHJpbmc6IGNvcmUuY29udmVydC50b0NTU0NvbG9yU3RyaW5nKFxuXHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ2hleCcpXG5cdFx0XHQpLFxuXHRcdFx0aHNsQ1NTU3RyaW5nOiBjb3JlLmNvbnZlcnQudG9DU1NDb2xvclN0cmluZyhjbG9uZWRDb2xvciksXG5cdFx0XHRoc3ZDU1NTdHJpbmc6IGNvcmUuY29udmVydC50b0NTU0NvbG9yU3RyaW5nKFxuXHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ2hzdicpXG5cdFx0XHQpLFxuXHRcdFx0bGFiQ1NTU3RyaW5nOiBjb3JlLmNvbnZlcnQudG9DU1NDb2xvclN0cmluZyhcblx0XHRcdFx0aHNsVG8oY2xvbmVkQ29sb3IsICdsYWInKVxuXHRcdFx0KSxcblx0XHRcdHJnYkNTU1N0cmluZzogY29yZS5jb252ZXJ0LnRvQ1NTQ29sb3JTdHJpbmcoXG5cdFx0XHRcdGhzbFRvKGNsb25lZENvbG9yLCAncmdiJylcblx0XHRcdCksXG5cdFx0XHR4eXpDU1NTdHJpbmc6IGNvcmUuY29udmVydC50b0NTU0NvbG9yU3RyaW5nKFxuXHRcdFx0XHRoc2xUbyhjbG9uZWRDb2xvciwgJ3h5eicpXG5cdFx0XHQpXG5cdFx0fVxuXHR9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBwYWxldHRlSXRlbUFycmF5KFxuXHRiYXNlQ29sb3I6IEhTTCxcblx0aHVlczogbnVtYmVyW10sXG5cdGVuYWJsZUFscGhhOiBib29sZWFuLFxuXHRsaW1pdERhcms6IGJvb2xlYW4sXG5cdGxpbWl0R3JheTogYm9vbGVhbixcblx0bGltaXRMaWdodDogYm9vbGVhblxuKTogUHJvbWlzZTxQYWxldHRlSXRlbVtdPiB7XG5cdGNvbnN0IHBhbGV0dGVJdGVtczogUGFsZXR0ZUl0ZW1bXSA9IFtcblx0XHRhd2FpdCBwYWxldHRlSXRlbShiYXNlQ29sb3IsIGVuYWJsZUFscGhhKVxuXHRdO1xuXG5cdGZvciAoY29uc3QgW2ksIGh1ZV0gb2YgaHVlcy5lbnRyaWVzKCkpIHtcblx0XHRsZXQgbmV3Q29sb3I6IEhTTCB8IG51bGwgPSBudWxsO1xuXG5cdFx0ZG8ge1xuXHRcdFx0Y29uc3Qgc2wgPSB1dGlscy5yYW5kb20uc2woZW5hYmxlQWxwaGEpIGFzIFNMO1xuXG5cdFx0XHRuZXdDb2xvciA9IHV0aWxzLmNvbnZlcnNpb24uZ2VuQWxsQ29sb3JWYWx1ZXMoe1xuXHRcdFx0XHR2YWx1ZToge1xuXHRcdFx0XHRcdGh1ZTogY29yZS5icmFuZC5hc1JhZGlhbChodWUpLFxuXHRcdFx0XHRcdC4uLnNsLnZhbHVlXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGZvcm1hdDogJ2hzbCdcblx0XHRcdH0pLmhzbCBhcyBIU0w7XG5cdFx0fSB3aGlsZSAoXG5cdFx0XHRuZXdDb2xvciAmJlxuXHRcdFx0KChsaW1pdEdyYXkgJiYgbGltaXRzLmlzVG9vR3JheShuZXdDb2xvcikpIHx8XG5cdFx0XHRcdChsaW1pdERhcmsgJiYgbGltaXRzLmlzVG9vRGFyayhuZXdDb2xvcikpIHx8XG5cdFx0XHRcdChsaW1pdExpZ2h0ICYmIGxpbWl0cy5pc1Rvb0xpZ2h0KG5ld0NvbG9yKSkpXG5cdFx0KTtcblxuXHRcdGlmIChuZXdDb2xvcikge1xuXHRcdFx0Y29uc3QgbmV3UGFsZXR0ZUl0ZW0gPSBhd2FpdCBwYWxldHRlSXRlbShuZXdDb2xvciwgZW5hYmxlQWxwaGEpO1xuXG5cdFx0XHRwYWxldHRlSXRlbXMucHVzaChuZXdQYWxldHRlSXRlbSk7XG5cblx0XHRcdHVwZGF0ZS5jb2xvckJveChuZXdDb2xvciwgaSArIDEpO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBwYWxldHRlSXRlbXM7XG59XG5cbmV4cG9ydCBjb25zdCBjcmVhdGU6IFBhbGV0dGVDb21tb25fU3VwZXJVdGlsc19DcmVhdGUgPSB7XG5cdGJhc2VDb2xvcixcblx0cGFsZXR0ZUl0ZW0sXG5cdHBhbGV0dGVJdGVtQXJyYXlcbn0gYXMgY29uc3Q7XG4iXX0=