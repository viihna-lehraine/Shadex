// File: src/io/deserialize.ts
import { common } from '../common/index.js';
import { data } from '../data/index.js';
import { log as logger } from '../classes/logger/factory.js';
import { parse } from './parse/index.js';
const logMode = data.mode.logging;
const parseColorString = parse.data.asColorString;
const convertToColorString = common.utils.color.colorToColorString;
const convertToCSSColorString = common.core.convert.toCSSColorString;
async function fromCSS(data) {
    try {
        // 1: asynchronously extract Palette ID from the CSS file header
        const id = (await parse.css.header(data)) ?? 'ERROR_(PALETTE_ID)';
        // 2: parse palette items asynchronously from the CSS file
        const items = await parse.css.paletteItems(data);
        // 3: parse settings asynchronously from the CSS file
        const settings = (await parse.css.settings(data)) ?? {
            enableAlpha: false,
            limitDarkness: false,
            limitGrayness: false,
            limitLightness: false
        };
        // 4: return the deserialized palette object
        return {
            id,
            items,
            flags: {
                enableAlpha: settings.enableAlpha,
                limitDarkness: settings.limitDarkness,
                limitGrayness: settings.limitGrayness,
                limitLightness: settings.limitLightness
            },
            metadata: {
                numBoxes: items.length, // Total number of parsed PaletteItems
                paletteType: 'random', // *DEV-NOTE* write a way to parse from file
                timestamp: Date.now() // *DEV-NOTE* write a way to parse from file
            }
        };
    }
    catch (error) {
        // handle parsing errors or unexpected failures
        console.error('Error in fromCSS:', error);
        throw new Error('Failed to deserialize CSS Palette.');
    }
}
async function fromJSON(data) {
    // *DEV-NOTE* revisit THE FUCK out of this
    try {
        const parsed = JSON.parse(data);
        if (!parsed.items || !Array.isArray(parsed.items)) {
            throw new Error('Invalid JSON format: Missing or invalid `items` property.');
        }
        return parsed;
    }
    catch (error) {
        if (error instanceof Error) {
            if (logMode.errors)
                logger.error(`Failed to deserialize JSON: ${error.message}`);
            throw new Error('Failed to deserialize palette from JSPM file');
        }
        else {
            if (logMode.errors)
                logger.error(`Failed to deserialize JSON: ${error}`);
            throw new Error('Failed to deserialize palette from JSPM file');
        }
    }
}
async function fromXML(data) {
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(data, 'application/xml');
    const parseError = xmlDoc.querySelector('parsererror');
    if (parseError) {
        throw new Error(`Invalid XML format: ${parseError.textContent}`);
    }
    const paletteElement = xmlDoc.querySelector('Palette');
    if (!paletteElement) {
        throw new Error('Missing <Palette> root element.');
    }
    const rawID = paletteElement.getAttribute('id') || 'ERROR_(PALETTE_ID)';
    const enableAlpha = paletteElement.querySelector('EnableAlpha')?.textContent === 'true';
    const limitDarkness = paletteElement.querySelector('LimitDarkness')?.textContent === 'true';
    const limitGrayness = paletteElement.querySelector('LimitGrayness')?.textContent === 'true';
    const limitLightness = paletteElement.querySelector('LimitLightness')?.textContent === 'true';
    const numBoxes = parseInt(paletteElement.querySelector('NumBoxes')?.textContent || '0', 10);
    const paletteType = paletteElement.querySelector('PaletteType')
        ?.textContent || 'ERROR';
    const rawHSLColor = paletteElement.querySelector('HSLColor')?.textContent;
    const hslColor = rawHSLColor
        ? parseColorString('hsl', rawHSLColor)
        : null;
    const rawConvertedColors = paletteElement.querySelector('ConvertedColors')?.textContent;
    const convertedColors = rawConvertedColors && rawConvertedColors.trim()
        ? JSON.parse(rawConvertedColors)
        : null;
    const customColor = {
        hslColor,
        convertedColors
    };
    const timestamp = parseInt(paletteElement.querySelector('Timestamp')?.textContent ||
        `${Date.now()}`);
    const rawColors = {
        cmyk: paletteElement.querySelector('CMYK')?.textContent,
        hex: paletteElement.querySelector('Hex')?.textContent,
        hsl: paletteElement.querySelector('HSL')?.textContent,
        hsv: paletteElement.querySelector('HSV')?.textContent,
        lab: paletteElement.querySelector('LAB')?.textContent,
        rgb: paletteElement.querySelector('RGB')?.textContent,
        xyz: paletteElement.querySelector('XYZ')?.textContent
    };
    if (rawColors.cmyk !== '' ||
        rawColors.hex !== '' ||
        rawColors.hsl !== '' ||
        rawColors.hsv !== '' ||
        rawColors.lab !== '' ||
        rawColors.rgb !== '' ||
        rawColors.xyz !== '') {
        if (logMode.errors) {
            logger.error('Palette deserialization error: Found unexpected color values.');
        }
        throw new Error('Unexpected color values found in Palette.');
    }
    const cmyk = parseColorString('cmyk', rawColors.cmyk);
    const cmykColorString = convertToColorString(cmyk);
    const cmykCSSString = convertToCSSColorString(cmyk);
    const hex = parseColorString('hex', rawColors.hex);
    const hexColortring = convertToColorString(hex);
    const hexCSSString = convertToCSSColorString(hex);
    const hsl = parseColorString('hsl', rawColors.hsl);
    const hslColorString = convertToColorString(hsl);
    const hslCSSString = convertToCSSColorString(hsl);
    const hsv = parseColorString('hsv', rawColors.hsv);
    const hsvColorString = convertToColorString(hsv);
    const hsvCSSString = convertToCSSColorString(hsv);
    const lab = parseColorString('lab', rawColors.lab);
    const labColorString = convertToColorString(lab);
    const labCSSString = convertToCSSColorString(lab);
    const rgb = parseColorString('rgb', rawColors.rgb);
    const rgbColorString = convertToColorString(rgb);
    const rgbCSSString = convertToCSSColorString(rgb);
    const xyz = parseColorString('xyz', rawColors.xyz);
    const xyzColorString = convertToColorString(xyz);
    const xyzCSSString = convertToCSSColorString(xyz);
    const items = Array.from(paletteElement.querySelectorAll('PaletteItem')).map(item => {
        const id = item.getAttribute('id') || '';
        const colors = {
            cmyk: cmyk.value,
            hex: hex.value,
            hsl: hsl.value,
            hsv: hsv.value,
            lab: lab.value,
            rgb: rgb.value,
            xyz: xyz.value
        };
        const colorStrings = {
            cmykString: cmykColorString.value,
            hexString: hexColortring.value,
            hslString: hslColorString.value,
            hsvString: hsvColorString.value,
            labString: labColorString.value,
            rgbString: rgbColorString.value,
            xyzString: xyzColorString.value
        };
        const cssStrings = {
            cmykCSSString,
            hexCSSString,
            hslCSSString,
            hsvCSSString,
            labCSSString,
            rgbCSSString,
            xyzCSSString
        };
        return { id, colors, colorStrings, cssStrings };
    });
    return {
        id: rawID,
        items,
        flags: { enableAlpha, limitDarkness, limitGrayness, limitLightness },
        metadata: { numBoxes, paletteType, customColor, timestamp }
    };
}
export const deserialize = {
    fromCSS,
    fromJSON,
    fromXML
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVzZXJpYWxpemUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvaW8vZGVzZXJpYWxpemUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOEJBQThCO0FBNkI5QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDNUMsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBQ3hDLE9BQU8sRUFBRSxHQUFHLElBQUksTUFBTSxFQUFFLE1BQU0sOEJBQThCLENBQUM7QUFDN0QsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLGtCQUFrQixDQUFDO0FBRXpDLE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO0FBRWxDLE1BQU0sZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUM7QUFFbEQsTUFBTSxvQkFBb0IsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztBQUNuRSxNQUFNLHVCQUF1QixHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDO0FBRXJFLEtBQUssVUFBVSxPQUFPLENBQUMsSUFBWTtJQUNsQyxJQUFJLENBQUM7UUFDSixnRUFBZ0U7UUFDaEUsTUFBTSxFQUFFLEdBQ1AsQ0FBQyxNQUFNLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUssb0JBQStCLENBQUM7UUFFcEUsMERBQTBEO1FBQzFELE1BQU0sS0FBSyxHQUFHLE1BQU0sS0FBSyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFakQscURBQXFEO1FBQ3JELE1BQU0sUUFBUSxHQUFHLENBQUMsTUFBTSxLQUFLLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJO1lBQ3BELFdBQVcsRUFBRSxLQUFL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LE1BQU0sVUFBVSxHQUFHO1lBQ2xCLGFBQWE7WUFDYixZQUFZO1lBQ1osWUFBWTtZQUNaLFlBQVk7WUFDWixZQUFZO1lBQ1osWUFBWTtZQUNaLFlBQVk7U0FDWixDQUFDO1FBRUYsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFVBQVUsRUFBRSxDQUFDO0lBQ2pELENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTztRQUNOLEVBQUUsRUFBRSxLQUFLO1FBQ1QsS0FBSztRQUNMLEtBQUssRUFBRSxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsYUFBYSxFQUFFLGNBQWMsRUFBRTtRQUNwRSxRQUFRLEVBQUUsRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxTQUFTLEVBQUU7S0FDaEQsQ0FBQztBQUNkLENBQUM7QUFFRCxNQUFNLENBQUMsTUFBTSxXQUFXLEdBQStCO0lBQ3RELE9BQU87SUFDUCxRQUFRO0lBQ1IsT0FBTztDQUNQLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBzcmMvaW8vZGVzZXJpYWxpemUudHNcblxuaW1wb3J0IHtcblx0Q01ZSyxcblx0Q01ZS1ZhbHVlLFxuXHRDTVlLVmFsdWVTdHJpbmcsXG5cdEhleCxcblx0SGV4VmFsdWUsXG5cdEhleFZhbHVlU3RyaW5nLFxuXHRIU0wsXG5cdEhTTFZhbHVlLFxuXHRIU0xWYWx1ZVN0cmluZyxcblx0SFNWLFxuXHRIU1ZWYWx1ZSxcblx0SFNWVmFsdWVTdHJpbmcsXG5cdElPX0ZuX0Rlc2VyaWFsaXplSW50ZXJmYWNlLFxuXHRMQUIsXG5cdExBQlZhbHVlLFxuXHRMQUJWYWx1ZVN0cmluZyxcblx0UGFsZXR0ZSxcblx0UGFsZXR0ZUl0ZW0sXG5cdFBhbGV0dGVUeXBlLFxuXHRSR0IsXG5cdFJHQlZhbHVlLFxuXHRSR0JWYWx1ZVN0cmluZyxcblx0WFlaLFxuXHRYWVpWYWx1ZSxcblx0WFlaVmFsdWVTdHJpbmdcbn0gZnJvbSAnLi4vaW5kZXgvaW5kZXguanMnO1xuaW1wb3J0IHsgY29tbW9uIH0gZnJvbSAnLi4vY29tbW9uL2luZGV4LmpzJztcbmltcG9ydCB7IGRhdGEgfSBmcm9tICcuLi9kYXRhL2luZGV4LmpzJztcbmltcG9ydCB7IGxvZyBhcyBsb2dnZXIgfSBmcm9tICcuLi9jbGFzc2VzL2xvZ2dlci9mYWN0b3J5LmpzJztcbmltcG9ydCB7IHBhcnNlIH0gZnJvbSAnLi9wYXJzZS9pbmRleC5qcyc7XG5cbmNvbnN0IGxvZ01vZGUgPSBkYXRhLm1vZGUubG9nZ2luZztcblxuY29uc3QgcGFyc2VDb2xvclN0cmluZyA9IHBhcnNlLmRhdGEuYXNDb2xvclN0cmluZztcblxuY29uc3QgY29udmVydFRvQ29sb3JTdHJpbmcgPSBjb21tb24udXRpbHMuY29sb3IuY29sb3JUb0NvbG9yU3RyaW5nO1xuY29uc3QgY29udmVydFRvQ1NTQ29sb3JTdHJpbmcgPSBjb21tb24uY29yZS5jb252ZXJ0LnRvQ1NTQ29sb3JTdHJpbmc7XG5cbmFzeW5jIGZ1bmN0aW9uIGZyb21DU1MoZGF0YTogc3RyaW5nKTogUHJvbWlzZTxQYWxldHRlPiB7XG5cdHRyeSB7XG5cdFx0Ly8gMTogYXN5bmNocm9ub3VzbHkgZXh0cmFjdCBQYWxldHRlIElEIGZyb20gdGhlIENTUyBmaWxlIGhlYWRlclxuXHRcdGNvbnN0IGlkID1cblx0XHRcdChhd2FpdCBwYXJzZS5jc3MuaGVhZGVyKGRhdGEpKSA/PyAoJ0VSUk9SXyhQQUxFVFRFX0lEKScgYXMgc3RyaW5nKTtcblxuXHRcdC8vIDI6IHBhcnNlIHBhbGV0dGUgaXRlbXMgYXN5bmNocm9ub3VzbHkgZnJvbSB0aGUgQ1NTIGZpbGVcblx0XHRjb25zdCBpdGVtcyA9IGF3YWl0IHBhcnNlLmNzcy5wYWxldHRlSXRlbXMoZGF0YSk7XG5cblx0XHQvLyAzOiBwYXJzZSBzZXR0aW5ncyBhc3luY2hyb25vdXNseSBmcm9tIHRoZSBDU1MgZmlsZVxuXHRcdGNvbnN0IHNldHRpbmdzID0gKGF3YWl0IHBhcnNlLmNzcy5zZXR0aW5ncyhkYXRhKSkgPz8ge1xuXHRcdFx0ZW5hYmxlQWxwaGE6IGZhbHNlLFxuXHRcdFx0bGltaXREYXJrbmVzczogZmFsc2UsXG5cdFx0XHRsaW1pdEdyYXluZXNzOiBmYWxzZSxcblx0XHRcdGxpbWl0TGlnaHRuZXNzOiBmYWxzZVxuXHRcdH07XG5cblx0XHQvLyA0OiByZXR1cm4gdGhlIGRlc2VyaWFsaXplZCBwYWxldHRlIG9iamVjdFxuXHRcdHJldHVybiB7XG5cdFx0XHRpZCxcblx0XHRcdGl0ZW1zLFxuXHRcdFx0ZmxhZ3M6IHtcblx0XHRcdFx0ZW5hYmxlQWxwaGE6IHNldHRpbmdzLmVuYWJsZUFscGhhLFxuXHRcdFx0XHRsaW1pdERhcmtuZXNzOiBzZXR0aW5ncy5saW1pdERhcmtuZXNzLFxuXHRcdFx0XHRsaW1pdEdyYXluZXNzOiBzZXR0aW5ncy5saW1pdEdyYXluZXNzLFxuXHRcdFx0XHRsaW1pdExpZ2h0bmVzczogc2V0dGluZ3MubGltaXRMaWdodG5lc3Ncblx0XHRcdH0sXG5cdFx0XHRtZXRhZGF0YToge1xuXHRcdFx0XHRudW1Cb3hlczogaXRlbXMubGVuZ3RoLCAvLyBUb3RhbCBudW1iZXIgb2YgcGFyc2VkIFBhbGV0dGVJdGVtc1xuXHRcdFx0XHRwYWxldHRlVHlwZTogJ3JhbmRvbScsIC8vICpERVYtTk9URSogd3JpdGUgYSB3YXkgdG8gcGFyc2UgZnJvbSBmaWxlXG5cdFx0XHRcdHRpbWVzdGFtcDogRGF0ZS5ub3coKSAvLyAqREVWLU5PVEUqIHdyaXRlIGEgd2F5IHRvIHBhcnNlIGZyb20gZmlsZVxuXHRcdFx0fVxuXHRcdH07XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Ly8gaGFuZGxlIHBhcnNpbmcgZXJyb3JzIG9yIHVuZXhwZWN0ZWQgZmFpbHVyZXNcblx0XHRjb25zb2xlLmVycm9yKCdFcnJvciBpbiBmcm9tQ1NTOicsIGVycm9yKTtcblxuXHRcdHRocm93IG5ldyBFcnJvcignRmFpbGVkIHRvIGRlc2VyaWFsaXplIENTUyBQYWxldHRlLicpO1xuXHR9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGZyb21KU09OKGRhdGE6IHN0cmluZyk6IFByb21pc2U8UGFsZXR0ZT4ge1xuXHQvLyAqREVWLU5PVEUqIHJldmlzaXQgVEhFIEZVQ0sgb3V0IG9mIHRoaXNcblx0dHJ5IHtcblx0XHRjb25zdCBwYXJzZWQgPSBKU09OLnBhcnNlKGRhdGEpO1xuXG5cdFx0aWYgKCFwYXJzZWQuaXRlbXMgfHwgIUFycmF5LmlzQXJyYXkocGFyc2VkLml0ZW1zKSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHQnSW52YWxpZCBKU09OIGZvcm1hdDogTWlzc2luZyBvciBpbnZhbGlkIGBpdGVtc2AgcHJvcGVydHkuJ1xuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcGFyc2VkIGFzIFBhbGV0dGU7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IpIHtcblx0XHRcdGlmIChsb2dNb2RlLmVycm9ycylcblx0XHRcdFx0bG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gZGVzZXJpYWxpemUgSlNPTjogJHtlcnJvci5tZXNzYWdlfWApO1xuXG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBkZXNlcmlhbGl6ZSBwYWxldHRlIGZyb20gSlNQTSBmaWxlJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGlmIChsb2dNb2RlLmVycm9ycylcblx0XHRcdFx0bG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gZGVzZXJpYWxpemUgSlNPTjogJHtlcnJvcn1gKTtcblxuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZGVzZXJpYWxpemUgcGFsZXR0ZSBmcm9tIEpTUE0gZmlsZScpO1xuXHRcdH1cblx0fVxufVxuXG5hc3luYyBmdW5jdGlvbiBmcm9tWE1MKGRhdGE6IHN0cmluZyk6IFByb21pc2U8UGFsZXR0ZT4ge1xuXHRjb25zdCBwYXJzZXIgPSBuZXcgRE9NUGFyc2VyKCk7XG5cdGNvbnN0IHhtbERvYyA9IHBhcnNlci5wYXJzZUZyb21TdHJpbmcoZGF0YSwgJ2FwcGxpY2F0aW9uL3htbCcpO1xuXHRjb25zdCBwYXJzZUVycm9yID0geG1sRG9jLnF1ZXJ5U2VsZWN0b3IoJ3BhcnNlcmVycm9yJyk7XG5cblx0aWYgKHBhcnNlRXJyb3IpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgWE1MIGZvcm1hdDogJHtwYXJzZUVycm9yLnRleHRDb250ZW50fWApO1xuXHR9XG5cblx0Y29uc3QgcGFsZXR0ZUVsZW1lbnQgPSB4bWxEb2MucXVlcnlTZWxlY3RvcignUGFsZXR0ZScpO1xuXG5cdGlmICghcGFsZXR0ZUVsZW1lbnQpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgPFBhbGV0dGU+IHJvb3QgZWxlbWVudC4nKTtcblx0fVxuXG5cdGNvbnN0IHJhd0lEID0gcGFsZXR0ZUVsZW1lbnQuZ2V0QXR0cmlidXRlKCdpZCcpIHx8ICdFUlJPUl8oUEFMRVRURV9JRCknO1xuXHRjb25zdCBlbmFibGVBbHBoYSA9XG5cdFx0cGFsZXR0ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignRW5hYmxlQWxwaGEnKT8udGV4dENvbnRlbnQgPT09ICd0cnVlJztcblx0Y29uc3QgbGltaXREYXJrbmVzcyA9XG5cdFx0cGFsZXR0ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignTGltaXREYXJrbmVzcycpPy50ZXh0Q29udGVudCA9PT0gJ3RydWUnO1xuXHRjb25zdCBsaW1pdEdyYXluZXNzID1cblx0XHRwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdMaW1pdEdyYXluZXNzJyk/LnRleHRDb250ZW50ID09PSAndHJ1ZSc7XG5cdGNvbnN0IGxpbWl0TGlnaHRuZXNzID1cblx0XHRwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdMaW1pdExpZ2h0bmVzcycpPy50ZXh0Q29udGVudCA9PT0gJ3RydWUnO1xuXHRjb25zdCBudW1Cb3hlcyA9IHBhcnNlSW50KFxuXHRcdHBhbGV0dGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ051bUJveGVzJyk/LnRleHRDb250ZW50IHx8ICcwJyxcblx0XHQxMFxuXHQpO1xuXHRjb25zdCBwYWxldHRlVHlwZSA9XG5cdFx0KHBhbGV0dGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ1BhbGV0dGVUeXBlJylcblx0XHRcdD8udGV4dENvbnRlbnQgYXMgUGFsZXR0ZVR5cGUpIHx8ICdFUlJPUic7XG5cdGNvbnN0IHJhd0hTTENvbG9yID0gcGFsZXR0ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignSFNMQ29sb3InKT8udGV4dENvbnRlbnQ7XG5cdGNvbnN0IGhzbENvbG9yOiBIU0wgfCBudWxsID0gcmF3SFNMQ29sb3Jcblx0XHQ/IChwYXJzZUNvbG9yU3RyaW5nKCdoc2wnLCByYXdIU0xDb2xvcikgYXMgSFNMKVxuXHRcdDogbnVsbDtcblx0Y29uc3QgcmF3Q29udmVydGVkQ29sb3JzID1cblx0XHRwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdDb252ZXJ0ZWRDb2xvcnMnKT8udGV4dENvbnRlbnQ7XG5cdGNvbnN0IGNvbnZlcnRlZENvbG9ycyA9XG5cdFx0cmF3Q29udmVydGVkQ29sb3JzICYmIHJhd0NvbnZlcnRlZENvbG9ycy50cmltKClcblx0XHRcdD8gKEpTT04ucGFyc2UocmF3Q29udmVydGVkQ29sb3JzKSBhcyB7XG5cdFx0XHRcdFx0Y215azogQ01ZS1ZhbHVlO1xuXHRcdFx0XHRcdGhleDogSGV4VmFsdWU7XG5cdFx0XHRcdFx0aHNsOiBIU0xWYWx1ZTtcblx0XHRcdFx0XHRoc3Y6IEhTVlZhbHVlO1xuXHRcdFx0XHRcdGxhYjogTEFCVmFsdWU7XG5cdFx0XHRcdFx0cmdiOiBSR0JWYWx1ZTtcblx0XHRcdFx0XHR4eXo6IFhZWlZhbHVlO1xuXHRcdFx0XHR9KVxuXHRcdFx0OiBudWxsO1xuXHRjb25zdCBjdXN0b21Db2xvciA9IHtcblx0XHRoc2xDb2xvcixcblx0XHRjb252ZXJ0ZWRDb2xvcnNcblx0fTtcblx0Y29uc3QgdGltZXN0YW1wID0gcGFyc2VJbnQoXG5cdFx0cGFsZXR0ZUVsZW1lbnQucXVlcnlTZWxlY3RvcignVGltZXN0YW1wJyk/LnRleHRDb250ZW50IHx8XG5cdFx0XHRgJHtEYXRlLm5vdygpfWBcblx0KTtcblx0Y29uc3QgcmF3Q29sb3JzID0ge1xuXHRcdGNteWs6IHBhbGV0dGVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ0NNWUsnKT8udGV4dENvbnRlbnQsXG5cdFx0aGV4OiBwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdIZXgnKT8udGV4dENvbnRlbnQsXG5cdFx0aHNsOiBwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdIU0wnKT8udGV4dENvbnRlbnQsXG5cdFx0aHN2OiBwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdIU1YnKT8udGV4dENvbnRlbnQsXG5cdFx0bGFiOiBwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdMQUInKT8udGV4dENvbnRlbnQsXG5cdFx0cmdiOiBwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdSR0InKT8udGV4dENvbnRlbnQsXG5cdFx0eHl6OiBwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yKCdYWVonKT8udGV4dENvbnRlbnRcblx0fTtcblxuXHRpZiAoXG5cdFx0cmF3Q29sb3JzLmNteWsgIT09ICcnIHx8XG5cdFx0cmF3Q29sb3JzLmhleCAhPT0gJycgfHxcblx0XHRyYXdDb2xvcnMuaHNsICE9PSAnJyB8fFxuXHRcdHJhd0NvbG9ycy5oc3YgIT09ICcnIHx8XG5cdFx0cmF3Q29sb3JzLmxhYiAhPT0gJycgfHxcblx0XHRyYXdDb2xvcnMucmdiICE9PSAnJyB8fFxuXHRcdHJhd0NvbG9ycy54eXogIT09ICcnXG5cdCkge1xuXHRcdGlmIChsb2dNb2RlLmVycm9ycykge1xuXHRcdFx0bG9nZ2VyLmVycm9yKFxuXHRcdFx0XHQnUGFsZXR0ZSBkZXNlcmlhbGl6YXRpb24gZXJyb3I6IEZvdW5kIHVuZXhwZWN0ZWQgY29sb3IgdmFsdWVzLidcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0dGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIGNvbG9yIHZhbHVlcyBmb3VuZCBpbiBQYWxldHRlLicpO1xuXHR9XG5cblx0Y29uc3QgY215ayA9IHBhcnNlQ29sb3JTdHJpbmcoJ2NteWsnLCByYXdDb2xvcnMuY215aykgYXMgQ01ZSztcblx0Y29uc3QgY215a0NvbG9yU3RyaW5nID0gY29udmVydFRvQ29sb3JTdHJpbmcoY215ayk7XG5cdGNvbnN0IGNteWtDU1NTdHJpbmcgPSBjb252ZXJ0VG9DU1NDb2xvclN0cmluZyhjbXlrKTtcblxuXHRjb25zdCBoZXggPSBwYXJzZUNvbG9yU3RyaW5nKCdoZXgnLCByYXdDb2xvcnMuaGV4KSBhcyBIZXg7XG5cdGNvbnN0IGhleENvbG9ydHJpbmcgPSBjb252ZXJ0VG9Db2xvclN0cmluZyhoZXgpO1xuXHRjb25zdCBoZXhDU1NTdHJpbmcgPSBjb252ZXJ0VG9DU1NDb2xvclN0cmluZyhoZXgpO1xuXG5cdGNvbnN0IGhzbCA9IHBhcnNlQ29sb3JTdHJpbmcoJ2hzbCcsIHJhd0NvbG9ycy5oc2wpIGFzIEhTTDtcblx0Y29uc3QgaHNsQ29sb3JTdHJpbmcgPSBjb252ZXJ0VG9Db2xvclN0cmluZyhoc2wpO1xuXHRjb25zdCBoc2xDU1NTdHJpbmcgPSBjb252ZXJ0VG9DU1NDb2xvclN0cmluZyhoc2wpO1xuXG5cdGNvbnN0IGhzdiA9IHBhcnNlQ29sb3JTdHJpbmcoJ2hzdicsIHJhd0NvbG9ycy5oc3YpIGFzIEhTVjtcblx0Y29uc3QgaHN2Q29sb3JTdHJpbmcgPSBjb252ZXJ0VG9Db2xvclN0cmluZyhoc3YpO1xuXHRjb25zdCBoc3ZDU1NTdHJpbmcgPSBjb252ZXJ0VG9DU1NDb2xvclN0cmluZyhoc3YpO1xuXG5cdGNvbnN0IGxhYiA9IHBhcnNlQ29sb3JTdHJpbmcoJ2xhYicsIHJhd0NvbG9ycy5sYWIpIGFzIExBQjtcblx0Y29uc3QgbGFiQ29sb3JTdHJpbmcgPSBjb252ZXJ0VG9Db2xvclN0cmluZyhsYWIpO1xuXHRjb25zdCBsYWJDU1NTdHJpbmcgPSBjb252ZXJ0VG9DU1NDb2xvclN0cmluZyhsYWIpO1xuXG5cdGNvbnN0IHJnYiA9IHBhcnNlQ29sb3JTdHJpbmcoJ3JnYicsIHJhd0NvbG9ycy5yZ2IpIGFzIFJHQjtcblx0Y29uc3QgcmdiQ29sb3JTdHJpbmcgPSBjb252ZXJ0VG9Db2xvclN0cmluZyhyZ2IpO1xuXHRjb25zdCByZ2JDU1NTdHJpbmcgPSBjb252ZXJ0VG9DU1NDb2xvclN0cmluZyhyZ2IpO1xuXG5cdGNvbnN0IHh5eiA9IHBhcnNlQ29sb3JTdHJpbmcoJ3h5eicsIHJhd0NvbG9ycy54eXopIGFzIFhZWjtcblx0Y29uc3QgeHl6Q29sb3JTdHJpbmcgPSBjb252ZXJ0VG9Db2xvclN0cmluZyh4eXopO1xuXHRjb25zdCB4eXpDU1NTdHJpbmcgPSBjb252ZXJ0VG9DU1NDb2xvclN0cmluZyh4eXopO1xuXG5cdGNvbnN0IGl0ZW1zOiBQYWxldHRlSXRlbVtdID0gQXJyYXkuZnJvbShcblx0XHRwYWxldHRlRWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKCdQYWxldHRlSXRlbScpXG5cdCkubWFwKGl0ZW0gPT4ge1xuXHRcdGNvbnN0IGlkID0gaXRlbS5nZXRBdHRyaWJ1dGUoJ2lkJykgfHwgJyc7XG5cdFx0Y29uc3QgY29sb3JzID0ge1xuXHRcdFx0Y215azogY215ay52YWx1ZSxcblx0XHRcdGhleDogaGV4LnZhbHVlLFxuXHRcdFx0aHNsOiBoc2wudmFsdWUsXG5cdFx0XHRoc3Y6IGhzdi52YWx1ZSxcblx0XHRcdGxhYjogbGFiLnZhbHVlLFxuXHRcdFx0cmdiOiByZ2IudmFsdWUsXG5cdFx0XHR4eXo6IHh5ei52YWx1ZVxuXHRcdH07XG5cdFx0Y29uc3QgY29sb3JTdHJpbmdzID0ge1xuXHRcdFx0Y215a1N0cmluZzogY215a0NvbG9yU3RyaW5nLnZhbHVlIGFzIENNWUtWYWx1ZVN0cmluZyxcblx0XHRcdGhleFN0cmluZzogaGV4Q29sb3J0cmluZy52YWx1ZSBhcyBIZXhWYWx1ZVN0cmluZyxcblx0XHRcdGhzbFN0cmluZzogaHNsQ29sb3JTdHJpbmcudmFsdWUgYXMgSFNMVmFsdWVTdHJpbmcsXG5cdFx0XHRoc3ZTdHJpbmc6IGhzdkNvbG9yU3RyaW5nLnZhbHVlIGFzIEhTVlZhbHVlU3RyaW5nLFxuXHRcdFx0bGFiU3RyaW5nOiBsYWJDb2xvclN0cmluZy52YWx1ZSBhcyBMQUJWYWx1ZVN0cmluZyxcblx0XHRcdHJnYlN0cmluZzogcmdiQ29sb3JTdHJpbmcudmFsdWUgYXMgUkdCVmFsdWVTdHJpbmcsXG5cdFx0XHR4eXpTdHJpbmc6IHh5ekNvbG9yU3RyaW5nLnZhbHVlIGFzIFhZWlZhbHVlU3RyaW5nXG5cdFx0fTtcblx0XHRjb25zdCBjc3NTdHJpbmdzID0ge1xuXHRcdFx0Y215a0NTU1N0cmluZyxcblx0XHRcdGhleENTU1N0cmluZyxcblx0XHRcdGhzbENTU1N0cmluZyxcblx0XHRcdGhzdkNTU1N0cmluZyxcblx0XHRcdGxhYkNTU1N0cmluZyxcblx0XHRcdHJnYkNTU1N0cmluZyxcblx0XHRcdHh5ekNTU1N0cmluZ1xuXHRcdH07XG5cblx0XHRyZXR1cm4geyBpZCwgY29sb3JzLCBjb2xvclN0cmluZ3MsIGNzc1N0cmluZ3MgfTtcblx0fSk7XG5cblx0cmV0dXJuIHtcblx0XHRpZDogcmF3SUQsXG5cdFx0aXRlbXMsXG5cdFx0ZmxhZ3M6IHsgZW5hYmxlQWxwaGEsIGxpbWl0RGFya25lc3MsIGxpbWl0R3JheW5lc3MsIGxpbWl0TGlnaHRuZXNzIH0sXG5cdFx0bWV0YWRhdGE6IHsgbnVtQm94ZXMsIHBhbGV0dGVUeXBlLCBjdXN0b21Db2xvciwgdGltZXN0YW1wIH1cblx0fSBhcyBQYWxldHRlO1xufVxuXG5leHBvcnQgY29uc3QgZGVzZXJpYWxpemU6IElPX0ZuX0Rlc2VyaWFsaXplSW50ZXJmYWNlID0ge1xuXHRmcm9tQ1NTLFxuXHRmcm9tSlNPTixcblx0ZnJvbVhNTFxufTtcbiJdfQ==