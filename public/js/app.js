// ColorGen - version 0.6.0-dev
// Author: Viihna Leraine (viihna@ViihnaTech.com / viihna.78 (Signal) / Viihna-Lehraine (Github))
// Licensed under GNU GPLv3 (https://www.gnu.org/licenses/gpl-3.0.html)
// You may use this code for any purpose EXCEPT for the creation of proprietary derivatives. I encourage you to improve on my code or to include it in other projects if you find it helpful. Please credit me as the original author.
// This application comes with ABSOLUTELY NO WARRANTY OR GUARANTEE OF ANY KIND.
import { dom } from './dom/dom-main.js';
import { storage } from './dom/storage.js';
import { domHelpers } from './helpers/dom.js';
import { generate } from './palette-gen/generate.js';
import { transforms } from './utils/transforms.js';
let customColor = null;
// applies all event listeners when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM content loaded - Initializing application');
    // define buttons within the main UI
    const generateButton = domHelpers.getElement('generate-button');
    const saturateButton = domHelpers.getElement('saturate-button');
    const desaturateButton = domHelpers.getElement('desaturate-button');
    const popupDivButton = domHelpers.getElement('custom-color-button');
    const applyCustomColorButton = domHelpers.getElement('apply-custom-color-button');
    const clearCustomColorButton = domHelpers.getElement('clear-custom-color-button');
    const advancedMenuToggleButton = domHelpers.getElement('advanced-menu-toggle-button');
    const applyInitialColorSpaceButton = domHelpers.getElement('apply-initial-color-space-button');
    const selectedColorOptions = domHelpers.getElement('selected-color-options');
    // confirm that all elements are accessible
    console.log(`generateButton: ${generateButton}\nsaturateButton: ${saturateButton}\ndesaturateButton: ${desaturateButton}\npopupDivButton: ${popupDivButton}\napplyCustomColorButton: ${applyCustomColorButton}\nclearCustomColorButton: ${clearCustomColorButton}\nadvancedMenuToggleButton: ${advancedMenuToggleButton}\napplyInitialColorSpaceButton: ${applyInitialColorSpaceButton}\nselectedColorOptions: ${selectedColorOptions}`);
    const selectedColor = selectedColorOptions
        ? parseInt(selectedColorOptions.value, 10)
        : 0;
    console.log(`Selected color: ${selectedColor}`);
    try {
        dom.addConversionButtonEventListeners();
        console.log('Conversion button event listeners attached');
    }
    catch (error) {
        console.error(`Unable to attach conversion button event listeners: ${error}`);
    }
    generateButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('generateButton clicked');
        const { paletteType, numBoxes, initialColorSpace } = dom.pullParamsFromUI();
        const color = customColor
            ? transforms.parseColor(customColor.format, customColor.value)
            : null;
        const space = initialColorSpace ?? 'hex';
        generate.startPaletteGen(paletteType, numBoxes, space, color);
    });
    saturateButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('saturateButton clicked');
        dom.saturateColor(selectedColor);
    });
    desaturateButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('desaturateButton clicked');
        dom.desaturateColor(selectedColor);
    });
    popupDivButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('popupDivButton clicked');
        dom.showCustomColorPopupDiv();
    });
    applyCustomColorButton?.addEventListener('click', e => {
        e.preventDefault();
        const hslColorFlat = dom.applyCustomColor();
        const customColor = hslColorFlat;
        storage.setAppStorage({ customColor });
        dom.showCustomColorPopupDiv();
    });
    applyInitialColorSpaceButton?.addEventListener('click', e => {
        e.preventDefault();
        const initialColorSpace = dom.applyInitialColorSpace();
        const currentStorage = storage.getAppStorage() || {};
        const newStorage = { ...currentStorage, initialColorSpace };
        storage.setAppStorage(newStorage);
    });
    clearCustomColorButton?.addEventListener('click', e => {
        e.preventDefault();
        storage.updateAppStorage({ customColor: null });
        customColor = null;
        dom.showCustomColorPopupDiv();
    });
    advancedMenuToggleButton?.addEventListener('click', e => {
        e.preventDefault();
        const advancedMenu = domHelpers.getElement('advanced-menu');
        if (advancedMenu) {
            advancedMenu.classList.toggle('hidden');
            advancedMenu.style.display = advancedMenu.classList.contains('hidden')
                ? 'none'
                : 'block';
        }
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrQkFBK0I7QUFFL0IsaUdBQWlHO0FBQ2pHLHVFQUF1RTtBQUV2RSxzT0FBc087QUFFdE8sK0VBQStFO0FBRS9FLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNyQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFM0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ2xELE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVoRCxJQUFJLFdBQVcsR0FBNkMsSUFBSSxDQUFDO0FBRWpFLGlEQUFpRDtBQUNqRCxRQUFRLENBQUMsZ0JBQWdCLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO0lBQ2xELE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQStDLENBQUMsQ0FBQztJQUU3RCxvQ0FBb0M7SUFDcEMsTUFBTSxjQUFjLEdBQ25CLFVBQVUsQ0FBQyxVQUFVLENBQW9CLGlCQUFpQixDQUFDLENBQUM7SUFDN0QsTUFBTSxjQUFjLEdBQ25CLFVBQVUsQ0FBQyxVQUFVLENBQW9CLGlCQUFpQixDQUFDLENBQUM7SUFDN0QsTUFBTSxnQkFBZ0IsR0FDckIsVUFBVSxDQUFDLFVBQVUsQ0FBb0IsbUJBQW1CLENBQUMsQ0FBQztJQUMvRCxNQUFNLGNBQWMsR0FBRyxVQUFVLENBQUMsVUFBVSxDQUMzQyxxQkFBcUIsQ0FDckIsQ0FBQztJQUNGLE1BQU0sc0JBQXNCLEdBQUcsVUFBVSxDQUFDLFVBQVUsQ0FDbkQsMkJBQTJCLENBQzNCLENBQUM7SUFDRixNQUFNLHNCQUFzQixHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQ25ELDJCQUEyQixDQUMzQixDQUFDO0lBQ0YsTUFBTSx3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WSxFQUFFLENBQUM7WUFDbEIsWUFBWSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEMsWUFBWSxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQzNELFFBQVEsQ0FDUjtnQkFDQSxDQUFDLENBQUMsTUFBTTtnQkFDUixDQUFDLENBQUMsT0FBTyxDQUFDO1FBQ1osQ0FBQztJQUNGLENBQUMsQ0FBQyxDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb2xvckdlbiAtIHZlcnNpb24gMC42LjAtZGV2XG5cbi8vIEF1dGhvcjogVmlpaG5hIExlcmFpbmUgKHZpaWhuYUBWaWlobmFUZWNoLmNvbSAvIHZpaWhuYS43OCAoU2lnbmFsKSAvIFZpaWhuYS1MZWhyYWluZSAoR2l0aHViKSlcbi8vIExpY2Vuc2VkIHVuZGVyIEdOVSBHUEx2MyAoaHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwtMy4wLmh0bWwpXG5cbi8vIFlvdSBtYXkgdXNlIHRoaXMgY29kZSBmb3IgYW55IHB1cnBvc2UgRVhDRVBUIGZvciB0aGUgY3JlYXRpb24gb2YgcHJvcHJpZXRhcnkgZGVyaXZhdGl2ZXMuIEkgZW5jb3VyYWdlIHlvdSB0byBpbXByb3ZlIG9uIG15IGNvZGUgb3IgdG8gaW5jbHVkZSBpdCBpbiBvdGhlciBwcm9qZWN0cyBpZiB5b3UgZmluZCBpdCBoZWxwZnVsLiBQbGVhc2UgY3JlZGl0IG1lIGFzIHRoZSBvcmlnaW5hbCBhdXRob3IuXG5cbi8vIFRoaXMgYXBwbGljYXRpb24gY29tZXMgd2l0aCBBQlNPTFVURUxZIE5PIFdBUlJBTlRZIE9SIEdVQVJBTlRFRSBPRiBBTlkgS0lORC5cblxuaW1wb3J0IHsgZG9tIH0gZnJvbSAnLi9kb20vZG9tLW1haW4nO1xuaW1wb3J0IHsgc3RvcmFnZSB9IGZyb20gJy4vZG9tL3N0b3JhZ2UnO1xuaW1wb3J0IHsgZG9tSGVscGVycyB9IGZyb20gJy4vaGVscGVycy9kb20nO1xuaW1wb3J0ICogYXMgdHlwZXMgZnJvbSAnLi9pbmRleC90eXBlcyc7XG5pbXBvcnQgeyBnZW5lcmF0ZSB9IGZyb20gJy4vcGFsZXR0ZS1nZW4vZ2VuZXJhdGUnO1xuaW1wb3J0IHsgdHJhbnNmb3JtcyB9IGZyb20gJy4vdXRpbHMvdHJhbnNmb3Jtcyc7XG5cbmxldCBjdXN0b21Db2xvcjogeyBmb3JtYXQ6IHN0cmluZzsgdmFsdWU6IHN0cmluZyB9IHwgbnVsbCA9IG51bGw7XG5cbi8vIGFwcGxpZXMgYWxsIGV2ZW50IGxpc3RlbmVycyB3aGVuIERPTSBpcyBsb2FkZWRcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XG5cdGNvbnNvbGUubG9nKCdET00gY29udGVudCBsb2FkZWQgLSBJbml0aWFsaXppbmcgYXBwbGljYXRpb24nKTtcblxuXHQvLyBkZWZpbmUgYnV0dG9ucyB3aXRoaW4gdGhlIG1haW4gVUlcblx0Y29uc3QgZ2VuZXJhdGVCdXR0b24gPVxuXHRcdGRvbUhlbHBlcnMuZ2V0RWxlbWVudDxIVE1MQnV0dG9uRWxlbWVudD4oJ2dlbmVyYXRlLWJ1dHRvbicpO1xuXHRjb25zdCBzYXR1cmF0ZUJ1dHRvbiA9XG5cdFx0ZG9tSGVscGVycy5nZXRFbGVtZW50PEhUTUxCdXR0b25FbGVtZW50Pignc2F0dXJhdGUtYnV0dG9uJyk7XG5cdGNvbnN0IGRlc2F0dXJhdGVCdXR0b24gPVxuXHRcdGRvbUhlbHBlcnMuZ2V0RWxlbWVudDxIVE1MQnV0dG9uRWxlbWVudD4oJ2Rlc2F0dXJhdGUtYnV0dG9uJyk7XG5cdGNvbnN0IHBvcHVwRGl2QnV0dG9uID0gZG9tSGVscGVycy5nZXRFbGVtZW50PEhUTUxCdXR0b25FbGVtZW50Pihcblx0XHQnY3VzdG9tLWNvbG9yLWJ1dHRvbidcblx0KTtcblx0Y29uc3QgYXBwbHlDdXN0b21Db2xvckJ1dHRvbiA9IGRvbUhlbHBlcnMuZ2V0RWxlbWVudDxIVE1MQnV0dG9uRWxlbWVudD4oXG5cdFx0J2FwcGx5LWN1c3RvbS1jb2xvci1idXR0b24nXG5cdCk7XG5cdGNvbnN0IGNsZWFyQ3VzdG9tQ29sb3JCdXR0b24gPSBkb21IZWxwZXJzLmdldEVsZW1lbnQ8SFRNTEJ1dHRvbkVsZW1lbnQ+KFxuXHRcdCdjbGVhci1jdXN0b20tY29sb3ItYnV0dG9uJ1xuXHQpO1xuXHRjb25zdCBhZHZhbmNlZE1lbnVUb2dnbGVCdXR0b24gPSBkb21IZWxwZXJzLmdldEVsZW1lbnQ8SFRNTEJ1dHRvbkVsZW1lbnQ+KFxuXHRcdCdhZHZhbmNlZC1tZW51LXRvZ2dsZS1idXR0b24nXG5cdCk7XG5cdGNvbnN0IGFwcGx5SW5pdGlhbENvbG9yU3BhY2VCdXR0b24gPVxuXHRcdGRvbUhlbHBlcnMuZ2V0RWxlbWVudDxIVE1MQnV0dG9uRWxlbWVudD4oXG5cdFx0XHQnYXBwbHktaW5pdGlhbC1jb2xvci1zcGFjZS1idXR0b24nXG5cdFx0KTtcblx0Y29uc3Qgc2VsZWN0ZWRDb2xvck9wdGlvbnMgPSBkb21IZWxwZXJzLmdldEVsZW1lbnQ8SFRNTFNlbGVjdEVsZW1lbnQ+KFxuXHRcdCdzZWxlY3RlZC1jb2xvci1vcHRpb25zJ1xuXHQpO1xuXG5cdC8vIGNvbmZpcm0gdGhhdCBhbGwgZWxlbWVudHMgYXJlIGFjY2Vzc2libGVcblx0Y29uc29sZS5sb2coXG5cdFx0YGdlbmVyYXRlQnV0dG9uOiAke2dlbmVyYXRlQnV0dG9ufVxcbnNhdHVyYXRlQnV0dG9uOiAke3NhdHVyYXRlQnV0dG9ufVxcbmRlc2F0dXJhdGVCdXR0b246ICR7ZGVzYXR1cmF0ZUJ1dHRvbn1cXG5wb3B1cERpdkJ1dHRvbjogJHtwb3B1cERpdkJ1dHRvbn1cXG5hcHBseUN1c3RvbUNvbG9yQnV0dG9uOiAke2FwcGx5Q3VzdG9tQ29sb3JCdXR0b259XFxuY2xlYXJDdXN0b21Db2xvckJ1dHRvbjogJHtjbGVhckN1c3RvbUNvbG9yQnV0dG9ufVxcbmFkdmFuY2VkTWVudVRvZ2dsZUJ1dHRvbjogJHthZHZhbmNlZE1lbnVUb2dnbGVCdXR0b259XFxuYXBwbHlJbml0aWFsQ29sb3JTcGFjZUJ1dHRvbjogJHthcHBseUluaXRpYWxDb2xvclNwYWNlQnV0dG9ufVxcbnNlbGVjdGVkQ29sb3JPcHRpb25zOiAke3NlbGVjdGVkQ29sb3JPcHRpb25zfWBcblx0KTtcblxuXHRjb25zdCBzZWxlY3RlZENvbG9yID0gc2VsZWN0ZWRDb2xvck9wdGlvbnNcblx0XHQ/IHBhcnNlSW50KHNlbGVjdGVkQ29sb3JPcHRpb25zLnZhbHVlLCAxMClcblx0XHQ6IDA7XG5cdGNvbnNvbGUubG9nKGBTZWxlY3RlZCBjb2xvcjogJHtzZWxlY3RlZENvbG9yfWApO1xuXG5cdHRyeSB7XG5cdFx0ZG9tLmFkZENvbnZlcnNpb25CdXR0b25FdmVudExpc3RlbmVycygpO1xuXHRcdGNvbnNvbGUubG9nKCdDb252ZXJzaW9uIGJ1dHRvbiBldmVudCBsaXN0ZW5lcnMgYXR0YWNoZWQnKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0YFVuYWJsZSB0byBhdHRhY2ggY29udmVyc2lvbiBidXR0b24gZXZlbnQgbGlzdGVuZXJzOiAke2Vycm9yfWBcblx0XHQpO1xuXHR9XG5cblx0Z2VuZXJhdGVCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0Y29uc29sZS5sb2coJ2dlbmVyYXRlQnV0dG9uIGNsaWNrZWQnKTtcblxuXHRcdGNvbnN0IHsgcGFsZXR0ZVR5cGUsIG51bUJveGVzLCBpbml0aWFsQ29sb3JTcGFjZSB9ID1cblx0XHRcdGRvbS5wdWxsUGFyYW1zRnJvbVVJKCk7XG5cblx0XHRjb25zdCBjb2xvcjogdHlwZXMuQ29sb3IgfCBudWxsID0gY3VzdG9tQ29sb3Jcblx0XHRcdD8gdHJhbnNmb3Jtcy5wYXJzZUNvbG9yKFxuXHRcdFx0XHRcdGN1c3RvbUNvbG9yLmZvcm1hdCBhcyB0eXBlcy5Db2xvclNwYWNlLFxuXHRcdFx0XHRcdGN1c3RvbUNvbG9yLnZhbHVlXG5cdFx0XHRcdClcblx0XHRcdDogbnVsbDtcblxuXHRcdGNvbnN0IHNwYWNlOiB0eXBlcy5Db2xvclNwYWNlID0gaW5pdGlhbENvbG9yU3BhY2UgPz8gJ2hleCc7XG5cblx0XHRnZW5lcmF0ZS5zdGFydFBhbGV0dGVHZW4ocGFsZXR0ZVR5cGUsIG51bUJveGVzLCBzcGFjZSwgY29sb3IpO1xuXHR9KTtcblxuXHRzYXR1cmF0ZUJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0Y29uc29sZS5sb2coJ3NhdHVyYXRlQnV0dG9uIGNsaWNrZWQnKTtcblx0XHRkb20uc2F0dXJhdGVDb2xvcihzZWxlY3RlZENvbG9yKTtcblx0fSk7XG5cblx0ZGVzYXR1cmF0ZUJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0Y29uc29sZS5sb2coJ2Rlc2F0dXJhdGVCdXR0b24gY2xpY2tlZCcpO1xuXHRcdGRvbS5kZXNhdHVyYXRlQ29sb3Ioc2VsZWN0ZWRDb2xvcik7XG5cdH0pO1xuXG5cdHBvcHVwRGl2QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRjb25zb2xlLmxvZygncG9wdXBEaXZCdXR0b24gY2xpY2tlZCcpO1xuXHRcdGRvbS5zaG93Q3VzdG9tQ29sb3JQb3B1cERpdigpO1xuXHR9KTtcblxuXHRhcHBseUN1c3RvbUNvbG9yQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRjb25zdCBoc2xDb2xvckZsYXQgPSBkb20uYXBwbHlDdXN0b21Db2xvcigpO1xuXHRcdGNvbnN0IGN1c3RvbUNvbG9yOiB0eXBlcy5Db2xvciA9IGhzbENvbG9yRmxhdDtcblx0XHRzdG9yYWdlLnNldEFwcFN0b3JhZ2UoeyBjdXN0b21Db2xvciB9KTtcblx0XHRkb20uc2hvd0N1c3RvbUNvbG9yUG9wdXBEaXYoKTtcblx0fSk7XG5cblx0YXBwbHlJbml0aWFsQ29sb3JTcGFjZUJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0Y29uc3QgaW5pdGlhbENvbG9yU3BhY2U6IHR5cGVzLkNvbG9yU3BhY2UgPVxuXHRcdFx0ZG9tLmFwcGx5SW5pdGlhbENvbG9yU3BhY2UoKTtcblx0XHRjb25zdCBjdXJyZW50U3RvcmFnZSA9IHN0b3JhZ2UuZ2V0QXBwU3RvcmFnZSgpIHx8IHt9O1xuXHRcdGNvbnN0IG5ld1N0b3JhZ2UgPSB7IC4uLmN1cnJlbnRTdG9yYWdlLCBpbml0aWFsQ29sb3JTcGFjZSB9O1xuXHRcdHN0b3JhZ2Uuc2V0QXBwU3RvcmFnZShuZXdTdG9yYWdlKTtcblx0fSk7XG5cblx0Y2xlYXJDdXN0b21Db2xvckJ1dHRvbj8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcblx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0c3RvcmFnZS51cGRhdGVBcHBTdG9yYWdlKHsgY3VzdG9tQ29sb3I6IG51bGwgfSk7XG5cdFx0Y3VzdG9tQ29sb3IgPSBudWxsO1xuXHRcdGRvbS5zaG93Q3VzdG9tQ29sb3JQb3B1cERpdigpO1xuXHR9KTtcblxuXHRhZHZhbmNlZE1lbnVUb2dnbGVCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdGNvbnN0IGFkdmFuY2VkTWVudSA9XG5cdFx0XHRkb21IZWxwZXJzLmdldEVsZW1lbnQ8SFRNTERpdkVsZW1lbnQ+KCdhZHZhbmNlZC1tZW51Jyk7XG5cdFx0aWYgKGFkdmFuY2VkTWVudSkge1xuXHRcdFx0YWR2YW5jZWRNZW51LmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xuXHRcdFx0YWR2YW5jZWRNZW51LnN0eWxlLmRpc3BsYXkgPSBhZHZhbmNlZE1lbnUuY2xhc3NMaXN0LmNvbnRhaW5zKFxuXHRcdFx0XHQnaGlkZGVuJ1xuXHRcdFx0KVxuXHRcdFx0XHQ/ICdub25lJ1xuXHRcdFx0XHQ6ICdibG9jayc7XG5cdFx0fVxuXHR9KTtcbn0pO1xuIl19