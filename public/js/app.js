// ColorGen - version 0.6.0-dev
import { core, utils } from './common/index.js';
import { data } from './data/index.js';
import { dom } from './dom/index.js';
import { IDBManager } from './idb/index.js';
import { logger } from './logger/index.js';
import { start } from './palette/index.js';
const buttonIDs = data.consts.dom.ids;
const consts = data.consts;
const mode = data.mode;
document.addEventListener('DOMContentLoaded', async () => {
    console.log('DOM content loaded - Initializing application');
    await dom.loadPartials();
    if (!mode.quiet)
        console.log('HTML partials loaded. Initializing UI...');
    const buttonElements = dom.defineUIElements();
    if (!buttonElements) {
        if (mode.errorLogs)
            console.error('Failed to initialize UI buttons');
        return;
    }
    await dom.initializeUI();
    if (!mode.quiet)
        console.log('UI successfully initialized');
    const idb = IDBManager.getInstance();
    if (!buttonElements) {
        console.error('Failed to initialize UI buttons');
        return;
    }
    const selectedColorOption = consts.dom.elements.selectedColorOption;
    if (mode.debug) {
        logger.debug.validateDOMElements();
        if (mode.verbose) {
            logger.verbose.validateDOMElements();
        }
    }
    else {
        if (!mode.quiet) {
            console.log('Skipping DOM element validation');
        }
    }
    const selectedColor = selectedColorOption
        ? parseInt(selectedColorOption.value, 10)
        : 0;
    if (!mode.quiet)
        console.log(`Selected color: ${selectedColor}`);
    try {
        dom.addConversionButtonEventListeners();
        if (!mode.quiet)
            console.log('Conversion button event listeners attached');
    }
    catch (error) {
        if (mode.errorLogs)
            console.error(`Unable to attach conversion button event listeners: ${error}`);
    }
    dom.buttons.addEventListener(buttonIDs.advancedMenuButton, 'click', async (e) => {
        e.preventDefault();
        const advancedMenuContent = document.querySelector('.advanced-menu-content');
        if (advancedMenuContent) {
            const isHidden = getComputedStyle(advancedMenuContent).display === 'none';
            advancedMenuContent.style.display = isHidden ? 'flex' : 'none';
        }
        if (!mode.quiet)
            console.log('advancedMenuButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.applyCustomColorButton, 'click', async (e) => {
        e.preventDefault();
        const customHSLColor = dom.applyCustomColor();
        const customHSLColorClone = core.base.clone(customHSLColor);
        await idb.saveData('customColor', 'appSettings', customHSLColorClone);
        if (!mode.quiet)
            console.log('Custom color saved to IndexedDB');
    });
    dom.buttons.addEventListener(buttonIDs.clearCustomColorButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('Custom color cleared from IndexedDB');
        dom.showCustomColorPopupDiv();
    });
    dom.buttons.addEventListener(buttonIDs.closeCustomColorMenuButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('closeCustomColorMenuButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.closeHelpMenuButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('closeHelpMenuButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.closeHistoryMenuButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('closeHistoryMenuButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.desaturateButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('desaturateButton clicked');
        dom.desaturateColor(selectedColor);
    });
    dom.buttons.addEventListener(buttonIDs.generateButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('generateButton clicked');
        const { paletteType, numBoxes, enableAlpha, limitDarkness, limitGrayness, limitLightness } = dom.pullParamsFromUI();
        let customColor = (await idb.getCustomColor());
        if (!customColor) {
            if (!mode.quiet)
                console.info('No custom color found. Using a random color');
            customColor = utils.random.hsl(true);
        }
        const paletteOptions = {
            paletteType,
            numBoxes,
            customColor: core.base.clone(customColor),
            enableAlpha,
            limitDarkness,
            limitGrayness,
            limitLightness
        };
        await start.genPalette(paletteOptions);
    });
    dom.buttons.addEventListener(buttonIDs.helpMenuButton, 'click', async (e) => {
        e.preventDefault();
        const helpMenuContent = document.querySelector('.help-menu-content');
        if (helpMenuContent) {
            const isHidden = getComputedStyle(helpMenuContent).display === 'none';
            helpMenuContent.style.display = isHidden ? 'flex' : 'none';
            if (!mode.quiet)
                console.log('helpMenuButton clicked');
        }
    });
    dom.buttons.addEventListener(buttonIDs.historyMenuButton, 'click', async (e) => {
        e.preventDefault();
        const historyMenuContent = document.querySelector('.history-menu-content');
        if (historyMenuContent) {
            const isHidden = getComputedStyle(historyMenuContent).display === 'none';
            historyMenuContent.style.display = isHidden ? 'flex' : 'none';
        }
        if (!mode.quiet)
            console.log('historyMenuToggleButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.saturateButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('saturateButton clicked');
        dom.saturateColor(selectedColor);
    });
    dom.buttons.addEventListener(buttonIDs.showAsCMYKButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('showAsCMYKButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.showAsHexButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('showAsHexButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.showAsHSLButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('showAsHSLButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.showAsHSVButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('showAsHSVButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.showAsLABButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('showAsLABButton clicked');
    });
    dom.buttons.addEventListener(buttonIDs.showAsRGBButton, 'click', async (e) => {
        e.preventDefault();
        if (!mode.quiet)
            console.log('showAsRGBButton clicked');
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrQkFBK0I7QUFZL0IsT0FBTyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUNoRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDdkMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3JDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7QUFDM0MsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTNDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztBQUN0QyxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0FBQzNCLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7QUFFdkIsUUFBUSxDQUFDLGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLEtBQUssSUFBSSxFQUFFO0lBQ3hELE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQStDLENBQUMsQ0FBQztJQUU3RCxNQUFNLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUV6QixJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUs7UUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7SUFFekUsTUFBTSxjQUFjLEdBQUcsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUM7SUFFOUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1FBQ3JCLElBQUksSUFBSSxDQUFDLFNBQVM7WUFBRSxPQUFPLENBQUMsS0FBSyxDQUFDLGlDQUFpQyxDQUFDLENBQUM7UUFFckUsT0FBTztJQUNSLENBQUM7SUFF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QUFJLENBQUMsSUFBSSxDQUFDLEtBQUs7WUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFDekQsQ0FBQyxDQUNELENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIENvbG9yR2VuIC0gdmVyc2lvbiAwLjYuMC1kZXZcblxuLy8gQXV0aG9yOiBWaWlobmEgTGVyYWluZSAodmlpaG5hQFZpaWhuYVRlY2guY29tIC8gdmlpaG5hLjc4IChTaWduYWwpIC8gVmlpaG5hLUxlaHJhaW5lIChHaXRodWIpKVxuLy8gTGljZW5zZWQgdW5kZXIgR05VIEdQTHYzIChodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC0zLjAuaHRtbClcblxuLy8gWW91IG1heSB1c2UgdGhpcyBjb2RlIGZvciBhbnkgcHVycG9zZSBFWENFUFQgZm9yIHRoZSBjcmVhdGlvbiBvZiBwcm9wcmlldGFyeSBkZXJpdmF0aXZlcy4gSSBlbmNvdXJhZ2UgeW91IHRvIGltcHJvdmUgb24gbXkgY29kZSBvciB0byBpbmNsdWRlIGl0IGluIG90aGVyIHByb2plY3RzIGlmIHlvdSBmaW5kIGl0IGhlbHBmdWwuIFBsZWFzZSBjcmVkaXQgbWUgYXMgdGhlIG9yaWdpbmFsIGF1dGhvci5cblxuLy8gVGhpcyBhcHBsaWNhdGlvbiBjb21lcyB3aXRoIEFCU09MVVRFTFkgTk8gV0FSUkFOVFkgT1IgR1VBUkFOVEVFIE9GIEFOWSBLSU5ELlxuXG4vLyBGaWxlOiBzcmMvYXBwLmpzXG5cbmltcG9ydCB7IEhTTCwgUGFsZXR0ZU9wdGlvbnMgfSBmcm9tICcuL2luZGV4L2luZGV4LmpzJztcbmltcG9ydCB7IGNvcmUsIHV0aWxzIH0gZnJvbSAnLi9jb21tb24vaW5kZXguanMnO1xuaW1wb3J0IHsgZGF0YSB9IGZyb20gJy4vZGF0YS9pbmRleC5qcyc7XG5pbXBvcnQgeyBkb20gfSBmcm9tICcuL2RvbS9pbmRleC5qcyc7XG5pbXBvcnQgeyBJREJNYW5hZ2VyIH0gZnJvbSAnLi9pZGIvaW5kZXguanMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXIvaW5kZXguanMnO1xuaW1wb3J0IHsgc3RhcnQgfSBmcm9tICcuL3BhbGV0dGUvaW5kZXguanMnO1xuXG5jb25zdCBidXR0b25JRHMgPSBkYXRhLmNvbnN0cy5kb20uaWRzO1xuY29uc3QgY29uc3RzID0gZGF0YS5jb25zdHM7XG5jb25zdCBtb2RlID0gZGF0YS5tb2RlO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgYXN5bmMgKCkgPT4ge1xuXHRjb25zb2xlLmxvZygnRE9NIGNvbnRlbnQgbG9hZGVkIC0gSW5pdGlhbGl6aW5nIGFwcGxpY2F0aW9uJyk7XG5cblx0YXdhaXQgZG9tLmxvYWRQYXJ0aWFscygpO1xuXG5cdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ0hUTUwgcGFydGlhbHMgbG9hZGVkLiBJbml0aWFsaXppbmcgVUkuLi4nKTtcblxuXHRjb25zdCBidXR0b25FbGVtZW50cyA9IGRvbS5kZWZpbmVVSUVsZW1lbnRzKCk7XG5cblx0aWYgKCFidXR0b25FbGVtZW50cykge1xuXHRcdGlmIChtb2RlLmVycm9yTG9ncykgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgVUkgYnV0dG9ucycpO1xuXG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0YXdhaXQgZG9tLmluaXRpYWxpemVVSSgpO1xuXG5cdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ1VJIHN1Y2Nlc3NmdWxseSBpbml0aWFsaXplZCcpO1xuXG5cdGNvbnN0IGlkYiA9IElEQk1hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcblxuXHRpZiAoIWJ1dHRvbkVsZW1lbnRzKSB7XG5cdFx0Y29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgVUkgYnV0dG9ucycpO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGNvbnN0IHNlbGVjdGVkQ29sb3JPcHRpb24gPSBjb25zdHMuZG9tLmVsZW1lbnRzLnNlbGVjdGVkQ29sb3JPcHRpb247XG5cblx0aWYgKG1vZGUuZGVidWcpIHtcblx0XHRsb2dnZXIuZGVidWcudmFsaWRhdGVET01FbGVtZW50cygpO1xuXG5cdFx0aWYgKG1vZGUudmVyYm9zZSkge1xuXHRcdFx0bG9nZ2VyLnZlcmJvc2UudmFsaWRhdGVET01FbGVtZW50cygpO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRpZiAoIW1vZGUucXVpZXQpIHtcblx0XHRcdGNvbnNvbGUubG9nKCdTa2lwcGluZyBET00gZWxlbWVudCB2YWxpZGF0aW9uJyk7XG5cdFx0fVxuXHR9XG5cblx0Y29uc3Qgc2VsZWN0ZWRDb2xvciA9IHNlbGVjdGVkQ29sb3JPcHRpb25cblx0XHQ/IHBhcnNlSW50KHNlbGVjdGVkQ29sb3JPcHRpb24udmFsdWUsIDEwKVxuXHRcdDogMDtcblxuXHRpZiAoIW1vZGUucXVpZXQpIGNvbnNvbGUubG9nKGBTZWxlY3RlZCBjb2xvcjogJHtzZWxlY3RlZENvbG9yfWApO1xuXG5cdHRyeSB7XG5cdFx0ZG9tLmFkZENvbnZlcnNpb25CdXR0b25FdmVudExpc3RlbmVycygpO1xuXG5cdFx0aWYgKCFtb2RlLnF1aWV0KVxuXHRcdFx0Y29uc29sZS5sb2coJ0NvbnZlcnNpb24gYnV0dG9uIGV2ZW50IGxpc3RlbmVycyBhdHRhY2hlZCcpO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChtb2RlLmVycm9yTG9ncylcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBVbmFibGUgdG8gYXR0YWNoIGNvbnZlcnNpb24gYnV0dG9uIGV2ZW50IGxpc3RlbmVyczogJHtlcnJvcn1gXG5cdFx0XHQpO1xuXHR9XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuYWR2YW5jZWRNZW51QnV0dG9uLFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0Y29uc3QgYWR2YW5jZWRNZW51Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdCcuYWR2YW5jZWQtbWVudS1jb250ZW50J1xuXHRcdFx0KSBhcyBIVE1MRWxlbWVudCB8IG51bGw7XG5cblx0XHRcdGlmIChhZHZhbmNlZE1lbnVDb250ZW50KSB7XG5cdFx0XHRcdGNvbnN0IGlzSGlkZGVuID1cblx0XHRcdFx0XHRnZXRDb21wdXRlZFN0eWxlKGFkdmFuY2VkTWVudUNvbnRlbnQpLmRpc3BsYXkgPT09ICdub25lJztcblxuXHRcdFx0XHRhZHZhbmNlZE1lbnVDb250ZW50LnN0eWxlLmRpc3BsYXkgPSBpc0hpZGRlbiA/ICdmbGV4JyA6ICdub25lJztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnYWR2YW5jZWRNZW51QnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuYXBwbHlDdXN0b21Db2xvckJ1dHRvbixcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGNvbnN0IGN1c3RvbUhTTENvbG9yID0gZG9tLmFwcGx5Q3VzdG9tQ29sb3IoKTtcblx0XHRcdGNvbnN0IGN1c3RvbUhTTENvbG9yQ2xvbmUgPSBjb3JlLmJhc2UuY2xvbmUoY3VzdG9tSFNMQ29sb3IpO1xuXG5cdFx0XHRhd2FpdCBpZGIuc2F2ZURhdGEoXG5cdFx0XHRcdCdjdXN0b21Db2xvcicsXG5cdFx0XHRcdCdhcHBTZXR0aW5ncycsXG5cdFx0XHRcdGN1c3RvbUhTTENvbG9yQ2xvbmVcblx0XHRcdCk7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ0N1c3RvbSBjb2xvciBzYXZlZCB0byBJbmRleGVkREInKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuY2xlYXJDdXN0b21Db2xvckJ1dHRvbixcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ0N1c3RvbSBjb2xvciBjbGVhcmVkIGZyb20gSW5kZXhlZERCJyk7XG5cblx0XHRcdGRvbS5zaG93Q3VzdG9tQ29sb3JQb3B1cERpdigpO1xuXHRcdH1cblx0KTtcblxuXHRkb20uYnV0dG9ucy5hZGRFdmVudExpc3RlbmVyKFxuXHRcdGJ1dHRvbklEcy5jbG9zZUN1c3RvbUNvbG9yTWVudUJ1dHRvbixcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ2Nsb3NlQ3VzdG9tQ29sb3JNZW51QnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuY2xvc2VIZWxwTWVudUJ1dHRvbixcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ2Nsb3NlSGVscE1lbnVCdXR0b24gY2xpY2tlZCcpO1xuXHRcdH1cblx0KTtcblxuXHRkb20uYnV0dG9ucy5hZGRFdmVudExpc3RlbmVyKFxuXHRcdGJ1dHRvbklEcy5jbG9zZUhpc3RvcnlNZW51QnV0dG9uLFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnY2xvc2VIaXN0b3J5TWVudUJ1dHRvbiBjbGlja2VkJyk7XG5cdFx0fVxuXHQpO1xuXG5cdGRvbS5idXR0b25zLmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0YnV0dG9uSURzLmRlc2F0dXJhdGVCdXR0b24sXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRpZiAoIW1vZGUucXVpZXQpIGNvbnNvbGUubG9nKCdkZXNhdHVyYXRlQnV0dG9uIGNsaWNrZWQnKTtcblxuXHRcdFx0ZG9tLmRlc2F0dXJhdGVDb2xvcihzZWxlY3RlZENvbG9yKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuZ2VuZXJhdGVCdXR0b24sXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRpZiAoIW1vZGUucXVpZXQpIGNvbnNvbGUubG9nKCdnZW5lcmF0ZUJ1dHRvbiBjbGlja2VkJyk7XG5cblx0XHRcdGNvbnN0IHtcblx0XHRcdFx0cGFsZXR0ZVR5cGUsXG5cdFx0XHRcdG51bUJveGVzLFxuXHRcdFx0XHRlbmFibGVBbHBoYSxcblx0XHRcdFx0bGltaXREYXJrbmVzcyxcblx0XHRcdFx0bGltaXRHcmF5bmVzcyxcblx0XHRcdFx0bGltaXRMaWdodG5lc3Ncblx0XHRcdH0gPSBkb20ucHVsbFBhcmFtc0Zyb21VSSgpO1xuXG5cdFx0XHRsZXQgY3VzdG9tQ29sb3IgPSAoYXdhaXQgaWRiLmdldEN1c3RvbUNvbG9yKCkpIGFzIEhTTCB8IG51bGw7XG5cblx0XHRcdGlmICghY3VzdG9tQ29sb3IpIHtcblx0XHRcdFx0aWYgKCFtb2RlLnF1aWV0KVxuXHRcdFx0XHRcdGNvbnNvbGUuaW5mbygnTm8gY3VzdG9tIGNvbG9yIGZvdW5kLiBVc2luZyBhIHJhbmRvbSBjb2xvcicpO1xuXG5cdFx0XHRcdGN1c3RvbUNvbG9yID0gdXRpbHMucmFuZG9tLmhzbCh0cnVlKTtcblx0XHRcdH1cblxuXHRcdFx0Y29uc3QgcGFsZXR0ZU9wdGlvbnM6IFBhbGV0dGVPcHRpb25zID0ge1xuXHRcdFx0XHRwYWxldHRlVHlwZSxcblx0XHRcdFx0bnVtQm94ZXMsXG5cdFx0XHRcdGN1c3RvbUNvbG9yOiBjb3JlLmJhc2UuY2xvbmUoY3VzdG9tQ29sb3IpLFxuXHRcdFx0XHRlbmFibGVBbHBoYSxcblx0XHRcdFx0bGltaXREYXJrbmVzcyxcblx0XHRcdFx0bGltaXRHcmF5bmVzcyxcblx0XHRcdFx0bGltaXRMaWdodG5lc3Ncblx0XHRcdH07XG5cblx0XHRcdGF3YWl0IHN0YXJ0LmdlblBhbGV0dGUocGFsZXR0ZU9wdGlvbnMpO1xuXHRcdH1cblx0KTtcblxuXHRkb20uYnV0dG9ucy5hZGRFdmVudExpc3RlbmVyKFxuXHRcdGJ1dHRvbklEcy5oZWxwTWVudUJ1dHRvbixcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGNvbnN0IGhlbHBNZW51Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdCcuaGVscC1tZW51LWNvbnRlbnQnXG5cdFx0XHQpIGFzIEhUTUxFbGVtZW50IHwgbnVsbDtcblxuXHRcdFx0aWYgKGhlbHBNZW51Q29udGVudCkge1xuXHRcdFx0XHRjb25zdCBpc0hpZGRlbiA9XG5cdFx0XHRcdFx0Z2V0Q29tcHV0ZWRTdHlsZShoZWxwTWVudUNvbnRlbnQpLmRpc3BsYXkgPT09ICdub25lJztcblxuXHRcdFx0XHRoZWxwTWVudUNvbnRlbnQuc3R5bGUuZGlzcGxheSA9IGlzSGlkZGVuID8gJ2ZsZXgnIDogJ25vbmUnO1xuXG5cdFx0XHRcdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ2hlbHBNZW51QnV0dG9uIGNsaWNrZWQnKTtcblx0XHRcdH1cblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuaGlzdG9yeU1lbnVCdXR0b24sXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRjb25zdCBoaXN0b3J5TWVudUNvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuXHRcdFx0XHQnLmhpc3RvcnktbWVudS1jb250ZW50J1xuXHRcdFx0KSBhcyBIVE1MRWxlbWVudCB8IG51bGw7XG5cblx0XHRcdGlmIChoaXN0b3J5TWVudUNvbnRlbnQpIHtcblx0XHRcdFx0Y29uc3QgaXNIaWRkZW4gPVxuXHRcdFx0XHRcdGdldENvbXB1dGVkU3R5bGUoaGlzdG9yeU1lbnVDb250ZW50KS5kaXNwbGF5ID09PSAnbm9uZSc7XG5cblx0XHRcdFx0aGlzdG9yeU1lbnVDb250ZW50LnN0eWxlLmRpc3BsYXkgPSBpc0hpZGRlbiA/ICdmbGV4JyA6ICdub25lJztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnaGlzdG9yeU1lbnVUb2dnbGVCdXR0b24gY2xpY2tlZCcpO1xuXHRcdH1cblx0KTtcblxuXHRkb20uYnV0dG9ucy5hZGRFdmVudExpc3RlbmVyKFxuXHRcdGJ1dHRvbklEcy5zYXR1cmF0ZUJ1dHRvbixcblx0XHQnY2xpY2snLFxuXHRcdGFzeW5jIChlOiBNb3VzZUV2ZW50KSA9PiB7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ3NhdHVyYXRlQnV0dG9uIGNsaWNrZWQnKTtcblxuXHRcdFx0ZG9tLnNhdHVyYXRlQ29sb3Ioc2VsZWN0ZWRDb2xvcik7XG5cdFx0fVxuXHQpO1xuXG5cdGRvbS5idXR0b25zLmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0YnV0dG9uSURzLnNob3dBc0NNWUtCdXR0b24sXG5cdFx0J2NsaWNrJyxcblx0XHRhc3luYyAoZTogTW91c2VFdmVudCkgPT4ge1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0XHRpZiAoIW1vZGUucXVpZXQpIGNvbnNvbGUubG9nKCdzaG93QXNDTVlLQnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuc2hvd0FzSGV4QnV0dG9uLFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnc2hvd0FzSGV4QnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuc2hvd0FzSFNMQnV0dG9uLFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnc2hvd0FzSFNMQnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuc2hvd0FzSFNWQnV0dG9uLFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnc2hvd0FzSFNWQnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuc2hvd0FzTEFCQnV0dG9uLFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnc2hvd0FzTEFCQnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG5cblx0ZG9tLmJ1dHRvbnMuYWRkRXZlbnRMaXN0ZW5lcihcblx0XHRidXR0b25JRHMuc2hvd0FzUkdCQnV0dG9uLFxuXHRcdCdjbGljaycsXG5cdFx0YXN5bmMgKGU6IE1vdXNlRXZlbnQpID0+IHtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZygnc2hvd0FzUkdCQnV0dG9uIGNsaWNrZWQnKTtcblx0XHR9XG5cdCk7XG59KTtcbiJdfQ==