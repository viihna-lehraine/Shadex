// ColorGen - version 0.6.0-dev
// Author: Viihna Leraine (viihna@ViihnaTech.com / viihna.78 (Signal) / Viihna-Lehraine (Github))
// Licensed under GNU GPLv3 (https://www.gnu.org/licenses/gpl-3.0.html)
// You may use this code for any purpose EXCEPT for the creation of proprietary derivatives. I encourage you to improve on my code or to include it in other projects if you find it helpful. Please credit me as the original author.
// This application comes with ABSOLUTELY NO WARRANTY OR GUARANTEE OF ANY KIND.
import { config } from './config/constants.js';
import { domFn } from './dom/dom-main.js';
import { database } from './database/database.js';
import { generate } from './palette-gen/generate.js';
import { randomHSL } from './utils/random-color-utils.js';
import { core } from './utils/core-utils.js';
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM content loaded - Initializing application');
    const buttons = domFn.defineUIElements();
    if (!buttons) {
        console.error('Failed to initialize UI buttons');
        return;
    }
    const selectedColorOptions = config.selectedColorOptions;
    const { advancedMenuToggleButton, applyCustomColorButton, clearCustomColorButton, customColorToggleButton, desaturateButton, historyMenuButton, generateButton, saturateButton, showAsCMYKButton, showAsHexButton, showAsHSLButton, showAsHSVButton, showAsLABButton, showAsRGBButton } = buttons;
    // confirm that all elements are accessible
    console.log(`Advanced Menu Toggle Button: ${advancedMenuToggleButton ? 'found' : 'not found'}\nApply Custom Color Button: ${applyCustomColorButton ? 'found' : 'not found'}\nClear Custom Color Button: ${clearCustomColorButton ? 'found' : 'not found'}\nCustom Color Toggle Button: ${customColorToggleButton ? 'found' : 'not found'}\nDesaturate Button: ${desaturateButton ? 'found' : 'not found'}\nGenerate Button: ${generateButton ? 'found' : 'not found'}\nSaturate Button: ${saturateButton ? 'found' : 'not found'}\nShow as CMYK Button: ${showAsCMYKButton ? 'found' : 'not found'}\nShow as Hex Button: ${showAsHexButton ? 'found' : 'not found'}\nShow as HSL Button: ${showAsHSLButton ? 'found' : 'not found'}\nShow as HSV Button: ${showAsHSVButton ? 'found' : 'not found'}\nShow as LAB Button: ${showAsLABButton ? 'found' : 'not found'}\nShow as RGB Button: ${showAsRGBButton ? 'found' : 'not found'}`);
    const selectedColor = selectedColorOptions
        ? parseInt(selectedColorOptions.value, 10)
        : 0;
    console.log(`Selected color: ${selectedColor}`);
    try {
        domFn.addConversionButtonEventListeners();
        console.log('Conversion button event listeners attached');
    }
    catch (error) {
        console.error(`Unable to attach conversion button event listeners: ${error}`);
    }
    advancedMenuToggleButton?.addEventListener('click', e => {
        e.preventDefault();
        if (config.advancedMenu) {
            const clonedClasses = [...config.advancedMenu.classList];
            const isHidden = clonedClasses.includes('hidden');
            config.advancedMenu.classList.toggle('hidden');
            config.advancedMenu.style.display = isHidden ? 'block' : 'none';
        }
    });
    applyCustomColorButton?.addEventListener('click', async (e) => {
        e.preventDefault();
        const customHSLColor = domFn.applyCustomColor();
        const customHSLColorClone = core.clone(customHSLColor);
        await database.saveData('customColor', 'appSettings', customHSLColorClone);
        console.log('Custom color saved to IndexedDB');
    });
    clearCustomColorButton?.addEventListener('click', async (e) => {
        e.preventDefault();
        await database.deleteTable('customColor');
        console.log('Custom color cleared from IndexedDB');
        domFn.showCustomColorPopupDiv();
    });
    customColorToggleButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('customColorToggleButton clicked');
        domFn.showCustomColorPopupDiv();
    });
    desaturateButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('desaturateButton clicked');
        domFn.desaturateColor(selectedColor);
    });
    generateButton?.addEventListener('click', async (e) => {
        e.preventDefault();
        console.log('generateButton clicked');
        const { paletteType, numBoxes, enableAlpha, limitBright, limitDark, limitGray } = domFn.pullParamsFromUI();
        let customColor = (await database.getCustomColor());
        if (!customColor) {
            console.info('No custom color found. Using a random color');
            customColor = randomHSL(true);
        }
        const paletteOptions = {
            paletteType,
            numBoxes,
            customColor: core.clone(customColor),
            enableAlpha,
            limitBright,
            limitDark,
            limitGray
        };
        await generate.startPaletteGen(paletteOptions);
    });
    historyMenuButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('historyMenuButton clicked');
    });
    saturateButton?.addEventListener('click', e => {
        e.preventDefault();
        console.log('saturateButton clicked');
        domFn.saturateColor(selectedColor);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSwrQkFBK0I7QUFFL0IsaUdBQWlHO0FBQ2pHLHVFQUF1RTtBQUV2RSxzT0FBc087QUFFdE8sK0VBQStFO0FBRS9FLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUM1QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDdkMsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBRS9DLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNsRCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sNEJBQTRCLENBQUM7QUFDdkQsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLG9CQUFvQixDQUFDO0FBRTFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7SUFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQ0FBK0MsQ0FBQyxDQUFDO0lBRTdELE1BQU0sT0FBTyxHQUFHLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBRXpDLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztRQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUNqRCxPQUFPO0lBQ1IsQ0FBQztJQUVELE1BQU0sb0JBQW9CLEdBQUcsTUFBTSxDQUFDLG9CQUFvQixDQUFDO0lBRXpELE1BQU0sRUFDTCx3QkFBd0IsRUFDeEIsc0JBQXNCLEVBQ3RCLHNCQUFzQixFQUN0Qix1QkFBdUIsRUFDdkIsZ0JBQWdCLEVBQ2hCLGlCQUFpQixFQUNqQixjQUFjLEVBQ2QsY0FBYyxFQUNkLGdCQUFnQixFQUNoQixlQUFlLEVBQ2YsZUFBZSxFQUNmLGVBQWUsRUFDZixlQUFlLEVBQ2YsZUFBZSxFQUNmLEdBQUcsT0FBTyxDQUFDO0lBRVosMkNB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QUUsQ0FBQztRQUU3QixJQUFJLFdBQVcsR0FDZCxDQUFDLE1BQU0sUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFzQixDQUFDO1FBRXhELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNsQixPQUFPLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxDQUFDLENBQUM7WUFFNUQsV0FBVyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQixDQUFDO1FBRUQsTUFBTSxjQUFjLEdBQTBCO1lBQzdDLFdBQVc7WUFDWCxRQUFRO1lBQ1IsV0FBVyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDO1lBQ3BDLFdBQVc7WUFDWCxXQUFXO1lBQ1gsU0FBUztZQUNULFNBQVM7U0FDVCxDQUFDO1FBRUYsTUFBTSxRQUFRLENBQUMsZUFBZSxDQUFDLGNBQWMsQ0FBQyxDQUFDO0lBQ2hELENBQUMsQ0FBQyxDQUFDO0lBRUgsaUJBQWlCLEVBQUUsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFO1FBQ2hELENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUVuQixPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixDQUFDLENBQUM7SUFDMUMsQ0FBQyxDQUFDLENBQUM7SUFFSCxjQUFjLEVBQUUsZ0JBQWdCLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFO1FBQzdDLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUVuQixPQUFPLENBQUMsR0FBRyxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFFdEMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUNwQyxDQUFDLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQ29sb3JHZW4gLSB2ZXJzaW9uIDAuNi4wLWRldlxuXG4vLyBBdXRob3I6IFZpaWhuYSBMZXJhaW5lICh2aWlobmFAVmlpaG5hVGVjaC5jb20gLyB2aWlobmEuNzggKFNpZ25hbCkgLyBWaWlobmEtTGVocmFpbmUgKEdpdGh1YikpXG4vLyBMaWNlbnNlZCB1bmRlciBHTlUgR1BMdjMgKGh0dHBzOi8vd3d3LmdudS5vcmcvbGljZW5zZXMvZ3BsLTMuMC5odG1sKVxuXG4vLyBZb3UgbWF5IHVzZSB0aGlzIGNvZGUgZm9yIGFueSBwdXJwb3NlIEVYQ0VQVCBmb3IgdGhlIGNyZWF0aW9uIG9mIHByb3ByaWV0YXJ5IGRlcml2YXRpdmVzLiBJIGVuY291cmFnZSB5b3UgdG8gaW1wcm92ZSBvbiBteSBjb2RlIG9yIHRvIGluY2x1ZGUgaXQgaW4gb3RoZXIgcHJvamVjdHMgaWYgeW91IGZpbmQgaXQgaGVscGZ1bC4gUGxlYXNlIGNyZWRpdCBtZSBhcyB0aGUgb3JpZ2luYWwgYXV0aG9yLlxuXG4vLyBUaGlzIGFwcGxpY2F0aW9uIGNvbWVzIHdpdGggQUJTT0xVVEVMWSBOTyBXQVJSQU5UWSBPUiBHVUFSQU5URUUgT0YgQU5ZIEtJTkQuXG5cbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJy4vY29uZmlnL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBkb21GbiB9IGZyb20gJy4vZG9tL2RvbS1tYWluJztcbmltcG9ydCB7IGRhdGFiYXNlIH0gZnJvbSAnLi9kYXRhYmFzZS9kYXRhYmFzZSc7XG5pbXBvcnQgKiBhcyBjb2xvcnMgZnJvbSAnLi9pbmRleC9jb2xvcnMnO1xuaW1wb3J0IHsgZ2VuZXJhdGUgfSBmcm9tICcuL3BhbGV0dGUtZ2VuL2dlbmVyYXRlJztcbmltcG9ydCB7IHJhbmRvbUhTTCB9IGZyb20gJy4vdXRpbHMvcmFuZG9tLWNvbG9yLXV0aWxzJztcbmltcG9ydCB7IGNvcmUgfSBmcm9tICcuL3V0aWxzL2NvcmUtdXRpbHMnO1xuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKCkgPT4ge1xuXHRjb25zb2xlLmxvZygnRE9NIGNvbnRlbnQgbG9hZGVkIC0gSW5pdGlhbGl6aW5nIGFwcGxpY2F0aW9uJyk7XG5cblx0Y29uc3QgYnV0dG9ucyA9IGRvbUZuLmRlZmluZVVJRWxlbWVudHMoKTtcblxuXHRpZiAoIWJ1dHRvbnMpIHtcblx0XHRjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gaW5pdGlhbGl6ZSBVSSBidXR0b25zJyk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0Y29uc3Qgc2VsZWN0ZWRDb2xvck9wdGlvbnMgPSBjb25maWcuc2VsZWN0ZWRDb2xvck9wdGlvbnM7XG5cblx0Y29uc3Qge1xuXHRcdGFkdmFuY2VkTWVudVRvZ2dsZUJ1dHRvbixcblx0XHRhcHBseUN1c3RvbUNvbG9yQnV0dG9uLFxuXHRcdGNsZWFyQ3VzdG9tQ29sb3JCdXR0b24sXG5cdFx0Y3VzdG9tQ29sb3JUb2dnbGVCdXR0b24sXG5cdFx0ZGVzYXR1cmF0ZUJ1dHRvbixcblx0XHRoaXN0b3J5TWVudUJ1dHRvbixcblx0XHRnZW5lcmF0ZUJ1dHRvbixcblx0XHRzYXR1cmF0ZUJ1dHRvbixcblx0XHRzaG93QXNDTVlLQnV0dG9uLFxuXHRcdHNob3dBc0hleEJ1dHRvbixcblx0XHRzaG93QXNIU0xCdXR0b24sXG5cdFx0c2hvd0FzSFNWQnV0dG9uLFxuXHRcdHNob3dBc0xBQkJ1dHRvbixcblx0XHRzaG93QXNSR0JCdXR0b25cblx0fSA9IGJ1dHRvbnM7XG5cblx0Ly8gY29uZmlybSB0aGF0IGFsbCBlbGVtZW50cyBhcmUgYWNjZXNzaWJsZVxuXHRjb25zb2xlLmxvZyhcblx0XHRgQWR2YW5jZWQgTWVudSBUb2dnbGUgQnV0dG9uOiAke2FkdmFuY2VkTWVudVRvZ2dsZUJ1dHRvbiA/ICdmb3VuZCcgOiAnbm90IGZvdW5kJ31cXG5BcHBseSBDdXN0b20gQ29sb3IgQnV0dG9uOiAke2FwcGx5Q3VzdG9tQ29sb3JCdXR0b24gPyAnZm91bmQnIDogJ25vdCBmb3VuZCd9XFxuQ2xlYXIgQ3VzdG9tIENvbG9yIEJ1dHRvbjogJHtjbGVhckN1c3RvbUNvbG9yQnV0dG9uID8gJ2ZvdW5kJyA6ICdub3QgZm91bmQnfVxcbkN1c3RvbSBDb2xvciBUb2dnbGUgQnV0dG9uOiAke2N1c3RvbUNvbG9yVG9nZ2xlQnV0dG9uID8gJ2ZvdW5kJyA6ICdub3QgZm91bmQnfVxcbkRlc2F0dXJhdGUgQnV0dG9uOiAke2Rlc2F0dXJhdGVCdXR0b24gPyAnZm91bmQnIDogJ25vdCBmb3VuZCd9XFxuR2VuZXJhdGUgQnV0dG9uOiAke2dlbmVyYXRlQnV0dG9uID8gJ2ZvdW5kJyA6ICdub3QgZm91bmQnfVxcblNhdHVyYXRlIEJ1dHRvbjogJHtzYXR1cmF0ZUJ1dHRvbiA/ICdmb3VuZCcgOiAnbm90IGZvdW5kJ31cXG5TaG93IGFzIENNWUsgQnV0dG9uOiAke3Nob3dBc0NNWUtCdXR0b24gPyAnZm91bmQnIDogJ25vdCBmb3VuZCd9XFxuU2hvdyBhcyBIZXggQnV0dG9uOiAke3Nob3dBc0hleEJ1dHRvbiA/ICdmb3VuZCcgOiAnbm90IGZvdW5kJ31cXG5TaG93IGFzIEhTTCBCdXR0b246ICR7c2hvd0FzSFNMQnV0dG9uID8gJ2ZvdW5kJyA6ICdub3QgZm91bmQnfVxcblNob3cgYXMgSFNWIEJ1dHRvbjogJHtzaG93QXNIU1ZCdXR0b24gPyAnZm91bmQnIDogJ25vdCBmb3VuZCd9XFxuU2hvdyBhcyBMQUIgQnV0dG9uOiAke3Nob3dBc0xBQkJ1dHRvbiA/ICdmb3VuZCcgOiAnbm90IGZvdW5kJ31cXG5TaG93IGFzIFJHQiBCdXR0b246ICR7c2hvd0FzUkdCQnV0dG9uID8gJ2ZvdW5kJyA6ICdub3QgZm91bmQnfWBcblx0KTtcblxuXHRjb25zdCBzZWxlY3RlZENvbG9yID0gc2VsZWN0ZWRDb2xvck9wdGlvbnNcblx0XHQ/IHBhcnNlSW50KHNlbGVjdGVkQ29sb3JPcHRpb25zLnZhbHVlLCAxMClcblx0XHQ6IDA7XG5cblx0Y29uc29sZS5sb2coYFNlbGVjdGVkIGNvbG9yOiAke3NlbGVjdGVkQ29sb3J9YCk7XG5cblx0dHJ5IHtcblx0XHRkb21Gbi5hZGRDb252ZXJzaW9uQnV0dG9uRXZlbnRMaXN0ZW5lcnMoKTtcblxuXHRcdGNvbnNvbGUubG9nKCdDb252ZXJzaW9uIGJ1dHRvbiBldmVudCBsaXN0ZW5lcnMgYXR0YWNoZWQnKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0YFVuYWJsZSB0byBhdHRhY2ggY29udmVyc2lvbiBidXR0b24gZXZlbnQgbGlzdGVuZXJzOiAke2Vycm9yfWBcblx0XHQpO1xuXHR9XG5cblx0YWR2YW5jZWRNZW51VG9nZ2xlQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGlmIChjb25maWcuYWR2YW5jZWRNZW51KSB7XG5cdFx0XHRjb25zdCBjbG9uZWRDbGFzc2VzID0gWy4uLmNvbmZpZy5hZHZhbmNlZE1lbnUuY2xhc3NMaXN0XTtcblx0XHRcdGNvbnN0IGlzSGlkZGVuID0gY2xvbmVkQ2xhc3Nlcy5pbmNsdWRlcygnaGlkZGVuJyk7XG5cblx0XHRcdGNvbmZpZy5hZHZhbmNlZE1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgnaGlkZGVuJyk7XG5cdFx0XHRjb25maWcuYWR2YW5jZWRNZW51LnN0eWxlLmRpc3BsYXkgPSBpc0hpZGRlbiA/ICdibG9jaycgOiAnbm9uZSc7XG5cdFx0fVxuXHR9KTtcblxuXHRhcHBseUN1c3RvbUNvbG9yQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGNvbnN0IGN1c3RvbUhTTENvbG9yID0gZG9tRm4uYXBwbHlDdXN0b21Db2xvcigpO1xuXHRcdGNvbnN0IGN1c3RvbUhTTENvbG9yQ2xvbmU6IGNvbG9ycy5IU0wgPSBjb3JlLmNsb25lKGN1c3RvbUhTTENvbG9yKTtcblxuXHRcdGF3YWl0IGRhdGFiYXNlLnNhdmVEYXRhKFxuXHRcdFx0J2N1c3RvbUNvbG9yJyxcblx0XHRcdCdhcHBTZXR0aW5ncycsXG5cdFx0XHRjdXN0b21IU0xDb2xvckNsb25lXG5cdFx0KTtcblxuXHRcdGNvbnNvbGUubG9nKCdDdXN0b20gY29sb3Igc2F2ZWQgdG8gSW5kZXhlZERCJyk7XG5cdH0pO1xuXG5cdGNsZWFyQ3VzdG9tQ29sb3JCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgZSA9PiB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0YXdhaXQgZGF0YWJhc2UuZGVsZXRlVGFibGUoJ2N1c3RvbUNvbG9yJyk7XG5cblx0XHRjb25zb2xlLmxvZygnQ3VzdG9tIGNvbG9yIGNsZWFyZWQgZnJvbSBJbmRleGVkREInKTtcblxuXHRcdGRvbUZuLnNob3dDdXN0b21Db2xvclBvcHVwRGl2KCk7XG5cdH0pO1xuXG5cdGN1c3RvbUNvbG9yVG9nZ2xlQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGNvbnNvbGUubG9nKCdjdXN0b21Db2xvclRvZ2dsZUJ1dHRvbiBjbGlja2VkJyk7XG5cblx0XHRkb21Gbi5zaG93Q3VzdG9tQ29sb3JQb3B1cERpdigpO1xuXHR9KTtcblxuXHRkZXNhdHVyYXRlQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGNvbnNvbGUubG9nKCdkZXNhdHVyYXRlQnV0dG9uIGNsaWNrZWQnKTtcblxuXHRcdGRvbUZuLmRlc2F0dXJhdGVDb2xvcihzZWxlY3RlZENvbG9yKTtcblx0fSk7XG5cblx0Z2VuZXJhdGVCdXR0b24/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgZSA9PiB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG5cdFx0Y29uc29sZS5sb2coJ2dlbmVyYXRlQnV0dG9uIGNsaWNrZWQnKTtcblxuXHRcdGNvbnN0IHtcblx0XHRcdHBhbGV0dGVUeXBlLFxuXHRcdFx0bnVtQm94ZXMsXG5cdFx0XHRlbmFibGVBbHBoYSxcblx0XHRcdGxpbWl0QnJpZ2h0LFxuXHRcdFx0bGltaXREYXJrLFxuXHRcdFx0bGltaXRHcmF5XG5cdFx0fSA9IGRvbUZuLnB1bGxQYXJhbXNGcm9tVUkoKTtcblxuXHRcdGxldCBjdXN0b21Db2xvciA9XG5cdFx0XHQoYXdhaXQgZGF0YWJhc2UuZ2V0Q3VzdG9tQ29sb3IoKSkgYXMgY29sb3JzLkhTTCB8IG51bGw7XG5cblx0XHRpZiAoIWN1c3RvbUNvbG9yKSB7XG5cdFx0XHRjb25zb2xlLmluZm8oJ05vIGN1c3RvbSBjb2xvciBmb3VuZC4gVXNpbmcgYSByYW5kb20gY29sb3InKTtcblxuXHRcdFx0Y3VzdG9tQ29sb3IgPSByYW5kb21IU0wodHJ1ZSk7XG5cdFx0fVxuXG5cdFx0Y29uc3QgcGFsZXR0ZU9wdGlvbnM6IGNvbG9ycy5QYWxldHRlT3B0aW9ucyA9IHtcblx0XHRcdHBhbGV0dGVUeXBlLFxuXHRcdFx0bnVtQm94ZXMsXG5cdFx0XHRjdXN0b21Db2xvcjogY29yZS5jbG9uZShjdXN0b21Db2xvciksXG5cdFx0XHRlbmFibGVBbHBoYSxcblx0XHRcdGxpbWl0QnJpZ2h0LFxuXHRcdFx0bGltaXREYXJrLFxuXHRcdFx0bGltaXRHcmF5XG5cdFx0fTtcblxuXHRcdGF3YWl0IGdlbmVyYXRlLnN0YXJ0UGFsZXR0ZUdlbihwYWxldHRlT3B0aW9ucyk7XG5cdH0pO1xuXG5cdGhpc3RvcnlNZW51QnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGNvbnNvbGUubG9nKCdoaXN0b3J5TWVudUJ1dHRvbiBjbGlja2VkJyk7XG5cdH0pO1xuXG5cdHNhdHVyYXRlQnV0dG9uPy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGNvbnNvbGUubG9nKCdzYXR1cmF0ZUJ1dHRvbiBjbGlja2VkJyk7XG5cblx0XHRkb21Gbi5zYXR1cmF0ZUNvbG9yKHNlbGVjdGVkQ29sb3IpO1xuXHR9KTtcbn0pO1xuIl19