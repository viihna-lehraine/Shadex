// File: src/idb/base.ts
import { openDB } from 'idb';
import { config } from '../config';
import { utils } from '../common';
const defaultSettings = config.defaults.idb.settings;
const mode = config.mode;
const logErrors = mode.logErrors;
const quietMode = mode.quiet;
function createMutationLogger(obj, key) {
    return new Proxy(obj, {
        set(target, property, value) {
            const oldValue = target[property];
            const success = Reflect.set(target, property, value);
            if (success) {
                logMutation({
                    timestamp: new Date().toISOString(),
                    key,
                    action: 'update',
                    newValue: { [property]: value },
                    oldValue: { [property]: oldValue },
                    origin: 'Proxy'
                });
            }
            return success;
        }
    });
}
const dbPromise = openDB('paletteDatabase', 1, {
    upgrade(db) {
        try {
            const stores = [
                'customColor',
                'mutations',
                'settings',
                'tables'
            ];
            stores.forEach(store => {
                if (!db.objectStoreNames.contains(store)) {
                    db.createObjectStore(store, {
                        keyPath: store === 'mutations' ? 'timestamp' : 'key'
                    });
                }
            });
        }
        catch (error) {
            if (mode.logErrors)
                console.error('Error during IndexedDB upgrade:', error);
            throw error;
        }
    }
});
async function getDB() {
    return dbPromise;
}
async function getCurrentPaletteID() {
    const db = await getDB();
    const settings = await db.get('settings', 'appSettings');
    return settings?.lastPaletteID ?? 0;
}
async function getCustomColor() {
    const db = await getDB();
    const entry = await db.get('customColor', 'customColor');
    return entry?.color
        ? createMutationLogger(entry.color, 'customColor')
        : null;
}
function getLoggedObject(obj, key) {
    if (obj) {
        return createMutationLogger(obj, key);
    }
    return null;
}
async function getNextPaletteID() {
    const currentID = await getCurrentPaletteID();
    const newID = currentID + 1;
    await updateCurrentPaletteID(newID);
    return newID;
}
async function getNextTableID() {
    const settings = await getSettings();
    const nextID = settings.lastTableID + 1;
    await saveData('settings', 'appSettings', {
        ...settings,
        lastTableID: nextID
    });
    return `palette_${nextID}`;
}
async function getSettings() {
    try {
        const db = await getDB();
        const settings = await db.get('settings', 'appSettings');
        return settings ?? defaultSettings;
    }
    catch (error) {
        if (mode.logErrors)
            console.error('Error fetching settings:', error);
        return { colorSpace: 'hex', lastTableID: 0 };
    }
}
async function getTable(id) {
    const db = await getDB();
    const result = await db.get('tables', id);
    if (!result) {
        if (mode.logErrors)
            console.warn(`Table with ID ${id} not found.`);
    }
    return result;
}
async function getStore(storeName, mode) {
    const db = await getDB();
    return db.transaction(storeName, mode).objectStore(storeName);
}
async function logMutation(log) {
    const db = await getDB();
    await db.put('mutations', log);
    if (!mode.quiet)
        console.log(`Logged mutation: ${JSON.stringify(log)}`);
}
async function renderPalette(tableId) {
    try {
        const storedPalette = await getTable(tableId);
        const paletteRow = document.getElementById('palette-row');
        if (!storedPalette)
            throw new Error(`Palette ${tableId} not found.`);
        if (!paletteRow)
            throw new Error('Palette row element not found.');
        paletteRow.innerHTML = '';
        const fragment = document.createDocumentFragment();
        const table = document.createElement('table');
        table.classList.add('palette-table');
        storedPalette.palette.items.forEach((item, index) => {
            const row = document.createElement('tr');
            const cell = document.createElement('td');
            const colorBox = document.createElement('div');
            cell.textContent = `Color ${index + 1}`;
            colorBox.classList.add('color-box');
            colorBox.style.backgroundColor = item.cssStrings.hexCSSString;
            row.appendChild(colorBox);
            row.appendChild(cell);
            table.appendChild(row);
        });
        fragment.appendChild(table);
        paletteRow.appendChild(fragment);
        if (!mode.quiet)
            console.log(`Rendered palette ${tableId}.`);
    }
    catch (error) {
        if (mode.logErrors)
            console.error(`Failed to render palette: ${error}`);
    }
}
async function saveData(storeName, key, data, oldValue) {
    try {
        const db = await getDB();
        const tx = db.transaction(storeName, 'readwrite');
        const store = tx.objectStore(storeName);
        await store.put({ key, ...data });
        await tx.done;
        console.log(`${key} saved to ${storeName}.`);
        await logMutation({
            timestamp: new Date().toISOString(),
            key,
            action: 'update',
            newValue: data,
            oldValue: oldValue ? oldValue : null,
            origin: 'saveData'
        });
    }
    catch (error) {
        if (mode.logErrors)
            console.error(`Failed to save data to ${storeName}:`, error);
        throw error;
    }
}
async function savePalette(id, newPalette) {
    try {
        const store = await getStore('tables', 'readwrite');
        const paletteToSave = {
            tableID: newPalette.tableID,
            palette: newPalette.palette
        };
        await store.put({ key: id, ...paletteToSave });
        if (!mode.quiet)
            console.log(`Palette ${id} saved successfully.`);
    }
    catch (error) {
        if (mode.logErrors)
            console.error(`Failed to save palette ${id}: ${error}`);
        throw error;
    }
}
async function savePaletteToDB(type, items, baseColor, numBoxes, enableAlpha, limitBright, limitDark, limitGray) {
    const paletteID = await getNextPaletteID();
    const newPalette = utils.palette.createObject(type, items, baseColor, paletteID, numBoxes, enableAlpha, limitBright, limitDark, limitGray);
    await savePalette(newPalette.id, {
        tableID: parseInt(newPalette.id.split('_')[1]),
        palette: newPalette
    });
    if (!mode.quiet)
        console.log(`Saved ${type} palette: ${JSON.stringify(newPalette)}`);
    return newPalette;
}
async function saveSettings(newSettings) {
    try {
        await saveData('settings', 'appSettings', newSettings);
        if (!mode.quiet)
            console.log('Settings updated');
    }
    catch (error) {
        if (mode.logErrors)
            console.error(`Failed to save settings: ${error}`);
        throw error;
    }
}
async function trackedTransaction(storeName, mode, callback) {
    const db = await getDB();
    const tx = db.transaction(storeName, mode);
    const store = tx.objectStore(storeName);
    try {
        await callback(store);
        await tx.done;
        if (!quietMode)
            console.log(`Transaction on ${storeName} completed.`);
    }
    catch (error) {
        if (logErrors)
            console.error(`Transaction on ${storeName} failed: ${error}`);
        throw error;
    }
}
async function updateCurrentPaletteID(newID) {
    const db = await getDB();
    const tx = db.transaction('settings', 'readwrite');
    const store = tx.objectStore('settings');
    await store.put({ key: 'appSettings', lastPaletteID: newID });
    await tx.done;
    if (!quietMode)
        console.log(`Current palette ID updated to ${newID}`);
}
async function updateEntryInPalette(tableID, entryIndex, newEntry) {
    try {
        const storedPalette = await getTable(tableID);
        if (!storedPalette)
            throw new Error(`Palette ${tableID} not found.`);
        const { items } = storedPalette.palette;
        if (entryIndex >= items.length) {
            if (!mode.gracefulErrors)
                throw new Error(`Entry ${entryIndex} not found in palette ${tableID}.`);
            if (logErrors)
                console.error(`Entry ${entryIndex} not found in palette ${tableID}.`);
            if (!quietMode)
                console.log('updateEntryInPalette: Entry not found.');
        }
        const oldEntry = items[entryIndex];
        items[entryIndex] = newEntry;
        await saveData('tables', tableID, storedPalette);
        await logMutation({
            timestamp: new Date().toISOString(),
            key: `${tableID}-${entryIndex}]`,
            action: 'update',
            newValue: newEntry,
            oldValue: oldEntry,
            origin: 'updateEntryInPalette'
        });
        if (!quietMode)
            console.log(`Entry ${entryIndex} in palette ${tableID} updated.`);
    }
    catch (error) {
        if (logErrors)
            console.error(`Failed to update entry in palette: ${error}`);
        throw error;
    }
}
export const base = {
    createMutationLogger,
    deleteTable: async (id) => {
        const db = await getDB();
        await db.delete('tables', id);
        console.log(`Table ${id} deleted.`);
    },
    getCurrentPaletteID,
    getCustomColor,
    getDB,
    getLoggedObject,
    getNextPaletteID,
    getNextTableID,
    getSettings,
    getStore,
    getTable,
    listTables: async () => {
        const db = await getDB();
        const keys = await db.getAllKeys('tables');
        return keys.map(String);
    },
    logMutation,
    renderPalette,
    saveData,
    savePalette,
    savePaletteToDB,
    saveSettings,
    trackedTransaction,
    updateCurrentPaletteID,
    updateEntryInPalette
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9pZGIvYmFzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx3QkFBd0I7QUFFeEIsT0FBTyxFQUFtQixNQUFNLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFXOUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUNuQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBRWxDLE1BQU0sZUFBZSxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQztBQUNyRCxNQUFNLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO0FBRXpCLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7QUFDakMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztBQUU3QixTQUFTLG9CQUFvQixDQUFtQixHQUFNLEVBQUUsR0FBVztJQUNsRSxPQUFPLElBQUksS0FBSyxDQUFDLEdBQUcsRUFBRTtRQUNyQixHQUFHLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLO1lBQzFCLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxRQUFtQixDQUFDLENBQUM7WUFDN0MsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBRXJELElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQ2IsV0FBVyxDQUFDO29CQUNYLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtvQkFDbkMsR0FBRztvQkFDSCxNQUFNLEVBQUUsUUFBUTtvQkFDaEIsUUFBUSxFQUFFLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBRSxLQUFLLEVBQUU7b0JBQy9CLFFBQVEsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsUUFBUSxFQUFFO29CQUNsQyxN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Q0FBQyxDQUFDO0lBQ3pCLENBQUM7SUFDRCxXQUFXO0lBQ1gsYUFBYTtJQUNiLFFBQVE7SUFDUixXQUFXO0lBQ1gsZUFBZTtJQUNmLFlBQVk7SUFDWixrQkFBa0I7SUFDbEIsc0JBQXNCO0lBQ3RCLG9CQUFvQjtDQUNYLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBzcmMvaWRiL2Jhc2UudHNcblxuaW1wb3J0IHsgSURCUE9iamVjdFN0b3JlLCBvcGVuREIgfSBmcm9tICdpZGInO1xuaW1wb3J0IHtcblx0SFNMLFxuXHRNdXRhdGlvbkxvZyxcblx0UGFsZXR0ZSxcblx0UGFsZXR0ZURCLFxuXHRQYWxldHRlSXRlbSxcblx0UGFsZXR0ZVNjaGVtYSxcblx0U2V0dGluZ3MsXG5cdFN0b3JlZFBhbGV0dGVcbn0gZnJvbSAnLi4vaW5kZXgnO1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnLi4vY29uZmlnJztcbmltcG9ydCB7IHV0aWxzIH0gZnJvbSAnLi4vY29tbW9uJztcblxuY29uc3QgZGVmYXVsdFNldHRpbmdzID0gY29uZmlnLmRlZmF1bHRzLmlkYi5zZXR0aW5ncztcbmNvbnN0IG1vZGUgPSBjb25maWcubW9kZTtcblxuY29uc3QgbG9nRXJyb3JzID0gbW9kZS5sb2dFcnJvcnM7XG5jb25zdCBxdWlldE1vZGUgPSBtb2RlLnF1aWV0O1xuXG5mdW5jdGlvbiBjcmVhdGVNdXRhdGlvbkxvZ2dlcjxUIGV4dGVuZHMgb2JqZWN0PihvYmo6IFQsIGtleTogc3RyaW5nKTogVCB7XG5cdHJldHVybiBuZXcgUHJveHkob2JqLCB7XG5cdFx0c2V0KHRhcmdldCwgcHJvcGVydHksIHZhbHVlKSB7XG5cdFx0XHRjb25zdCBvbGRWYWx1ZSA9IHRhcmdldFtwcm9wZXJ0eSBhcyBrZXlvZiBUXTtcblx0XHRcdGNvbnN0IHN1Y2Nlc3MgPSBSZWZsZWN0LnNldCh0YXJnZXQsIHByb3BlcnR5LCB2YWx1ZSk7XG5cblx0XHRcdGlmIChzdWNjZXNzKSB7XG5cdFx0XHRcdGxvZ011dGF0aW9uKHtcblx0XHRcdFx0XHR0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcblx0XHRcdFx0XHRrZXksXG5cdFx0XHRcdFx0YWN0aW9uOiAndXBkYXRlJyxcblx0XHRcdFx0XHRuZXdWYWx1ZTogeyBbcHJvcGVydHldOiB2YWx1ZSB9LFxuXHRcdFx0XHRcdG9sZFZhbHVlOiB7IFtwcm9wZXJ0eV06IG9sZFZhbHVlIH0sXG5cdFx0XHRcdFx0b3JpZ2luOiAnUHJveHknXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gc3VjY2Vzcztcblx0XHR9XG5cdH0pO1xufVxuXG5jb25zdCBkYlByb21pc2U6IFByb21pc2U8UGFsZXR0ZURCPiA9IG9wZW5EQjxQYWxldHRlU2NoZW1hPihcblx0J3BhbGV0dGVEYXRhYmFzZScsXG5cdDEsXG5cdHtcblx0XHR1cGdyYWRlKGRiKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHRjb25zdCBzdG9yZXMgPSBbXG5cdFx0XHRcdFx0J2N1c3RvbUNvbG9yJyxcblx0XHRcdFx0XHQnbXV0YXRpb25zJyxcblx0XHRcdFx0XHQnc2V0dGluZ3MnLFxuXHRcdFx0XHRcdCd0YWJsZXMnXG5cdFx0XHRcdF07XG5cblx0XHRcdFx0c3RvcmVzLmZvckVhY2goc3RvcmUgPT4ge1xuXHRcdFx0XHRcdGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhzdG9yZSkpIHtcblx0XHRcdFx0XHRcdGRiLmNyZWF0ZU9iamVjdFN0b3JlKHN0b3JlLCB7XG5cdFx0XHRcdFx0XHRcdGtleVBhdGg6IHN0b3JlID09PSAnbXV0YXRpb25zJyA/ICd0aW1lc3RhbXAnIDogJ2tleSdcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0XHRpZiAobW9kZS5sb2dFcnJvcnMpXG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIEluZGV4ZWREQiB1cGdyYWRlOicsIGVycm9yKTtcblxuXHRcdFx0XHR0aHJvdyBlcnJvcjtcblx0XHRcdH1cblx0XHR9XG5cdH1cbik7XG5cbmFzeW5jIGZ1bmN0aW9uIGdldERCKCk6IFByb21pc2U8UGFsZXR0ZURCPiB7XG5cdHJldHVybiBkYlByb21pc2U7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldEN1cnJlbnRQYWxldHRlSUQoKTogUHJvbWlzZTxudW1iZXI+IHtcblx0Y29uc3QgZGIgPSBhd2FpdCBnZXREQigpO1xuXHRjb25zdCBzZXR0aW5ncyA9IGF3YWl0IGRiLmdldCgnc2V0dGluZ3MnLCAnYXBwU2V0dGluZ3MnKTtcblxuXHRyZXR1cm4gc2V0dGluZ3M/Lmxhc3RQYWxldHRlSUQgPz8gMDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q3VzdG9tQ29sb3IoKTogUHJvbWlzZTxIU0wgfCBudWxsPiB7XG5cdGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcblx0Y29uc3QgZW50cnkgPSBhd2FpdCBkYi5nZXQoJ2N1c3RvbUNvbG9yJywgJ2N1c3RvbUNvbG9yJyk7XG5cblx0cmV0dXJuIGVudHJ5Py5jb2xvclxuXHRcdD8gY3JlYXRlTXV0YXRpb25Mb2dnZXIoZW50cnkuY29sb3IsICdjdXN0b21Db2xvcicpXG5cdFx0OiBudWxsO1xufVxuXG5mdW5jdGlvbiBnZXRMb2dnZWRPYmplY3Q8VCBleHRlbmRzIG9iamVjdD4oXG5cdG9iajogVCB8IG51bGwsXG5cdGtleTogc3RyaW5nXG4pOiBUIHwgbnVsbCB7XG5cdGlmIChvYmopIHtcblx0XHRyZXR1cm4gY3JlYXRlTXV0YXRpb25Mb2dnZXIob2JqLCBrZXkpO1xuXHR9XG5cblx0cmV0dXJuIG51bGw7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE5leHRQYWxldHRlSUQoKTogUHJvbWlzZTxudW1iZXI+IHtcblx0Y29uc3QgY3VycmVudElEID0gYXdhaXQgZ2V0Q3VycmVudFBhbGV0dGVJRCgpO1xuXHRjb25zdCBuZXdJRCA9IGN1cnJlbnRJRCArIDE7XG5cblx0YXdhaXQgdXBkYXRlQ3VycmVudFBhbGV0dGVJRChuZXdJRCk7XG5cblx0cmV0dXJuIG5ld0lEO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXROZXh0VGFibGVJRCgpOiBQcm9taXNlPHN0cmluZz4ge1xuXHRjb25zdCBzZXR0aW5ncyA9IGF3YWl0IGdldFNldHRpbmdzKCk7XG5cdGNvbnN0IG5leHRJRCA9IHNldHRpbmdzLmxhc3RUYWJsZUlEICsgMTtcblxuXHRhd2FpdCBzYXZlRGF0YSgnc2V0dGluZ3MnLCAnYXBwU2V0dGluZ3MnLCB7XG5cdFx0Li4uc2V0dGluZ3MsXG5cdFx0bGFzdFRhYmxlSUQ6IG5leHRJRFxuXHR9KTtcblxuXHRyZXR1cm4gYHBhbGV0dGVfJHtuZXh0SUR9YDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0U2V0dGluZ3MoKTogUHJvbWlzZTxTZXR0aW5ncz4ge1xuXHR0cnkge1xuXHRcdGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcblx0XHRjb25zdCBzZXR0aW5ncyA9IGF3YWl0IGRiLmdldCgnc2V0dGluZ3MnLCAnYXBwU2V0dGluZ3MnKTtcblxuXHRcdHJldHVybiBzZXR0aW5ncyA/PyBkZWZhdWx0U2V0dGluZ3M7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKG1vZGUubG9nRXJyb3JzKSBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBzZXR0aW5nczonLCBlcnJvcik7XG5cblx0XHRyZXR1cm4geyBjb2xvclNwYWNlOiAnaGV4JywgbGFzdFRhYmxlSUQ6IDAgfTtcblx0fVxufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRUYWJsZShpZDogc3RyaW5nKTogUHJvbWlzZTxTdG9yZWRQYWxldHRlIHwgbnVsbD4ge1xuXHRjb25zdCBkYiA9IGF3YWl0IGdldERCKCk7XG5cdGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmdldCgndGFibGVzJywgaWQpO1xuXG5cdGlmICghcmVzdWx0KSB7XG5cdFx0aWYgKG1vZGUubG9nRXJyb3JzKSBjb25zb2xlLndhcm4oYFRhYmxlIHdpdGggSUQgJHtpZH0gbm90IGZvdW5kLmApO1xuXHR9XG5cdHJldHVybiByZXN1bHQ7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldFN0b3JlPFN0b3JlTmFtZSBleHRlbmRzIGtleW9mIFBhbGV0dGVTY2hlbWE+KFxuXHRzdG9yZU5hbWU6IFN0b3JlTmFtZSxcblx0bW9kZTogJ3JlYWRvbmx5J1xuKTogUHJvbWlzZTxJREJQT2JqZWN0U3RvcmU8UGFsZXR0ZVNjaGVtYSwgW1N0b3JlTmFtZV0sIFN0b3JlTmFtZSwgJ3JlYWRvbmx5Jz4+O1xuXG5hc3luYyBmdW5jdGlvbiBnZXRTdG9yZTxTdG9yZU5hbWUgZXh0ZW5kcyBrZXlvZiBQYWxldHRlU2NoZW1hPihcblx0c3RvcmVOYW1lOiBTdG9yZU5hbWUsXG5cdG1vZGU6ICdyZWFkd3JpdGUnXG4pOiBQcm9taXNlPElEQlBPYmplY3RTdG9yZTxQYWxldHRlU2NoZW1hLCBbU3RvcmVOYW1lXSwgU3RvcmVOYW1lLCAncmVhZHdyaXRlJz4+O1xuXG5hc3luYyBmdW5jdGlvbiBnZXRTdG9yZTxTdG9yZU5hbWUgZXh0ZW5kcyBrZXlvZiBQYWxldHRlU2NoZW1hPihcblx0c3RvcmVOYW1lOiBTdG9yZU5hbWUsXG5cdG1vZGU6ICdyZWFkb25seScgfCAncmVhZHdyaXRlJ1xuKSB7XG5cdGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcblxuXHRyZXR1cm4gZGIudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBtb2RlKS5vYmplY3RTdG9yZShzdG9yZU5hbWUpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBsb2dNdXRhdGlvbihsb2c6IE11dGF0aW9uTG9nKTogUHJvbWlzZTx2b2lkPiB7XG5cdGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcblxuXHRhd2FpdCBkYi5wdXQoJ211dGF0aW9ucycsIGxvZyk7XG5cblx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZyhgTG9nZ2VkIG11dGF0aW9uOiAke0pTT04uc3RyaW5naWZ5KGxvZyl9YCk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHJlbmRlclBhbGV0dGUodGFibGVJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG5cdHRyeSB7XG5cdFx0Y29uc3Qgc3RvcmVkUGFsZXR0ZSA9IGF3YWl0IGdldFRhYmxlKHRhYmxlSWQpO1xuXHRcdGNvbnN0IHBhbGV0dGVSb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFsZXR0ZS1yb3cnKTtcblxuXHRcdGlmICghc3RvcmVkUGFsZXR0ZSkgdGhyb3cgbmV3IEVycm9yKGBQYWxldHRlICR7dGFibGVJZH0gbm90IGZvdW5kLmApO1xuXHRcdGlmICghcGFsZXR0ZVJvdykgdGhyb3cgbmV3IEVycm9yKCdQYWxldHRlIHJvdyBlbGVtZW50IG5vdCBmb3VuZC4nKTtcblxuXHRcdHBhbGV0dGVSb3cuaW5uZXJIVE1MID0gJyc7XG5cblx0XHRjb25zdCBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcblx0XHRjb25zdCB0YWJsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RhYmxlJyk7XG5cdFx0dGFibGUuY2xhc3NMaXN0LmFkZCgncGFsZXR0ZS10YWJsZScpO1xuXG5cdFx0c3RvcmVkUGFsZXR0ZS5wYWxldHRlLml0ZW1zLmZvckVhY2goKGl0ZW0sIGluZGV4KSA9PiB7XG5cdFx0XHRjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xuXHRcdFx0Y29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XG5cdFx0XHRjb25zdCBjb2xvckJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG5cdFx0XHRjZWxsLnRleHRDb250ZW50ID0gYENvbG9yICR7aW5kZXggKyAxfWA7XG5cdFx0XHRjb2xvckJveC5jbGFzc0xpc3QuYWRkKCdjb2xvci1ib3gnKTtcblx0XHRcdGNvbG9yQm94LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGl0ZW0uY3NzU3RyaW5ncy5oZXhDU1NTdHJpbmc7XG5cblx0XHRcdHJvdy5hcHBlbmRDaGlsZChjb2xvckJveCk7XG5cdFx0XHRyb3cuYXBwZW5kQ2hpbGQoY2VsbCk7XG5cdFx0XHR0YWJsZS5hcHBlbmRDaGlsZChyb3cpO1xuXHRcdH0pO1xuXG5cdFx0ZnJhZ21lbnQuYXBwZW5kQ2hpbGQodGFibGUpO1xuXHRcdHBhbGV0dGVSb3cuYXBwZW5kQ2hpbGQoZnJhZ21lbnQpO1xuXG5cdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZyhgUmVuZGVyZWQgcGFsZXR0ZSAke3RhYmxlSWR9LmApO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChtb2RlLmxvZ0Vycm9ycykgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHJlbmRlciBwYWxldHRlOiAke2Vycm9yfWApO1xuXHR9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNhdmVEYXRhPFQ+KFxuXHRzdG9yZU5hbWU6IGtleW9mIFBhbGV0dGVTY2hlbWEsXG5cdGtleTogc3RyaW5nLFxuXHRkYXRhOiBULFxuXHRvbGRWYWx1ZT86IFRcbik6IFByb21pc2U8dm9pZD4ge1xuXHR0cnkge1xuXHRcdGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcblx0XHRjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKHN0b3JlTmFtZSwgJ3JlYWR3cml0ZScpO1xuXHRcdGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoc3RvcmVOYW1lKTtcblxuXHRcdGF3YWl0IHN0b3JlLnB1dCh7IGtleSwgLi4uZGF0YSB9KTtcblx0XHRhd2FpdCB0eC5kb25lO1xuXG5cdFx0Y29uc29sZS5sb2coYCR7a2V5fSBzYXZlZCB0byAke3N0b3JlTmFtZX0uYCk7XG5cblx0XHRhd2FpdCBsb2dNdXRhdGlvbih7XG5cdFx0XHR0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcblx0XHRcdGtleSxcblx0XHRcdGFjdGlvbjogJ3VwZGF0ZScsXG5cdFx0XHRuZXdWYWx1ZTogZGF0YSxcblx0XHRcdG9sZFZhbHVlOiBvbGRWYWx1ZSA/IG9sZFZhbHVlIDogbnVsbCxcblx0XHRcdG9yaWdpbjogJ3NhdmVEYXRhJ1xuXHRcdH0pO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGlmIChtb2RlLmxvZ0Vycm9ycylcblx0XHRcdGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBzYXZlIGRhdGEgdG8gJHtzdG9yZU5hbWV9OmAsIGVycm9yKTtcblxuXHRcdHRocm93IGVycm9yO1xuXHR9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNhdmVQYWxldHRlKFxuXHRpZDogc3RyaW5nLFxuXHRuZXdQYWxldHRlOiBTdG9yZWRQYWxldHRlXG4pOiBQcm9taXNlPHZvaWQ+IHtcblx0dHJ5IHtcblx0XHRjb25zdCBzdG9yZSA9IGF3YWl0IGdldFN0b3JlKCd0YWJsZXMnLCAncmVhZHdyaXRlJyk7XG5cdFx0Y29uc3QgcGFsZXR0ZVRvU2F2ZTogU3RvcmVkUGFsZXR0ZSA9IHtcblx0XHRcdHRhYmxlSUQ6IG5ld1BhbGV0dGUudGFibGVJRCxcblx0XHRcdHBhbGV0dGU6IG5ld1BhbGV0dGUucGFsZXR0ZVxuXHRcdH07XG5cblx0XHRhd2FpdCBzdG9yZS5wdXQoeyBrZXk6IGlkLCAuLi5wYWxldHRlVG9TYXZlIH0pO1xuXG5cdFx0aWYgKCFtb2RlLnF1aWV0KSBjb25zb2xlLmxvZyhgUGFsZXR0ZSAke2lkfSBzYXZlZCBzdWNjZXNzZnVsbHkuYCk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKG1vZGUubG9nRXJyb3JzKVxuXHRcdFx0Y29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHNhdmUgcGFsZXR0ZSAke2lkfTogJHtlcnJvcn1gKTtcblxuXHRcdHRocm93IGVycm9yO1xuXHR9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHNhdmVQYWxldHRlVG9EQihcblx0dHlwZTogc3RyaW5nLFxuXHRpdGVtczogUGFsZXR0ZUl0ZW1bXSxcblx0YmFzZUNvbG9yOiBIU0wsXG5cdG51bUJveGVzOiBudW1iZXIsXG5cdGVuYWJsZUFscGhhOiBib29sZWFuLFxuXHRsaW1pdEJyaWdodDogYm9vbGVhbixcblx0bGltaXREYXJrOiBib29sZWFuLFxuXHRsaW1pdEdyYXk6IGJvb2xlYW5cbik6IFByb21pc2U8UGFsZXR0ZT4ge1xuXHRjb25zdCBwYWxldHRlSUQgPSBhd2FpdCBnZXROZXh0UGFsZXR0ZUlEKCk7XG5cblx0Y29uc3QgbmV3UGFsZXR0ZSA9IHV0aWxzLnBhbGV0dGUuY3JlYXRlT2JqZWN0KFxuXHRcdHR5cGUsXG5cdFx0aXRlbXMsXG5cdFx0YmFzZUNvbG9yLFxuXHRcdHBhbGV0dGVJRCxcblx0XHRudW1Cb3hlcyxcblx0XHRlbmFibGVBbHBoYSxcblx0XHRsaW1pdEJyaWdodCxcblx0XHRsaW1pdERhcmssXG5cdFx0bGltaXRHcmF5XG5cdCk7XG5cblx0YXdhaXQgc2F2ZVBhbGV0dGUobmV3UGFsZXR0ZS5pZCwge1xuXHRcdHRhYmxlSUQ6IHBhcnNlSW50KG5ld1BhbGV0dGUuaWQuc3BsaXQoJ18nKVsxXSksXG5cdFx0cGFsZXR0ZTogbmV3UGFsZXR0ZVxuXHR9KTtcblxuXHRpZiAoIW1vZGUucXVpZXQpXG5cdFx0Y29uc29sZS5sb2coYFNhdmVkICR7dHlwZX0gcGFsZXR0ZTogJHtKU09OLnN0cmluZ2lmeShuZXdQYWxldHRlKX1gKTtcblxuXHRyZXR1cm4gbmV3UGFsZXR0ZTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gc2F2ZVNldHRpbmdzKG5ld1NldHRpbmdzOiBTZXR0aW5ncyk6IFByb21pc2U8dm9pZD4ge1xuXHR0cnkge1xuXHRcdGF3YWl0IHNhdmVEYXRhKCdzZXR0aW5ncycsICdhcHBTZXR0aW5ncycsIG5ld1NldHRpbmdzKTtcblxuXHRcdGlmICghbW9kZS5xdWlldCkgY29uc29sZS5sb2coJ1NldHRpbmdzIHVwZGF0ZWQnKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobW9kZS5sb2dFcnJvcnMpIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBzYXZlIHNldHRpbmdzOiAke2Vycm9yfWApO1xuXG5cdFx0dGhyb3cgZXJyb3I7XG5cdH1cbn1cblxuYXN5bmMgZnVuY3Rpb24gdHJhY2tlZFRyYW5zYWN0aW9uPFN0b3JlTmFtZSBleHRlbmRzIGtleW9mIFBhbGV0dGVTY2hlbWE+KFxuXHRzdG9yZU5hbWU6IFN0b3JlTmFtZSxcblx0bW9kZTogJ3JlYWRvbmx5JyB8ICdyZWFkd3JpdGUnLFxuXHRjYWxsYmFjazogKFxuXHRcdHN0b3JlOiBJREJQT2JqZWN0U3RvcmU8XG5cdFx0XHRQYWxldHRlU2NoZW1hLFxuXHRcdFx0W1N0b3JlTmFtZV0sXG5cdFx0XHRTdG9yZU5hbWUsXG5cdFx0XHQncmVhZG9ubHknIHwgJ3JlYWR3cml0ZSdcblx0XHQ+XG5cdCkgPT4gUHJvbWlzZTx2b2lkPlxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdGNvbnN0IGRiID0gYXdhaXQgZ2V0REIoKTtcblx0Y29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihzdG9yZU5hbWUsIG1vZGUpO1xuXHRjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKHN0b3JlTmFtZSk7XG5cblx0dHJ5IHtcblx0XHRhd2FpdCBjYWxsYmFjayhzdG9yZSk7XG5cdFx0YXdhaXQgdHguZG9uZTtcblxuXHRcdGlmICghcXVpZXRNb2RlKSBjb25zb2xlLmxvZyhgVHJhbnNhY3Rpb24gb24gJHtzdG9yZU5hbWV9IGNvbXBsZXRlZC5gKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRpZiAobG9nRXJyb3JzKVxuXHRcdFx0Y29uc29sZS5lcnJvcihgVHJhbnNhY3Rpb24gb24gJHtzdG9yZU5hbWV9IGZhaWxlZDogJHtlcnJvcn1gKTtcblxuXHRcdHRocm93IGVycm9yO1xuXHR9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZUN1cnJlbnRQYWxldHRlSUQobmV3SUQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuXHRjb25zdCBkYiA9IGF3YWl0IGdldERCKCk7XG5cdGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3NldHRpbmdzJywgJ3JlYWR3cml0ZScpO1xuXHRjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdzZXR0aW5ncycpO1xuXG5cdGF3YWl0IHN0b3JlLnB1dCh7IGtleTogJ2FwcFNldHRpbmdzJywgbGFzdFBhbGV0dGVJRDogbmV3SUQgfSk7XG5cdGF3YWl0IHR4LmRvbmU7XG5cblx0aWYgKCFxdWlldE1vZGUpIGNvbnNvbGUubG9nKGBDdXJyZW50IHBhbGV0dGUgSUQgdXBkYXRlZCB0byAke25ld0lEfWApO1xufVxuXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVFbnRyeUluUGFsZXR0ZShcblx0dGFibGVJRDogc3RyaW5nLFxuXHRlbnRyeUluZGV4OiBudW1iZXIsXG5cdG5ld0VudHJ5OiBQYWxldHRlSXRlbVxuKTogUHJvbWlzZTx2b2lkPiB7XG5cdHRyeSB7XG5cdFx0Y29uc3Qgc3RvcmVkUGFsZXR0ZSA9IGF3YWl0IGdldFRhYmxlKHRhYmxlSUQpO1xuXG5cdFx0aWYgKCFzdG9yZWRQYWxldHRlKSB0aHJvdyBuZXcgRXJyb3IoYFBhbGV0dGUgJHt0YWJsZUlEfSBub3QgZm91bmQuYCk7XG5cblx0XHRjb25zdCB7IGl0ZW1zIH0gPSBzdG9yZWRQYWxldHRlLnBhbGV0dGU7XG5cblx0XHRpZiAoZW50cnlJbmRleCA+PSBpdGVtcy5sZW5ndGgpIHtcblx0XHRcdGlmICghbW9kZS5ncmFjZWZ1bEVycm9ycylcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRcdGBFbnRyeSAke2VudHJ5SW5kZXh9IG5vdCBmb3VuZCBpbiBwYWxldHRlICR7dGFibGVJRH0uYFxuXHRcdFx0XHQpO1xuXHRcdFx0aWYgKGxvZ0Vycm9ycylcblx0XHRcdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdFx0XHRgRW50cnkgJHtlbnRyeUluZGV4fSBub3QgZm91bmQgaW4gcGFsZXR0ZSAke3RhYmxlSUR9LmBcblx0XHRcdFx0KTtcblx0XHRcdGlmICghcXVpZXRNb2RlKVxuXHRcdFx0XHRjb25zb2xlLmxvZygndXBkYXRlRW50cnlJblBhbGV0dGU6IEVudHJ5IG5vdCBmb3VuZC4nKTtcblx0XHR9XG5cblx0XHRjb25zdCBvbGRFbnRyeSA9IGl0ZW1zW2VudHJ5SW5kZXhdO1xuXHRcdGl0ZW1zW2VudHJ5SW5kZXhdID0gbmV3RW50cnk7XG5cblx0XHRhd2FpdCBzYXZlRGF0YSgndGFibGVzJywgdGFibGVJRCwgc3RvcmVkUGFsZXR0ZSk7XG5cdFx0YXdhaXQgbG9nTXV0YXRpb24oe1xuXHRcdFx0dGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG5cdFx0XHRrZXk6IGAke3RhYmxlSUR9LSR7ZW50cnlJbmRleH1dYCxcblx0XHRcdGFjdGlvbjogJ3VwZGF0ZScsXG5cdFx0XHRuZXdWYWx1ZTogbmV3RW50cnksXG5cdFx0XHRvbGRWYWx1ZTogb2xkRW50cnksXG5cdFx0XHRvcmlnaW46ICd1cGRhdGVFbnRyeUluUGFsZXR0ZSdcblx0XHR9KTtcblxuXHRcdGlmICghcXVpZXRNb2RlKVxuXHRcdFx0Y29uc29sZS5sb2coYEVudHJ5ICR7ZW50cnlJbmRleH0gaW4gcGFsZXR0ZSAke3RhYmxlSUR9IHVwZGF0ZWQuYCk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0aWYgKGxvZ0Vycm9ycylcblx0XHRcdGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byB1cGRhdGUgZW50cnkgaW4gcGFsZXR0ZTogJHtlcnJvcn1gKTtcblxuXHRcdHRocm93IGVycm9yO1xuXHR9XG59XG5cbmV4cG9ydCBjb25zdCBiYXNlID0ge1xuXHRjcmVhdGVNdXRhdGlvbkxvZ2dlcixcblx0ZGVsZXRlVGFibGU6IGFzeW5jIChpZDogc3RyaW5nKSA9PiB7XG5cdFx0Y29uc3QgZGIgPSBhd2FpdCBnZXREQigpO1xuXHRcdGF3YWl0IGRiLmRlbGV0ZSgndGFibGVzJywgaWQpO1xuXHRcdGNvbnNvbGUubG9nKGBUYWJsZSAke2lkfSBkZWxldGVkLmApO1xuXHR9LFxuXHRnZXRDdXJyZW50UGFsZXR0ZUlELFxuXHRnZXRDdXN0b21Db2xvcixcblx0Z2V0REIsXG5cdGdldExvZ2dlZE9iamVjdCxcblx0Z2V0TmV4dFBhbGV0dGVJRCxcblx0Z2V0TmV4dFRhYmxlSUQsXG5cdGdldFNldHRpbmdzLFxuXHRnZXRTdG9yZSxcblx0Z2V0VGFibGUsXG5cdGxpc3RUYWJsZXM6IGFzeW5jICgpID0+IHtcblx0XHRjb25zdCBkYiA9IGF3YWl0IGdldERCKCk7XG5cdFx0Y29uc3Qga2V5cyA9IGF3YWl0IGRiLmdldEFsbEtleXMoJ3RhYmxlcycpO1xuXHRcdHJldHVybiBrZXlzLm1hcChTdHJpbmcpO1xuXHR9LFxuXHRsb2dNdXRhdGlvbixcblx0cmVuZGVyUGFsZXR0ZSxcblx0c2F2ZURhdGEsXG5cdHNhdmVQYWxldHRlLFxuXHRzYXZlUGFsZXR0ZVRvREIsXG5cdHNhdmVTZXR0aW5ncyxcblx0dHJhY2tlZFRyYW5zYWN0aW9uLFxuXHR1cGRhdGVDdXJyZW50UGFsZXR0ZUlELFxuXHR1cGRhdGVFbnRyeUluUGFsZXR0ZVxufSBhcyBjb25zdDtcbiJdfQ==