import { convertColors, showTooltip } from '../dom/dom-main.js';
import { attachDragAndDropEventListeners } from '../dom/drag-and-drop.js';
import { guards } from '../utils/type-guards.js';
// defines buttons for the main UI
function defineUIButtons() {
    const generateButton = document.getElementById('generate-button');
    const saturateButton = document.getElementById('saturate-button');
    const desaturateButton = document.getElementById('desaturate-button');
    const popupDivButton = document.getElementById('custom-color-button');
    const applyCustomColorButton = document.getElementById('apply-custom-color-button');
    const clearCustomColorButton = document.getElementById('clear-custom-color-button');
    const advancedMenuToggleButton = document.getElementById('advanced-menu-toggle-button');
    const applyInitialColorSpaceButton = document.getElementById('apply-initial-color-space-button');
    const selectedColorOptions = document.getElementById('selected-color-options');
    const selectedColor = selectedColorOptions
        ? parseInt(selectedColorOptions.value, 10)
        : 0;
    return {
        generateButton,
        saturateButton,
        desaturateButton,
        popupDivButton,
        applyCustomColorButton,
        clearCustomColorButton,
        advancedMenuToggleButton,
        applyInitialColorSpaceButton,
        selectedColor
    };
}
// add conversion button event listeners
function addConversionButtonEventListeners() {
    const addListener = (id, colorSpace) => {
        const button = document.getElementById(id);
        if (button) {
            button.addEventListener('click', () => convertColors(colorSpace));
        }
        else {
            console.warn(`Element with id "${id}" not found.`);
        }
    };
    addListener('hex-conversion-button', 'hex');
    addListener('rgb-conversion-button', 'rgb');
    addListener('hsv-conversion-button', 'hsv');
    addListener('hsl-conversion-button', 'hsl');
    addListener('cmyk-conversion-button', 'cmyk');
    addListener('lab-conversion-button', 'lab');
}
function makePaletteBox(colorValues, paletteBoxCount) {
    // create main palette box container
    const paletteBox = document.createElement('div');
    paletteBox.className = 'palette-box';
    paletteBox.id = `palette-box-${paletteBoxCount}`;
    // create top half of palette box
    const paletteBoxTopHalf = document.createElement('div');
    paletteBoxTopHalf.className = 'palette-box-half palette-box-top-half';
    paletteBoxTopHalf.id = `palette-box-top-half-${paletteBoxCount}`;
    // create input element with extended type
    const colorTextOutputBox = document.createElement('input');
    colorTextOutputBox.type = 'text';
    colorTextOutputBox.className = 'color-text-output-box tooltip';
    colorTextOutputBox.id = `color-text-output-box-${paletteBoxCount}`;
    colorTextOutputBox.setAttribute('data-format', 'hex');
    // access nested properties safely using type guard(s)
    if (colorValues.format === 'hex' && 'value' in colorValues) {
        colorTextOutputBox.value = colorValues.value.hex;
    }
    else {
        console.warn(`Hex value not found for palette-box #${paletteBoxCount}`);
        colorTextOutputBox.value = '';
    }
    // store color values within input element
    colorTextOutputBox.colorValues = colorValues;
    colorTextOutputBox.readOnly = false;
    colorTextOutputBox.style.cursor = 'text';
    // create copy button
    const copyButton = document.createElement('button');
    copyButton.className = 'copy-button';
    copyButton.textContent = 'Copy';
    const tooltipText = document.createElement('span');
    tooltipText.className = 'tooltiptext';
    tooltipText.textContent = 'Copied to clipboard!';
    // add clipboard functionality to copy button
    copyButton.addEventListener('click', async () => {
        try {
            await navigator.clipboard.writeText(colorTextOutputBox.value);
            showTooltip(colorTextOutputBox);
        }
        catch (error) {
            console.error(`Failed to copy: ${error}`);
        }
    });
    // add event listener for input changes
    colorTextOutputBox.addEventListener('input', e => {
        const target = e.target;
        if (target && /^#[0-9A-F]{6}$%/i.test(target.value)) {
            const boxElement = document.getElementById(`color-box-${paletteBoxCount}`);
            const stripeElement = document.getElementById(`color-stripe-${paletteBoxCount}`);
            if (boxElement)
                boxElement.style.backgroundColor = target.value;
            if (stripeElement)
                stripeElement.style.backgroundColor = target.value;
        }
    });
    // appends elements to top half
    paletteBoxTopHalf.appendChild(colorTextOutputBox);
    paletteBoxTopHalf.appendChild(copyButton);
    // create bottom half of palette box
    const paletteBoxBottomHalf = document.createElement('div');
    paletteBoxBottomHalf.className = 'palette-box-half palette-box-bottom-half';
    paletteBoxBottomHalf.id = `palette-box-bottom-half-${paletteBoxCount}`;
    // create color box
    const colorBox = document.createElement('div');
    colorBox.className = 'color-box';
    colorBox.id = `color-box-${paletteBoxCount}`;
    if (colorValues.value && 'hsl' in colorValues.value) {
        const hslString = colorValues.value.hsl;
        colorBox.style.backgroundColor = hslString;
    }
    else {
        colorBox.style.backgroundColor = '#ffffff'; // default color
    }
    paletteBoxBottomHalf.appendChild(colorBox);
    // append halves to main palette box
    paletteBox.appendChild(paletteBoxTopHalf);
    paletteBox.appendChild(paletteBoxBottomHalf);
    // create color stripe
    const colorStripe = document.createElement('div');
    colorStripe.className = 'color-stripe';
    colorStripe.id = `color-stripe-${paletteBoxCount}`;
    if (colorValues.value && 'hsl' in colorValues.value) {
        colorStripe.style.backgroundColor = colorValues.value.hsl;
    }
    colorStripe.setAttribute('draggable', 'true');
    attachDragAndDropEventListeners(colorStripe);
    // append palette box to color stripe
    colorStripe.appendChild(paletteBox);
    return {
        colorStripe,
        paletteBoxCount: paletteBoxCount + 1
    };
}
//extracts user-defined parameters
function pullParamsFromUI() {
    const paletteTypeElement = document.getElementById('palette-type-options');
    const numBoxesElement = document.getElementById('palette-number-options');
    const initialColorSpaceElement = document.getElementById('initial-color-space-options');
    const paletteType = paletteTypeElement
        ? parseInt(paletteTypeElement.value, 10)
        : 0;
    const numBoxes = numBoxesElement ? parseInt(numBoxesElement.value, 10) : 0;
    const initialColorSpace = initialColorSpaceElement &&
        guards.isColorSpace(initialColorSpaceElement.value)
        ? initialColorSpaceElement.value
        : 'hex';
    return {
        paletteType,
        numBoxes,
        initialColorSpace
    };
}
export const domHelpers = {
    defineUIButtons,
    addConversionButtonEventListeners,
    makePaletteBox,
    pullParamsFromUI
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2hlbHBlcnMvZG9tLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxhQUFhLEVBQUUsV0FBVyxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDN0QsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDdkUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRTlDLGtDQUFrQztBQUNsQyxTQUFTLGVBQWU7SUFDdkIsTUFBTSxjQUFjLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ2xFLE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNsRSxNQUFNLGdCQUFnQixHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsQ0FBQztJQUN0RSxNQUFNLGNBQWMsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDdEUsTUFBTSxzQkFBc0IsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUNyRCwyQkFBMkIsQ0FDM0IsQ0FBQztJQUNGLE1BQU0sc0JBQXNCLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FDckQsMkJBQTJCLENBQzNCLENBQUM7SUFDRixNQUFNLHdCQUF3QixHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQ3ZELDZCQUE2QixDQUM3QixDQUFDO0lBQ0YsTUFBTSw0QkFBNEIsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUMzRCxrQ0FBa0MsQ0FDbEMsQ0FBQztJQUNGLE1BQU0sb0JBQW9CLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FDbkQsd0JBQXdCLENBQ0ksQ0FBQztJQUM5QixNQUFNLGFBQWEsR0FBRyxvQkFBb0I7UUFDekMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxLQUFLLEVBQUUsRUFBRSxD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ZUFBZSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzNFLE1BQU0saUJBQWlCLEdBQ3RCLHdCQUF3QjtRQUN4QixNQUFNLENBQUMsWUFBWSxDQUFDLHdCQUF3QixDQUFDLEtBQUssQ0FBQztRQUNsRCxDQUFDLENBQUMsd0JBQXdCLENBQUMsS0FBSztRQUNoQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBRVYsT0FBTztRQUNOLFdBQVc7UUFDWCxRQUFRO1FBQ1IsaUJBQWlCO0tBQ2pCLENBQUM7QUFDSCxDQUFDO0FBRUQsTUFBTSxDQUFDLE1BQU0sVUFBVSxHQUFHO0lBQ3pCLGVBQWU7SUFDZixpQ0FBaUM7SUFDakMsY0FBYztJQUNkLGdCQUFnQjtDQUNoQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgdHlwZXMgZnJvbSAnLi4vaW5kZXgnO1xuaW1wb3J0IHsgY29udmVydENvbG9ycywgc2hvd1Rvb2x0aXAgfSBmcm9tICcuLi9kb20vZG9tLW1haW4nO1xuaW1wb3J0IHsgYXR0YWNoRHJhZ0FuZERyb3BFdmVudExpc3RlbmVycyB9IGZyb20gJy4uL2RvbS9kcmFnLWFuZC1kcm9wJztcbmltcG9ydCB7IGd1YXJkcyB9IGZyb20gJy4uL3V0aWxzL3R5cGUtZ3VhcmRzJztcblxuLy8gZGVmaW5lcyBidXR0b25zIGZvciB0aGUgbWFpbiBVSVxuZnVuY3Rpb24gZGVmaW5lVUlCdXR0b25zKCk6IHR5cGVzLlVJQnV0dG9ucyB7XG5cdGNvbnN0IGdlbmVyYXRlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dlbmVyYXRlLWJ1dHRvbicpO1xuXHRjb25zdCBzYXR1cmF0ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzYXR1cmF0ZS1idXR0b24nKTtcblx0Y29uc3QgZGVzYXR1cmF0ZUJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXNhdHVyYXRlLWJ1dHRvbicpO1xuXHRjb25zdCBwb3B1cERpdkJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXN0b20tY29sb3ItYnV0dG9uJyk7XG5cdGNvbnN0IGFwcGx5Q3VzdG9tQ29sb3JCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHQnYXBwbHktY3VzdG9tLWNvbG9yLWJ1dHRvbidcblx0KTtcblx0Y29uc3QgY2xlYXJDdXN0b21Db2xvckJ1dHRvbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdCdjbGVhci1jdXN0b20tY29sb3ItYnV0dG9uJ1xuXHQpO1xuXHRjb25zdCBhZHZhbmNlZE1lbnVUb2dnbGVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHQnYWR2YW5jZWQtbWVudS10b2dnbGUtYnV0dG9uJ1xuXHQpO1xuXHRjb25zdCBhcHBseUluaXRpYWxDb2xvclNwYWNlQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG5cdFx0J2FwcGx5LWluaXRpYWwtY29sb3Itc3BhY2UtYnV0dG9uJ1xuXHQpO1xuXHRjb25zdCBzZWxlY3RlZENvbG9yT3B0aW9ucyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdCdzZWxlY3RlZC1jb2xvci1vcHRpb25zJ1xuXHQpIGFzIEhUTUxTZWxlY3RFbGVtZW50IHwgbnVsbDtcblx0Y29uc3Qgc2VsZWN0ZWRDb2xvciA9IHNlbGVjdGVkQ29sb3JPcHRpb25zXG5cdFx0PyBwYXJzZUludChzZWxlY3RlZENvbG9yT3B0aW9ucy52YWx1ZSwgMTApXG5cdFx0OiAwO1xuXG5cdHJldHVybiB7XG5cdFx0Z2VuZXJhdGVCdXR0b24sXG5cdFx0c2F0dXJhdGVCdXR0b24sXG5cdFx0ZGVzYXR1cmF0ZUJ1dHRvbixcblx0XHRwb3B1cERpdkJ1dHRvbixcblx0XHRhcHBseUN1c3RvbUNvbG9yQnV0dG9uLFxuXHRcdGNsZWFyQ3VzdG9tQ29sb3JCdXR0b24sXG5cdFx0YWR2YW5jZWRNZW51VG9nZ2xlQnV0dG9uLFxuXHRcdGFwcGx5SW5pdGlhbENvbG9yU3BhY2VCdXR0b24sXG5cdFx0c2VsZWN0ZWRDb2xvclxuXHR9O1xufVxuXG4vLyBhZGQgY29udmVyc2lvbiBidXR0b24gZXZlbnQgbGlzdGVuZXJzXG5mdW5jdGlvbiBhZGRDb252ZXJzaW9uQnV0dG9uRXZlbnRMaXN0ZW5lcnMoKSB7XG5cdGNvbnN0IGFkZExpc3RlbmVyID0gKGlkOiBzdHJpbmcsIGNvbG9yU3BhY2U6IGtleW9mIHR5cGVzLkNvbnZlcnNpb25NYXApID0+IHtcblx0XHRjb25zdCBidXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCkgYXMgSFRNTEJ1dHRvbkVsZW1lbnQgfCBudWxsO1xuXG5cdFx0aWYgKGJ1dHRvbikge1xuXHRcdFx0YnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gY29udmVydENvbG9ycyhjb2xvclNwYWNlKSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdGNvbnNvbGUud2FybihgRWxlbWVudCB3aXRoIGlkIFwiJHtpZH1cIiBub3QgZm91bmQuYCk7XG5cdFx0fVxuXHR9O1xuXG5cdGFkZExpc3RlbmVyKCdoZXgtY29udmVyc2lvbi1idXR0b24nLCAnaGV4Jyk7XG5cdGFkZExpc3RlbmVyKCdyZ2ItY29udmVyc2lvbi1idXR0b24nLCAncmdiJyk7XG5cdGFkZExpc3RlbmVyKCdoc3YtY29udmVyc2lvbi1idXR0b24nLCAnaHN2Jyk7XG5cdGFkZExpc3RlbmVyKCdoc2wtY29udmVyc2lvbi1idXR0b24nLCAnaHNsJyk7XG5cdGFkZExpc3RlbmVyKCdjbXlrLWNvbnZlcnNpb24tYnV0dG9uJywgJ2NteWsnKTtcblx0YWRkTGlzdGVuZXIoJ2xhYi1jb252ZXJzaW9uLWJ1dHRvbicsICdsYWInKTtcbn1cblxuZnVuY3Rpb24gbWFrZVBhbGV0dGVCb3goXG5cdGNvbG9yVmFsdWVzOiB0eXBlcy5Db2xvck9iamVjdERhdGEsXG5cdHBhbGV0dGVCb3hDb3VudDogbnVtYmVyXG4pOiB7XG5cdGNvbG9yU3RyaXBlOiBIVE1MRGl2RWxlbWVudDtcblx0cGFsZXR0ZUJveENvdW50OiBudW1iZXI7XG59IHtcblx0Ly8gY3JlYXRlIG1haW4gcGFsZXR0ZSBib3ggY29udGFpbmVyXG5cdGNvbnN0IHBhbGV0dGVCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0cGFsZXR0ZUJveC5jbGFzc05hbWUgPSAncGFsZXR0ZS1ib3gnO1xuXHRwYWxldHRlQm94LmlkID0gYHBhbGV0dGUtYm94LSR7cGFsZXR0ZUJveENvdW50fWA7XG5cblx0Ly8gY3JlYXRlIHRvcCBoYWxmIG9mIHBhbGV0dGUgYm94XG5cdGNvbnN0IHBhbGV0dGVCb3hUb3BIYWxmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdHBhbGV0dGVCb3hUb3BIYWxmLmNsYXNzTmFtZSA9ICdwYWxldHRlLWJveC1oYWxmIHBhbGV0dGUtYm94LXRvcC1oYWxmJztcblx0cGFsZXR0ZUJveFRvcEhhbGYuaWQgPSBgcGFsZXR0ZS1ib3gtdG9wLWhhbGYtJHtwYWxldHRlQm94Q291bnR9YDtcblxuXHQvLyBjcmVhdGUgaW5wdXQgZWxlbWVudCB3aXRoIGV4dGVuZGVkIHR5cGVcblx0Y29uc3QgY29sb3JUZXh0T3V0cHV0Qm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcblx0XHQnaW5wdXQnXG5cdCkgYXMgdHlwZXMuQ29sb3JJbnB1dEVsZW1lbnQ7XG5cdGNvbG9yVGV4dE91dHB1dEJveC50eXBlID0gJ3RleHQnO1xuXHRjb2xvclRleHRPdXRwdXRCb3guY2xhc3NOYW1lID0gJ2NvbG9yLXRleHQtb3V0cHV0LWJveCB0b29sdGlwJztcblx0Y29sb3JUZXh0T3V0cHV0Qm94LmlkID0gYGNvbG9yLXRleHQtb3V0cHV0LWJveC0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXHRjb2xvclRleHRPdXRwdXRCb3guc2V0QXR0cmlidXRlKCdkYXRhLWZvcm1hdCcsICdoZXgnKTtcblxuXHQvLyBhY2Nlc3MgbmVzdGVkIHByb3BlcnRpZXMgc2FmZWx5IHVzaW5nIHR5cGUgZ3VhcmQocylcblx0aWYgKGNvbG9yVmFsdWVzLmZvcm1hdCA9PT0gJ2hleCcgJiYgJ3ZhbHVlJyBpbiBjb2xvclZhbHVlcykge1xuXHRcdGNvbG9yVGV4dE91dHB1dEJveC52YWx1ZSA9IChjb2xvclZhbHVlcyBhcyB0eXBlcy5IZXhPYmplY3QpLnZhbHVlLmhleDtcblx0fSBlbHNlIHtcblx0XHRjb25zb2xlLndhcm4oYEhleCB2YWx1ZSBub3QgZm91bmQgZm9yIHBhbGV0dGUtYm94ICMke3BhbGV0dGVCb3hDb3VudH1gKTtcblx0XHRjb2xvclRleHRPdXRwdXRCb3gudmFsdWUgPSAnJztcblx0fVxuXG5cdC8vIHN0b3JlIGNvbG9yIHZhbHVlcyB3aXRoaW4gaW5wdXQgZWxlbWVudFxuXHRjb2xvclRleHRPdXRwdXRCb3guY29sb3JWYWx1ZXMgPSBjb2xvclZhbHVlcztcblx0Y29sb3JUZXh0T3V0cHV0Qm94LnJlYWRPbmx5ID0gZmFsc2U7XG5cdGNvbG9yVGV4dE91dHB1dEJveC5zdHlsZS5jdXJzb3IgPSAndGV4dCc7XG5cblx0Ly8gY3JlYXRlIGNvcHkgYnV0dG9uXG5cdGNvbnN0IGNvcHlCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblx0Y29weUJ1dHRvbi5jbGFzc05hbWUgPSAnY29weS1idXR0b24nO1xuXHRjb3B5QnV0dG9uLnRleHRDb250ZW50ID0gJ0NvcHknO1xuXG5cdGNvbnN0IHRvb2x0aXBUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXHR0b29sdGlwVGV4dC5jbGFzc05hbWUgPSAndG9vbHRpcHRleHQnO1xuXHR0b29sdGlwVGV4dC50ZXh0Q29udGVudCA9ICdDb3BpZWQgdG8gY2xpcGJvYXJkISc7XG5cblx0Ly8gYWRkIGNsaXBib2FyZCBmdW5jdGlvbmFsaXR5IHRvIGNvcHkgYnV0dG9uXG5cdGNvcHlCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBhc3luYyAoKSA9PiB7XG5cdFx0dHJ5IHtcblx0XHRcdGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGNvbG9yVGV4dE91dHB1dEJveC52YWx1ZSk7XG5cdFx0XHRzaG93VG9vbHRpcChjb2xvclRleHRPdXRwdXRCb3gpO1xuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gY29weTogJHtlcnJvcn1gKTtcblx0XHR9XG5cdH0pO1xuXG5cdC8vIGFkZCBldmVudCBsaXN0ZW5lciBmb3IgaW5wdXQgY2hhbmdlc1xuXHRjb2xvclRleHRPdXRwdXRCb3guYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBlID0+IHtcblx0XHRjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50IHwgbnVsbDtcblx0XHRpZiAodGFyZ2V0ICYmIC9eI1swLTlBLUZdezZ9JCUvaS50ZXN0KHRhcmdldC52YWx1ZSkpIHtcblx0XHRcdGNvbnN0IGJveEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHRcdFx0YGNvbG9yLWJveC0ke3BhbGV0dGVCb3hDb3VudH1gXG5cdFx0XHQpO1xuXHRcdFx0Y29uc3Qgc3RyaXBlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRgY29sb3Itc3RyaXBlLSR7cGFsZXR0ZUJveENvdW50fWBcblx0XHRcdCk7XG5cdFx0XHRpZiAoYm94RWxlbWVudCkgYm94RWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB0YXJnZXQudmFsdWU7XG5cdFx0XHRpZiAoc3RyaXBlRWxlbWVudClcblx0XHRcdFx0c3RyaXBlRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSB0YXJnZXQudmFsdWU7XG5cdFx0fVxuXHR9KTtcblxuXHQvLyBhcHBlbmRzIGVsZW1lbnRzIHRvIHRvcCBoYWxmXG5cdHBhbGV0dGVCb3hUb3BIYWxmLmFwcGVuZENoaWxkKGNvbG9yVGV4dE91dHB1dEJveCk7XG5cdHBhbGV0dGVCb3hUb3BIYWxmLmFwcGVuZENoaWxkKGNvcHlCdXR0b24pO1xuXG5cdC8vIGNyZWF0ZSBib3R0b20gaGFsZiBvZiBwYWxldHRlIGJveFxuXHRjb25zdCBwYWxldHRlQm94Qm90dG9tSGFsZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRwYWxldHRlQm94Qm90dG9tSGFsZi5jbGFzc05hbWUgPSAncGFsZXR0ZS1ib3gtaGFsZiBwYWxldHRlLWJveC1ib3R0b20taGFsZic7XG5cdHBhbGV0dGVCb3hCb3R0b21IYWxmLmlkID0gYHBhbGV0dGUtYm94LWJvdHRvbS1oYWxmLSR7cGFsZXR0ZUJveENvdW50fWA7XG5cblx0Ly8gY3JlYXRlIGNvbG9yIGJveFxuXHRjb25zdCBjb2xvckJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRjb2xvckJveC5jbGFzc05hbWUgPSAnY29sb3ItYm94Jztcblx0Y29sb3JCb3guaWQgPSBgY29sb3ItYm94LSR7cGFsZXR0ZUJveENvdW50fWA7XG5cblx0aWYgKGNvbG9yVmFsdWVzLnZhbHVlICYmICdoc2wnIGluIGNvbG9yVmFsdWVzLnZhbHVlKSB7XG5cdFx0Y29uc3QgaHNsU3RyaW5nID0gY29sb3JWYWx1ZXMudmFsdWUuaHNsIGFzIHN0cmluZztcblx0XHRjb2xvckJveC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBoc2xTdHJpbmc7XG5cdH0gZWxzZSB7XG5cdFx0Y29sb3JCb3guc3R5bGUuYmFja2dyb3VuZENvbG9yID0gJyNmZmZmZmYnOyAvLyBkZWZhdWx0IGNvbG9yXG5cdH1cblxuXHRwYWxldHRlQm94Qm90dG9tSGFsZi5hcHBlbmRDaGlsZChjb2xvckJveCk7XG5cblx0Ly8gYXBwZW5kIGhhbHZlcyB0byBtYWluIHBhbGV0dGUgYm94XG5cdHBhbGV0dGVCb3guYXBwZW5kQ2hpbGQocGFsZXR0ZUJveFRvcEhhbGYpO1xuXHRwYWxldHRlQm94LmFwcGVuZENoaWxkKHBhbGV0dGVCb3hCb3R0b21IYWxmKTtcblxuXHQvLyBjcmVhdGUgY29sb3Igc3RyaXBlXG5cdGNvbnN0IGNvbG9yU3RyaXBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdGNvbG9yU3RyaXBlLmNsYXNzTmFtZSA9ICdjb2xvci1zdHJpcGUnO1xuXHRjb2xvclN0cmlwZS5pZCA9IGBjb2xvci1zdHJpcGUtJHtwYWxldHRlQm94Q291bnR9YDtcblxuXHRpZiAoY29sb3JWYWx1ZXMudmFsdWUgJiYgJ2hzbCcgaW4gY29sb3JWYWx1ZXMudmFsdWUpIHtcblx0XHRjb2xvclN0cmlwZS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvclZhbHVlcy52YWx1ZS5oc2wgYXMgc3RyaW5nO1xuXHR9XG5cblx0Y29sb3JTdHJpcGUuc2V0QXR0cmlidXRlKCdkcmFnZ2FibGUnLCAndHJ1ZScpO1xuXHRhdHRhY2hEcmFnQW5kRHJvcEV2ZW50TGlzdGVuZXJzKGNvbG9yU3RyaXBlKTtcblxuXHQvLyBhcHBlbmQgcGFsZXR0ZSBib3ggdG8gY29sb3Igc3RyaXBlXG5cdGNvbG9yU3RyaXBlLmFwcGVuZENoaWxkKHBhbGV0dGVCb3gpO1xuXG5cdHJldHVybiB7XG5cdFx0Y29sb3JTdHJpcGUsXG5cdFx0cGFsZXR0ZUJveENvdW50OiBwYWxldHRlQm94Q291bnQgKyAxXG5cdH07XG59XG5cbi8vZXh0cmFjdHMgdXNlci1kZWZpbmVkIHBhcmFtZXRlcnNcbmZ1bmN0aW9uIHB1bGxQYXJhbXNGcm9tVUkoKTogdHlwZXMuUHVsbFBhcmFtc0Zyb21VSSB7XG5cdGNvbnN0IHBhbGV0dGVUeXBlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdCdwYWxldHRlLXR5cGUtb3B0aW9ucydcblx0KSBhcyBIVE1MU2VsZWN0RWxlbWVudCB8IG51bGw7XG5cdGNvbnN0IG51bUJveGVzRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdCdwYWxldHRlLW51bWJlci1vcHRpb25zJ1xuXHQpIGFzIEhUTUxTZWxlY3RFbGVtZW50IHwgbnVsbDtcblx0Y29uc3QgaW5pdGlhbENvbG9yU3BhY2VFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG5cdFx0J2luaXRpYWwtY29sb3Itc3BhY2Utb3B0aW9ucydcblx0KSBhcyBIVE1MU2VsZWN0RWxlbWVudCB8IG51bGw7XG5cblx0Y29uc3QgcGFsZXR0ZVR5cGUgPSBwYWxldHRlVHlwZUVsZW1lbnRcblx0XHQ/IHBhcnNlSW50KHBhbGV0dGVUeXBlRWxlbWVudC52YWx1ZSwgMTApXG5cdFx0OiAwO1xuXHRjb25zdCBudW1Cb3hlcyA9IG51bUJveGVzRWxlbWVudCA/IHBhcnNlSW50KG51bUJveGVzRWxlbWVudC52YWx1ZSwgMTApIDogMDtcblx0Y29uc3QgaW5pdGlhbENvbG9yU3BhY2UgPVxuXHRcdGluaXRpYWxDb2xvclNwYWNlRWxlbWVudCAmJlxuXHRcdGd1YXJkcy5pc0NvbG9yU3BhY2UoaW5pdGlhbENvbG9yU3BhY2VFbGVtZW50LnZhbHVlKVxuXHRcdFx0PyBpbml0aWFsQ29sb3JTcGFjZUVsZW1lbnQudmFsdWVcblx0XHRcdDogJ2hleCc7XG5cblx0cmV0dXJuIHtcblx0XHRwYWxldHRlVHlwZSxcblx0XHRudW1Cb3hlcyxcblx0XHRpbml0aWFsQ29sb3JTcGFjZVxuXHR9O1xufVxuXG5leHBvcnQgY29uc3QgZG9tSGVscGVycyA9IHtcblx0ZGVmaW5lVUlCdXR0b25zLFxuXHRhZGRDb252ZXJzaW9uQnV0dG9uRXZlbnRMaXN0ZW5lcnMsXG5cdG1ha2VQYWxldHRlQm94LFxuXHRwdWxsUGFyYW1zRnJvbVVJXG59O1xuIl19