import { config } from '../config/constants.js';
import { dragAndDrop } from '../dom/drag-and-drop.js';
import { colorUtils } from '../utils/color-utils.js';
import { commonUtils } from '../utils/common-utils.js';
import { core } from '../utils/core-utils.js';
function makePaletteBox(color, paletteBoxCount) {
    try {
        if (!commonUtils.validateColorValues(color)) {
            console.error(`Invalid ${color.format} color value ${JSON.stringify(color)}`);
            return {
                colorStripe: document.createElement('div'),
                paletteBoxCount
            };
        }
        const clonedColor = core.clone(color);
        const paletteBox = document.createElement('div');
        paletteBox.className = 'palette-box';
        paletteBox.id = `palette-box-${paletteBoxCount}`;
        const paletteBoxTopHalf = document.createElement('div');
        paletteBoxTopHalf.className = 'palette-box-half palette-box-top-half';
        paletteBoxTopHalf.id = `palette-box-top-half-${paletteBoxCount}`;
        const colorTextOutputBox = document.createElement('input');
        colorTextOutputBox.type = 'text';
        colorTextOutputBox.className = 'color-text-output-box tooltip';
        colorTextOutputBox.id = `color-text-output-box-${paletteBoxCount}`;
        colorTextOutputBox.setAttribute('data-format', 'hex');
        const colorString = colorUtils.getCSSColorString(clonedColor);
        colorTextOutputBox.value = colorString || '';
        colorTextOutputBox.colorValues = clonedColor;
        colorTextOutputBox.readOnly = false;
        colorTextOutputBox.style.cursor = 'text';
        colorTextOutputBox.style.pointerEvents = 'none';
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-button';
        copyButton.textContent = 'Copy';
        const tooltipText = document.createElement('span');
        tooltipText.className = 'tooltiptext';
        tooltipText.textContent = 'Copied to clipboard!';
        copyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(colorTextOutputBox.value);
                domHelpers.showTooltip(colorTextOutputBox);
                clearTimeout(config.tooltipTimeout || 1000);
                copyButton.textContent = 'Copied!';
                setTimeout(() => (copyButton.textContent = 'Copy'), config.copyButtonTextTimeout || 1000);
            }
            catch (error) {
                console.error(`Failed to copy: ${error}`);
            }
        });
        colorTextOutputBox.addEventListener('input', core.debounce((e) => {
            const target = e.target;
            if (target) {
                const cssColor = target.value.trim();
                const boxElement = document.getElementById(`color-box-${paletteBoxCount}`);
                const stripeElement = document.getElementById(`color-stripe-${paletteBoxCount}`);
                if (boxElement)
                    boxElement.style.backgroundColor = cssColor;
                if (stripeElement)
                    stripeElement.style.backgroundColor = cssColor;
            }
        }, config.inputDebounce || 200));
        paletteBoxTopHalf.appendChild(colorTextOutputBox);
        paletteBoxTopHalf.appendChild(copyButton);
        const paletteBoxBottomHalf = document.createElement('div');
        paletteBoxBottomHalf.className =
            'palette-box-half palette-box-bottom-half';
        paletteBoxBottomHalf.id = `palette-box-bottom-half-${paletteBoxCount}`;
        const colorBox = document.createElement('div');
        colorBox.className = 'color-box';
        colorBox.id = `color-box-${paletteBoxCount}`;
        colorBox.style.backgroundColor = colorString || '#ffffff';
        paletteBoxBottomHalf.appendChild(colorBox);
        paletteBox.appendChild(paletteBoxTopHalf);
        paletteBox.appendChild(paletteBoxBottomHalf);
        const colorStripe = document.createElement('div');
        colorStripe.className = 'color-stripe';
        colorStripe.id = `color-stripe-${paletteBoxCount}`;
        colorStripe.style.backgroundColor = colorString || '#ffffff';
        colorStripe.setAttribute('draggable', 'true');
        dragAndDrop.attachDragAndDropEventListeners(colorStripe);
        colorStripe.appendChild(paletteBox);
        return {
            colorStripe,
            paletteBoxCount: paletteBoxCount + 1
        };
    }
    catch (error) {
        console.error(`Failed to execute makePaletteBox: ${error}`);
        return {
            colorStripe: document.createElement('div'),
            paletteBoxCount
        };
    }
}
function showTooltip(tooltipElement) {
    try {
        const tooltip = tooltipElement.querySelector('.tooltiptext');
        if (tooltip) {
            tooltip.style.visibility = 'visible';
            tooltip.style.opacity = '1';
            setTimeout(() => {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            }, config.tooltipTimeout || 1000);
        }
        console.log('showTooltip executed');
    }
    catch (error) {
        console.error(`Failed to execute showTooltip: ${error}`);
    }
}
export const domHelpers = {
    makePaletteBox,
    showTooltip
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2hlbHBlcnMvZG9tLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFJbkQsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ2xELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNwRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFM0MsU0FBUyxjQUFjLENBQ3RCLEtBQW1CLEVBQ25CLGVBQXVCO0lBRXZCLElBQUksQ0FBQztRQUNKLElBQUksQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUM3QyxPQUFPLENBQUMsS0FBSyxDQUNaLFdBQVcsS0FBSyxDQUFDLE1BQU0sZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FDOUQsQ0FBQztZQUVGLE9BQU87Z0JBQ04sV0FBVyxFQUFFLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO2dCQUMxQyxlQUFlO2FBQ2YsQ0FBQztRQUNILENBQUM7UUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXRDLE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakQsVUFBVSxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUM7UUFDckMsVUFBVSxDQUFDLEVBQUUsR0FBRyxlQUFlLGVBQWUsRUFBRSxDQUFDO1FBRWpELE1BQU0saUJBQWlCLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4RCxpQkFBaUIsQ0FBQyxTQUFTLEdB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Y0FBYztJQUNkLFdBQVc7Q0FDWCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnLi4vY29uZmlnL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBkcmFnQW5kRHJvcCB9IGZyb20gJy4uL2RvbS9kcmFnLWFuZC1kcm9wJztcbmltcG9ydCAqIGFzIGZuT2JqZWN0cyBmcm9tICcuLi9pbmRleC9mbi1vYmplY3RzJztcbmltcG9ydCAqIGFzIGRvbVR5cGVzIGZyb20gJy4uL2luZGV4L2RvbS10eXBlcyc7XG5pbXBvcnQgKiBhcyBjb2xvcnMgZnJvbSAnLi4vaW5kZXgvY29sb3JzJztcbmltcG9ydCB7IGNvbG9yVXRpbHMgfSBmcm9tICcuLi91dGlscy9jb2xvci11dGlscyc7XG5pbXBvcnQgeyBjb21tb25VdGlscyB9IGZyb20gJy4uL3V0aWxzL2NvbW1vbi11dGlscyc7XG5pbXBvcnQgeyBjb3JlIH0gZnJvbSAnLi4vdXRpbHMvY29yZS11dGlscyc7XG5cbmZ1bmN0aW9uIG1ha2VQYWxldHRlQm94KFxuXHRjb2xvcjogY29sb3JzLkNvbG9yLFxuXHRwYWxldHRlQm94Q291bnQ6IG51bWJlclxuKTogZG9tVHlwZXMuTWFrZVBhbGV0dGVCb3gge1xuXHR0cnkge1xuXHRcdGlmICghY29tbW9uVXRpbHMudmFsaWRhdGVDb2xvclZhbHVlcyhjb2xvcikpIHtcblx0XHRcdGNvbnNvbGUuZXJyb3IoXG5cdFx0XHRcdGBJbnZhbGlkICR7Y29sb3IuZm9ybWF0fSBjb2xvciB2YWx1ZSAke0pTT04uc3RyaW5naWZ5KGNvbG9yKX1gXG5cdFx0XHQpO1xuXG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRjb2xvclN0cmlwZTogZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JyksXG5cdFx0XHRcdHBhbGV0dGVCb3hDb3VudFxuXHRcdFx0fTtcblx0XHR9XG5cblx0XHRjb25zdCBjbG9uZWRDb2xvciA9IGNvcmUuY2xvbmUoY29sb3IpO1xuXG5cdFx0Y29uc3QgcGFsZXR0ZUJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdHBhbGV0dGVCb3guY2xhc3NOYW1lID0gJ3BhbGV0dGUtYm94Jztcblx0XHRwYWxldHRlQm94LmlkID0gYHBhbGV0dGUtYm94LSR7cGFsZXR0ZUJveENvdW50fWA7XG5cblx0XHRjb25zdCBwYWxldHRlQm94VG9wSGFsZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdHBhbGV0dGVCb3hUb3BIYWxmLmNsYXNzTmFtZSA9ICdwYWxldHRlLWJveC1oYWxmIHBhbGV0dGUtYm94LXRvcC1oYWxmJztcblx0XHRwYWxldHRlQm94VG9wSGFsZi5pZCA9IGBwYWxldHRlLWJveC10b3AtaGFsZi0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXG5cdFx0Y29uc3QgY29sb3JUZXh0T3V0cHV0Qm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcblx0XHRcdCdpbnB1dCdcblx0XHQpIGFzIGRvbVR5cGVzLkNvbG9ySW5wdXRFbGVtZW50O1xuXHRcdGNvbG9yVGV4dE91dHB1dEJveC50eXBlID0gJ3RleHQnO1xuXHRcdGNvbG9yVGV4dE91dHB1dEJveC5jbGFzc05hbWUgPSAnY29sb3ItdGV4dC1vdXRwdXQtYm94IHRvb2x0aXAnO1xuXHRcdGNvbG9yVGV4dE91dHB1dEJveC5pZCA9IGBjb2xvci10ZXh0LW91dHB1dC1ib3gtJHtwYWxldHRlQm94Q291bnR9YDtcblx0XHRjb2xvclRleHRPdXRwdXRCb3guc2V0QXR0cmlidXRlKCdkYXRhLWZvcm1hdCcsICdoZXgnKTtcblxuXHRcdGNvbnN0IGNvbG9yU3RyaW5nID0gY29sb3JVdGlscy5nZXRDU1NDb2xvclN0cmluZyhjbG9uZWRDb2xvcik7XG5cblx0XHRjb2xvclRleHRPdXRwdXRCb3gudmFsdWUgPSBjb2xvclN0cmluZyB8fCAnJztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guY29sb3JWYWx1ZXMgPSBjbG9uZWRDb2xvcjtcblx0XHRjb2xvclRleHRPdXRwdXRCb3gucmVhZE9ubHkgPSBmYWxzZTtcblx0XHRjb2xvclRleHRPdXRwdXRCb3guc3R5bGUuY3Vyc29yID0gJ3RleHQnO1xuXHRcdGNvbG9yVGV4dE91dHB1dEJveC5zdHlsZS5wb2ludGVyRXZlbnRzID0gJ25vbmUnO1xuXG5cdFx0Y29uc3QgY29weUJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpO1xuXHRcdGNvcHlCdXR0b24uY2xhc3NOYW1lID0gJ2NvcHktYnV0dG9uJztcblx0XHRjb3B5QnV0dG9uLnRleHRDb250ZW50ID0gJ0NvcHknO1xuXG5cdFx0Y29uc3QgdG9vbHRpcFRleHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XG5cdFx0dG9vbHRpcFRleHQuY2xhc3NOYW1lID0gJ3Rvb2x0aXB0ZXh0Jztcblx0XHR0b29sdGlwVGV4dC50ZXh0Q29udGVudCA9ICdDb3BpZWQgdG8gY2xpcGJvYXJkISc7XG5cblx0XHRjb3B5QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0YXdhaXQgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQoY29sb3JUZXh0T3V0cHV0Qm94LnZhbHVlKTtcblx0XHRcdFx0ZG9tSGVscGVycy5zaG93VG9vbHRpcChjb2xvclRleHRPdXRwdXRCb3gpO1xuXG5cdFx0XHRcdGNsZWFyVGltZW91dChjb25maWcudG9vbHRpcFRpbWVvdXQgfHwgMTAwMCk7XG5cblx0XHRcdFx0Y29weUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDb3BpZWQhJztcblx0XHRcdFx0c2V0VGltZW91dChcblx0XHRcdFx0XHQoKSA9PiAoY29weUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDb3B5JyksXG5cdFx0XHRcdFx0Y29uZmlnLmNvcHlCdXR0b25UZXh0VGltZW91dCB8fCAxMDAwXG5cdFx0XHRcdCk7XG5cdFx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0XHRjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gY29weTogJHtlcnJvcn1gKTtcblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGNvbG9yVGV4dE91dHB1dEJveC5hZGRFdmVudExpc3RlbmVyKFxuXHRcdFx0J2lucHV0Jyxcblx0XHRcdGNvcmUuZGVib3VuY2UoKGU6IEV2ZW50KSA9PiB7XG5cdFx0XHRcdGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQgfCBudWxsO1xuXHRcdFx0XHRpZiAodGFyZ2V0KSB7XG5cdFx0XHRcdFx0Y29uc3QgY3NzQ29sb3IgPSB0YXJnZXQudmFsdWUudHJpbSgpO1xuXHRcdFx0XHRcdGNvbnN0IGJveEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcblx0XHRcdFx0XHRcdGBjb2xvci1ib3gtJHtwYWxldHRlQm94Q291bnR9YFxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0Y29uc3Qgc3RyaXBlRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRcdFx0YGNvbG9yLXN0cmlwZS0ke3BhbGV0dGVCb3hDb3VudH1gXG5cdFx0XHRcdFx0KTtcblxuXHRcdFx0XHRcdGlmIChib3hFbGVtZW50KSBib3hFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNzc0NvbG9yO1xuXHRcdFx0XHRcdGlmIChzdHJpcGVFbGVtZW50KVxuXHRcdFx0XHRcdFx0c3RyaXBlRWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjc3NDb2xvcjtcblx0XHRcdFx0fVxuXHRcdFx0fSwgY29uZmlnLmlucHV0RGVib3VuY2UgfHwgMjAwKVxuXHRcdCk7XG5cblx0XHRwYWxldHRlQm94VG9wSGFsZi5hcHBlbmRDaGlsZChjb2xvclRleHRPdXRwdXRCb3gpO1xuXHRcdHBhbGV0dGVCb3hUb3BIYWxmLmFwcGVuZENoaWxkKGNvcHlCdXR0b24pO1xuXG5cdFx0Y29uc3QgcGFsZXR0ZUJveEJvdHRvbUhhbGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRwYWxldHRlQm94Qm90dG9tSGFsZi5jbGFzc05hbWUgPVxuXHRcdFx0J3BhbGV0dGUtYm94LWhhbGYgcGFsZXR0ZS1ib3gtYm90dG9tLWhhbGYnO1xuXHRcdHBhbGV0dGVCb3hCb3R0b21IYWxmLmlkID0gYHBhbGV0dGUtYm94LWJvdHRvbS1oYWxmLSR7cGFsZXR0ZUJveENvdW50fWA7XG5cblx0XHRjb25zdCBjb2xvckJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdGNvbG9yQm94LmNsYXNzTmFtZSA9ICdjb2xvci1ib3gnO1xuXHRcdGNvbG9yQm94LmlkID0gYGNvbG9yLWJveC0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXHRcdGNvbG9yQm94LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yU3RyaW5nIHx8ICcjZmZmZmZmJztcblxuXHRcdHBhbGV0dGVCb3hCb3R0b21IYWxmLmFwcGVuZENoaWxkKGNvbG9yQm94KTtcblx0XHRwYWxldHRlQm94LmFwcGVuZENoaWxkKHBhbGV0dGVCb3hUb3BIYWxmKTtcblx0XHRwYWxldHRlQm94LmFwcGVuZENoaWxkKHBhbGV0dGVCb3hCb3R0b21IYWxmKTtcblxuXHRcdGNvbnN0IGNvbG9yU3RyaXBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0Y29sb3JTdHJpcGUuY2xhc3NOYW1lID0gJ2NvbG9yLXN0cmlwZSc7XG5cdFx0Y29sb3JTdHJpcGUuaWQgPSBgY29sb3Itc3RyaXBlLSR7cGFsZXR0ZUJveENvdW50fWA7XG5cdFx0Y29sb3JTdHJpcGUuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY29sb3JTdHJpbmcgfHwgJyNmZmZmZmYnO1xuXG5cdFx0Y29sb3JTdHJpcGUuc2V0QXR0cmlidXRlKCdkcmFnZ2FibGUnLCAndHJ1ZScpO1xuXG5cdFx0ZHJhZ0FuZERyb3AuYXR0YWNoRHJhZ0FuZERyb3BFdmVudExpc3RlbmVycyhjb2xvclN0cmlwZSk7XG5cblx0XHRjb2xvclN0cmlwZS5hcHBlbmRDaGlsZChwYWxldHRlQm94KTtcblxuXHRcdHJldHVybiB7XG5cdFx0XHRjb2xvclN0cmlwZSxcblx0XHRcdHBhbGV0dGVCb3hDb3VudDogcGFsZXR0ZUJveENvdW50ICsgMVxuXHRcdH07XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGV4ZWN1dGUgbWFrZVBhbGV0dGVCb3g6ICR7ZXJyb3J9YCk7XG5cdFx0cmV0dXJuIHtcblx0XHRcdGNvbG9yU3RyaXBlOiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcblx0XHRcdHBhbGV0dGVCb3hDb3VudFxuXHRcdH07XG5cdH1cbn1cblxuZnVuY3Rpb24gc2hvd1Rvb2x0aXAodG9vbHRpcEVsZW1lbnQ6IEhUTUxFbGVtZW50KTogdm9pZCB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgdG9vbHRpcCA9XG5cdFx0XHR0b29sdGlwRWxlbWVudC5xdWVyeVNlbGVjdG9yPEhUTUxFbGVtZW50PignLnRvb2x0aXB0ZXh0Jyk7XG5cblx0XHRpZiAodG9vbHRpcCkge1xuXHRcdFx0dG9vbHRpcC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuXHRcdFx0dG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gJzEnO1xuXHRcdFx0c2V0VGltZW91dCgoKSA9PiB7XG5cdFx0XHRcdHRvb2x0aXAuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuXHRcdFx0XHR0b29sdGlwLnN0eWxlLm9wYWNpdHkgPSAnMCc7XG5cdFx0XHR9LCBjb25maWcudG9vbHRpcFRpbWVvdXQgfHwgMTAwMCk7XG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coJ3Nob3dUb29sdGlwIGV4ZWN1dGVkJyk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGV4ZWN1dGUgc2hvd1Rvb2x0aXA6ICR7ZXJyb3J9YCk7XG5cdH1cbn1cblxuZXhwb3J0IGNvbnN0IGRvbUhlbHBlcnM6IGZuT2JqZWN0cy5ET01IZWxwZXJzID0ge1xuXHRtYWtlUGFsZXR0ZUJveCxcblx0c2hvd1Rvb2x0aXBcbn07XG4iXX0=