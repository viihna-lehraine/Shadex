// File: src/common/helpers/dom.ts
import { config } from '../../config.js';
import { core } from '../index.js';
const timeouts = config.consts.timeouts;
let dragSrcEl = null;
function attachDragAndDropListeners(element) {
    try {
        if (element) {
            element.addEventListener('dragstart', dragStart);
            element.addEventListener('dragover', dragOver);
            element.addEventListener('drop', drop);
            element.addEventListener('dragend', dragEnd);
        }
        console.log('Drag and drop event listeners successfully attached');
    }
    catch (error) {
        console.error(`Failed to execute attachDragAndDropEventListeners: ${error}`);
    }
}
function dragStart(e) {
    try {
        dragSrcEl = e.currentTarget;
        if (e.dataTransfer) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', dragSrcEl.outerHTML);
        }
        console.log('handleDragStart complete');
    }
    catch (error) {
        console.error(`Error in handleDragStart: ${error}`);
    }
}
function dragOver(e) {
    try {
        e.preventDefault();
        if (e.dataTransfer) {
            e.dataTransfer.dropEffect = 'move';
        }
        console.log('handleDragOver complete');
        return false;
    }
    catch (error) {
        console.error(`Error in handleDragOver: ${error}`);
        return false;
    }
}
function dragEnd(e) {
    try {
        const target = e.currentTarget;
        target.classList.remove('dragging');
        document.querySelectorAll('.color-stripe').forEach(el => {
            el.classList.remove('dragging');
        });
        console.log('handleDragEnd complete');
    }
    catch (error) {
        console.error(`Error in handleDragEnd: ${error}`);
    }
}
function drop(e) {
    try {
        e.stopPropagation();
        const target = e.currentTarget;
        if (dragSrcEl && dragSrcEl !== target) {
            const dragSrcId = dragSrcEl.id;
            const dropTargetId = target.id;
            const dragSrcText = dragSrcEl.querySelector('.color-text-output-box').value;
            const dropTargetText = target.querySelector('.color-text-output-box').value;
            const dragSrcOuterHTML = dragSrcEl.outerHTML;
            const dropTargetOuterHTML = target.outerHTML;
            dragSrcEl.outerHTML = dropTargetOuterHTML;
            target.outerHTML = dragSrcOuterHTML;
            const newDragSrcEl = document.getElementById(dropTargetId);
            const newDropTargetEl = document.getElementById(dragSrcId);
            newDragSrcEl.id = dragSrcId;
            newDropTargetEl.id = dropTargetId;
            newDragSrcEl.querySelector('.color-text-output-box').value = dropTargetText;
            newDropTargetEl.querySelector('.color-text-output-box').value = dragSrcText;
            console.log('calling attachDragAndDropEventListeners for new elements');
            attachDragAndDropListeners(newDragSrcEl);
            attachDragAndDropListeners(newDropTargetEl);
        }
        console.log('handleDrop complete');
    }
    catch (error) {
        console.error(`Error in handleDrop: ${error}`);
    }
}
function makePaletteBox(color, paletteBoxCount) {
    try {
        if (!core.validateColorValues(color)) {
            console.error(`Invalid ${color.format} color value ${JSON.stringify(color)}`);
            return {
                colorStripe: document.createElement('div'),
                paletteBoxCount
            };
        }
        const clonedColor = core.clone(color);
        const paletteBox = document.createElement('div');
        paletteBox.className = 'palette-box';
        paletteBox.id = `palette-box-${paletteBoxCount}`;
        const paletteBoxTopHalf = document.createElement('div');
        paletteBoxTopHalf.className = 'palette-box-half palette-box-top-half';
        paletteBoxTopHalf.id = `palette-box-top-half-${paletteBoxCount}`;
        const colorTextOutputBox = document.createElement('input');
        colorTextOutputBox.type = 'text';
        colorTextOutputBox.className = 'color-text-output-box tooltip';
        colorTextOutputBox.id = `color-text-output-box-${paletteBoxCount}`;
        colorTextOutputBox.setAttribute('data-format', 'hex');
        const colorString = core.getCSSColorString(clonedColor);
        colorTextOutputBox.value = colorString || '';
        colorTextOutputBox.colorValues = clonedColor;
        colorTextOutputBox.readOnly = false;
        colorTextOutputBox.style.cursor = 'text';
        colorTextOutputBox.style.pointerEvents = 'none';
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-button';
        copyButton.textContent = 'Copy';
        const tooltipText = document.createElement('span');
        tooltipText.className = 'tooltiptext';
        tooltipText.textContent = 'Copied to clipboard!';
        copyButton.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(colorTextOutputBox.value);
                showTooltip(colorTextOutputBox);
                clearTimeout(config.consts.timeouts.tooltip || 1000);
                copyButton.textContent = 'Copied!';
                setTimeout(() => (copyButton.textContent = 'Copy'), config.consts.timeouts.copyButtonText || 1000);
            }
            catch (error) {
                console.error(`Failed to copy: ${error}`);
            }
        });
        colorTextOutputBox.addEventListener('input', core.debounce((e) => {
            const target = e.target;
            if (target) {
                const cssColor = target.value.trim();
                const boxElement = document.getElementById(`color-box-${paletteBoxCount}`);
                const stripeElement = document.getElementById(`color-stripe-${paletteBoxCount}`);
                if (boxElement)
                    boxElement.style.backgroundColor = cssColor;
                if (stripeElement)
                    stripeElement.style.backgroundColor = cssColor;
            }
        }, config.consts.debounce.input || 200));
        paletteBoxTopHalf.appendChild(colorTextOutputBox);
        paletteBoxTopHalf.appendChild(copyButton);
        const paletteBoxBottomHalf = document.createElement('div');
        paletteBoxBottomHalf.className =
            'palette-box-half palette-box-bottom-half';
        paletteBoxBottomHalf.id = `palette-box-bottom-half-${paletteBoxCount}`;
        const colorBox = document.createElement('div');
        colorBox.className = 'color-box';
        colorBox.id = `color-box-${paletteBoxCount}`;
        colorBox.style.backgroundColor = colorString || '#ffffff';
        paletteBoxBottomHalf.appendChild(colorBox);
        paletteBox.appendChild(paletteBoxTopHalf);
        paletteBox.appendChild(paletteBoxBottomHalf);
        const colorStripe = document.createElement('div');
        colorStripe.className = 'color-stripe';
        colorStripe.id = `color-stripe-${paletteBoxCount}`;
        colorStripe.style.backgroundColor = colorString || '#ffffff';
        colorStripe.setAttribute('draggable', 'true');
        attachDragAndDropListeners(colorStripe);
        colorStripe.appendChild(paletteBox);
        return {
            colorStripe,
            paletteBoxCount: paletteBoxCount + 1
        };
    }
    catch (error) {
        console.error(`Failed to execute makePaletteBox: ${error}`);
        return {
            colorStripe: document.createElement('div'),
            paletteBoxCount
        };
    }
}
function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast-message';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.classList.add('fade-out');
        toast.addEventListener('transitioned', () => toast.remove());
    }, timeouts.toast || 3000);
}
function showTooltip(tooltipElement) {
    try {
        const tooltip = tooltipElement.querySelector('.tooltiptext');
        if (tooltip) {
            tooltip.style.visibility = 'visible';
            tooltip.style.opacity = '1';
            setTimeout(() => {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            }, config.consts.timeouts.tooltip || 1000);
        }
        console.log('showTooltip executed');
    }
    catch (error) {
        console.error(`Failed to execute showTooltip: ${error}`);
    }
}
function validateAndConvertColor(color) {
    if (!color)
        return null;
    const convertedColor = core.isColorString(color)
        ? core.colorStringToColor(color)
        : color;
    if (!core.validateColorValues(convertedColor)) {
        console.error(`Invalid color: ${JSON.stringify(convertedColor)}`);
        return null;
    }
    return convertedColor;
}
const handle = {
    dragStart,
    dragOver,
    dragEnd,
    drop
};
export const dom = {
    attachDragAndDropListeners,
    handle,
    makePaletteBox,
    showToast,
    showTooltip,
    validateAndConvertColor
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2NvbW1vbi9oZWxwZXJzL2RvbS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxrQ0FBa0M7QUFRbEMsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGNBQWMsQ0FBQztBQUN0QyxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sVUFBVSxDQUFDO0FBRWhDLE1BQU0sUUFBUSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDO0FBRXhDLElBQUksU0FBUyxHQUF1QixJQUFJLENBQUM7QUFFekMsU0FBUywwQkFBMEIsQ0FBQyxPQUEyQjtJQUM5RCxJQUFJLENBQUM7UUFDSixJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUNqRCxPQUFPLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQy9DLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDdkMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxREFBcUQsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQ1osc0RBQXNELEtBQUssRUFBRSxDQUM3RCxDQUFDO0lBQ0gsQ0FBQztBQUNGLENBQUM7QUFFRCxTQUFTLFNBQVMsQ0FBQyxDQUFZO0lBQzlCLElBQUksQ0FBQztRQUNKLFNBQVMsR0FBRyxDQUFDLENBQUMsYUFBNEIsQ0FBQztRQUUzQyxJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNwQixDQUFDLENBQUMsWUFBWSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUM7WUFDdEMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMxRCxDQUFDO1FBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsNkJBQTZCLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDckQsQ0FBQztBQUNGLENBQUM7QUFFRCxTQUFTLFFBQVEsQ0FBQyxDQUFZO0lBQzdCLElBQUksQ0FBQztRQUNKLENBQUMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztRQUVuQixJQUFJLENBQUMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNwQixDQUFDLENBQUMsWUFBWSxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7UUFDcEMsQ0FBQztRQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUMsQ0FBQztRQUV2QyxPQUFPLEtBQUssQ0FBQztJQUNkLENBQUM7SUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1FBQ2hCLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEtBQUssRUFBRSxDQUFDLENBQUM7UUFFbkQsT0FBTyxLQUFLLENBQUM7SUFDZCxDQUFDO0FBQ0YsQ0FBQztBQUVELFNBQVMsT0FBTyxDQUFDLENBQVk7SUFDNUIsSUFBSSxDQUFDO1FBQ0osTUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDLGFBQTRCLENBQUM7UUFFOUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFcEMsUUFBUSxDQUFDLGdCQUFnQixDQUFDLGVBQWUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsRUFBRTtZQUN2RCxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztJQUN2QyxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixPQUFPLENBQUMsS0FBSyxDQUFDLDJCQUEyQixLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ25ELENBQUM7QUFDRixDQUFDO0FBRUQsU0FBUyxJQUFJLENBQUMsQ0FBWTtJQUN6QixJQUFJLENBQUM7UUFDSixDQUFDLENBQUMsZUFBZSxFQUFFLENBQUM7UUFFcEIsTUFBTSxNQUFNLEdBQUcsQ0FBQyxDQUFDLGFBQTRCLENBQUM7UUFFOUMsSUFBSSxTQUFTLElBQUksU0FBUyxLQUFLLE1BQU0sRUFBRSxDQUFDO1lBQ3ZDLE1BQU0sU0FBUyxHQUFHLFNBQVMsQ0FBQyxFQUFFLENBQUM7WUFDL0IsTUFBTSxZQUFZLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUMvQixNQUFNLFdBQVcsR0FDaEIsU0FBUyxDQUFDLGFBQWEsQ0FDdEIsd0JBQXdCLENBRXpCLENBQUMsS0FBSyxDQUFDO1lBQ1IsTUFBTSxjQUFjLEdBQ25CLE1BQU0sQ0FBQyxhQUFhLENBQ25CLHdCQUF3QixDQUV6QixDQUFDLEtBQUssQ0FBQztZQUNSLE1BQU0sZ0JBQWdCLEdBQUcsU0FBUyxDQUFDLFNBQVMsQ0FBQztZQUM3QyxNQUFNLG1CQUFtQixHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUM7WUFFN0MsU0FBUyxDQUFDLFNBQVMsR0FBRyxtQkFBbUIsQ0FBQztZQUMxQyxNQUFNLENBQUMsU0FBUyxHQUFHLGdCQUFnQixDQUFDO1lBRXBDLE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQzNDLFlBQVksQ0FDRyxDQUFDO1lBQ2pCLE1BQU0sZUFBZSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQzlDLFNBQVMsQ0FDTSxDQUFDO1lBRWpCLFlBQVksQ0FBQyxFQUFFLEdBQUcsU0FBUyxDQUFDO1lBQzVCLGVBQWUsQ0FBQyxFQUFFLEdBQUcsWUFBWSxDQUFDO1lBR2pDLFlBQVksQ0FBQyxhQUFhLENBQ3pCLHdCQUF3QixDQUV6QixDQUFDLEtBQUssR0FBRyxjQUFjLENBQUM7WUFFeEIsZUFBZSxDQUFDLGFBQWEsQ0FDNUIsd0JBQXdCLENBRXpCLENBQUMsS0FBSyxHQUFHLFdBQVcsQ0FBQztZQUV0QixPQUFPLENBQUMsR0FBRyxDQUNWLDBEQUEwRCxDQUMxRCxDQUFDO1lBRUYsMEJBQTBCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFekMsMEJBQTBCLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDN0MsQ0FBQztRQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMscUJBQXFCLENBQUMsQ0FBQztJQUNwQyxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUF3QixLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQ2hELENBQUM7QUFDRixDQUFDO0FBRUQsU0FBUyxjQUFjLENBQUMsS0FBWSxFQUFFLGVBQXVCO0lBQzVELElBQUksQ0FBQztRQUNKLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztZQUN0QyxPQUFPLENBQUMsS0FBSyxDQUNaLFdBQVcsS0FBSyxDQUFDLE1BQU0sZ0JBQWdCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FDOUQsQ0FBQztZQUVGLE9BQU87Z0JBQ04sV0FBVyxFQUFFLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDO2dCQUMxQyxlQUFlO2FBQ2YsQ0FBQztRQUNILENBQUM7UUFFRCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXRDLE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakQsVUFBVSxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUM7UUFDckMsVUFBVSxDQUFDLEVBQUUsR0FBRyxlQUFlLGVBQWUsRUFBRSxDQUFDO1FBRWpELE1BQU0saUJBQWlCLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4RCxpQkFBaUIsQ0FBQyxTQUFTLEdBQUcsdUNBQXVDLENBQUM7UUFDdEUsaUJBQWlCLENBQUMsRUFBRSxHQUFHLHdCQUF3QixlQUFlLEVBQUUsQ0FBQztRQUVqRSxNQUFNLGtCQUFrQixHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQ2hELE9BQU8sQ0FDYyxDQUFDO1FBQ3ZCLGtCQUFrQixDQUFDLElBQUksR0FBRyxNQUFNLENBQUM7UUFDakMsa0JBQWtCLENBQUMsU0FBUyxHQUFHLCtCQUErQixDQUFDO1FBQy9ELGtCQUFrQixDQUFDLEVBQUUsR0FBRyx5QkFBeUIsZUFBZSxFQUFFLENBQUM7UUFDbkUsa0JBQWtCLENBQUMsWUFBWSxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUV0RCxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsV0FBVyxDQUFDLENBQUM7UUFFeEQsa0JBQWtCLENBQUMsS0FBSyxHQUFHLFdBQVcsSUFBSSxFQUFFLENBQUM7UUFDN0Msa0JBQWtCLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUM3QyxrQkFBa0IsQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3BDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3pDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDO1FBRWhELE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDcEQsVUFBVSxDQUFDLFNBQVMsR0FBRyxhQUFhLENBQUM7UUFDckMsVUFBVSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUM7UUFFaEMsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNuRCxXQUFXLENBQUMsU0FBUyxHQUFHLGFBQWEsQ0FBQztRQUN0QyxXQUFXLENBQUMsV0FBVyxHQUFHLHNCQUFzQixDQUFDO1FBRWpELFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0MsSUFBSSxDQUFDO2dCQUNKLE1BQU0sU0FBUyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQzlELFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO2dCQUVoQyxZQUFZLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxDQUFDO2dCQUVyRCxVQUFVLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztnQkFDbkMsVUFBVSxDQUNULEdBQUcsRUFBRSxDQUFDLENBQUMsVUFBVSxDQUFDLFdBQVcsR0FBRyxNQUFNLENBQUMsRUFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsY0FBYyxJQUFJLElBQUksQ0FDN0MsQ0FBQztZQUNILENBQUM7WUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO2dCQUNoQixPQUFPLENBQUMsS0FBSyxDQUFDLG1CQUFtQixLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQzNDLENBQUM7UUFDRixDQUFDLENBQUMsQ0FBQztRQUVILGtCQUFrQixDQUFDLGdCQUFnQixDQUNsQyxPQUFPLEVBQ1AsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQVEsRUFBRSxFQUFFO1lBQzFCLE1BQU0sTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFpQyxDQUFDO1lBQ25ELElBQUksTUFBTSxFQUFFLENBQUM7Z0JBQ1osTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDckMsTUFBTSxVQUFVLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FDekMsYUFBYSxlQUFlLEVBQUUsQ0FDOUIsQ0FBQztnQkFDRixNQUFNLGFBQWEsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUM1QyxnQkFBZ0IsZUFBZSxFQUFFLENBQ2pDLENBQUM7Z0JBRUYsSUFBSSxVQUFVO29CQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsZUFBZSxHQUFHLFFBQVEsQ0FBQztnQkFDNUQsSUFBSSxhQUFhO29CQUNoQixhQUFhLENBQUMsS0FBSyxDQUFDLGVBQWUsR0FBRyxRQUFRLENBQUM7WUFDakQsQ0FBQztRQUNGLENBQUMsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLENBQ3ZDLENBQUM7UUFFRixpQkFBaUIsQ0FBQyxXQUFXLENBQUMsa0JBQWtCLENBQUMsQ0FBQztRQUNsRCxpQkFBaUIsQ0FBQyxXQUFXLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFMUMsTUFBTSxvQkFBb0IsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNELG9CQUFvQixDQUFDLFNBQVM7WUFDN0IsMENBQTBDLENBQUM7UUFDNUMsb0JBQW9CLENBQUMsRUFBRSxHQUFHLDJCQUEyQixlQUFlLEVBQUUsQ0FBQztRQUV2RSxNQUFNLFFBQVEsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQy9DLFFBQVEsQ0FBQyxTQUFTLEdBQUcsV0FBVyxDQUFDO1FBQ2pDLFFBQVEsQ0FBQyxFQUFFLEdBQUcsYUFBYSxlQUFlLEVBQUUsQ0FBQztRQUM3QyxRQUFRLENBQUMsS0FBSyxDQUFDLGVBQWUsR0FBRyxXQUFXLElBQUksU0FBUyxDQUFDO1FBRTFELG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMzQyxVQUFVLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDMUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1FBRTdDLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbEQsV0FBVyxDQUFDLFNBQVMsR0FBRyxjQUFjLENBQUM7UUFDdkMsV0FBVyxDQUFDLEVBQUUsR0FBRyxnQkFBZ0IsZUFBZSxFQUFFLENBQUM7UUFDbkQsV0FBVyxDQUFDLEtBQUssQ0FBQyxlQUFlLEdBQUcsV0FBVyxJQUFJLFNBQVMsQ0FBQztRQUU3RCxXQUFXLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUU5QywwQkFBMEIsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUV4QyxXQUFXLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBRXBDLE9BQU87WUFDTixXQUFXO1lBQ1gsZUFBZSxFQUFFLGVBQWUsR0FBRyxDQUFDO1NBQ3BDLENBQUM7SUFDSCxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixPQUFPLENBQUMsS0FBSyxDQUFDLHFDQUFxQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQzVELE9BQU87WUFDTixXQUFXLEVBQUUsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7WUFDMUMsZUFBZTtTQUNmLENBQUM7SUFDSCxDQUFDO0FBQ0YsQ0FBQztBQUVELFNBQVMsU0FBUyxDQUFDLE9BQWU7SUFDakMsTUFBTSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUU1QyxLQUFLLENBQUMsU0FBUyxHQUFHLGVBQWUsQ0FBQztJQUVsQyxLQUFLLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQztJQUU1QixRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUVqQyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2YsS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDaEMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLGNBQWMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUM5RCxDQUFDLEVBQUUsUUFBUSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQztBQUM1QixDQUFDO0FBRUQsU0FBUyxXQUFXLENBQUMsY0FBMkI7SUFDL0MsSUFBSSxDQUFDO1FBQ0osTUFBTSxPQUFPLEdBQ1osY0FBYyxDQUFDLGFBQWEsQ0FBYyxjQUFjLENBQUMsQ0FBQztRQUUzRCxJQUFJLE9BQU8sRUFBRSxDQUFDO1lBQ2IsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLEdBQUcsU0FBUyxDQUFDO1lBQ3JDLE9BQU8sQ0FBQyxLQUFLLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQztZQUM1QixVQUFVLENBQUMsR0FBRyxFQUFFO2dCQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsVUFBVSxHQUFHLFFBQVEsQ0FBQztnQkFDcEMsT0FBTyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsR0FBRyxDQUFDO1lBQzdCLENBQUMsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLENBQUM7UUFDNUMsQ0FBQztRQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztRQUNoQixPQUFPLENBQUMsS0FBSyxDQUFDLGtDQUFrQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQzFELENBQUM7QUFDRixDQUFDO0FBRUQsU0FBUyx1QkFBdUIsQ0FDL0IsS0FBaUM7SUFFakMsSUFBSSxDQUFDLEtBQUs7UUFBRSxPQUFPLElBQUksQ0FBQztJQUV4QixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQztRQUMvQyxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQztRQUNoQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBRVQsSUFBSSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxLQUFLLENBQUMsa0JBQWtCLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBRWxFLE9BQU8sSUFBSSxDQUFDO0lBQ2IsQ0FBQztJQUVELE9BQU8sY0FBYyxDQUFDO0FBQ3ZCLENBQUM7QUFFRCxNQUFNLE1BQU0sR0FBRztJQUNkLFNBQVM7SUFDVCxRQUFRO0lBQ1IsT0FBTztJQUNQLElBQUk7Q0FDSixDQUFDO0FBRUYsTUFBTSxDQUFDLE1BQU0sR0FBRyxHQUFHO0lBQ2xCLDBCQUEwQjtJQUMxQixNQUFNO0lBQ04sY0FBYztJQUNkLFNBQVM7SUFDVCxXQUFXO0lBQ1gsdUJBQXVCO0NBQ3ZCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBGaWxlOiBzcmMvY29tbW9uL2hlbHBlcnMvZG9tLnRzXG5cbmltcG9ydCB7XG5cdENvbG9yLFxuXHRDb2xvcklucHV0RWxlbWVudCxcblx0Q29sb3JTdHJpbmcsXG5cdE1ha2VQYWxldHRlQm94XG59IGZyb20gJy4uLy4uL2luZGV4JztcbmltcG9ydCB7IGNvbmZpZyB9IGZyb20gJy4uLy4uL2NvbmZpZyc7XG5pbXBvcnQgeyBjb3JlIH0gZnJvbSAnLi4vaW5kZXgnO1xuXG5jb25zdCB0aW1lb3V0cyA9IGNvbmZpZy5jb25zdHMudGltZW91dHM7XG5cbmxldCBkcmFnU3JjRWw6IEhUTUxFbGVtZW50IHwgbnVsbCA9IG51bGw7XG5cbmZ1bmN0aW9uIGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKGVsZW1lbnQ6IEhUTUxFbGVtZW50IHwgbnVsbCk6IHZvaWQge1xuXHR0cnkge1xuXHRcdGlmIChlbGVtZW50KSB7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdzdGFydCcsIGRyYWdTdGFydCk7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgZHJhZ092ZXIpO1xuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgZHJvcCk7XG5cdFx0XHRlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdlbmQnLCBkcmFnRW5kKTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZygnRHJhZyBhbmQgZHJvcCBldmVudCBsaXN0ZW5lcnMgc3VjY2Vzc2Z1bGx5IGF0dGFjaGVkJyk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihcblx0XHRcdGBGYWlsZWQgdG8gZXhlY3V0ZSBhdHRhY2hEcmFnQW5kRHJvcEV2ZW50TGlzdGVuZXJzOiAke2Vycm9yfWBcblx0XHQpO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRyYWdTdGFydChlOiBEcmFnRXZlbnQpOiB2b2lkIHtcblx0dHJ5IHtcblx0XHRkcmFnU3JjRWwgPSBlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG5cblx0XHRpZiAoZS5kYXRhVHJhbnNmZXIpIHtcblx0XHRcdGUuZGF0YVRyYW5zZmVyLmVmZmVjdEFsbG93ZWQgPSAnbW92ZSc7XG5cdFx0XHRlLmRhdGFUcmFuc2Zlci5zZXREYXRhKCd0ZXh0L2h0bWwnLCBkcmFnU3JjRWwub3V0ZXJIVE1MKTtcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZygnaGFuZGxlRHJhZ1N0YXJ0IGNvbXBsZXRlJyk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRXJyb3IgaW4gaGFuZGxlRHJhZ1N0YXJ0OiAke2Vycm9yfWApO1xuXHR9XG59XG5cbmZ1bmN0aW9uIGRyYWdPdmVyKGU6IERyYWdFdmVudCk6IGJvb2xlYW4ge1xuXHR0cnkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdGlmIChlLmRhdGFUcmFuc2Zlcikge1xuXHRcdFx0ZS5kYXRhVHJhbnNmZXIuZHJvcEVmZmVjdCA9ICdtb3ZlJztcblx0XHR9XG5cblx0XHRjb25zb2xlLmxvZygnaGFuZGxlRHJhZ092ZXIgY29tcGxldGUnKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBFcnJvciBpbiBoYW5kbGVEcmFnT3ZlcjogJHtlcnJvcn1gKTtcblxuXHRcdHJldHVybiBmYWxzZTtcblx0fVxufVxuXG5mdW5jdGlvbiBkcmFnRW5kKGU6IERyYWdFdmVudCk6IHZvaWQge1xuXHR0cnkge1xuXHRcdGNvbnN0IHRhcmdldCA9IGUuY3VycmVudFRhcmdldCBhcyBIVE1MRWxlbWVudDtcblxuXHRcdHRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnZ2luZycpO1xuXG5cdFx0ZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmNvbG9yLXN0cmlwZScpLmZvckVhY2goZWwgPT4ge1xuXHRcdFx0ZWwuY2xhc3NMaXN0LnJlbW92ZSgnZHJhZ2dpbmcnKTtcblx0XHR9KTtcblxuXHRcdGNvbnNvbGUubG9nKCdoYW5kbGVEcmFnRW5kIGNvbXBsZXRlJyk7XG5cdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0Y29uc29sZS5lcnJvcihgRXJyb3IgaW4gaGFuZGxlRHJhZ0VuZDogJHtlcnJvcn1gKTtcblx0fVxufVxuXG5mdW5jdGlvbiBkcm9wKGU6IERyYWdFdmVudCk6IHZvaWQge1xuXHR0cnkge1xuXHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cblx0XHRjb25zdCB0YXJnZXQgPSBlLmN1cnJlbnRUYXJnZXQgYXMgSFRNTEVsZW1lbnQ7XG5cblx0XHRpZiAoZHJhZ1NyY0VsICYmIGRyYWdTcmNFbCAhPT0gdGFyZ2V0KSB7XG5cdFx0XHRjb25zdCBkcmFnU3JjSWQgPSBkcmFnU3JjRWwuaWQ7XG5cdFx0XHRjb25zdCBkcm9wVGFyZ2V0SWQgPSB0YXJnZXQuaWQ7XG5cdFx0XHRjb25zdCBkcmFnU3JjVGV4dCA9IChcblx0XHRcdFx0ZHJhZ1NyY0VsLnF1ZXJ5U2VsZWN0b3IoXG5cdFx0XHRcdFx0Jy5jb2xvci10ZXh0LW91dHB1dC1ib3gnXG5cdFx0XHRcdCkgYXMgSFRNTElucHV0RWxlbWVudFxuXHRcdFx0KS52YWx1ZTtcblx0XHRcdGNvbnN0IGRyb3BUYXJnZXRUZXh0ID0gKFxuXHRcdFx0XHR0YXJnZXQucXVlcnlTZWxlY3Rvcihcblx0XHRcdFx0XHQnLmNvbG9yLXRleHQtb3V0cHV0LWJveCdcblx0XHRcdFx0KSBhcyBIVE1MSW5wdXRFbGVtZW50XG5cdFx0XHQpLnZhbHVlO1xuXHRcdFx0Y29uc3QgZHJhZ1NyY091dGVySFRNTCA9IGRyYWdTcmNFbC5vdXRlckhUTUw7XG5cdFx0XHRjb25zdCBkcm9wVGFyZ2V0T3V0ZXJIVE1MID0gdGFyZ2V0Lm91dGVySFRNTDtcblxuXHRcdFx0ZHJhZ1NyY0VsLm91dGVySFRNTCA9IGRyb3BUYXJnZXRPdXRlckhUTUw7XG5cdFx0XHR0YXJnZXQub3V0ZXJIVE1MID0gZHJhZ1NyY091dGVySFRNTDtcblxuXHRcdFx0Y29uc3QgbmV3RHJhZ1NyY0VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG5cdFx0XHRcdGRyb3BUYXJnZXRJZFxuXHRcdFx0KSBhcyBIVE1MRWxlbWVudDtcblx0XHRcdGNvbnN0IG5ld0Ryb3BUYXJnZXRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRkcmFnU3JjSWRcblx0XHRcdCkgYXMgSFRNTEVsZW1lbnQ7XG5cblx0XHRcdG5ld0RyYWdTcmNFbC5pZCA9IGRyYWdTcmNJZDtcblx0XHRcdG5ld0Ryb3BUYXJnZXRFbC5pZCA9IGRyb3BUYXJnZXRJZDtcblxuXHRcdFx0KFxuXHRcdFx0XHRuZXdEcmFnU3JjRWwucXVlcnlTZWxlY3Rvcihcblx0XHRcdFx0XHQnLmNvbG9yLXRleHQtb3V0cHV0LWJveCdcblx0XHRcdFx0KSBhcyBIVE1MSW5wdXRFbGVtZW50XG5cdFx0XHQpLnZhbHVlID0gZHJvcFRhcmdldFRleHQ7XG5cdFx0XHQoXG5cdFx0XHRcdG5ld0Ryb3BUYXJnZXRFbC5xdWVyeVNlbGVjdG9yKFxuXHRcdFx0XHRcdCcuY29sb3ItdGV4dC1vdXRwdXQtYm94J1xuXHRcdFx0XHQpIGFzIEhUTUxJbnB1dEVsZW1lbnRcblx0XHRcdCkudmFsdWUgPSBkcmFnU3JjVGV4dDtcblxuXHRcdFx0Y29uc29sZS5sb2coXG5cdFx0XHRcdCdjYWxsaW5nIGF0dGFjaERyYWdBbmREcm9wRXZlbnRMaXN0ZW5lcnMgZm9yIG5ldyBlbGVtZW50cydcblx0XHRcdCk7XG5cblx0XHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKG5ld0RyYWdTcmNFbCk7XG5cblx0XHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKG5ld0Ryb3BUYXJnZXRFbCk7XG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coJ2hhbmRsZURyb3AgY29tcGxldGUnKTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBFcnJvciBpbiBoYW5kbGVEcm9wOiAke2Vycm9yfWApO1xuXHR9XG59XG5cbmZ1bmN0aW9uIG1ha2VQYWxldHRlQm94KGNvbG9yOiBDb2xvciwgcGFsZXR0ZUJveENvdW50OiBudW1iZXIpOiBNYWtlUGFsZXR0ZUJveCB7XG5cdHRyeSB7XG5cdFx0aWYgKCFjb3JlLnZhbGlkYXRlQ29sb3JWYWx1ZXMoY29sb3IpKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKFxuXHRcdFx0XHRgSW52YWxpZCAke2NvbG9yLmZvcm1hdH0gY29sb3IgdmFsdWUgJHtKU09OLnN0cmluZ2lmeShjb2xvcil9YFxuXHRcdFx0KTtcblxuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0Y29sb3JTdHJpcGU6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuXHRcdFx0XHRwYWxldHRlQm94Q291bnRcblx0XHRcdH07XG5cdFx0fVxuXG5cdFx0Y29uc3QgY2xvbmVkQ29sb3IgPSBjb3JlLmNsb25lKGNvbG9yKTtcblxuXHRcdGNvbnN0IHBhbGV0dGVCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRwYWxldHRlQm94LmNsYXNzTmFtZSA9ICdwYWxldHRlLWJveCc7XG5cdFx0cGFsZXR0ZUJveC5pZCA9IGBwYWxldHRlLWJveC0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXG5cdFx0Y29uc3QgcGFsZXR0ZUJveFRvcEhhbGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRwYWxldHRlQm94VG9wSGFsZi5jbGFzc05hbWUgPSAncGFsZXR0ZS1ib3gtaGFsZiBwYWxldHRlLWJveC10b3AtaGFsZic7XG5cdFx0cGFsZXR0ZUJveFRvcEhhbGYuaWQgPSBgcGFsZXR0ZS1ib3gtdG9wLWhhbGYtJHtwYWxldHRlQm94Q291bnR9YDtcblxuXHRcdGNvbnN0IGNvbG9yVGV4dE91dHB1dEJveCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXG5cdFx0XHQnaW5wdXQnXG5cdFx0KSBhcyBDb2xvcklucHV0RWxlbWVudDtcblx0XHRjb2xvclRleHRPdXRwdXRCb3gudHlwZSA9ICd0ZXh0Jztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guY2xhc3NOYW1lID0gJ2NvbG9yLXRleHQtb3V0cHV0LWJveCB0b29sdGlwJztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guaWQgPSBgY29sb3ItdGV4dC1vdXRwdXQtYm94LSR7cGFsZXR0ZUJveENvdW50fWA7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnNldEF0dHJpYnV0ZSgnZGF0YS1mb3JtYXQnLCAnaGV4Jyk7XG5cblx0XHRjb25zdCBjb2xvclN0cmluZyA9IGNvcmUuZ2V0Q1NTQ29sb3JTdHJpbmcoY2xvbmVkQ29sb3IpO1xuXG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnZhbHVlID0gY29sb3JTdHJpbmcgfHwgJyc7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LmNvbG9yVmFsdWVzID0gY2xvbmVkQ29sb3I7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnJlYWRPbmx5ID0gZmFsc2U7XG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LnN0eWxlLmN1cnNvciA9ICd0ZXh0Jztcblx0XHRjb2xvclRleHRPdXRwdXRCb3guc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJztcblxuXHRcdGNvbnN0IGNvcHlCdXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcblx0XHRjb3B5QnV0dG9uLmNsYXNzTmFtZSA9ICdjb3B5LWJ1dHRvbic7XG5cdFx0Y29weUJ1dHRvbi50ZXh0Q29udGVudCA9ICdDb3B5JztcblxuXHRcdGNvbnN0IHRvb2x0aXBUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xuXHRcdHRvb2x0aXBUZXh0LmNsYXNzTmFtZSA9ICd0b29sdGlwdGV4dCc7XG5cdFx0dG9vbHRpcFRleHQudGV4dENvbnRlbnQgPSAnQ29waWVkIHRvIGNsaXBib2FyZCEnO1xuXG5cdFx0Y29weUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpID0+IHtcblx0XHRcdHRyeSB7XG5cdFx0XHRcdGF3YWl0IG5hdmlnYXRvci5jbGlwYm9hcmQud3JpdGVUZXh0KGNvbG9yVGV4dE91dHB1dEJveC52YWx1ZSk7XG5cdFx0XHRcdHNob3dUb29sdGlwKGNvbG9yVGV4dE91dHB1dEJveCk7XG5cblx0XHRcdFx0Y2xlYXJUaW1lb3V0KGNvbmZpZy5jb25zdHMudGltZW91dHMudG9vbHRpcCB8fCAxMDAwKTtcblxuXHRcdFx0XHRjb3B5QnV0dG9uLnRleHRDb250ZW50ID0gJ0NvcGllZCEnO1xuXHRcdFx0XHRzZXRUaW1lb3V0KFxuXHRcdFx0XHRcdCgpID0+IChjb3B5QnV0dG9uLnRleHRDb250ZW50ID0gJ0NvcHknKSxcblx0XHRcdFx0XHRjb25maWcuY29uc3RzLnRpbWVvdXRzLmNvcHlCdXR0b25UZXh0IHx8IDEwMDBcblx0XHRcdFx0KTtcblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBjb3B5OiAke2Vycm9yfWApO1xuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0Y29sb3JUZXh0T3V0cHV0Qm94LmFkZEV2ZW50TGlzdGVuZXIoXG5cdFx0XHQnaW5wdXQnLFxuXHRcdFx0Y29yZS5kZWJvdW5jZSgoZTogRXZlbnQpID0+IHtcblx0XHRcdFx0Y29uc3QgdGFyZ2V0ID0gZS50YXJnZXQgYXMgSFRNTElucHV0RWxlbWVudCB8IG51bGw7XG5cdFx0XHRcdGlmICh0YXJnZXQpIHtcblx0XHRcdFx0XHRjb25zdCBjc3NDb2xvciA9IHRhcmdldC52YWx1ZS50cmltKCk7XG5cdFx0XHRcdFx0Y29uc3QgYm94RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFxuXHRcdFx0XHRcdFx0YGNvbG9yLWJveC0ke3BhbGV0dGVCb3hDb3VudH1gXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHRjb25zdCBzdHJpcGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXG5cdFx0XHRcdFx0XHRgY29sb3Itc3RyaXBlLSR7cGFsZXR0ZUJveENvdW50fWBcblx0XHRcdFx0XHQpO1xuXG5cdFx0XHRcdFx0aWYgKGJveEVsZW1lbnQpIGJveEVsZW1lbnQuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY3NzQ29sb3I7XG5cdFx0XHRcdFx0aWYgKHN0cmlwZUVsZW1lbnQpXG5cdFx0XHRcdFx0XHRzdHJpcGVFbGVtZW50LnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNzc0NvbG9yO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCBjb25maWcuY29uc3RzLmRlYm91bmNlLmlucHV0IHx8IDIwMClcblx0XHQpO1xuXG5cdFx0cGFsZXR0ZUJveFRvcEhhbGYuYXBwZW5kQ2hpbGQoY29sb3JUZXh0T3V0cHV0Qm94KTtcblx0XHRwYWxldHRlQm94VG9wSGFsZi5hcHBlbmRDaGlsZChjb3B5QnV0dG9uKTtcblxuXHRcdGNvbnN0IHBhbGV0dGVCb3hCb3R0b21IYWxmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0cGFsZXR0ZUJveEJvdHRvbUhhbGYuY2xhc3NOYW1lID1cblx0XHRcdCdwYWxldHRlLWJveC1oYWxmIHBhbGV0dGUtYm94LWJvdHRvbS1oYWxmJztcblx0XHRwYWxldHRlQm94Qm90dG9tSGFsZi5pZCA9IGBwYWxldHRlLWJveC1ib3R0b20taGFsZi0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXG5cdFx0Y29uc3QgY29sb3JCb3ggPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRjb2xvckJveC5jbGFzc05hbWUgPSAnY29sb3ItYm94Jztcblx0XHRjb2xvckJveC5pZCA9IGBjb2xvci1ib3gtJHtwYWxldHRlQm94Q291bnR9YDtcblx0XHRjb2xvckJveC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvclN0cmluZyB8fCAnI2ZmZmZmZic7XG5cblx0XHRwYWxldHRlQm94Qm90dG9tSGFsZi5hcHBlbmRDaGlsZChjb2xvckJveCk7XG5cdFx0cGFsZXR0ZUJveC5hcHBlbmRDaGlsZChwYWxldHRlQm94VG9wSGFsZik7XG5cdFx0cGFsZXR0ZUJveC5hcHBlbmRDaGlsZChwYWxldHRlQm94Qm90dG9tSGFsZik7XG5cblx0XHRjb25zdCBjb2xvclN0cmlwZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdGNvbG9yU3RyaXBlLmNsYXNzTmFtZSA9ICdjb2xvci1zdHJpcGUnO1xuXHRcdGNvbG9yU3RyaXBlLmlkID0gYGNvbG9yLXN0cmlwZS0ke3BhbGV0dGVCb3hDb3VudH1gO1xuXHRcdGNvbG9yU3RyaXBlLnN0eWxlLmJhY2tncm91bmRDb2xvciA9IGNvbG9yU3RyaW5nIHx8ICcjZmZmZmZmJztcblxuXHRcdGNvbG9yU3RyaXBlLnNldEF0dHJpYnV0ZSgnZHJhZ2dhYmxlJywgJ3RydWUnKTtcblxuXHRcdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzKGNvbG9yU3RyaXBlKTtcblxuXHRcdGNvbG9yU3RyaXBlLmFwcGVuZENoaWxkKHBhbGV0dGVCb3gpO1xuXG5cdFx0cmV0dXJuIHtcblx0XHRcdGNvbG9yU3RyaXBlLFxuXHRcdFx0cGFsZXR0ZUJveENvdW50OiBwYWxldHRlQm94Q291bnQgKyAxXG5cdFx0fTtcblx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZXhlY3V0ZSBtYWtlUGFsZXR0ZUJveDogJHtlcnJvcn1gKTtcblx0XHRyZXR1cm4ge1xuXHRcdFx0Y29sb3JTdHJpcGU6IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLFxuXHRcdFx0cGFsZXR0ZUJveENvdW50XG5cdFx0fTtcblx0fVxufVxuXG5mdW5jdGlvbiBzaG93VG9hc3QobWVzc2FnZTogc3RyaW5nKTogdm9pZCB7XG5cdGNvbnN0IHRvYXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cblx0dG9hc3QuY2xhc3NOYW1lID0gJ3RvYXN0LW1lc3NhZ2UnO1xuXG5cdHRvYXN0LnRleHRDb250ZW50ID0gbWVzc2FnZTtcblxuXHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRvYXN0KTtcblxuXHRzZXRUaW1lb3V0KCgpID0+IHtcblx0XHR0b2FzdC5jbGFzc0xpc3QuYWRkKCdmYWRlLW91dCcpO1xuXHRcdHRvYXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3RyYW5zaXRpb25lZCcsICgpID0+IHRvYXN0LnJlbW92ZSgpKTtcblx0fSwgdGltZW91dHMudG9hc3QgfHwgMzAwMCk7XG59XG5cbmZ1bmN0aW9uIHNob3dUb29sdGlwKHRvb2x0aXBFbGVtZW50OiBIVE1MRWxlbWVudCk6IHZvaWQge1xuXHR0cnkge1xuXHRcdGNvbnN0IHRvb2x0aXAgPVxuXHRcdFx0dG9vbHRpcEVsZW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MRWxlbWVudD4oJy50b29sdGlwdGV4dCcpO1xuXG5cdFx0aWYgKHRvb2x0aXApIHtcblx0XHRcdHRvb2x0aXAuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcblx0XHRcdHRvb2x0aXAuc3R5bGUub3BhY2l0eSA9ICcxJztcblx0XHRcdHNldFRpbWVvdXQoKCkgPT4ge1xuXHRcdFx0XHR0b29sdGlwLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJztcblx0XHRcdFx0dG9vbHRpcC5zdHlsZS5vcGFjaXR5ID0gJzAnO1xuXHRcdFx0fSwgY29uZmlnLmNvbnN0cy50aW1lb3V0cy50b29sdGlwIHx8IDEwMDApO1xuXHRcdH1cblxuXHRcdGNvbnNvbGUubG9nKCdzaG93VG9vbHRpcCBleGVjdXRlZCcpO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBleGVjdXRlIHNob3dUb29sdGlwOiAke2Vycm9yfWApO1xuXHR9XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQW5kQ29udmVydENvbG9yKFxuXHRjb2xvcjogQ29sb3IgfCBDb2xvclN0cmluZyB8IG51bGxcbik6IENvbG9yIHwgbnVsbCB7XG5cdGlmICghY29sb3IpIHJldHVybiBudWxsO1xuXG5cdGNvbnN0IGNvbnZlcnRlZENvbG9yID0gY29yZS5pc0NvbG9yU3RyaW5nKGNvbG9yKVxuXHRcdD8gY29yZS5jb2xvclN0cmluZ1RvQ29sb3IoY29sb3IpXG5cdFx0OiBjb2xvcjtcblxuXHRpZiAoIWNvcmUudmFsaWRhdGVDb2xvclZhbHVlcyhjb252ZXJ0ZWRDb2xvcikpIHtcblx0XHRjb25zb2xlLmVycm9yKGBJbnZhbGlkIGNvbG9yOiAke0pTT04uc3RyaW5naWZ5KGNvbnZlcnRlZENvbG9yKX1gKTtcblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0cmV0dXJuIGNvbnZlcnRlZENvbG9yO1xufVxuXG5jb25zdCBoYW5kbGUgPSB7XG5cdGRyYWdTdGFydCxcblx0ZHJhZ092ZXIsXG5cdGRyYWdFbmQsXG5cdGRyb3Bcbn07XG5cbmV4cG9ydCBjb25zdCBkb20gPSB7XG5cdGF0dGFjaERyYWdBbmREcm9wTGlzdGVuZXJzLFxuXHRoYW5kbGUsXG5cdG1ha2VQYWxldHRlQm94LFxuXHRzaG93VG9hc3QsXG5cdHNob3dUb29sdGlwLFxuXHR2YWxpZGF0ZUFuZENvbnZlcnRDb2xvclxufTtcbiJdfQ==